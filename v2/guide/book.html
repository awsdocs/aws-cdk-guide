<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="keywords" content="CDK, AWS CDK, AWS Cloud Development Kit">
<title>AWS Cloud Development Kit (AWS CDK) v2</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="top" class="book toc2 toc-left">
<div id="header">
<h1>AWS Cloud Development Kit (AWS CDK) v2</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#home">1. What is the AWS CDK?</a>
<ul class="sectlevel2">
<li><a href="#home-benefits">Benefits of the AWS CDK</a></li>
<li><a href="#home-example">1.1. Example of the AWS CDK</a></li>
<li><a href="#home-features">1.2. AWS CDK features</a></li>
<li><a href="#home-next">1.3. Next steps</a></li>
<li><a href="#home-learn">1.4. Learn more</a></li>
</ul>
</li>
<li><a href="#core-concepts">2. Learn AWS CDK core concepts</a>
<ul class="sectlevel2">
<li><a href="#concepts-iac">2.1. AWS CDK and <code class="noloc">IaC</code></a></li>
<li><a href="#concepts-cfn">2.2. AWS CDK and AWS CloudFormation</a></li>
<li><a href="#concepts-abstractions">2.3. AWS CDK and abstractions</a></li>
<li><a href="#concepts-learn">2.4. Learn more about core AWS CDK concepts</a></li>
<li><a href="#languages">2.5. Supported programming languages for the AWS CDK</a></li>
<li><a href="#libraries">2.6. The AWS CDK libraries</a></li>
<li><a href="#projects">2.7. AWS CDK projects</a></li>
<li><a href="#apps">2.8. AWS CDK apps</a></li>
<li><a href="#stacks">2.9. Introduction to AWS CDK stacks</a></li>
<li><a href="#stages">2.10. Introduction to AWS CDK stages</a></li>
<li><a href="#constructs">2.11. AWS CDK Constructs</a></li>
<li><a href="#environments">2.12. Environments for the AWS CDK</a></li>
<li><a href="#bootstrapping">2.13. AWS CDK bootstrapping</a></li>
<li><a href="#resources">2.14. Resources and the AWS CDK</a></li>
<li><a href="#identifiers">2.15. Identifiers and the AWS CDK</a></li>
<li><a href="#tokens">2.16. Tokens and the AWS CDK</a></li>
<li><a href="#parameters">2.17. Parameters and the AWS CDK</a></li>
<li><a href="#tagging">2.18. Tags and the AWS CDK</a></li>
<li><a href="#assets">2.19. Assets and the AWS CDK</a></li>
<li><a href="#permissions">2.20. Permissions and the AWS CDK</a></li>
<li><a href="#context">2.21. Context values and the AWS CDK</a></li>
<li><a href="#featureflags">2.22. AWS CDK feature flags</a></li>
<li><a href="#aspects">2.23. Aspects and the AWS CDK</a></li>
</ul>
</li>
<li><a href="#prerequisites">3. AWS CDK prerequisites</a>
<ul class="sectlevel2">
<li><a href="#prerequisites-account">3.1. Set up your AWS account</a></li>
<li><a href="#prerequisites-cli">3.2. Install and configure the AWS CLI</a></li>
<li><a href="#prerequisites-node">3.3. Install <code class="noloc">Node.js</code> and programming language prerequisites</a></li>
<li><a href="#prerequisites-next">3.4. Next steps</a></li>
</ul>
</li>
<li><a href="#getting-started">4. Getting started with the AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#getting-started-prerequisites">4.1. Prerequisites</a></li>
<li><a href="#getting-started-install">4.2. Install the AWS CDK <code class="noloc">CLI</code></a></li>
<li><a href="#getting-started-configure">4.3. Configure the AWS CDK <code class="noloc">CLI</code></a></li>
<li><a href="#getting-started-tools">4.4. (Optional) Install additional AWS CDK tools</a></li>
<li><a href="#getting-started-app">4.5. Create your first CDK app</a></li>
<li><a href="#hello-world">4.6. Tutorial: Create your first AWS CDK app</a></li>
</ul>
</li>
<li><a href="#work-with">5. Work with the AWS CDK library</a>
<ul class="sectlevel2">
<li><a href="#work-with-library">5.1. Import the AWS CDK Library</a></li>
<li><a href="#work-with-library-reference">5.2. Using the AWS CDK API Reference</a></li>
<li><a href="#work-with-cdk-dependencies">5.3. Managing dependencies</a></li>
<li><a href="#work-with-cdk-compare">5.4. Comparing AWS CDK in  <code class="noloc">TypeScript</code> with other languages</a></li>
<li><a href="#work-with-cdk-typescript">5.5. Working with the AWS CDK in TypeScript</a></li>
<li><a href="#work-with-cdk-javascript">5.6. Working with the AWS CDK in JavaScript</a></li>
<li><a href="#work-with-cdk-python">5.7. Working with the AWS CDK in Python</a></li>
<li><a href="#work-with-cdk-java">5.8. Working with the AWS CDK in Java</a></li>
<li><a href="#work-with-cdk-csharp">5.9. Working with the AWS CDK in C#</a></li>
<li><a href="#work-with-cdk-go">5.10. Working with the AWS CDK in Go</a></li>
</ul>
</li>
<li><a href="#best-practices">6. Best practices for developing and deploying cloud infrastructure with the AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#best-practices-organization">6.1. Organization best practices</a></li>
<li><a href="#best-practices-code">6.2. Coding best practices</a></li>
<li><a href="#best-practices-constructs">6.3. Construct best practices</a></li>
<li><a href="#best-practices-apps">6.4. Application best practices</a></li>
<li><a href="#best-practices-security">6.5. AWS CDK security best practices</a></li>
</ul>
</li>
<li><a href="#migrating-v2">7. Migrating from AWS CDK v1 to AWS CDK v2</a>
<ul class="sectlevel2">
<li><a href="#migrating-v2-prerequisites">7.1. New prerequisites</a></li>
<li><a href="#migrating-v2-dp-upgrade">7.2. Upgrading from AWS CDK v2 Developer Preview</a></li>
<li><a href="#migrating-v2-v1-uppgrade">7.3. Migrating from AWS CDK v1 to CDK v2</a></li>
<li><a href="#migrating-v2-diff.title">7.4. Testing your migrated app before deploying</a></li>
<li><a href="#migrating-v2-trouble.title">7.5. Troubleshooting</a></li>
<li><a href="#finding-v1-stacks.title">7.6. Finding v1 stacks</a></li>
</ul>
</li>
<li><a href="#migrate">8. Migrate existing resources and AWS CloudFormation templates to the AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#migrate-intro">8.1. How migration works</a></li>
<li><a href="#migrate-benefits">8.2. Benefits of CDK Migrate</a></li>
<li><a href="#migrate-considerations">8.3. Considerations</a></li>
<li><a href="#migrate-prerequisites">8.4. Prerequisites</a></li>
<li><a href="#migrate-gs">8.5. Get started with CDK Migrate</a></li>
<li><a href="#migrate-stack">8.6. Migrate from an AWS CloudFormation stack</a></li>
<li><a href="#migrate-template">8.7. Migrate from an AWS CloudFormation template</a></li>
<li><a href="#migrate-resources">8.8. Migrate from deployed resources</a></li>
<li><a href="#migrate-manage">8.9. Manage and deploy your CDK app</a></li>
</ul>
</li>
<li><a href="#configure-access">9. Configure security credentials for the AWS CDK <code class="noloc">CLI</code></a>
<ul class="sectlevel2">
<li><a href="#configure-access-prerequisites">9.1. Prerequisites</a></li>
<li><a href="#configure-access-how">9.2. How to configure security credentials</a></li>
<li><a href="#configure-access-sso">9.3. Configure and manage security credentials for IAM Identity Center users</a></li>
<li><a href="#configure-access-iam">9.4. Configure and manage security credentials for IAM users</a></li>
<li><a href="#configure-access-info">9.5. Additional information</a></li>
<li><a href="#configure-access-sso-example-cli">9.6. Example: Authenticate with IAM Identity Center automatic token refresh for use with the AWS CDK <code class="noloc">CLI</code></a></li>
</ul>
</li>
<li><a href="#configure-env">10. Configure environments to use with the AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#configure-env-where">10.1. Where you can specify environments from</a></li>
<li><a href="#configure-env-precedence">10.2. Environment precedence with the AWS CDK</a></li>
<li><a href="#configure-env-when">10.3. When to specify environments</a></li>
<li><a href="#configure-env-how">10.4. How to specify environments with the AWS CDK</a></li>
<li><a href="#configure-env-considerations">10.5. Considerations when configuring environments with the AWS CDK</a></li>
<li><a href="#configure-env-examples">10.6. Examples</a></li>
</ul>
</li>
<li><a href="#bootstrapping-env">11. Bootstrap your environment for use with the AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#bootstrapping-howto">11.1. How to bootstrap your environment</a></li>
<li><a href="#bootstrapping-env-when">11.2. When to bootstrap your environment</a></li>
<li><a href="#bootstrapping-env-default">11.3. Default resources created during bootstrapping</a></li>
<li><a href="#bootstrapping-env-permissions">11.4. Permissions to use when bootstrapping your environment</a></li>
<li><a href="#bootstrapping-env-customize">11.5. Customize bootstrapping</a></li>
<li><a href="#bootstrapping-env-pipelines">11.6. Bootstrapping with CDK Pipelines</a></li>
<li><a href="#bootstrap-template-history">11.7. Bootstrap template version history</a></li>
<li><a href="#bootstrapping-template">11.8. Upgrade from legacy to modern bootstrap template</a></li>
<li><a href="#bootstrapping-securityhub">11.9. Address Security Hub Findings</a></li>
<li><a href="#bootstrapping-env-considerations">11.10. Considerations</a></li>
<li><a href="#bootstrapping-customizing">11.11. Customize AWS CDK bootstrapping</a></li>
<li><a href="#customize-permissions-boundaries">11.12. Create and apply permissions boundaries for the AWS CDK</a></li>
<li><a href="#bootstrapping-troubleshoot">11.13. Troubleshoot AWS CDK bootstrapping issues</a></li>
</ul>
</li>
<li><a href="#develop">12. Develop AWS CDK applications</a>
<ul class="sectlevel2">
<li><a href="#develop-prerequisites">12.1. Prerequisites</a></li>
<li><a href="#develop-overview">12.2. Developing AWS CDK applications overview</a></li>
<li><a href="#develop-gs">12.3. Get started with developing CDK applications</a></li>
<li><a href="#develop-library">12.4. Import and use the AWS CDK Library</a></li>
<li><a href="#develop-next">12.5. Next steps</a></li>
<li><a href="#usage-data">12.6. Configure AWS CDK usage data reporting</a></li>
<li><a href="#cfn-layer">12.7. Customize constructs from the AWS Construct Library</a></li>
<li><a href="#get-env-var">12.8. Get a value from an environment variable</a></li>
<li><a href="#get-cfn-param">12.9. Use CloudFormation parameters to get a CloudFormation value</a></li>
<li><a href="#use-cfn-template">12.10. Import an existing AWS CloudFormation template</a></li>
<li><a href="#get-ssm-value">12.11. Get a value from the Systems Manager Parameter Store</a></li>
<li><a href="#get-secrets-manager-value">12.12. Get a value from AWS Secrets Manager</a></li>
<li><a href="#how-to-set-cw-alarm">12.13. Set a CloudWatch alarm</a></li>
<li><a href="#get-context-var">12.14. Save and retrieve context variable values</a></li>
<li><a href="#use-cfn-public-registry">12.15. Use resources from the AWS CloudFormation Public Registry</a></li>
<li><a href="#define-iam-l2">12.16. Define permissions for L2 constructs with the AWS CDK</a></li>
</ul>
</li>
<li><a href="#configure-synth">13. Configure and perform CDK stack synthesis</a>
<ul class="sectlevel2">
<li><a href="#configure-synth-bootstrap">13.1. How synthesis and bootstrapping work together</a></li>
<li><a href="#bootstrapping-synthesizers">13.2. How to configure CDK stack synthesis</a></li>
<li><a href="#configure-synth-stack">13.3. How to synthesize a CDK stack</a></li>
<li><a href="#how-synth-default">13.4. How synthesis works by default</a></li>
<li><a href="#bootstrapping-custom-synth">13.5. Customize CDK stack synthesis</a></li>
</ul>
</li>
<li><a href="#deploy">14. Deploy AWS CDK applications</a>
<ul class="sectlevel2">
<li><a href="#deploy-how">14.1. How AWS CDK deployments work</a></li>
<li><a href="#deploy-prerequisites">14.2. Prerequisites for CDK deployments</a></li>
<li><a href="#deploy-how-synth">14.3. CDK app synthesis</a></li>
<li><a href="#deploy-how-deploy">14.4. Deploy your application</a></li>
<li><a href="#policy-validation-synthesis">14.5. AWS CDK policy validation at synthesis time</a></li>
<li><a href="#cdk-pipeline">14.6. Continuous integration and delivery (CI/CD) using CDK Pipelines</a></li>
<li><a href="#build-containers">14.7. Build and deploy container image assets in CDK apps</a></li>
<li><a href="#deploy-troubleshoot">14.8. Troubleshoot AWS CDK deployments</a></li>
</ul>
</li>
<li><a href="#toolkit-library">15. Perform programmatic actions using the CDK Toolkit Library</a>
<ul class="sectlevel2">
<li><a href="#toolkit-library-intro">15.1. What is the CDK Toolkit Library Library?</a></li>
<li><a href="#toolkit-library-gs">15.2. Get started with the CDK Toolkit Library</a></li>
</ul>
</li>
<li><a href="#testing">16. Test AWS CDK applications</a>
<ul class="sectlevel2">
<li><a href="#testing-locally">16.1. Locally test and build AWS CDK applications with the AWS SAM <code class="noloc">CLI</code></a></li>
<li><a href="#testing-getting-started">16.2. Getting started</a></li>
<li><a href="#testing-app">16.3. The example stack</a></li>
<li><a href="#testing-lambda">16.4. The Lambda function</a></li>
<li><a href="#testing-running-tests">16.5. Running tests</a></li>
<li><a href="#testing-fine-grained">16.6. Fine-grained assertions</a></li>
<li><a href="#testing-snapshot">16.7. Snapshot tests</a></li>
<li><a href="#testing-tips">16.8. Tips for tests</a></li>
</ul>
</li>
<li><a href="#cli">17. AWS CDK <code class="noloc">CLI</code> reference</a>
<ul class="sectlevel2">
<li><a href="#cli-commands">17.1. CDK <code class="noloc">CLI</code> commands</a></li>
<li><a href="#cli-options">17.2. Specify options and their values</a></li>
<li><a href="#cli-help">17.3. Built-in help</a></li>
<li><a href="#version-reporting">17.4. Version reporting</a></li>
<li><a href="#cli-auth">17.5. Authentication with AWS</a></li>
<li><a href="#cli-environment">17.6. Specify Region and other configuration</a></li>
<li><a href="#cli-app-command">17.7. Specify the app command</a></li>
<li><a href="#cli-stacks">17.8. Specify stacks</a></li>
<li><a href="#cli-bootstrap">17.9. Bootstrap your AWS environment</a></li>
<li><a href="#cli-init">17.10. Create a new app</a></li>
<li><a href="#cli-list">17.11. List stacks</a></li>
<li><a href="#cli-synth">17.12. Synthesize stacks</a></li>
<li><a href="#cli-deploy">17.13. Deploy stacks</a></li>
<li><a href="#cli-diff">17.14. Compare stacks</a></li>
<li><a href="#cli-import">17.15. Import existing resources into a stack</a></li>
<li><a href="#cli-config">17.16. Configuration (<code class="path">cdk.json</code>)</a></li>
</ul>
</li>
<li><a href="#ref-cli-cmd">18. AWS CDK <code class="noloc">CLI</code> command reference</a>
<ul class="sectlevel2">
<li><a href="#ref-cli-cmd-usage">18.1. Usage</a></li>
<li><a href="#ref-cli-cmd-commands">18.2. Commands</a></li>
<li><a href="#ref-cli-cmd-options">18.3. Global options</a></li>
<li><a href="#ref-cli-cmd-configure">18.4. Providing and configuring options</a></li>
<li><a href="#ref-cli-cmd-pass">18.5. Passing options at the command line</a></li>
<li><a href="#ref-cli-cmd-ack">18.6. <code class="noloc">cdk acknowledge</code></a></li>
<li><a href="#ref-cli-cmd-bootstrap">18.7. <code class="noloc">cdk bootstrap</code></a></li>
<li><a href="#ref-cli-cmd-context">18.8. <code class="noloc">cdk context</code></a></li>
<li><a href="#ref-cli-cmd-deploy">18.9. <code class="noloc">cdk deploy</code></a></li>
<li><a href="#ref-cli-cmd-destroy">18.10. <code class="noloc">cdk destroy</code></a></li>
<li><a href="#ref-cli-cmd-diff">18.11. <code class="noloc">cdk diff</code></a></li>
<li><a href="#ref-cli-cmd-docs">18.12. <code class="noloc">cdk docs</code></a></li>
<li><a href="#ref-cli-cmd-doctor">18.13. <code class="noloc">cdk doctor</code></a></li>
<li><a href="#ref-cli-cmd-gc">18.14. <code class="noloc">cdk gc</code></a></li>
<li><a href="#ref-cli-cmd-import">18.15. <code class="noloc">cdk import</code></a></li>
<li><a href="#ref-cli-cmd-init">18.16. <code class="noloc">cdk init</code></a></li>
<li><a href="#ref-cli-cmd-list">18.17. <code class="noloc">cdk list</code></a></li>
<li><a href="#ref-cli-cmd-metadata">18.18. <code class="noloc">cdk metadata</code></a></li>
<li><a href="#ref-cli-cdk-migrate">18.19. <code class="noloc">cdk migrate</code></a></li>
<li><a href="#ref-cli-cmd-notices">18.20. <code class="noloc">cdk notices</code></a></li>
<li><a href="#ref-cli-cmd-rollback">18.21. <code class="noloc">cdk rollback</code></a></li>
<li><a href="#ref-cli-cmd-synth">18.22. <code class="noloc">cdk synthesize</code></a></li>
<li><a href="#ref-cli-cmd-watch">18.23. <code class="noloc">cdk watch</code></a></li>
</ul>
</li>
<li><a href="#reference">19. AWS CDK reference</a>
<ul class="sectlevel2">
<li><a href="#reference-api">19.1. API reference</a></li>
<li><a href="#versioning">19.2. AWS CDK versioning</a></li>
<li><a href="#videos">19.3. AWS CDK video resources</a></li>
</ul>
</li>
<li><a href="#how-tos">20. AWS CDK tutorials and examples</a>
<ul class="sectlevel2">
<li><a href="#serverless-example">20.1. Tutorial: Create a serverless Hello World application</a></li>
<li><a href="#stack-how-to-create-multiple-stacks">20.2. Example: Create a CDK app with multiple stacks</a></li>
<li><a href="#ecs-example">20.3. Example: Create an AWS Fargate service using the AWS CDK</a></li>
</ul>
</li>
<li><a href="#tools">21. Use other tools with the AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#vscode">21.1. AWS Toolkit for Visual Studio Code</a></li>
<li><a href="#sam">21.2. AWS SAM integration</a></li>
</ul>
</li>
<li><a href="#security">22. Security for the AWS Cloud Development Kit (AWS CDK)</a>
<ul class="sectlevel2">
<li><a href="#security-iam">22.1. Identity and access management for the AWS Cloud Development Kit (AWS CDK)</a></li>
<li><a href="#compliance-validation">22.2. Compliance validation for the AWS Cloud Development Kit (AWS CDK)</a></li>
<li><a href="#disaster-recovery-resiliency">22.3. Resilience for the AWS Cloud Development Kit (AWS CDK)</a></li>
<li><a href="#infrastructure-security">22.4. Infrastructure security for the AWS Cloud Development Kit (AWS CDK)</a></li>
</ul>
</li>
<li><a href="#troubleshooting">23. Troubleshooting common AWS CDK issues</a></li>
<li><a href="#pgp-keys">24. OpenPGP keys for the AWS CDK and jsii</a>
<ul class="sectlevel2">
<li><a href="#pgp-keys-current">24.1. Current keys</a></li>
<li><a href="#pgp-keys-expired">24.2. Historical keys</a></li>
</ul>
</li>
<li><a href="#doc-history">25. AWS CDK Developer Guide history</a>
<ul class="sectlevel2">
<li><a href="#unknown-title">25.1. Unknown Title!</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Provides a conceptual overview and practical examples to help you understand the features provided by the AWS CDK and how to use them.</p>
</div>
</blockquote>
</div>
<div class="paragraph banner info">
<p>This is the AWS CDK v2 Developer Guide. The older CDK v1 entered maintenance on June 1, 2022 and ended support on June 1, 2023.</p>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="home">1. What is the AWS CDK?</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) is an open-source software development framework for defining cloud infrastructure in code and provisioning it through AWS CloudFormation.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) is an open-source software development framework for defining cloud infrastructure in code and provisioning it through AWS CloudFormation.</p>
</div>
<div class="paragraph">
<p>The AWS CDK consists of two primary parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><a href="#constructs">AWS CDK Construct Library</a></strong> – A collection of pre-written modular and reusable pieces of code, called constructs, that you can use, modify, and integrate to develop your infrastructure quickly. The goal of the AWS CDK Construct Library is to reduce the complexity required to define and integrate AWS services together when building applications on AWS.</p>
</li>
<li>
<p><strong><a href="#cli">AWS CDK Command Line Interface (AWS CDK CLI)</a></strong> – A command line tool for interacting with CDK apps. Use the CDK <code class="noloc">CLI</code> to create, manage, and deploy your AWS CDK projects. The CDK  <code class="noloc">CLI</code> is also referred to as the CDK Toolkit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The AWS CDK supports  <code class="noloc">TypeScript</code>,  <code class="noloc">JavaScript</code>,  <code class="noloc">Python</code>,  <code class="noloc">Java</code>,  <code class="noloc">C#/.Net</code>, and  <code class="noloc">Go</code>. You can use any of these supported programming languages to define reusable cloud components known as  <a href="#constructs">constructs</a>. You compose these together into <a href="#stacks">stacks</a> and <a href="#apps">apps</a>. Then, you deploy your CDK applications to AWS CloudFormation to provision or update your resources.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/AppStacks.png" alt="AWS CDK app structure with stacks, constructs, and deployment to CloudFormation.">
</div>
</div>
<div class="sect2">
<h3 id="home-benefits">Benefits of the AWS CDK</h3>
<div class="paragraph">
<p>Use the AWS CDK to develop reliable, scalable, cost-effective applications in the cloud with the considerable expressive power of a programming language. This approach yields many benefits, including:</p>
</div>
<div id="home-benefits-iac" class="dlist">
<dl>
<dt class="hdlist1">Develop and manage your infrastructure as code (IaC)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Practice <em>infrastructure as code</em> to create, deploy, and maintain infrastructure in a programmatic, descriptive, and declarative way. With IaC, you treat infrastructure the same way developers treat code. This results in a scalable and structured approach to managing infrastructure. To learn more about IaC, see <a href="https://docs.aws.amazon.com/whitepapers/latest/introduction-devops-aws/infrastructure-as-code.html">Infrastructure as code</a> in the <em>Introduction to DevOps on AWS Whitepaper</em>.</p>
<div class="paragraph">
<p>With the AWS CDK, you can put your infrastructure, application code, and configuration all in one place, ensuring that you have a complete, cloud-deployable system at every milestone. Employ software engineering best practices such as code reviews, unit tests, and source control to make your infrastructure more robust.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="home-benefits-languages" class="dlist">
<dl>
<dt class="hdlist1">Define your cloud infrastructure using general-purpose programming languages</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>With the AWS CDK, you can use any of the following programming languages to define your cloud infrastructure: <code class="noloc">TypeScript</code>,  <code class="noloc">JavaScript</code>,  <code class="noloc">Python</code>,  <code class="noloc">Java</code>,  <code class="noloc">C#/.Net</code>, and  <code class="noloc">Go</code>. Choose your preferred language and use programming elements like parameters, conditionals, loops, composition, and inheritance to define the desired outcome of your infrastructure.</p>
<div class="paragraph">
<p>Use the same programming language to define your infrastructure and your application logic.</p>
</div>
<div class="paragraph">
<p>Receive the benefits of developing infrastructure in your preferred IDE (Integrated Development Environment), such as syntax highlighting and intelligent code completion.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/CodeCompletion.png" alt="Code snippet showing AWS CDK setup for ECS cluster with VPC and Fargate service configuration.">
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="home-benefits-cfn" class="dlist">
<dl>
<dt class="hdlist1">Deploy infrastructure through AWS CloudFormation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>AWS CDK integrates with AWS CloudFormation to deploy and provision your infrastructure on AWS. AWS CloudFormation is a managed AWS service that offers extensive support of resource and property configurations for provisioning services on AWS. With AWS CloudFormation, you can perform infrastructure deployments predictably and repeatedly, with rollback on error. If you are already familiar with AWS CloudFormation, you don&#8217;t have to learn a new IaC management service when getting started with the AWS CDK.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="home-benefits-constructs" class="dlist">
<dl>
<dt class="hdlist1">Get started developing your application quickly with constructs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Develop faster by using and sharing reusable components called constructs. Use low-level constructs to define individual AWS CloudFormation resources and their properties. Use high-level constructs to quickly define larger components of your application, with sensible, secure defaults for your AWS resources, defining more infrastructure with less code.</p>
<div class="paragraph">
<p>Create your own constructs that are customized for your unique use cases and share them across your organization or even with the public.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="home-example">1.1. Example of the AWS CDK</h3>
<div class="paragraph">
<p>The following is an example of using the AWS CDK Constructs Library to create an Amazon Elastic Container Service (Amazon ECS) service with AWS Fargate launch type. For more details of this example, see  <a href="#ecs-example">Example: Create an AWS Fargate service using the AWS CDK</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export class MyEcsConstructStack extends Stack {
  constructor(scope: App, id: string, props?: StackProps) {
    super(scope, id, props);

    const vpc = new ec2.Vpc(this, "MyVpc", {
      maxAzs: 3 // Default is all AZs in region
    });

    const cluster = new ecs.Cluster(this, "MyCluster", {
      vpc: vpc
    });

    // Create a load-balanced Fargate service and make it public
    new ecs_patterns.ApplicationLoadBalancedFargateService(this, "MyFargateService", {
      cluster: cluster, // Required
      cpu: 512, // Default is 256
      desiredCount: 6, // Default is 1
      taskImageOptions: { image: ecs.ContainerImage.fromRegistry("amazon/amazon-ecs-sample") },
      memoryLimitMiB: 2048, // Default is 512
      publicLoadBalancer: true // Default is false
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class MyEcsConstructStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const vpc = new ec2.Vpc(this, "MyVpc", {
      maxAzs: 3 // Default is all AZs in region
    });

    const cluster = new ecs.Cluster(this, "MyCluster", {
      vpc: vpc
    });

    // Create a load-balanced Fargate service and make it public
    new ecs_patterns.ApplicationLoadBalancedFargateService(this, "MyFargateService", {
      cluster: cluster, // Required
      cpu: 512, // Default is 256
      desiredCount: 6, // Default is 1
      taskImageOptions: { image: ecs.ContainerImage.fromRegistry("amazon/amazon-ecs-sample") },
      memoryLimitMiB: 2048, // Default is 512
      publicLoadBalancer: true // Default is false
    });
  }
}

module.exports = { MyEcsConstructStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class MyEcsConstructStack(Stack):

    def __init__(self, scope: Construct, id: str, **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        vpc = ec2.Vpc(self, "MyVpc", max_azs=3)     # default is all AZs in region

        cluster = ecs.Cluster(self, "MyCluster", vpc=vpc)

        ecs_patterns.ApplicationLoadBalancedFargateService(self, "MyFargateService",
            cluster=cluster,            # Required
            cpu=512,                    # Default is 256
            desired_count=6,            # Default is 1
            task_image_options=ecs_patterns.ApplicationLoadBalancedTaskImageOptions(
                image=ecs.ContainerImage.from_registry("amazon/amazon-ecs-sample")),
            memory_limit_mib=2048,      # Default is 512
            public_load_balancer=True)  # Default is False</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyEcsConstructStack extends Stack {

    public MyEcsConstructStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyEcsConstructStack(final Construct scope, final String id,
            StackProps props) {
        super(scope, id, props);

        Vpc vpc = Vpc.Builder.create(this, "MyVpc").maxAzs(3).build();

        Cluster cluster = Cluster.Builder.create(this, "MyCluster")
                .vpc(vpc).build();

        ApplicationLoadBalancedFargateService.Builder.create(this, "MyFargateService")
                .cluster(cluster)
                .cpu(512)
                .desiredCount(6)
                .taskImageOptions(
                       ApplicationLoadBalancedTaskImageOptions.builder()
                               .image(ContainerImage
                                       .fromRegistry("amazon/amazon-ecs-sample"))
                               .build()).memoryLimitMiB(2048)
                .publicLoadBalancer(true).build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class MyEcsConstructStack : Stack
{
    public MyEcsConstructStack(Construct scope, string id, IStackProps props=null) : base(scope, id, props)
    {
        var vpc = new Vpc(this, "MyVpc", new VpcProps
        {
            MaxAzs = 3
        });

        var cluster = new Cluster(this, "MyCluster", new ClusterProps
        {
            Vpc = vpc
        });

        new ApplicationLoadBalancedFargateService(this, "MyFargateService",
            new ApplicationLoadBalancedFargateServiceProps
        {
            Cluster = cluster,
            Cpu = 512,
            DesiredCount = 6,
            TaskImageOptions = new ApplicationLoadBalancedTaskImageOptions
            {
                Image = ContainerImage.FromRegistry("amazon/amazon-ecs-sample")
            },
            MemoryLimitMiB = 2048,
            PublicLoadBalancer = true,
        });
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">func NewMyEcsConstructStack(scope constructs.Construct, id string, props *MyEcsConstructStackProps) awscdk.Stack {

	var sprops awscdk.StackProps

	if props != nil {
		sprops = props.StackProps
	}

	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	vpc := awsec2.NewVpc(stack, jsii.String("MyVpc"), &amp;awsec2.VpcProps{
		MaxAzs: jsii.Number(3), // Default is all AZs in region
	})

	cluster := awsecs.NewCluster(stack, jsii.String("MyCluster"), &amp;awsecs.ClusterProps{
		Vpc: vpc,
	})

	awsecspatterns.NewApplicationLoadBalancedFargateService(stack, jsii.String("MyFargateService"),
		&amp;awsecspatterns.ApplicationLoadBalancedFargateServiceProps{
			Cluster:        cluster,           // required
			Cpu:            jsii.Number(512),  // default is 256
			DesiredCount:   jsii.Number(5),    // default is 1
			MemoryLimitMiB: jsii.Number(2048), // Default is 512
			TaskImageOptions: &amp;awsecspatterns.ApplicationLoadBalancedTaskImageOptions{
				Image: awsecs.ContainerImage_FromRegistry(jsii.String("amazon/amazon-ecs-sample"), nil),
			},
			PublicLoadBalancer: jsii.Bool(true), // Default is false
		})

	return stack

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class produces an AWS CloudFormation  <a href="https://github.com/awsdocs/aws-cdk-guide/blob/main/doc_source/my_ecs_construct-stack.yaml">template of more than 500 lines</a>. Deploying the AWS CDK app produces more than 50 resources of the following types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-eip.html">AWS::EC2::EIP</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-internetgateway.html">AWS::EC2::InternetGateway</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-natgateway.html">AWS::EC2::NatGateway</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-route.html">AWS::EC2::Route</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-routetable.html">AWS::EC2::RouteTable</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-subnet.html">AWS::EC2::Subnet</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-subnet-route-table-assoc.html">AWS::EC2::SubnetRouteTableAssociation</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpc-gateway-attachment.html">AWS::EC2::VPCGatewayAttachment</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpc.html">AWS::EC2::VPC</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-cluster.html">AWS::ECS::Cluster</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html">AWS::ECS::Service</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html">AWS::ECS::TaskDefinition</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html">AWS::ElasticLoadBalancingV2::Listener</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-loadbalancer.html">AWS::ElasticLoadBalancingV2::LoadBalancer</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html">AWS::ElasticLoadBalancingV2::TargetGroup</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-policy.html">AWS::IAM::Policy</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html">AWS::IAM::Role</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-logs-loggroup.html">AWS::Logs::LogGroup</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="home-features">1.2. AWS CDK features</h3>
<div class="sect3">
<h4 id="home-features-repo">1.2.1. The AWS CDK <code class="noloc">GitHub</code> repository</h4>
<div class="paragraph">
<p>For the official AWS CDK  <code class="noloc">GitHub</code> repository, see  <a href="https://github.com/aws/aws-cdk">aws-cdk</a>. Here, you can submit <a href="https://github.com/aws/aws-cdk/issues">issues</a>, view our <a href="https://github.com/aws/aws-cdk/blob/main/LICENSE">license</a>, track <a href="https://github.com/aws/aws-cdk/releases">releases</a>, and more.</p>
</div>
<div class="paragraph">
<p>Because the AWS CDK is open-source, the team encourages you to contribute to make it an even better tool. For details, see <a href="https://github.com/aws/aws-cdk/blob/main/CONTRIBUTING.md">Contributing to the AWS Cloud Development Kit (AWS CDK)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="home-features-api">1.2.2. The AWS CDK API reference</h4>
<div class="paragraph">
<p>The AWS CDK Construct Library provides APIs to define your CDK application and add CDK constructs to the application. For more information, see the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">AWS CDK API Reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="home-features-cpm">1.2.3. The Construct Programming Model</h4>
<div class="paragraph">
<p>The Construct Programming Model (CPM) extends the concepts behind the AWS CDK into additional domains. Other tools using the CPM include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.terraform.io/docs/cdktf/index.html">CDK for Terraform</a> (CDKtf)</p>
</li>
<li>
<p><a href="https://cdk8s.io/">CDK for Kubernetes</a> (CDK8s)</p>
</li>
<li>
<p><a href="https://github.com/projen/projen">Projen</a>, for building project configurations</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="home-features-hub">1.2.4. The Construct Hub</h4>
<div class="paragraph">
<p>The  <a href="https://constructs.dev/">Construct Hub</a> is an online registry where you can find, publish, and share open-source AWS CDK libraries.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="home-next">1.3. Next steps</h3>
<div class="paragraph">
<p>To get started with using the AWS CDK, see  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="home-learn">1.4. Learn more</h3>
<div class="paragraph">
<p>To continue learning about the AWS CDK, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><a href="#core-concepts">Learn AWS CDK core concepts</a></strong> – Important concepts and terms for the AWS CDK.</p>
</li>
<li>
<p><strong><a href="https://cdkworkshop.com/">AWS CDK Workshop</a></strong> – Hands-on workshop to learn and use the AWS CDK.</p>
</li>
<li>
<p><strong><a href="https://cdkpatterns.com/">AWS CDK Patterns</a></strong> – Open-source collection of AWS serverless architecture patterns, built for the AWS CDK by AWS experts.</p>
</li>
<li>
<p><strong><a href="https://github.com/aws-samples/aws-cdk-examples">AWS CDK code examples</a></strong> – <code class="noloc">GitHub</code> repository of example AWS CDK projects.</p>
</li>
<li>
<p><strong><a href="https://cdk.dev/">cdk.dev</a></strong> – Community-driven hub for the AWS CDK, including a community <code class="noloc">Slack</code> workspace.</p>
</li>
<li>
<p><strong><a href="https://github.com/kalaiser/awesome-cdk">Awesome CDK</a></strong> – <code class="noloc">GitHub</code> repository containing a curated list of AWS CDK open-source projects, guides, blogs, and other resources.</p>
</li>
<li>
<p><strong><a href="https://aws.amazon.com/solutions/constructs/">AWS Solutions Constructs</a></strong> – Vetted, configuration infrastructure as code (IaC) patterns that can easily be assembled into production-ready applications.</p>
</li>
<li>
<p><strong><a href="https://aws.amazon.com/blogs/developer/category/developer-tools/aws-cloud-development-kit/">AWS Developer Tools Blog</a></strong> – Blog posts filtered for the AWS CDK.</p>
</li>
<li>
<p><strong><a href="https://stackoverflow.com/questions/tagged/aws-cdk">AWS CDK on Stack Overflow</a></strong> – Questions tagged with * aws-cdk* on <code class="noloc">Stack Overflow</code>.</p>
</li>
<li>
<p><strong><a href="https://docs.aws.amazon.com/cloud9/latest/user-guide/sample-cdk.html">AWS CDK tutorial for AWS Cloud9</a></strong> – Tutorial on using the AWS CDK with the AWS Cloud9 development environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To learn more about related topics to the AWS CDK, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-whatis-concepts.html">AWS CloudFormation concepts</a></strong> – Since the AWS CDK is built to work with AWS CloudFormation, we recommend that you learn and understand key AWS CloudFormation concepts.</p>
</li>
<li>
<p><strong><a href="https://docs.aws.amazon.com/general/latest/gr/glos-chap.html">AWS Glossary</a></strong> – Definitions of key terms used across AWS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To learn more about tools related to the AWS CDK that can be used to simplify serverless application development and deployment, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><a href="https://aws.amazon.com/serverless/sam/">AWS Serverless Application Model</a></strong> – An open-source developer tool that simplifies and improves the experience of building and running serverless applications on AWS.</p>
</li>
<li>
<p><strong><a href="https://github.com/aws/chalice">AWS Chalice</a></strong> – A framework for writing serverless apps in <code class="noloc">Python</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="core-concepts">2. Learn AWS CDK core concepts</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Learn core concepts behind the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Learn core concepts behind the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="sect2">
<h3 id="concepts-iac">2.1. AWS CDK and <code class="noloc">IaC</code></h3>
<div class="paragraph">
<p>The AWS CDK is an open-source framework that you can use to manage your AWS infrastructure using code. This approach is known as  <em>infrastructure as code (<code class="noloc">IaC</code>)</em>. By managing and provisioning your infrastructure as code, you treat your infrastructure in the same way that developers treat code. This provides many benefits, such as version control and scalability. To learn more about IaC, see <a href="https://aws.amazon.com/what-is/iac/">What is Infrastructure as Code?</a></p>
</div>
</div>
<div class="sect2">
<h3 id="concepts-cfn">2.2. AWS CDK and AWS CloudFormation</h3>
<div class="paragraph">
<p>The AWS CDK is tightly integrated with AWS CloudFormation. AWS CloudFormation is a fully managed service that you can use to manage and provision your infrastructure on AWS. With AWS CloudFormation, you define your infrastructure in templates and deploy them to AWS CloudFormation. The AWS CloudFormation service then provisions your infrastructure according to the configuration defined on your templates.</p>
</div>
<div class="paragraph">
<p>AWS CloudFormation templates are <em>declarative</em>, meaning they declare the desired state or outcome of your infrastructure. Using JSON or YAML, you declare your AWS infrastructure by defining AWS <em>resources</em> and <em>properties</em>. Resources represent the many services on AWS and properties represent your desired configuration of those services. When you deploy your template to AWS CloudFormation, your resources and their configured properties are provisioned as described on your template.</p>
</div>
<div class="paragraph">
<p>With the AWS CDK, you can manage your infrastructure <em>imperatively</em>, using general-purpose programming languages. Instead of just defining a desired state declaratively, you can define the logic or sequence necessary to reach the desired state. For example, you can use <code>if</code> statements or conditional loops that determine how to reach a desired end state for your infrastructure.</p>
</div>
<div class="paragraph">
<p>Infrastructure created with the AWS CDK is eventually translated, or <em>synthesized</em> into AWS CloudFormation templates and deployed using the AWS CloudFormation service. So while the AWS CDK offers a different approach to creating your infrastructure, you still receive the benefits of AWS CloudFormation, such as extensive AWS resource configuration support and robust deployment processes.</p>
</div>
<div class="paragraph">
<p>To learn more about AWS CloudFormation, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">What is AWS CloudFormation?</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="concepts-abstractions">2.3. AWS CDK and abstractions</h3>
<div class="paragraph">
<p>With AWS CloudFormation, you must define every detail of how your resources are configured. This provides the benefit of having complete control over your infrastructure. However, this requires you to learn, understand, and create robust templates that contain resource configuration details and relationships between resources, such as permissions and event-driven interactions.</p>
</div>
<div class="paragraph">
<p>With the AWS CDK, you can have the same control over your resource configurations. However, the AWS CDK also offers powerful abstractions, which can speed up and simplify the infrastructure development process. For example, the AWS CDK includes constructs that provide sensible default configurations and helper methods that generate boilerplate code for you. The AWS CDK also offers tools, such as the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>), that perform infrastructure management actions for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="concepts-learn">2.4. Learn more about core AWS CDK concepts</h3>
<div class="sect3">
<h4 id="concepts-learn-interact">2.4.1. Interacting with the AWS CDK</h4>
<div class="paragraph">
<p>When using with the AWS CDK, you will primarily interact with the AWS Construct Library and the AWS CDK  <code class="noloc">CLI</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="concepts-learn-develop">2.4.2. Developing with the AWS CDK</h4>
<div class="paragraph">
<p>The AWS CDK can be written in any  <a href="#languages">supported programming language</a>. You start with a <a href="#projects">CDK project</a>, which contains a structure of folders and files, including <a href="#assets">assets</a>. Within the project, you create a <a href="#apps">CDK application</a>. Within the app, you define a <a href="#stacks">stack</a>, which directly represents a CloudFormation stack. Within the stack, you define your AWS resources and properties using <a href="#constructs">constructs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="concepts-learn-deploy">2.4.3. Deploying with the AWS CDK</h4>
<div class="paragraph">
<p>You deploy CDK apps into an AWS  <a href="#environments">environment</a>. Before deploying, you must perform a one-time <a href="#bootstrapping">bootstrapping</a> to prepare your environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="concepts-learn-more">2.4.4. Learn more</h4>
<div class="paragraph">
<p>To learn more about AWS CDK core concepts, see the topics in this section.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="languages">2.5. Supported programming languages for the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) has first-class support for the <code class="noloc">TypeScript</code>,  <code class="noloc">JavaScript</code>,  <code class="noloc">Python</code>,  <code class="noloc">Java</code>,  <code class="noloc">C#</code>, and  <code class="noloc">Go</code> general-purpose programming languages.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) has first-class support for the following general-purpose programming languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="noloc">TypeScript</code></p>
</li>
<li>
<p><code class="noloc">JavaScript</code></p>
</li>
<li>
<p><code class="noloc">Python</code></p>
</li>
<li>
<p><code class="noloc">Java</code></p>
</li>
<li>
<p><code class="noloc">C#</code></p>
</li>
<li>
<p><code class="noloc">Go</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other  <code class="noloc">JVM</code> and  <code class="noloc">.NET</code><code class="noloc">CLR</code> languages may also be used in theory, but we do not offer official support at this time.</p>
</div>
<div class="paragraph">
<p>The AWS CDK is developed in one language, <code class="noloc">TypeScript</code>. To support the other languages, the AWS CDK utilizes a tool called  <a href="https://github.com/aws/jsii">JSII</a> to generate language bindings.</p>
</div>
<div class="paragraph">
<p>We attempt to offer each language&#8217;s usual conventions to make development with the AWS CDK as natural and intuitive as possible. For example, we distribute AWS Construct Library modules using your preferred language&#8217;s standard repository, and you install them using the language&#8217;s standard package manager. Methods and properties are also named using your language&#8217;s recommended naming patterns.</p>
</div>
<div class="paragraph">
<p>The following are a few code examples:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket', {
  bucketName: 'amzn-s3-demo-bucket',
  versioned: true,
  websiteRedirect: {hostName: 'aws.amazon.com'}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket', {
  bucketName: 'amzn-s3-demo-bucket',
  versioned: true,
  websiteRedirect: {hostName: 'aws.amazon.com'}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = s3.Bucket("amzn-s3-demo-bucket", bucket_name="amzn-s3-demo-bucket", versioned=True,
            website_redirect=s3.RedirectTarget(host_name="aws.amazon.com"))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = Bucket.Builder.create(self, "amzn-s3-demo-bucket")
                      .bucketName("amzn-s3-demo-bucket")
                      .versioned(true)
                      .websiteRedirect(new RedirectTarget.Builder()
                          .hostName("aws.amazon.com").build())
                      .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new Bucket(this, "amzn-s3-demo-bucket", new BucketProps {
                      BucketName = "amzn-s3-demo-bucket",
                      Versioned  = true,
                      WebsiteRedirect = new RedirectTarget {
                              HostName = "aws.amazon.com"
                      }});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">bucket := awss3.NewBucket(scope, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.BucketProps {
	BucketName: jsii.String("amzn-s3-demo-bucket"),
	Versioned: jsii.Bool(true),
	WebsiteRedirect: &amp;awss3.RedirectTarget {
		HostName: jsii.String("aws.amazon.com"),
	},
})</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These code snippets are intended for illustration only. They are incomplete and won&#8217;t run as they are.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The AWS Construct Library is distributed using each language&#8217;s standard package management tools, including  <code class="noloc">NPM</code>,  <code class="noloc">PyPi</code>,  <code class="noloc">Maven</code>, and  <code class="noloc">NuGet</code>. We also provide a version of the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">AWS CDK API Reference</a> for each language.</p>
</div>
<div class="paragraph">
<p>To help you use the AWS CDK in your preferred language, this guide includes the following topics for supported languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#work-with-cdk-typescript">Working with the AWS CDK in TypeScript</a></p>
</li>
<li>
<p><a href="#work-with-cdk-javascript">Working with the AWS CDK in JavaScript</a></p>
</li>
<li>
<p><a href="#work-with-cdk-python">Working with the AWS CDK in Python</a></p>
</li>
<li>
<p><a href="#work-with-cdk-java">Working with the AWS CDK in Java</a></p>
</li>
<li>
<p><a href="#work-with-cdk-csharp">Working with the AWS CDK in C#</a></p>
</li>
<li>
<p><a href="#work-with-cdk-go">Working with the AWS CDK in Go</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code class="noloc">TypeScript</code> was the first language supported by the AWS CDK, and much of the AWS CDK example code is written in  <code class="noloc">TypeScript</code>. This guide includes a topic specifically to show how to adapt  <code class="noloc">TypeScript</code> AWS CDK code for use with the other supported languages. For more information, see  <a href="#work-with-cdk-compare">Comparing AWS CDK in TypeScript with other languages</a>.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="libraries">2.6. The AWS CDK libraries</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Learn about the core libraries that you will use with the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Learn about the core libraries that you will use with the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="sect3">
<h4 id="libraries-cdk">2.6.1. The AWS CDK Library</h4>
<div class="paragraph">
<p>The AWS CDK Library, also referred to as  <code>aws-cdk-lib</code>, is the main library that you will use to develop applications with the AWS CDK. It is developed and maintained by AWS. This library contains base classes, such as <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.App.html">App</a></code> and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code>. It also contains the libraries you will use to define your infrastructure through constructs.</p>
</div>
</div>
<div class="sect3">
<h4 id="libraries-construct">2.6.2. The AWS Construct Library</h4>
<div class="paragraph">
<p>The AWS Construct Library is a part of the AWS CDK Library. It contains a collection of  <a href="#constructs">constructs</a> that are developed and maintained by AWS. It is organized into various modules for each AWS service. Each module includes constructs that you can use to define your AWS resources and properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="libraries-constructs">2.6.3. The Constructs library</h4>
<div class="paragraph">
<p>The Constructs library, commonly referred to as  <code>constructs</code>, is a library for defining and composing cloud infrastructure components. It contains the core <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct</a></code> class, which represents the construct building block. This class is the foundational base class of all constructs from the AWS Construct Library. The Constructs library is a separate general-purpose library that is used by other construct-based tools such as <em>CDK for <code class="noloc">Terraform</code></em> and <em>CDK for <code class="noloc">Kubernetes</code></em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="libraries-reference">2.6.4. The AWS CDK API reference</h4>
<div class="paragraph">
<p>The  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">AWS CDK API reference</a> contains official reference documentation for the AWS CDK Library, including the AWS Construct Library and Constructs library. A version of the API reference is provided for each supported programming language.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For AWS CDK Library (<code>aws-cdk-lib</code>) documentation, see <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib-readme.html">aws-cdk-lib module</a>.</p>
</li>
<li>
<p>Documentation for constructs in the AWS Construct Library are organized by AWS service in the following format: <code>aws-cdk-lib.[replaceable]</code>&lt;service&gt;````. For example, construct documentation for Amazon Simple Storage Service (Amazon S3), can be found at <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3-readme.html">aws-cdk-lib.aws_s3 module</a>.</p>
</li>
<li>
<p>For Constructs library (constructs) documentation, see <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs-readme.html">constructs module</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="libraries-reference-contribute">Contribute to the AWS CDK API reference</h5>
<div class="paragraph">
<p>The AWS CDK is open-source and we welcome you to contribute. Community contributions positively impact and improve the AWS CDK. For instructions on contributing specifically to AWS CDK API reference documentation, see  <a href="https://github.com/aws/aws-cdk/blob/main/CONTRIBUTING.md#documentation">Documentation</a> in the <em>aws-cdk <code class="noloc">GitHub</code> repository</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="libraries-learn">2.6.5. Learn more</h4>
<div class="paragraph">
<p>For instructions on importing and using the CDK Library, see  <a href="#work-with">Work with the CDK library</a>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="projects">2.7. AWS CDK projects</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An AWS Cloud Development Kit (AWS CDK) project represents the files and folders that contain your CDK code. Contents will vary based on your programming language.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>An AWS Cloud Development Kit (AWS CDK) project represents the files and folders that contain your CDK code. Contents will vary based on your programming language.</p>
</div>
<div class="paragraph">
<p>You can create your AWS CDK project manually or with the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>)  <code>cdk init</code> command. In this topic, we will refer to the project structure and naming conventions of files and folders created by the AWS CDK CLI. You can customize and organize your CDK projects to fit your needs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Project structure created by the AWS CDK <code class="noloc">CLI</code> may vary across versions over time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="projects-universal">2.7.1. Universal files and folders</h4>
<div id="projects-universal-git" class="dlist">
<dl>
<dt class="hdlist1"><code class="noloc">.git</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you have  <code>git</code> installed, the AWS CDK <code class="noloc">CLI</code> automatically initializes a  <code class="noloc">Git</code> repository for your project. The  <code class="path">.git</code> directory contains information about the repository.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="projects-universal-gitignore" class="dlist">
<dl>
<dt class="hdlist1"><code class="noloc">.gitignore</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Text file used by  <code class="noloc">Git</code> to specify files and folders to ignore.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="projects-universal-readme" class="dlist">
<dl>
<dt class="hdlist1"><code class="noloc">README.md</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Text file that provides you with basic guidance and important information for managing your AWS CDK project. Modify this file as necessary to document important information regarding your CDK project.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="projects-universal-cdk" class="dlist">
<dl>
<dt class="hdlist1"><code class="noloc">cdk.json</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configuration file for the AWS CDK. This file provides instruction to the AWS CDK  <code class="noloc">CLI</code> regarding how to run your app.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="projects-specific">2.7.2. Language-specific files and folders</h4>
<div class="paragraph">
<p>The following files and folders are unique to each supported programming language.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code class="noloc">TypeScript</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following is an example project created in the  <code class="path">my-cdk-ts-project</code> directory using the  <code>cdk init --language typescript</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-ts-project
├── .git
├── .gitignore
├── .npmignore
├── README.md
├── bin
│   └── my-cdk-ts-project.ts
├── cdk.json
├── jest.config.js
├── lib
│   └── my-cdk-ts-project-stack.ts
├── node_modules
├── package-lock.json
├── package.json
├── test
│   └── my-cdk-ts-project.test.ts
└── tsconfig.json</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">.npmignore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File that specifies which files and folders to ignore when publishing a package to the <code class="noloc">npm</code> registry. This file is similar to  <code class="path">.gitignore</code>, but is specific to  <code class="noloc">npm</code> packages.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">bin/my-cdk-ts-project.ts</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>application file</em> defines your CDK app. CDK projects can contain one or more application files. Application files are stored in the <code class="path">bin</code> folder.</p>
<div class="paragraph">
<p>The following is an example of a basic application file that defines a CDK app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { MyCdkTsProjectStack } from '../lib/my-cdk-ts-project-stack';

const app = new cdk.App();
new MyCdkTsProjectStack(app, 'MyCdkTsProjectStack');</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">jest.config.js</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configuration file for <code class="noloc">Jest</code>.  <em><code class="noloc">Jest</code></em> is a popular <code class="noloc">JavaScript</code> testing framework.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">lib/my-cdk-ts-project-stack.ts</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>stack file</em> defines your CDK stack. Within your stack, you define AWS resources and properties using constructs.</p>
<div class="paragraph">
<p>The following is an example of a basic stack file that defines a CDK stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

export class MyCdkTsProjectStack extends cdk.Stack {
 constructor(scope: Construct, id: string, props?: cdk.StackProps) {
  super(scope, id, props);

  // code that defines your resources and properties go here
 }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">node_modules</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Common folder in <code class="noloc">Node.js</code> projects that contain dependencies for your project.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">package-lock.json</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Metadata file that works with the <code class="path">package.json</code> file to manage versions of dependencies.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">package.json</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Metadata file that is commonly used in <code class="noloc">Node.js</code> projects. This file contains information about your CDK project such as the project name, script definitions, dependencies, and other import project-level information.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">test/my-cdk-ts-project.test.ts</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A test folder is created to organize tests for your CDK project. A sample test file is also created.</p>
<div class="paragraph">
<p>You can write tests in <code class="noloc">TypeScript</code> and use  <code class="noloc">Jest</code> to compile your  <code class="noloc">TypeScript</code> code before running tests.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">tsconfig.json</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configuration file used in <code class="noloc">TypeScript</code> projects that specifies compiler options and project settings.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code class="noloc">JavaScript</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following is an example project created in the  <code class="path">my-cdk-js-project</code> directory using the  <code>cdk init --language javascript</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-js-project
├── .git
├── .gitignore
├── .npmignore
├── README.md
├── bin
│   └── my-cdk-js-project.js
├── cdk.json
├── jest.config.js
├── lib
│   └── my-cdk-js-project-stack.js
├── node_modules
├── package-lock.json
├── package.json
└── test
    └── my-cdk-js-project.test.js</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">.npmignore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File that specifies which files and folders to ignore when publishing a package to the <code class="noloc">npm</code> registry. This file is similar to  <code class="path">.gitignore</code>, but is specific to  <code class="noloc">npm</code> packages.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">bin/my-cdk-js-project.js</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>application file</em> defines your CDK app. CDK projects can contain one or more application files. Application files are stored in the <code class="path">bin</code> folder.</p>
<div class="paragraph">
<p>The following is an example of a basic application file that defines a CDK app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

const cdk = require('aws-cdk-lib');
const { MyCdkJsProjectStack } = require('../lib/my-cdk-js-project-stack');

const app = new cdk.App();
new MyCdkJsProjectStack(app, 'MyCdkJsProjectStack');</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">jest.config.js</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configuration file for <code class="noloc">Jest</code>.  <em><code class="noloc">Jest</code></em> is a popular <code class="noloc">JavaScript</code> testing framework.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">lib/my-cdk-js-project-stack.js</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>stack file</em> defines your CDK stack. Within your stack, you define AWS resources and properties using constructs.</p>
<div class="paragraph">
<p>The following is an example of a basic stack file that defines a CDK stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');

class MyCdkJsProjectStack extends Stack {
 constructor(scope, id, props) {
  super(scope, id, props);

  // code that defines your resources and properties go here
 }
}

module.exports = { MyCdkJsProjectStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">node_modules</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Common folder in <code class="noloc">Node.js</code> projects that contain dependencies for your project.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">package-lock.json</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Metadata file that works with the <code class="path">package.json</code> file to manage versions of dependencies.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">package.json</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Metadata file that is commonly used in <code class="noloc">Node.js</code> projects. This file contains information about your CDK project such as the project name, script definitions, dependencies, and other import project-level information.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">test/my-cdk-js-project.test.js</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A test folder is created to organize tests for your CDK project. A sample test file is also created.</p>
<div class="paragraph">
<p>You can write tests in <code class="noloc">JavaScript</code> and use  <code class="noloc">Jest</code> to compile your  <code class="noloc">JavaScript</code> code before running tests.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code class="noloc">Python</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following is an example project created in the  <code class="path">my-cdk-py-project</code> directory using the  <code>cdk init --language python</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-py-project
├── .git
├── .gitignore
├── .venv
├── README.md
├── app.py
├── cdk.json
├── my_cdk_py_project
│   ├── __init__.py
│   └── my_cdk_py_project_stack.py
├── requirements-dev.txt
├── requirements.txt
├── source.bat
└── tests
    ├── __init__.py
    └── unit</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">.venv</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The CDK <code class="noloc">CLI</code> automatically creates a virtual environment for your project. The  <code class="path">.venv</code> directory refers to this virtual environment.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">app.py</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <em>application file</em> defines your CDK app. CDK projects can contain one or more application files.</p>
<div class="paragraph">
<p>The following is an example of a basic application file that defines a CDK app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os

import aws_cdk as cdk

from my_cdk_py_project.my_cdk_py_project_stack import MyCdkPyProjectStack

app = cdk.App()
MyCdkPyProjectStack(app, "MyCdkPyProjectStack")

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">my_cdk_py_project</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Directory that contains your <em>stack files</em>. The CDK <code class="noloc">CLI</code> creates the following here:</p>
<div class="ulist">
<ul>
<li>
<p><code class="path"><em>init</em>.py </code> – An empty  <code class="noloc">Python</code> package definition file.</p>
</li>
<li>
<p><code class="path">my_cdk_py_project</code> – File that defines your CDK stack. You then define AWS resources and properties within the stack using constructs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a stack file:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import Stack

from constructs import Construct

class MyCdkPyProjectStack(Stack):
 def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
  super().__init__(scope, construct_id, **kwargs)

  # code that defines your resources and properties go here</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">requirements-dev.txt</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File similar to <code class="path">requirements.txt</code>, but used to manage dependencies specifically for development purposes rather than production.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">requirements.txt</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Common file used in <code class="noloc">Python</code> projects to specify and manage project dependencies.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">source.bat</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Batch file for <code class="noloc">Windows</code> that is used to set up the  <code class="noloc">Python</code> virtual environment.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">tests</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Directory that contains tests for your CDK project.</p>
<div class="paragraph">
<p>The following is an example of a unit test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as core
import aws_cdk.assertions as assertions

from my_cdk_py_project.my_cdk_py_project_stack import MyCdkPyProjectStack

def test_sqs_queue_created():
 app = core.App()
 stack = MyCdkPyProjectStack(app, "my-cdk-py-project")
 template = assertions.Template.from_stack(stack)

 template.has_resource_properties("AWS::SQS::Queue", {
  "VisibilityTimeout": 300
 })</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code class="noloc">Java</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following is an example project created in the  <code class="path">my-cdk-java-project</code> directory using the  <code>cdk init --language java</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-java-project
├── .git
├── .gitignore
├── README.md
├── cdk.json
├── pom.xml
└── src
    ├── main
    └── test</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">pom.xml</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File that contains configuration information and metadata about your CDK project. This file is a part of <code class="noloc">Maven</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">src/main</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Directory containing your <em>application</em> and <em>stack</em> files.</p>
<div class="paragraph">
<p>The following is an example application file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

import java.util.Arrays;

public class MyCdkJavaProjectApp {
 public static void main(final String[] args) {
  App app = new App();

  new MyCdkJavaProjectStack(app, "MyCdkJavaProjectStack", StackProps.builder()
   .build());

  app.synth();
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example stack file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class MyCdkJavaProjectStack extends Stack {
 public MyCdkJavaProjectStack(final Construct scope, final String id) {
  this(scope, id, null);
 }

 public MyCdkJavaProjectStack(final Construct scope, final String id, final StackProps props) {
  super(scope, id, props);

  // code that defines your resources and properties go here
 }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">src/test</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Directory containing your test files. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.assertions.Template;
import java.io.IOException;

import java.util.HashMap;

import org.junit.jupiter.api.Test;

public class MyCdkJavaProjectTest {

 @Test
 public void testStack() throws IOException {
  App app = new App();
  MyCdkJavaProjectStack stack = new MyCdkJavaProjectStack(app, "test");

  Template template = Template.fromStack(stack);

  template.hasResourceProperties("AWS::SQS::Queue", new HashMap&lt;String, Number&gt;() {{
   put("VisibilityTimeout", 300);
  }});
 }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code class="noloc">C#</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following is an example project created in the  <code class="path">my-cdk-csharp-project</code> directory using the  <code>cdk init --language csharp</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-csharp-project
├── .git
├── .gitignore
├── README.md
├── cdk.json
└── src
    ├── MyCdkCsharpProject
    └── MyCdkCsharpProject.sln</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">src/MyCdkCsharpProject</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Directory containing your <em>application</em> and <em>stack</em> files.</p>
<div class="paragraph">
<p>The following is an example application file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using System;
using System.Collections.Generic;
using System.Linq;

namespace MyCdkCsharpProject
{
 sealed class Program
 {
  public static void Main(string[] args)
  {
   var app = new App();
   new MyCdkCsharpProjectStack(app, "MyCdkCsharpProjectStack", new StackProps{});
   app.Synth();
  }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example stack file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace MyCdkCsharpProject
{
 public class MyCdkCsharpProjectStack : Stack
 {
  internal MyCdkCsharpProjectStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
  {
   // code that defines your resources and properties go here
  }
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This directory also contains the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="path">GlobalSuppressions.cs</code> – File used to suppress specific compiler warnings or errors across your project.</p>
</li>
<li>
<p><code class="path">.csproj</code> – XML-based file used to define project settings, dependencies, and build configurations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">src/MyCdkCsharpProject.sln</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code class="noloc">Microsoft Visual Studio Solution File</code> used to organize and manage related projects.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code class="noloc">Go</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The following is an example project created in the  <code class="path">my-cdk-go-project</code> directory using the  <code>cdk init --language go</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-go-project
├── .git
├── .gitignore
├── README.md
├── cdk.json
├── go.mod
├── my-cdk-go-project.go
└── my-cdk-go-project_test.go</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">go.mod</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File that contains module information and is used to manage dependencies and versioning for your <code class="noloc">Go</code> project.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">my-cdk-go-project.go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File that defines your CDK application and stacks.</p>
<div class="paragraph">
<p>The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main
import (
 "github.com/aws/aws-cdk-go/awscdk/v2"
 "github.com/aws/constructs-go/constructs/v10"
 "github.com/aws/jsii-runtime-go"
)

type MyCdkGoProjectStackProps struct {
 awscdk.StackProps
}

func NewMyCdkGoProjectStack(scope constructs.Construct, id string, props *MyCdkGoProjectStackProps) awscdk.Stack {
 var sprops awscdk.StackProps
 if props != nil {
  sprops = props.StackProps
 }
 stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)
 // The code that defines your resources and properties go here

  return stack
}

func main() {
 defer jsii.Close()
 app := awscdk.NewApp(nil)
 NewMyCdkGoProjectStack(app, "MyCdkGoProjectStack", &amp;MyCdkGoProjectStackProps{
  awscdk.StackProps{
   Env: env(),
  },
 })
 app.Synth(nil)
}

func env() *awscdk.Environment {

 return nil
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">my-cdk-go-project_test.go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File that defines a sample test.</p>
<div class="paragraph">
<p>The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
 "testing"

 "github.com/aws/aws-cdk-go/awscdk/v2"
 "github.com/aws/aws-cdk-go/awscdk/v2/assertions"
 "github.com/aws/jsii-runtime-go"
)

func TestMyCdkGoProjectStack(t *testing.T) {

 // GIVEN
 app := awscdk.NewApp(nil)

 // WHEN
 stack := NewMyCdkGoProjectStack(app, "MyStack", nil)

 // THEN
 template := assertions.Template_FromStack(stack, nil)
 template.HasResourceProperties(jsii.String("AWS::SQS::Queue"), map[string]interface{}{
  "VisibilityTimeout": 300,
 })
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="apps">2.8. AWS CDK apps</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) application or <em>app</em> is a collection of one or more CDK <a href="#stacks">stacks</a>. Stacks are a collection of one or more <a href="#constructs">constructs</a>, which define AWS resources and properties. Therefore, the overall grouping of your stacks and constructs are known as your CDK app.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) application or  <em>app</em> is a collection of one or more CDK <a href="#stacks">stacks</a>. Stacks are a collection of one or more <a href="#constructs">constructs</a>, which define AWS resources and properties. Therefore, the overall grouping of your stacks and constructs are known as your CDK app.</p>
</div>
<div class="sect3">
<h4 id="apps-define">2.8.1. How to create a CDK app</h4>
<div class="paragraph">
<p>You create an app by defining an app instance in the application file of your  <a href="#projects">project</a>. To do this, you import and use the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.App.html">App</a> construct from the AWS Construct Library. The <code>App</code> construct doesn&#8217;t require any initialization arguments. It is the only construct that can be used as the root.</p>
</div>
<div class="paragraph">
<p>The <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.App.html">App</a></code> and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> classes from the AWS Construct Library are unique constructs. Compared to other constructs, they don&#8217;t configure AWS resources on their own. Instead, they are used to provide context for your other constructs. All constructs that represent AWS resources must be defined, directly or indirectly, within the scope of a <code>Stack</code> construct. <code>Stack</code> constructs are defined within the scope of an <code>App</code> construct.</p>
</div>
<div class="paragraph">
<p>Apps are then synthesized to create AWS CloudFormation templates for your stacks. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new App();
new MyFirstStack(app, 'hello-cdk');
app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new App();
new MyFirstStack(app, 'hello-cdk');
app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">app = App()
MyFirstStack(app, "hello-cdk")
app.synth()</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">App app = new App();
new MyFirstStack(app, "hello-cdk");
app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var app = new App();
new MyFirstStack(app, "hello-cdk");
app.Synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">app := awscdk.NewApp(nil)

MyFirstStack(app, "MyFirstStack", &amp;MyFirstStackProps{
  awscdk.StackProps{
    Env: env(),
  },
})

app.Synth(nil)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Stacks within a single app can easily refer to each other&#8217;s resources and properties. The AWS CDK infers dependencies between stacks so that they can be deployed in the correct order. You can deploy any or all of the stacks within an app with a single  <code>cdk deploy</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="apps-tree">2.8.2. The construct tree</h4>
<div class="paragraph">
<p>Constructs are defined inside of other constructs using the  <code>scope</code> argument that is passed to every construct, with the <code>App</code> class as the root. In this way, an AWS CDK app defines a hierarchy of constructs known as the <em>construct tree</em>.</p>
</div>
<div class="paragraph">
<p>The root of this tree is your app, which is an instance of the <code>App</code> class. Within the app, you instantiate one or more stacks. Within stacks, you instantiate constructs, which may themselves instantiate resources or other constructs, and so on down the tree.</p>
</div>
<div class="paragraph">
<p>Constructs are <em>always</em> explicitly defined within the scope of another construct, which creates relationships between constructs. Almost always, you should pass <code>this</code> (in Python, <code>self</code>) as the scope, indicating that the new construct is a child of the current construct. The intended pattern is that you derive your construct from <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct</a>, then instantiate the constructs it uses in its constructor.</p>
</div>
<div class="paragraph">
<p>Passing the scope explicitly allows each construct to add itself to the tree, with this behavior entirely contained within the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct base class</a>. It works the same way in every language supported by the AWS CDK and does not require additional customization.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically, it&#8217;s possible to pass some scope other than <code>this</code> when instantiating a construct. You can add constructs anywhere in the tree, or even in another stack in the same app. For example, you could write a mixin-style function that adds constructs to a scope passed in as an argument. The practical difficulty here is that you can&#8217;t easily ensure that the IDs you choose for your constructs are unique within someone else&#8217;s scope. The practice also makes your code more difficult to understand, maintain, and reuse. Therefore, we recommend that you use the general structure of the construct tree.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The AWS CDK uses the IDs of all constructs in the path from the tree&#8217;s root to each child construct to generate the unique IDs required by AWS CloudFormation. This approach means that construct IDs only need to be unique within their scope, rather than within the entire stack as in native AWS CloudFormation. However, if you move a construct to a different scope, its generated stack-unique ID changes, and AWS CloudFormation won&#8217;t consider it the same resource.</p>
</div>
<div class="paragraph">
<p>The construct tree is separate from the constructs that you define in your AWS CDK code. However, it&#8217;s accessible through any construct&#8217;s <code>node</code> attribute, which is a reference to the node that represents that construct in the tree. Each node is a <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Node.html">Node</a> instance, the attributes of which provide access to the tree&#8217;s root and to the node&#8217;s parent scopes and children.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>node.children</code> – The direct children of the construct.</p>
</li>
<li>
<p><code>node.id</code> – The identifier of the construct within its scope.</p>
</li>
<li>
<p><code>node.path</code> – The full path of the construct including the IDs of all of its parents.</p>
</li>
<li>
<p><code>node.root</code> – The root of the construct tree (the app).</p>
</li>
<li>
<p><code>node.scope</code> – The scope (parent) of the construct, or undefined if the node is the root.</p>
</li>
<li>
<p><code>node.scopes</code> – All parents of the construct, up to the root.</p>
</li>
<li>
<p><code>node.uniqueId</code> – The unique alphanumeric identifier for this construct within the tree (by default, generated from <code>node.path</code> and a hash).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The construct tree defines an implicit order in which constructs are synthesized to resources in the final AWS CloudFormation template. Where one resource must be created before another, AWS CloudFormation or the AWS Construct Library generally infers the dependency. They then make sure that the resources are created in the right order.</p>
</div>
<div class="paragraph">
<p>You can also add an explicit dependency between two nodes by using <code>node.addDependency()</code>. For more information, see <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib-readme.html#dependencies">Dependencies</a> in the <em>AWS CDK API Reference</em>.</p>
</div>
<div class="paragraph">
<p>The AWS CDK provides a simple way to visit every node in the construct tree and perform an operation on each one. For more information, see <a href="#aspects">Aspects and the AWS CDK</a>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="stacks">2.9. Introduction to AWS CDK stacks</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An AWS CDK stack is a single unit of deployment. It represents a collection of AWS resources. When you develop CDK applications, you define AWS resources using CDK constructs and organize them within CDK stacks. When you deploy, the resources within a CDK stack are deployed together as an AWS CloudFormation stack.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>An AWS CDK stack is the smallest single unit of deployment. It represents a collection of AWS resources that you define using CDK constructs. When you deploy CDK apps, the resources within a CDK stack are deployed together as an AWS CloudFormation stack. To learn more about AWS CloudFormation stacks, see  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html">Managing AWS resources as a single unit with AWS CloudFormation stacks</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="paragraph">
<p>You define a stack by extending or inheriting from the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> construct. The following example is a common pattern for defining a CDK stack on a separate file, known as a <em>stack file</em>. Here, we extend or inherit the <code>Stack</code> class and define a constructor that accepts <code>scope</code>, <code>id</code>, and <code>props</code>. Then, we invoke the base <code>Stack</code> class constructor using <code>super</code> with the received <code>scope</code>, <code>id</code>, and <code>props</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

export class MyCdkStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define your constructs here

  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack } = require('aws-cdk-lib');

class MyCdkStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define your constructs here

  }
}

module.exports = { MyCdkStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
  Stack,
)
from constructs import Construct

class MyCdkStack(Stack):

  def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
    super().__init__(scope, construct_id, **kwargs)

    # Define your constructs here</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class MyCdkStack extends Stack {
  public MyCdkStack(final Construct scope, final String id) {
    this(scope, id, null);
  }

  public MyCdkStack(final Construct scope, final String id, final StackProps props) {
    super(scope, id, props);

    // Define your constructs here
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace MyCdk
{
  public class MyCdkStack : Stack
  {
    internal MyCdkStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
    {
      // Define your constructs here
    }
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

type CdkDemoAppStackProps struct {
	awscdk.StackProps
}

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// The code that defines your stack goes here

	return stack
}

func main() {
	defer jsii.Close()

	app := awscdk.NewApp(nil)

	NewCdkDemoAppStack(app, "CdkDemoAppStack", &amp;CdkDemoAppStackProps{
		awscdk.StackProps{
			Env: env(),
		},
	})

	app.Synth(nil)
}

//...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous example has only defined a stack. To create the stack, it must be instantiated within the context of your CDK app. A common pattern is to define your CDK app and initialize your stack on a separate file, known as an  <em>application file</em>.</p>
</div>
<div class="paragraph">
<p>The following is an example that creates a CDK stack named <code>MyCdkStack</code>. Here, the CDK app is created and <code>MyCdkStack</code> is instantiated in the context of the app:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { MyCdkStack } from '../lib/my-cdk-stack';

const app = new cdk.App();
new MyCdkStack(app, 'MyCdkStack', {
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

const cdk = require('aws-cdk-lib');
const { MyCdkStack } = require('../lib/my-cdk-stack');

const app = new cdk.App();
new MyCdkStack(app, 'MyCdkStack', {
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">app.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os

import aws_cdk as cdk

from my_cdk.my_cdk_stack import MyCdkStack


app = cdk.App()
MyCdkStack(app, "MyCdkStack",)

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

import java.util.Arrays;

public class MyCdkApp {
  public static void main(final String[] args) {
    App app = new App();

    new MyCdkStack(app, "MyCdkStack", StackProps.builder()
      .build());

    app.synth();
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using System;
using System.Collections.Generic;
using System.Linq;

namespace MyCdk
{
  sealed class Program
  {
    public static void Main(string[] args)
    {
      var app = new App();
      new MyCdkStack(app, "MyCdkStack", new StackProps
      {});
      app.Synth();
    }
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/constructs-go/constructs/v10"
  "github.com/aws/jsii-runtime-go"
)

// ...

func main() {
  defer jsii.Close()

  app := awscdk.NewApp(nil)

  NewMyCdkStack(app, "MyCdkStack", &amp;MyCdkStackProps{
    awscdk.StackProps{
      Env: env(),
    },
  })

  app.Synth(nil)
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example creates a CDK app that contains two stacks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new App();

new MyFirstStack(app, 'stack1');
new MySecondStack(app, 'stack2');

app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new App();

new MyFirstStack(app, 'stack1');
new MySecondStack(app, 'stack2');

app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">app = App()

MyFirstStack(app, 'stack1')
MySecondStack(app, 'stack2')

app.synth()</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">App app = new App();

new MyFirstStack(app, "stack1");
new MySecondStack(app, "stack2");

app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var app = new App();

new MyFirstStack(app, "stack1");
new MySecondStack(app, "stack2");

app.Synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

type MyFirstStackProps struct {
	awscdk.StackProps
}

func NewMyFirstStack(scope constructs.Construct, id string, props *MyFirstStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	myFirstStack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// The code that defines your stack goes here

	return myFirstStack
}

type MySecondStackProps struct {
	awscdk.StackProps
}

func NewMySecondStack(scope constructs.Construct, id string, props *MySecondStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	mySecondStack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// The code that defines your stack goes here

	return mySecondStack
}

func main() {
	defer jsii.Close()

	app := awscdk.NewApp(nil)

	NewMyFirstStack(app, "MyFirstStack", &amp;MyFirstStackProps{
		awscdk.StackProps{
			Env: env(),
		},
	})

	NewMySecondStack(app, "MySecondStack", &amp;MySecondStackProps{
		awscdk.StackProps{
			Env: env(),
		},
	})

	app.Synth(nil)
}

// ...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="stack-api">2.9.1. About the stack API</h4>
<div class="paragraph">
<p>The  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> object provides a rich API, including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Stack.of(construct)</code> – A static method that returns the <strong>Stack</strong> in which a construct is defined. This is useful if you need to interact with a stack from within a reusable construct. The call fails if a stack cannot be found in scope.</p>
</li>
<li>
<p><code>stack.stackName</code> (Python: <code>stack_name</code>) – Returns the physical name of the stack. As mentioned previously, all AWS CDK stacks have a physical name that the AWS CDK can resolve during synthesis.</p>
</li>
<li>
<p><code>stack.region</code> and <code>stack.account</code> – Return the AWS Region and account, respectively, into which this stack will be deployed. These properties return one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>The account or Region explicitly specified when the stack was defined</p>
</li>
<li>
<p>A string-encoded token that resolves to the AWS CloudFormation pseudo parameters for account and Region to indicate that this stack is environment agnostic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about how environments are determined for stacks, see  <a href="#environments">Environments for the AWS CDK</a>.</p>
</div>
</li>
<li>
<p><code>stack.addDependency(stack)</code> (Python: <code>stack.add_dependency(stack)</code> – Can be used to explicitly define dependency order between two stacks. This order is respected by the <strong class="command">cdk deploy</strong> command when deploying multiple stacks at once.</p>
</li>
<li>
<p><code>stack.tags</code> – Returns a <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.TagManager.html">TagManager</a> that you can use to add or remove stack-level tags. This tag manager tags all resources within the stack, and also tags the stack itself when it&#8217;s created through AWS CloudFormation.</p>
</li>
<li>
<p><code>stack.partition</code>, <code>stack.urlSuffix</code> (Python: <code>url_suffix</code>), <code>stack.stackId</code> (Python: <code>stack_id</code>), and <code>stack.notificationArn</code> (Python: <code>notification_arn</code>) – Return tokens that resolve to the respective AWS CloudFormation pseudo parameters, such as <code>{ "Ref": "AWS::Partition" }</code>. These tokens are associated with the specific stack object so that the AWS CDK framework can identify cross-stack references.</p>
</li>
<li>
<p><code>stack.availabilityZones</code> (Python: <code>availability_zones</code>) – Returns the set of Availability Zones available in the environment in which this stack is deployed. For environment-agnostic stacks, this always returns an array with two Availability Zones. For environment-specific stacks, the AWS CDK queries the environment and returns the exact set of Availability Zones available in the Region that you specified.</p>
</li>
<li>
<p><code>stack.parseArn(arn)</code> and <code>stack.formatArn(comps)</code> (Python: <code>parse_arn</code>, <code>format_arn</code>) – Can be used to work with Amazon Resource Names (ARNs).</p>
</li>
<li>
<p><code>stack.toJsonString(obj)</code> (Python: <code>to_json_string</code>) – Can be used to format an arbitrary object as a JSON string that can be embedded in an AWS CloudFormation template. The object can include tokens, attributes, and references, which are only resolved during deployment.</p>
</li>
<li>
<p><code>stack.templateOptions</code> (Python: <code>template_options</code>) – Use to specify AWS CloudFormation template options, such as Transform, Description, and Metadata, for your stack.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="stacks-work">2.9.2. Working with stacks</h4>
<div class="paragraph">
<p>Stacks are deployed as an AWS CloudFormation stack into an AWS  <em><a href="#environments">environment</a></em>. The environment covers a specific AWS account and AWS Region.</p>
</div>
<div class="paragraph">
<p>When you run the <code>cdk synth</code> command for an app with multiple stacks, the cloud assembly includes a separate template for each stack instance. Even if the two stacks are instances of the same class, the AWS CDK emits them as two individual templates.</p>
</div>
<div class="paragraph">
<p>You can synthesize each template by specifying the stack name in the <code>cdk synth</code> command. The following example synthesizes the template for <code class="path">stack1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth stack1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is conceptually different from how AWS CloudFormation templates are normally used, where a template can be deployed multiple times and parameterized through  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">AWS CloudFormation parameters</a>. Although AWS CloudFormation parameters can be defined in the AWS CDK, they are generally discouraged because AWS CloudFormation parameters are resolved only during deployment. This means that you cannot determine their value in your code.</p>
</div>
<div class="paragraph">
<p>For example, to conditionally include a resource in your app based on a parameter value, you must set up an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html">AWS CloudFormation condition</a> and tag the resource with it. The AWS CDK takes an approach where concrete templates are resolved at synthesis time. Therefore, you can use an <code>if</code> statement to check the value to determine whether a resource should be defined or some behavior should be applied.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The AWS CDK provides as much resolution as possible during synthesis time to enable idiomatic and natural usage of your programming language.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like any other construct, stacks can be composed together into groups. The following code shows an example of a service that consists of three stacks: a control plane, a data plane, and monitoring stacks. The service construct is defined twice: once for the beta environment and once for the production environment.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { App, Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';

interface EnvProps {
  prod: boolean;
}

// imagine these stacks declare a bunch of related resources
class ControlPlane extends Stack {}
class DataPlane extends Stack {}
class Monitoring extends Stack {}

class MyService extends Construct {

  constructor(scope: Construct, id: string, props?: EnvProps) {

    super(scope, id);

    // we might use the prod argument to change how the service is configured
    new ControlPlane(this, "cp");
    new DataPlane(this, "data");
    new Monitoring(this, "mon");  }
}

const app = new App();
new MyService(app, "beta");
new MyService(app, "prod", { prod: true });

app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { App, Stack } = require('aws-cdk-lib');
const { Construct } = require('constructs');

// imagine these stacks declare a bunch of related resources
class ControlPlane extends Stack {}
class DataPlane extends Stack {}
class Monitoring extends Stack {}

class MyService extends Construct {

  constructor(scope, id, props) {

    super(scope, id);

    // we might use the prod argument to change how the service is configured
    new ControlPlane(this, "cp");
    new DataPlane(this, "data");
    new Monitoring(this, "mon");
  }
}

const app = new App();
new MyService(app, "beta");
new MyService(app, "prod", { prod: true });

app.synth();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import App, Stack
from constructs import Construct

# imagine these stacks declare a bunch of related resources
class ControlPlane(Stack): pass
class DataPlane(Stack): pass
class Monitoring(Stack): pass

class MyService(Construct):

  def __init__(self, scope: Construct, id: str, *, prod=False):

    super().__init__(scope, id)

    # we might use the prod argument to change how the service is configured
    ControlPlane(self, "cp")
    DataPlane(self, "data")
    Monitoring(self, "mon")

app = App();
MyService(app, "beta")
MyService(app, "prod", prod=True)

app.synth()</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Stack;
import software.constructs.Construct;

public class MyApp {

    // imagine these stacks declare a bunch of related resources
    static class ControlPlane extends Stack {
        ControlPlane(Construct scope, String id) {
            super(scope, id);
        }
    }

    static class DataPlane extends Stack {
        DataPlane(Construct scope, String id) {
            super(scope, id);
        }
    }

    static class Monitoring extends Stack {
        Monitoring(Construct scope, String id) {
            super(scope, id);
        }
    }

    static class MyService extends Construct {
        MyService(Construct scope, String id) {
            this(scope, id, false);
        }

        MyService(Construct scope, String id, boolean prod) {
            super(scope, id);

            // we might use the prod argument to change how the service is configured
            new ControlPlane(this, "cp");
            new DataPlane(this, "data");
            new Monitoring(this, "mon");
        }
    }

    public static void main(final String argv[]) {
        App app = new App();

        new MyService(app, "beta");
        new MyService(app, "prod", true);

        app.synth();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

// imagine these stacks declare a bunch of related resources
public class ControlPlane : Stack {
    public ControlPlane(Construct scope, string id=null) : base(scope, id) { }
}

public class DataPlane : Stack {
    public DataPlane(Construct scope, string id=null) : base(scope, id) { }
}

public class Monitoring : Stack
{
    public Monitoring(Construct scope, string id=null) : base(scope, id) { }
}

public class MyService : Construct
{
    public MyService(Construct scope, string id, Boolean prod=false) : base(scope, id)
    {
        // we might use the prod argument to change how the service is configured
        new ControlPlane(this, "cp");
        new DataPlane(this, "data");
        new Monitoring(this, "mon");
    }
}

class Program
{
    static void Main(string[] args)
    {

        var app = new App();
        new MyService(app, "beta");
        new MyService(app, "prod", prod: true);
        app.Synth();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

type ControlPlaneStackProps struct {
	awscdk.StackProps
}

func NewControlPlaneStack(scope constructs.Construct, id string, props *ControlPlaneStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	ControlPlaneStack := awscdk.NewStack(scope, jsii.String(id), &amp;sprops)

	// The code that defines your stack goes here

	return ControlPlaneStack
}

type DataPlaneStackProps struct {
	awscdk.StackProps
}

func NewDataPlaneStack(scope constructs.Construct, id string, props *DataPlaneStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	DataPlaneStack := awscdk.NewStack(scope, jsii.String(id), &amp;sprops)

	// The code that defines your stack goes here

	return DataPlaneStack
}

type MonitoringStackProps struct {
	awscdk.StackProps
}

func NewMonitoringStack(scope constructs.Construct, id string, props *MonitoringStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	MonitoringStack := awscdk.NewStack(scope, jsii.String(id), &amp;sprops)

	// The code that defines your stack goes here

	return MonitoringStack
}

type MyServiceStackProps struct {
	awscdk.StackProps
	Prod bool
}

func NewMyServiceStack(scope constructs.Construct, id string, props *MyServiceStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	MyServiceStack := awscdk.NewStack(scope, jsii.String(id), &amp;sprops)

	NewControlPlaneStack(MyServiceStack, "cp", &amp;ControlPlaneStackProps{
		StackProps: sprops,
	})
	NewDataPlaneStack(MyServiceStack, "data", &amp;DataPlaneStackProps{
		StackProps: sprops,
	})
	NewMonitoringStack(MyServiceStack, "mon", &amp;MonitoringStackProps{
		StackProps: sprops,
	})

	return MyServiceStack
}

func main() {
	defer jsii.Close()

	app := awscdk.NewApp(nil)

	betaProps := MyServiceStackProps{
		StackProps: awscdk.StackProps{
			Env: env(),
		},
		Prod: false,
	}

	NewMyServiceStack(app, "beta", &amp;betaProps)

	prodProps := MyServiceStackProps{
		StackProps: awscdk.StackProps{
			Env: env(),
		},
		Prod: true,
	}

	NewMyServiceStack(app, "prod", &amp;prodProps)

	app.Synth(nil)
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This AWS CDK app eventually consists of six stacks, three for each environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk ls

betacpDA8372D3
betadataE23DB2BA
betamon632BD457
prodcp187264CE
proddataF7378CE5
prodmon631A1083</code></pre>
</div>
</div>
<div class="paragraph">
<p>The physical names of the AWS CloudFormation stacks are automatically determined by the AWS CDK based on the stack&#8217;s construct path in the tree. By default, a stack&#8217;s name is derived from the construct ID of the  <code>Stack</code> object. However, you can specify an explicit name by using the <code>stackName</code> prop (in Python, <code>stack_name</code>), as follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'not:a:stack:name', { stackName: 'this-is-stack-name' });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'not:a:stack:name', { stackName: 'this-is-stack-name' });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">MyStack(self, "not:a:stack:name", stack_name="this-is-stack-name")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new MyStack(this, "not:a:stack:name", StackProps.builder()
    .StackName("this-is-stack-name").build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new MyStack(this, "not:a:stack:name", new StackProps
{
    StackName = "this-is-stack-name"
});</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="stack-nesting">Working with nested stacks</h5>
<div class="paragraph">
<p>A  <em>nested stack</em> is a CDK stack that you create inside another stack, known as the parent stack. You create nested stacks using the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.NestedStack.html">NestedStack</a></code> construct.</p>
</div>
<div class="paragraph">
<p>By using nested stacks, you can organize resources across multiple stacks. Nested stacks also offer a way around the AWS CloudFormation 500-resource limit for stacks. A nested stack counts as only one resource in the stack that contains it. However, it can contain up to 500 resources, including additional nested stacks.</p>
</div>
<div class="paragraph">
<p>The scope of a nested stack must be a <code>Stack</code> or <code>NestedStack</code> construct. The nested stack doesn&#8217;t need to be declared lexically inside its parent stack. It is necessary only to pass the parent stack as the first parameter (<code>scope</code>) when instantiating the nested stack. Aside from this restriction, defining constructs in a nested stack works exactly the same as in an ordinary stack.</p>
</div>
<div class="paragraph">
<p>At synthesis time, the nested stack is synthesized to its own AWS CloudFormation template, which is uploaded to the AWS CDK staging bucket at deployment. Nested stacks are bound to their parent stack and are not treated as independent deployment artifacts. They aren&#8217;t listed by <code>cdk list</code>, and they can&#8217;t be deployed by <code>cdk deploy</code>.</p>
</div>
<div class="paragraph">
<p>References between parent stacks and nested stacks are automatically translated to stack parameters and outputs in the generated AWS CloudFormation templates, as with any <a href="#resource-stack">cross-stack reference</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changes in security posture are not displayed before deployment for nested stacks. This information is displayed only for top-level stacks.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="stages">2.10. Introduction to AWS CDK stages</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An AWS Cloud Development Kit (AWS CDK) <em>stage</em> represents a group of one or more CDK stacks that are configured to deploy together. Use stages to deploy the same grouping of stacks to multiple environments, such as development, testing, and production.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>An AWS Cloud Development Kit (AWS CDK)  <em>stage</em> represents a group of one or more CDK stacks that are configured to deploy together. Use stages to deploy the same grouping of stacks to multiple environments, such as development, testing, and production.</p>
</div>
<div class="paragraph">
<p>To configure a CDK stage, import and use the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stage.html">Stage</a></code> construct.</p>
</div>
<div class="paragraph">
<p>The following is a basic example that defines a CDK stage named <code>MyAppStage</code>. We add two CDK stacks, named <code>AppStack</code> and <code>DatabaseStack</code> to our stage. For this example, <code>AppStack</code> contains application resources and <code>DatabaseStack</code> contains database resources. We then create two instances of <code>MyAppStage</code>, for development and production environments:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk-demo-app/lib/app-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

// Define the app stack
export class AppStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);
    // The code that defines your application goes here
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/lib/database-stack.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

// Define the database stack
export class DatabaseStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);
    // The code that defines your database goes here
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/lib/my-stage.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { Stage } from 'aws-cdk-lib';
import { AppStack } from './app-stack';
import { DatabaseStack } from './database-stack';

// Define the stage
export class MyAppStage extends Stage {
  constructor(scope: Construct, id: string, props?: cdk.StageProps) {
    super(scope, id, props);

    // Add both stacks to the stage
    new AppStack(this, 'AppStack');
    new DatabaseStack(this, 'DatabaseStack');
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/bin/cdk-demo-app.ts</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { MyAppStage } from '../lib/my-stage';

// Create a CDK app
const app = new cdk.App();

// Create the development stage
new MyAppStage(app, 'Dev', {
  env: {
    account: '123456789012',
    region: 'us-east-1'
  }
});

// Create the production stage
new MyAppStage(app, 'Prod', {
  env: {
    account: '098765432109',
    region: 'us-east-1'
  }
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk-demo-app/lib/app-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack } = require('aws-cdk-lib');

class AppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // The code that defines your application goes here
  }
}

module.exports = { AppStack }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/lib/database-stack.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack } = require('aws-cdk-lib');

class DatabaseStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // The code that defines your database goes here
  }
}

module.exports = { DatabaseStack }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/lib/my-stage.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stage } = require('aws-cdk-lib');
const { AppStack } = require('./app-stack');
const { DatabaseStack } = require('./database-stack');

// Define the stage
class MyAppStage extends Stage {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Add both stacks to the stage
    new AppStack(this, 'AppStack');
    new DatabaseStack(this, 'DatabaseStack');
  }
}

module.exports = { MyAppStage };</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/bin/cdk-demo-app.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

const cdk = require('aws-cdk-lib');
const { MyAppStage } = require('../lib/my-stage');

// Create the CDK app
const app = new cdk.App();

// Create the development stage
new MyAppStage(app, 'Dev', {
  env: {
    account: '123456789012',
    region: 'us-east-1',
  },
});

// Create the production stage
new MyAppStage(app, 'Prod', {
  env: {
    account: '098765432109',
    region: 'us-east-1',
  },
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk-demo-app/cdk_demo_app/app_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import Stack
from constructs import Construct

# Define the app stack
class AppStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # The code that defines your application goes here</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/cdk_demo_app/database_stack.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import Stack
from constructs import Construct

# Define the database stack
class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # The code that defines your database goes here</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/cdk_demo_app/my_stage.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import Stage
from constructs import Construct
from .app_stack import AppStack
from .database_stack import DatabaseStack

# Define the stage
class MyAppStage(Stage):
    def __init__(self, scope: Construct, id: str, **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        # Add both stacks to the stage
        AppStack(self, "AppStack")
        DatabaseStack(self, "DatabaseStack")</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/app.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os

import aws_cdk as cdk

from cdk_demo_app.my_stage import MyAppStage

#  Create a CDK app
app = cdk.App()

# Create the development stage
MyAppStage(app, 'Dev',
           env=cdk.Environment(account='123456789012', region='us-east-1'),
           )

# Create the production stage
MyAppStage(app, 'Prod',
           env=cdk.Environment(account='098765432109', region='us-east-1'),
           )

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk-demo-app/src/main/java/com/myorg/AppStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class AppStack extends Stack {
    public AppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public AppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // The code that defines your application goes here
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/src/main/java/com/myorg/DatabaseStack.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class DatabaseStack extends Stack {
    public DatabaseStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public DatabaseStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // The code that defines your database goes here
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/src/main/java/com/myorg/MyAppStage.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.Stage;
import software.amazon.awscdk.StageProps;
import software.constructs.Construct;

// Define the stage
public class MyAppStage extends Stage {
    public MyAppStage(final Construct scope, final String id, final software.amazon.awscdk.Environment env) {
        super(scope, id, StageProps.builder().env(env).build());

        // Add both stacks to the stage
        new AppStack(this, "AppStack");
        new DatabaseStack(this, "DatabaseStack");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/src/main/java/com/myorg/CdkDemoAppApp.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

import java.util.Arrays;

public class CdkDemoAppApp {
    public static void main(final String[] args) {

        // Create a CDK app
        App app = new App();

        // Create the development stage
        new MyAppStage(app, "Dev", Environment.builder()
                .account("123456789012")
                .region("us-east-1")
                .build());

        // Create the production stage
        new MyAppStage(app, "Prod", Environment.builder()
        .account("098765432109")
        .region("us-east-1")
        .build());

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk-demo-app/src/CdkDemoApp/AppStack.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace CdkDemoApp
{
    public class AppStack : Stack
    {
        internal AppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // The code that defines your application goes here
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/src/CdkDemoApp/DatabaseStack.cs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace CdkDemoApp
{
    public class DatabaseStack : Stack
    {
        internal DatabaseStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // The code that defines your database goes here
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/src/CdkDemoApp/MyAppStage.cs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace CdkDemoApp
{
    // Define the stage
    public class MyAppStage : Stage
    {
        internal MyAppStage(Construct scope, string id, Environment env) : base(scope, id, new StageProps { Env = env })
        {
            // Add both stacks to the stage
            new AppStack(this, "AppStack");
            new DatabaseStack(this, "DatabaseStack");
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">cdk-demo-app/src/CdkDemoApp/program.cs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using System;
using System.Collections.Generic;
using System.Linq;

namespace CdkDemoApp
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            // Create a CDK app
            var app = new App();

            // Create the development stage
            new MyAppStage(app, "Dev", new Amazon.CDK.Environment
            {
                Account = "123456789012",
                Region = "us-east-1"
            });

            // Create the production stage
            new MyAppStage(app, "Prod", new Amazon.CDK.Environment
            {
                Account = "098765432109",
                Region = "us-east-1"
            });

            app.Synth();
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk-demo-app/cdk-demo-app.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

// Define the app stack
type AppStackProps struct {
	awscdk.StackProps
}

func NewAppStack(scope constructs.Construct, id string, props *AppStackProps) awscdk.Stack {
	stack := awscdk.NewStack(scope, &amp;id, &amp;props.StackProps)

	// The code that defines your application goes here

	return stack
}

// Define the database stack
type DatabaseStackProps struct {
	awscdk.StackProps
}

func NewDatabaseStack(scope constructs.Construct, id string, props *DatabaseStackProps) awscdk.Stack {
	stack := awscdk.NewStack(scope, &amp;id, &amp;props.StackProps)

	// The code that defines your database goes here

	return stack
}

// Define the stage
type MyAppStageProps struct {
	awscdk.StageProps
}

func NewMyAppStage(scope constructs.Construct, id string, props *MyAppStageProps) awscdk.Stage {
	stage := awscdk.NewStage(scope, &amp;id, &amp;props.StageProps)

	// Add both stacks to the stage
	NewAppStack(stage, "AppStack", &amp;AppStackProps{
		StackProps: awscdk.StackProps{
			Env: props.Env,
		},
	})

	NewDatabaseStack(stage, "DatabaseStack", &amp;DatabaseStackProps{
		StackProps: awscdk.StackProps{
			Env: props.Env,
		},
	})

	return stage
}

func main() {
	defer jsii.Close()

	// Create a CDK app
	app := awscdk.NewApp(nil)

	// Create the development stage
	NewMyAppStage(app, "Dev", &amp;MyAppStageProps{
		StageProps: awscdk.StageProps{
			Env: &amp;awscdk.Environment{
				Account: jsii.String("123456789012"),
				Region:  jsii.String("us-east-1"),
			},
		},
	})

	// Create the production stage
	NewMyAppStage(app, "Prod", &amp;MyAppStageProps{
		StageProps: awscdk.StageProps{
			Env: &amp;awscdk.Environment{
				Account: jsii.String("098765432109"),
				Region:  jsii.String("us-east-1"),
			},
		},
	})

	app.Synth(nil)
}

func env() *awscdk.Environment {
	return nil
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, two cloud assemblies are created in <code class="path">cdk.out</code>. These two cloud assemblies contain the synthesized AWS CloudFormation template and assets for each stage. The following is snippet of our project directory:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-demo-app
├── bin
│   └── cdk-demo-app.ts
├── cdk.out
│   ├── assembly-Dev
│   │   ├── DevAppStackunique-hash.assets.json
│   │   ├── DevAppStackunique-hash.template.json
│   │   ├── DevDatabaseStackunique-hash.assets.json
│   │   ├── DevDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── assembly-Prod
│   │   ├── ProdAppStackunique-hash.assets.json
│   │   ├── ProdAppStackunique-hash.template.json
│   │   ├── ProdDatabaseStackunique-hash.assets.json
│   │   ├── ProdDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
└── lib
    ├── app-stack.ts
    ├── database-stack.ts
    └── my-stage.ts</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-demo-app
├── bin
│   └── cdk-demo-app.js
├── cdk.out
│   ├── assembly-Dev
│   │   ├── DevAppStackunique-hash.assets.json
│   │   ├── DevAppStackunique-hash.template.json
│   │   ├── DevDatabaseStackunique-hash.assets.json
│   │   ├── DevDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── assembly-Prod
│   │   ├── ProdAppStackunique-hash.assets.json
│   │   ├── ProdAppStackunique-hash.template.json
│   │   ├── ProdDatabaseStackunique-hash.assets.json
│   │   ├── ProdDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
└── lib
    ├── app-stack.js
    ├── database-stack.js
    └── my-stage.js</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-demo-app
├── app.py
├── cdk.out
│   ├── assembly-Dev
│   │   ├── DevAppStackunique-hash.assets.json
│   │   ├── DevAppStackunique-hash.template.json
│   │   ├── DevDatabaseStackunique-hash.assets.json
│   │   ├── DevDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── assembly-Prod
│   │   ├── ProdAppStackunique-hash.assets.json
│   │   ├── ProdAppStackunique-hash.template.json
│   │   ├── ProdDatabaseStackunique-hash.assets.json
│   │   ├── ProdDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── cdk.out
│   ├── manifest.json
│   └── tree.json
└── cdk_demo_app
    ├── __init__.py
    ├── app_stack.py
    ├── database_stack.py
    └── my_stage.py</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-demo-app
├── cdk.out
│   ├── assembly-Dev
│   │   ├── DevAppStackunique-hash.assets.json
│   │   ├── DevAppStackunique-hash.template.json
│   │   ├── DevDatabaseStackunique-hash.assets.json
│   │   ├── DevDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── assembly-Prod
│   │   ├── ProdAppStackunique-hash.assets.json
│   │   ├── ProdAppStackunique-hash.template.json
│   │   ├── ProdDatabaseStackunique-hash.assets.json
│   │   ├── ProdDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── cdk.out
│   ├── manifest.json
│   └── tree.json
└── src
    └── main
        └── java
            └── com
                └── myorg
                    ├── AppStack.java
                    ├── CdkDemoAppApp.java
                    ├── DatabaseStack.java
                    └── MyAppStage.java</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-demo-app
├── cdk.out
│   ├── assembly-Dev
│   │   ├── DevAppStackunique-hash.assets.json
│   │   ├── DevAppStackunique-hash.template.json
│   │   ├── DevDatabaseStackunique-hash.assets.json
│   │   ├── DevDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── assembly-Prod
│   │   ├── ProdAppStackunique-hash.assets.json
│   │   ├── ProdAppStackunique-hash.template.json
│   │   ├── ProdDatabaseStackunique-hash.assets.json
│   │   ├── ProdDatabaseStackunique-hash.template.json
│   │   ├── cdk.out
│   │   └── manifest.json
│   ├── cdk.out
│   ├── manifest.json
│   └── tree.json
└── src
    └── CdkDemoApp
        ├── AppStack.cs
        ├── DatabaseStack.cs
        ├── MyAppStage.cs
        └── Program.cs</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-demo-app
├── cdk-demo-app.go
└── cdk.out
    ├── assembly-Dev
    │   ├── DevAppStackunique-hash.assets.json
    │   ├── DevAppStackunique-hash.template.json
    │   ├── DevDatabaseStackunique-hash.assets.json
    │   ├── DevDatabaseStackunique-hash.template.json
    │   ├── cdk.out
    │   └── manifest.json
    ├── assembly-Prod
    │   ├── ProdAppStackunique-hash.assets.json
    │   ├── ProdAppStackunique-hash.template.json
    │   ├── ProdDatabaseStackunique-hash.assets.json
    │   ├── ProdDatabaseStackunique-hash.template.json
    │   ├── cdk.out
    │   └── manifest.json
    ├── cdk.out
    ├── manifest.json
    └── tree.json</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When we list our stacks with  <code>cdk list</code>, we see a total of four stacks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk list
Dev/AppStack (Dev-AppStack)
Dev/DatabaseStack (Dev-DatabaseStack)
Prod/AppStack (Prod-AppStack)
Prod/DatabaseStack (Prod-DatabaseStack)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To deploy a specific stage, we run  <code>cdk deploy</code> and provide the stacks to deploy. The following is an example that uses the <code>\*</code> wildcard to deploy both stacks in our <code>Dev</code> stage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk deploy "Dev/*"

✨  Synthesis time: 3.18s

Dev/AppStack (Dev-AppStack)
Dev/AppStack (Dev-AppStack): deploying... [1/2]

 ✅  Dev/AppStack (Dev-AppStack)

✨  Deployment time: 1.11s

Stack ARN:
...

✨  Total time: 4.29s

Dev/DatabaseStack (Dev-DatabaseStack)
Dev/DatabaseStack (Dev-DatabaseStack): deploying... [2/2]

 ✅  Dev/DatabaseStack (Dev-DatabaseStack)

✨  Deployment time: 1.09s

Stack ARN:
...

✨  Total time: 4.27s</code></pre>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="constructs">2.11. AWS CDK Constructs</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Constructs are the basic building blocks of AWS Cloud Development Kit (AWS CDK) applications. A construct is a component within your application that represents one or more AWS CloudFormation resources and their configuration. You build your application, piece by piece, by importing and configuring constructs.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Constructs are the basic building blocks of AWS Cloud Development Kit (AWS CDK) applications. A construct is a component within your application that represents one or more AWS CloudFormation resources and their configuration. You build your application, piece by piece, by importing and configuring constructs.</p>
</div>
<div class="sect3">
<h4 id="constructs-import">2.11.1. Import and use constructs</h4>
<div class="paragraph">
<p>Constructs are classes that you import into your CDK applications from the  <a href="#libraries-construct">AWS Construct Library</a>. You can also create and distribute your own constructs, or use constructs created by third-party developers.</p>
</div>
<div class="paragraph">
<p>Constructs are part of the Construct Programming Model (CPM). They are available to use with other tools such as CDK for <code class="noloc">Terraform</code> (CDKtf), CDK for  <code class="noloc">Kubernetes</code> (CDK8s), and  <code class="noloc">Projen</code>.</p>
</div>
<div class="paragraph">
<p>Numerous third parties have also published constructs compatible with the AWS CDK. Visit <a href="https://constructs.dev/search?q=&amp;cdk=aws-cdk&amp;cdkver=2&amp;offset=0">Construct Hub</a> to explore the AWS CDK construct partner ecosystem.</p>
</div>
</div>
<div class="sect3">
<h4 id="constructs-lib-levels">2.11.2. Construct levels</h4>
<div class="paragraph">
<p>Constructs from the AWS Construct Library are categorized into three levels. Each level offers an increasing level of abstraction. The higher the abstraction, the easier to configure, requiring less expertise. The lower the abstraction, the more customization available, requiring more expertise.</p>
</div>
<div id="constructs-lib-levels-one" class="dlist">
<dl>
<dt class="hdlist1">Level 1 (L1) constructs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>L1 constructs, also known as <em>CFN resources</em>, are the lowest-level construct and offer no abstraction. Each L1 construct maps directly to a single AWS CloudFormation resource. With L1 constructs, you import a construct that represents a specific AWS CloudFormation resource. You then define the resource&#8217;s properties within your construct instance.</p>
<div class="paragraph">
<p>L1 constructs are great to use when you are familiar with AWS CloudFormation and need complete control over defining your AWS resource properties.</p>
</div>
<div class="paragraph">
<p>In the AWS Construct Library, L1 constructs are named starting with <code>Cfn</code>, followed by an identifier for the AWS CloudFormation resource that it represents. For example, the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.CfnBucket.html">CfnBucket</a></code> construct is an L1 construct that represents an <code><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-s3-bucket.html">AWS::S3::Bucket</a></code> AWS CloudFormation resource.</p>
</div>
<div class="paragraph">
<p>L1 constructs are generated from the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">AWS CloudFormation resource specification</a>. If a resource exists in AWS CloudFormation, it&#8217;ll be available in the AWS CDK as an L1 construct. New resources or properties may take up to a week to become available in the AWS Construct Library. For more information, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">AWS resource and property types reference</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="constructs-lib-levels-two" class="dlist">
<dl>
<dt class="hdlist1">Level 2 (L2) constructs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>L2 constructs, also known as <em>curated</em> constructs, are thoughtfully developed by the CDK team and are usually the most widely used construct type. L2 constructs map directly to single AWS CloudFormation resources, similar to L1 constructs. Compared to L1 constructs, L2 constructs provide a higher-level abstraction through an intuitive intent-based API. L2 constructs include sensible default property configurations, best practice security policies, and generate a lot of the boilerplate code and glue logic for you.</p>
<div class="paragraph">
<p>L2 constructs also provide helper methods for most resources that make it simpler and quicker to define properties, permissions, event-based interactions between resources, and more.</p>
</div>
<div class="paragraph">
<p>The <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">s3.Bucket</a></code> class is an example of an L2 construct for an Amazon Simple Storage Service (Amazon S3) bucket resource.</p>
</div>
<div class="paragraph">
<p>The AWS Construct Library contains L2 constructs that are designated stable and ready for production use. For L2 constructs under development, they are designated as experimental and offered in a separate module.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="constructs-lib-levels-three" class="dlist">
<dl>
<dt class="hdlist1">Level 3 (L3) constructs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>L3 constructs, also known as <em>patterns</em>, are the highest-level of abstraction. Each L3 construct can contain a collection of resources that are configured to work together to accomplish a specific task or service within your application. L3 constructs are used to create entire AWS architectures for particular use cases in your application.</p>
<div class="paragraph">
<p>To provide complete system designs, or substantial parts of a larger system, L3 constructs offer opinionated default property configurations. They are built around a particular approach toward solving a problem and providing a solution. With L3 constructs, you can create and configure multiple resources quickly, with the fewest amount of input and code.</p>
</div>
<div class="paragraph">
<p>The <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecs_patterns.ApplicationLoadBalancedFargateService.html">ecsPatterns.ApplicationLoadBalancedFargateService</a></code> class is an example of an L3 construct that represents an AWS Fargate service running on an Amazon Elastic Container Service (Amazon ECS) cluster and fronted by an application load balancer.</p>
</div>
<div class="paragraph">
<p>Similar to L2 constructs, L3 constructs that are ready for production use are included in the AWS Construct Library. Those under development are offered in separate modules.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="constructs-define">2.11.3. Defining constructs</h4>
<div class="sect4">
<h5 id="constructs-composition">Composition</h5>
<div class="paragraph">
<p><em>Composition</em> is the key pattern for defining higher-level abstractions through constructs. A high-level construct can be composed from any number of lower-level constructs. From a bottom-up perspective, you use constructs to organize the individual AWS resources that you want to deploy. You use whatever abstractions are convenient for your purpose, with as many levels as you need.</p>
</div>
<div class="paragraph">
<p>With composition, you define reusable components and share them like any other code. For example, a team can define a construct that implements the company&#8217;s best practice for an Amazon DynamoDB table, including backup, global replication, automatic scaling, and monitoring. The team can share the construct internally with other teams, or publicly.</p>
</div>
<div class="paragraph">
<p>Teams can use constructs like any other library package. When the library is updated, developers get access to the new version&#8217;s improvements and bug fixes, similar to any other code library.</p>
</div>
</div>
<div class="sect4">
<h5 id="constructs-init">Initialization</h5>
<div class="paragraph">
<p>Constructs are implemented in classes that extend the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct</a> base class. You define a construct by instantiating the class. All constructs take three parameters when they are initialized:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scope</strong> – The construct&#8217;s parent or owner. This can either be a stack or another construct. Scope determines the construct&#8217;s place in the <a href="#apps-tree">construct tree</a>. You should usually pass <code>this</code> (<code>self</code> in <code class="noloc">Python</code>), which represents the current object, for the scope.</p>
</li>
<li>
<p><strong>id</strong> – An <a href="#identifiers">identifier</a> that must be unique within the scope. The identifier serves as a namespace for everything that&#8217;s defined within the construct. It&#8217;s used to generate unique identifiers, such as <a href="#resources-physical-names">resource names</a> and AWS CloudFormation logical IDs.</p>
<div class="paragraph">
<p>Identifiers need only be unique within a scope. This lets you instantiate and reuse constructs without concern for the constructs and identifiers they might contain, and enables composing constructs into higher-level abstractions. In addition, scopes make it possible to refer to groups of constructs all at once. Examples include for <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Tag.html">tagging</a>, or specifying where the constructs will be deployed.</p>
</div>
</li>
<li>
<p><strong>props</strong> – A set of properties or keyword arguments, depending on the language, that define the construct&#8217;s initial configuration. Higher-level constructs provide more defaults, and if all prop elements are optional, you can omit the props parameter completely.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="constructs-config">Configuration</h5>
<div class="paragraph">
<p>Most constructs accept  <code>props</code> as their third argument (or in Python, keyword arguments), a name/value collection that defines the construct&#8217;s configuration. The following example defines a bucket with AWS Key Management Service (AWS KMS) encryption and static website hosting enabled. Since it does not explicitly specify an encryption key, the <code>Bucket</code> construct defines a new <code>kms.Key</code> and associates it with the bucket.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new s3.Bucket(this, 'MyEncryptedBucket', {
  encryption: s3.BucketEncryption.KMS,
  websiteIndexDocument: 'index.html'
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new s3.Bucket(this, 'MyEncryptedBucket', {
  encryption: s3.BucketEncryption.KMS,
  websiteIndexDocument: 'index.html'
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">s3.Bucket(self, "MyEncryptedBucket", encryption=s3.BucketEncryption.KMS,
    website_index_document="index.html")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket.Builder.create(this, "MyEncryptedBucket")
        .encryption(BucketEncryption.KMS_MANAGED)
        .websiteIndexDocument("index.html").build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new Bucket(this, "MyEncryptedBucket", new BucketProps
{
    Encryption = BucketEncryption.KMS_MANAGED,
    WebsiteIndexDocument = "index.html"
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	awss3.NewBucket(stack, jsii.String("MyEncryptedBucket"), &amp;awss3.BucketProps{
		Encryption: awss3.BucketEncryption_KMS,
		WebsiteIndexDocument: jsii.String("index.html"),
	})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="constructs-interact">Interacting with constructs</h5>
<div class="paragraph">
<p>Constructs are classes that extend the base  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct</a> class. After you instantiate a construct, the construct object exposes a set of methods and properties that let you interact with the construct and pass it around as a reference to other parts of the system.</p>
</div>
<div class="paragraph">
<p>The AWS CDK framework doesn&#8217;t put any restrictions on the APIs of constructs. Authors can define any API they want. However, the AWS constructs that are included with the AWS Construct Library, such as <code>s3.Bucket</code>, follow guidelines and common patterns. This provides a consistent experience across all AWS resources.</p>
</div>
<div class="paragraph">
<p>Most AWS constructs have a set of <a href="#permissions-grants">grant</a> methods that you can use to grant AWS Identity and Access Management (IAM) permissions on that construct to a principal. The following example grants the IAM group <code>data-science</code> permission to read from the Amazon S3 bucket <code>raw-data</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const rawData = new s3.Bucket(this, 'raw-data');
const dataScience = new iam.Group(this, 'data-science');
rawData.grantRead(dataScience);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const rawData = new s3.Bucket(this, 'raw-data');
const dataScience = new iam.Group(this, 'data-science');
rawData.grantRead(dataScience);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">raw_data = s3.Bucket(self, 'raw-data')
data_science = iam.Group(self, 'data-science')
raw_data.grant_read(data_science)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket rawData = new Bucket(this, "raw-data");
Group dataScience = new Group(this, "data-science");
rawData.grantRead(dataScience);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var rawData = new Bucket(this, "raw-data");
var dataScience = new Group(this, "data-science");
rawData.GrantRead(dataScience);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	rawData := awss3.NewBucket(stack, jsii.String("raw-data"), nil)
	dataScience := awsiam.NewGroup(stack, jsii.String("data-science"), nil)
	rawData.GrantRead(dataScience, nil)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another common pattern is for AWS constructs to set one of the resource&#8217;s attributes from data supplied elsewhere. Attributes can include Amazon Resource Names (ARNs), names, or URLs.</p>
</div>
<div class="paragraph">
<p>The following code defines an AWS Lambda function and associates it with an Amazon Simple Queue Service (Amazon SQS) queue through the queue&#8217;s URL in an environment variable.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const jobsQueue = new sqs.Queue(this, 'jobs');
const createJobLambda = new lambda.Function(this, 'create-job', {
  runtime: lambda.Runtime.NODEJS_18_X,
  handler: 'index.handler',
  code: lambda.Code.fromAsset('./create-job-lambda-code'),
  environment: {
    QUEUE_URL: jobsQueue.queueUrl
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const jobsQueue = new sqs.Queue(this, 'jobs');
const createJobLambda = new lambda.Function(this, 'create-job', {
  runtime: lambda.Runtime.NODEJS_18_X,
  handler: 'index.handler',
  code: lambda.Code.fromAsset('./create-job-lambda-code'),
  environment: {
    QUEUE_URL: jobsQueue.queueUrl
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">jobs_queue = sqs.Queue(self, "jobs")
create_job_lambda = lambda_.Function(self, "create-job",
    runtime=lambda_.Runtime.NODEJS_18_X,
    handler="index.handler",
    code=lambda_.Code.from_asset("./create-job-lambda-code"),
    environment=dict(
        QUEUE_URL=jobs_queue.queue_url
    )
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final Queue jobsQueue = new Queue(this, "jobs");
Function createJobLambda = Function.Builder.create(this, "create-job")
                .handler("index.handler")
                .code(Code.fromAsset("./create-job-lambda-code"))
                .environment(java.util.Map.of(   // Map.of is Java 9 or later
                    "QUEUE_URL", jobsQueue.getQueueUrl())
                .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var jobsQueue = new Queue(this, "jobs");
var createJobLambda = new Function(this, "create-job", new FunctionProps
{
    Runtime = Runtime.NODEJS_18_X,
    Handler = "index.handler",
    Code = Code.FromAsset(@".\create-job-lambda-code"),
    Environment = new Dictionary&lt;string, string&gt;
    {
        ["QUEUE_URL"] = jobsQueue.QueueUrl
    }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	createJobLambda := awslambda.NewFunction(stack, jsii.String("create-job"), &amp;awslambda.FunctionProps{
		Runtime: awslambda.Runtime_NODEJS_18_X(),
		Handler: jsii.String("index.handler"),
		Code:    awslambda.Code_FromAsset(jsii.String(".\\create-job-lambda-code"), nil),
		Environment: &amp;map[string]*string{
			"QUEUE_URL": jsii.String(*jobsQueue.QueueUrl()),
		},
	})</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information about the most common API patterns in the AWS Construct Library, see  <a href="#resources">Resources and the AWS CDK</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="constructs-apps-stacks">The app and stack construct</h5>
<div class="paragraph">
<p>The  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.App.html">App</a></code> and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> classes from the AWS Construct Library are unique constructs. Compared to other constructs, they don&#8217;t configure AWS resources on their own. Instead, they are used to provide context for your other constructs. All constructs that represent AWS resources must be defined, directly or indirectly, within the scope of a <code>Stack</code> construct. <code>Stack</code> constructs are defined within the scope of an <code>App</code> construct.</p>
</div>
<div class="paragraph">
<p>To learn more about CDK apps, see <a href="#apps">AWS CDK apps</a>. To learn more about CDK stacks, see <a href="#stacks">Introduction to AWS CDK stacks</a>.</p>
</div>
<div class="paragraph">
<p>The following example defines an app with a single stack. Within the stack, an L2 construct is used to configure an Amazon S3 bucket resource.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { App, Stack, StackProps } from 'aws-cdk-lib';
import * as s3 from 'aws-cdk-lib/aws-s3';

class HelloCdkStack extends Stack {
  constructor(scope: App, id: string, props?: StackProps) {
    super(scope, id, props);

    new s3.Bucket(this, 'MyFirstBucket', {
      versioned: true
    });
  }
}

const app = new App();
new HelloCdkStack(app, "HelloCdkStack");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { App , Stack } = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');

class HelloCdkStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    new s3.Bucket(this, 'MyFirstBucket', {
      versioned: true
    });
  }
}

const app = new App();
new HelloCdkStack(app, "HelloCdkStack");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import App, Stack
import aws_cdk.aws_s3 as s3
from constructs import Construct

class HelloCdkStack(Stack):

    def __init__(self, scope: Construct, id: str, **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        s3.Bucket(self, "MyFirstBucket", versioned=True)

app = App()
HelloCdkStack(app, "HelloCdkStack")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Stack defined in <code class="path">HelloCdkStack.java</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.s3.*;

public class HelloCdkStack extends Stack {
    public HelloCdkStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public HelloCdkStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Bucket.Builder.create(this, "MyFirstBucket")
            .versioned(true).build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>App defined in  <code class="path">HelloCdkApp.java</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.App;
import software.amazon.awscdk.StackProps;

public class HelloCdkApp {
    public static void main(final String[] args) {
        App app = new App();

        new HelloCdkStack(app, "HelloCdkStack", StackProps.builder()
                .build());

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.S3;

namespace HelloCdkApp
{
    internal static class Program
    {
        public static void Main(string[] args)
        {
            var app = new App();
            new HelloCdkStack(app, "HelloCdkStack");
            app.Synth();
        }
    }

    public class HelloCdkStack : Stack
    {
        public HelloCdkStack(Construct scope, string id, IStackProps props=null) : base(scope, id, props)
        {
            new Bucket(this, "MyFirstBucket", new BucketProps { Versioned = true });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">func NewHelloCdkStack(scope constructs.Construct, id string, props *HelloCdkStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	awss3.NewBucket(stack, jsii.String("MyFirstBucket"), &amp;awss3.BucketProps{
		Versioned: jsii.Bool(true),
	})

	return stack
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="constructs-work">2.11.4. Working with constructs</h4>
<div class="sect4">
<h5 id="constructs-l1-using">Working with L1 constructs</h5>
<div class="paragraph">
<p>L1 constructs map directly to individual AWS CloudFormation resources. You must provide the resource&#8217;s required configuration.</p>
</div>
<div class="paragraph">
<p>In this example, we create a <code>bucket</code> object using the <code>CfnBucket</code> L1 construct:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.CfnBucket(this, "amzn-s3-demo-bucket", {
  bucketName: "amzn-s3-demo-bucket"
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.CfnBucket(this, "amzn-s3-demo-bucket", {
  bucketName: "amzn-s3-demo-bucket"
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = s3.CfnBucket(self, "amzn-s3-demo-bucket", bucket_name="amzn-s3-demo-bucket")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnBucket bucket = new CfnBucket.Builder().bucketName("amzn-s3-demo-bucket").build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new CfnBucket(this, "amzn-s3-demo-bucket", new CfnBucketProps
{
    BucketName= "amzn-s3-demo-bucket"
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	awss3.NewCfnBucket(stack, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.CfnBucketProps{
		BucketName: jsii.String("amzn-s3-demo-bucket"),
	})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Construct properties that aren&#8217;t simple Booleans, strings, numbers, or containers are handled differently in the supported languages.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.CfnBucket(this, "amzn-s3-demo-bucket", {
  bucketName: "amzn-s3-demo-bucket",
  corsConfiguration: {
    corsRules: [{
          allowedOrigins: ["*"],
          allowedMethods: ["GET"]
    }]
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.CfnBucket(this, "amzn-s3-demo-bucket", {
  bucketName: "amzn-s3-demo-bucket",
  corsConfiguration: {
    corsRules: [{
          allowedOrigins: ["*"],
          allowedMethods: ["GET"]
    }]
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Python, these properties are represented by types defined as inner classes of the L1 construct. For example, the optional property <code>cors_configuration</code> of a <code>CfnBucket</code> requires a wrapper of type <code>CfnBucket.CorsConfigurationProperty</code>. Here we are defining <code>cors_configuration</code> on a <code>CfnBucket</code> instance.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = CfnBucket(self, "amzn-s3-demo-bucket", bucket_name="amzn-s3-demo-bucket",
    cors_configuration=CfnBucket.CorsConfigurationProperty(
        cors_rules=[CfnBucket.CorsRuleProperty(
            allowed_origins=["*"],
            allowed_methods=["GET"]
        )]
    )
)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Java, these properties are represented by types defined as inner classes of the L1 construct. For example, the optional property <code>corsConfiguration</code> of a <code>CfnBucket</code> requires a wrapper of type <code>CfnBucket.CorsConfigurationProperty</code>. Here we are defining <code>corsConfiguration</code> on a <code>CfnBucket</code> instance.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnBucket bucket = CfnBucket.Builder.create(this, "amzn-s3-demo-bucket")
                        .bucketName("amzn-s3-demo-bucket")
                        .corsConfiguration(new CfnBucket.CorsConfigurationProperty.Builder()
                            .corsRules(Arrays.asList(new CfnBucket.CorsRuleProperty.Builder()
                                .allowedOrigins(Arrays.asList("*"))
                                .allowedMethods(Arrays.asList("GET"))
                                .build()))
                            .build())
                        .build();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In C#, these properties are represented by types defined as inner classes of the L1 construct. For example, the optional property <code>CorsConfiguration</code> of a <code>CfnBucket</code> requires a wrapper of type <code>CfnBucket.CorsConfigurationProperty</code>. Here we are defining <code>CorsConfiguration</code> on a <code>CfnBucket</code> instance.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new CfnBucket(this, "amzn-s3-demo-bucket", new CfnBucketProps
{
    BucketName = "amzn-s3-demo-bucket",
    CorsConfiguration = new CfnBucket.CorsConfigurationProperty
    {
        CorsRules = new object[] {
            new CfnBucket.CorsRuleProperty
            {
                AllowedOrigins = new string[] { "*" },
                AllowedMethods = new string[] { "GET" },
            }
        }
    }
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Go, these types are named using the name of the L1 construct, an underscore, and the property name. For example, the optional property <code>CorsConfiguration</code> of a <code>CfnBucket</code> requires a wrapper of type <code>CfnBucket_CorsConfigurationProperty</code>. Here we are defining <code>CorsConfiguration</code> on a <code>CfnBucket</code> instance.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	awss3.NewCfnBucket(stack, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.CfnBucketProps{
		BucketName: jsii.String("amzn-s3-demo-bucket"),
		CorsConfiguration: &amp;awss3.CfnBucket_CorsConfigurationProperty{
			CorsRules: []awss3.CorsRule{
				awss3.CorsRule{
					AllowedOrigins: jsii.Strings("*"),
					AllowedMethods: &amp;[]awss3.HttpMethods{"GET"},
				},
			},
		},
	})</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can&#8217;t use L2 property types with L1 constructs, or vice versa. When working with L1 constructs, always use the types defined for the L1 construct you&#8217;re using. Do not use types from other L1 constructs (some may have the same name, but they are not the same type).</p>
</div>
<div class="paragraph">
<p>Some of our language-specific API references currently have errors in the paths to L1 property types, or don&#8217;t document these classes at all. We hope to fix this soon. In the meantime, remember that such types are always inner classes of the L1 construct they are used with.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="constructs-using">Working with L2 constructs</h5>
<div class="paragraph">
<p>In the following example, we define an Amazon S3 bucket by creating an object from the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">Bucket</a> L2 construct:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as s3 from 'aws-cdk-lib/aws-s3';

// "this" is HelloCdkStack
new s3.Bucket(this, 'MyFirstBucket', {
  versioned: true
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const s3 = require('aws-cdk-lib/aws-s3');

// "this" is HelloCdkStack
new s3.Bucket(this, 'MyFirstBucket', {
  versioned: true
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_s3 as s3

# "self" is HelloCdkStack
s3.Bucket(self, "MyFirstBucket", versioned=True)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.s3.*;

public class HelloCdkStack extends Stack {
    public HelloCdkStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public HelloCdkStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Bucket.Builder.create(this, "MyFirstBucket")
                .versioned(true).build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.S3;

// "this" is HelloCdkStack
new Bucket(this, "MyFirstBucket", new BucketProps
{
    Versioned = true
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
	"github.com/aws/aws-cdk-go/awscdk/v2/awss3"
	"github.com/aws/jsii-runtime-go"
)

// stack is HelloCdkStack
awss3.NewBucket(stack, jsii.String("MyFirstBucket"), &amp;awss3.BucketProps{
		Versioned: jsii.Bool(true),
	})&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MyFirstBucket</code> is not the name of the bucket that AWS CloudFormation creates. It is a logical identifier given to the new construct within the context of your CDK app. The <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Resource.html#physicalname">physicalName</a> value will be used to name the AWS CloudFormation resource.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="constructs-work-third">2.11.5. Working with third-party constructs</h4>
<div class="paragraph">
<p><a href="https://constructs.dev/search?q=&amp;cdk=aws-cdk&amp;cdkver=2&amp;sort=downloadsDesc&amp;offset=0">Construct Hub</a> is a resource to help you discover additional constructs from AWS, third parties, and the open-source CDK community.</p>
</div>
<div class="sect4">
<h5 id="constructs-author">Writing your own constructs</h5>
<div class="paragraph">
<p>In addition to using existing constructs, you can also write your own constructs and let anyone use them in their apps. All constructs are equal in the AWS CDK. Constructs from the AWS Construct Library are treated the same as a construct from a third-party library published via  <code class="noloc">NPM</code>,  <code class="noloc">Maven</code>, or  <code class="noloc">PyPI</code>. Constructs published to your company&#8217;s internal package repository are also treated in the same way.</p>
</div>
<div class="paragraph">
<p>To declare a new construct, create a class that extends the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct</a> base class, in the <code>constructs</code> package, then follow the pattern for initializer arguments.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare a construct that represents an Amazon S3 bucket. The S3 bucket sends an Amazon Simple Notification Service (Amazon SNS) notification every time someone uploads a file into it.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export interface NotifyingBucketProps {
  prefix?: string;
}

export class NotifyingBucket extends Construct {
  constructor(scope: Construct, id: string, props: NotifyingBucketProps = {}) {
    super(scope, id);
    const bucket = new s3.Bucket(this, 'bucket');
    const topic = new sns.Topic(this, 'topic');
    bucket.addObjectCreatedNotification(new s3notify.SnsDestination(topic),
      { prefix: props.prefix });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class NotifyingBucket extends Construct {
  constructor(scope, id, props = {}) {
    super(scope, id);
    const bucket = new s3.Bucket(this, 'bucket');
    const topic = new sns.Topic(this, 'topic');
    bucket.addObjectCreatedNotification(new s3notify.SnsDestination(topic),
      { prefix: props.prefix });
  }
}

module.exports = { NotifyingBucket }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class NotifyingBucket(Construct):

    def __init__(self, scope: Construct, id: str, *, prefix=None):
        super().__init__(scope, id)
        bucket = s3.Bucket(self, "bucket")
        topic = sns.Topic(self, "topic")
        bucket.add_object_created_notification(s3notify.SnsDestination(topic),
            s3.NotificationKeyFilter(prefix=prefix))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class NotifyingBucket extends Construct {

    public NotifyingBucket(final Construct scope, final String id) {
        this(scope, id, null, null);
    }

    public NotifyingBucket(final Construct scope, final String id, final BucketProps props) {
        this(scope, id, props, null);
    }

    public NotifyingBucket(final Construct scope, final String id, final String prefix) {
        this(scope, id, null, prefix);
    }

    public NotifyingBucket(final Construct scope, final String id, final BucketProps props, final String prefix) {
        super(scope, id);

        Bucket bucket = new Bucket(this, "bucket");
        Topic topic = new Topic(this, "topic");
        if (prefix != null)
            bucket.addObjectCreatedNotification(new SnsDestination(topic),
                NotificationKeyFilter.builder().prefix(prefix).build());
     }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class NotifyingBucketProps : BucketProps
{
    public string Prefix { get; set; }
}

public class NotifyingBucket : Construct
{
    public NotifyingBucket(Construct scope, string id, NotifyingBucketProps props = null) : base(scope, id)
    {
        var bucket = new Bucket(this, "bucket");
        var topic = new Topic(this, "topic");
        bucket.AddObjectCreatedNotification(new SnsDestination(topic), new NotificationKeyFilter
        {
            Prefix = props?.Prefix
        });
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">type NotifyingBucketProps struct {
	awss3.BucketProps
	Prefix *string
}

func NewNotifyingBucket(scope constructs.Construct, id *string, props *NotifyingBucketProps) awss3.Bucket {
	var bucket awss3.Bucket
	if props == nil {
		bucket = awss3.NewBucket(scope, jsii.String(*id+"Bucket"), nil)
	} else {
		bucket = awss3.NewBucket(scope, jsii.String(*id+"Bucket"), &amp;props.BucketProps)
	}
	topic := awssns.NewTopic(scope, jsii.String(*id+"Topic"), nil)
	if props == nil {
		bucket.AddObjectCreatedNotification(awss3notifications.NewSnsDestination(topic))
	} else {
		bucket.AddObjectCreatedNotification(awss3notifications.NewSnsDestination(topic), &amp;awss3.NotificationKeyFilter{
			Prefix: props.Prefix,
		})
	}
	return bucket
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Our  <code>NotifyingBucket</code> construct inherits not from <code>Bucket</code> but rather from <code>Construct</code>. We are using composition, not inheritance, to bundle an Amazon S3 bucket and an Amazon SNS topic together. In general, composition is preferred over inheritance when developing AWS CDK constructs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The  <code>NotifyingBucket</code> constructor has a typical construct signature: <code>scope</code>, <code>id</code>, and <code>props</code>. The last argument, <code>props</code>, is optional (gets the default value <code>{}</code>) because all props are optional. (The base <code>Construct</code> class does not take a <code>props</code> argument.) You could define an instance of this construct in your app without <code>props</code>, for example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new NotifyingBucket(this, 'MyNotifyingBucket');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new NotifyingBucket(this, 'MyNotifyingBucket');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">NotifyingBucket(self, "MyNotifyingBucket")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new NotifyingBucket(this, "MyNotifyingBucket");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new NotifyingBucket(this, "MyNotifyingBucket");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">NewNotifyingBucket(stack, jsii.String("MyNotifyingBucket"), nil)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you could use  <code>props</code> (in Java, an additional parameter) to specify the path prefix to filter on, for example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new NotifyingBucket(this, 'MyNotifyingBucket', { prefix: 'images/' });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new NotifyingBucket(this, 'MyNotifyingBucket', { prefix: 'images/' });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">NotifyingBucket(self, "MyNotifyingBucket", prefix="images/")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new NotifyingBucket(this, "MyNotifyingBucket", "/images");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new NotifyingBucket(this, "MyNotifyingBucket", new NotifyingBucketProps
{
    Prefix = "/images"
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">NewNotifyingBucket(stack, jsii.String("MyNotifyingBucket"), &amp;NotifyingBucketProps{
	Prefix: jsii.String("images/"),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, you would also want to expose some properties or methods on your constructs. It&#8217;s not very useful to have a topic hidden behind your construct, because users of your construct aren&#8217;t able to subscribe to it. Adding a  <code>topic</code> property lets consumers access the inner topic, as shown in the following example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export class NotifyingBucket extends Construct {
  public readonly topic: sns.Topic;

  constructor(scope: Construct, id: string, props: NotifyingBucketProps) {
    super(scope, id);
    const bucket = new s3.Bucket(this, 'bucket');
    this.topic = new sns.Topic(this, 'topic');
    bucket.addObjectCreatedNotification(new s3notify.SnsDestination(this.topic), { prefix: props.prefix });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class NotifyingBucket extends Construct {

  constructor(scope, id, props) {
    super(scope, id);
    const bucket = new s3.Bucket(this, 'bucket');
    this.topic = new sns.Topic(this, 'topic');
    bucket.addObjectCreatedNotification(new s3notify.SnsDestination(this.topic), { prefix: props.prefix });
  }
}

module.exports = { NotifyingBucket };</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class NotifyingBucket(Construct):

    def __init__(self, scope: Construct, id: str, *, prefix=None, **kwargs):
        super().__init__(scope, id)
        bucket = s3.Bucket(self, "bucket")
        self.topic = sns.Topic(self, "topic")
        bucket.add_object_created_notification(s3notify.SnsDestination(self.topic),
            s3.NotificationKeyFilter(prefix=prefix))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class NotifyingBucket extends Construct {

    public Topic topic = null;

    public NotifyingBucket(final Construct scope, final String id) {
        this(scope, id, null, null);
    }

    public NotifyingBucket(final Construct scope, final String id, final BucketProps props) {
        this(scope, id, props, null);
    }

    public NotifyingBucket(final Construct scope, final String id, final String prefix) {
        this(scope, id, null, prefix);
    }

    public NotifyingBucket(final Construct scope, final String id, final BucketProps props, final String prefix) {
        super(scope, id);

        Bucket bucket = new Bucket(this, "bucket");
        topic = new Topic(this, "topic");
        if (prefix != null)
            bucket.addObjectCreatedNotification(new SnsDestination(topic),
                NotificationKeyFilter.builder().prefix(prefix).build());
     }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class NotifyingBucket : Construct
{
    public readonly Topic topic;

    public NotifyingBucket(Construct scope, string id, NotifyingBucketProps props = null) : base(scope, id)
    {
        var bucket = new Bucket(this, "bucket");
        topic = new Topic(this, "topic");
        bucket.AddObjectCreatedNotification(new SnsDestination(topic), new NotificationKeyFilter
        {
            Prefix = props?.Prefix
        });
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To do this in Go, we&#8217;ll need a little extra plumbing. Our original <code>NewNotifyingBucket</code> function returned an <code>awss3.Bucket</code>. We&#8217;ll need to extend <code>Bucket</code> to include a <code>topic</code> member by creating a <code>NotifyingBucket</code> struct. Our function will then return this type.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">type NotifyingBucket struct {
	awss3.Bucket
	topic awssns.Topic
}

func NewNotifyingBucket(scope constructs.Construct, id *string, props *NotifyingBucketProps) NotifyingBucket {
	var bucket awss3.Bucket
	if props == nil {
		bucket = awss3.NewBucket(scope, jsii.String(*id+"Bucket"), nil)
	} else {
		bucket = awss3.NewBucket(scope, jsii.String(*id+"Bucket"), &amp;props.BucketProps)
	}
	topic := awssns.NewTopic(scope, jsii.String(*id+"Topic"), nil)
	if props == nil {
		bucket.AddObjectCreatedNotification(awss3notifications.NewSnsDestination(topic))
	} else {
		bucket.AddObjectCreatedNotification(awss3notifications.NewSnsDestination(topic), &amp;awss3.NotificationKeyFilter{
			Prefix: props.Prefix,
		})
	}
	var nbucket NotifyingBucket
	nbucket.Bucket = bucket
	nbucket.topic = topic
	return nbucket
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Now, consumers can subscribe to the topic, for example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const queue = new sqs.Queue(this, 'NewImagesQueue');
const images = new NotifyingBucket(this, '/images');
images.topic.addSubscription(new sns_sub.SqsSubscription(queue));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const queue = new sqs.Queue(this, 'NewImagesQueue');
const images = new NotifyingBucket(this, '/images');
images.topic.addSubscription(new sns_sub.SqsSubscription(queue));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">queue = sqs.Queue(self, "NewImagesQueue")
images = NotifyingBucket(self, prefix="Images")
images.topic.add_subscription(sns_sub.SqsSubscription(queue))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">NotifyingBucket images = new NotifyingBucket(this, "MyNotifyingBucket", "/images");
images.topic.addSubscription(new SqsSubscription(queue));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var queue = new Queue(this, "NewImagesQueue");
var images = new NotifyingBucket(this, "MyNotifyingBucket", new NotifyingBucketProps
{
    Prefix = "/images"
});
images.topic.AddSubscription(new SqsSubscription(queue));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	queue := awssqs.NewQueue(stack, jsii.String("NewImagesQueue"), nil)
	images := NewNotifyingBucket(stack, jsii.String("MyNotifyingBucket"), &amp;NotifyingBucketProps{
		Prefix: jsii.String("/images"),
	})
	images.topic.AddSubscription(awssnssubscriptions.NewSqsSubscription(queue, nil))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="constructs-learn">2.11.6. Learn more</h4>
<div class="paragraph">
<p>The following video provides a comprehensive overview of CDK constructs, and explains how you can use them in your CDK apps.</p>
</div>
<div class="videoblock text-center">
<div class="content">
<iframe width="480" height="390" src="https://www.youtube.com/embed/PzU-i0rJPGw?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="environments">2.12. Environments for the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An environment consists of the AWS account and AWS Region that you deploy an AWS Cloud Development Kit (AWS CDK) stack to.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>An environment consists of the AWS account and AWS Region that you deploy an AWS Cloud Development Kit (AWS CDK) stack to.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AWS account</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When you create an AWS account, you receive an account ID. This ID is a 12-digit number, such as <strong>012345678901</strong>, that uniquely identifies your account. To learn more, see <a href="https://docs.aws.amazon.com/accounts/latest/reference/manage-acct-identifiers.html">View AWS account identifiers</a> in the <em>AWS Account Management Reference Guide</em>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">AWS Region</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>AWS Regions are named by using a combination of geographical location and a number that represents an Availability Zone in the Region. For example, <strong><code class="noloc">us-east-1</code></strong> represents an Availability Zone in the US East (N. Virginia) Region. To learn more about AWS Regions, see <a href="https://aws.amazon.com/about-aws/global-infrastructure/regions_az/">Regions and Availability Zones</a>. For a list of Region codes, see <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints">Regional endpoints</a> in the <em>AWS General Reference</em> Reference Guide.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The AWS CDK can determine environments from your credentials and configuration files. These files can be created and managed with the AWS Command Line Interface (AWS CLI). The following is a basic example of these files:</p>
</div>
<div class="paragraph">
<p><strong>Credentials file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-toml" data-lang="toml">[default]
aws_access_key_id=ASIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
aws_session_token = IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGEXAMPLE

[user1]
aws_access_key_id=ASIAI44QH8DHBEXAMPLE
aws_secret_access_key=je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY
aws_session_token = fcZib3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZ2luX2IQoJb3JpZVERYLONGSTRINGEXAMPLE</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-toml" data-lang="toml">[default]
region=us-west-2
output=json

[profile user1]
region=us-east-1
output=text</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can pass environment information from these files in your CDK code through environment variables that are provided by the CDK. When you run a CDK  <code class="noloc">CLI</code> command, such as  <code>cdk deploy</code>, you then provide the profile from your credentials and configuration files to gather environment information from.</p>
</div>
<div class="paragraph">
<p>The following is an example of specifying these environment variables in your CDK code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyDevStack(app, 'dev', {
  env: {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION
}});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of passing values associated with the  <code>user1</code> profile from your credentials and configuration files to the CDK <code class="noloc">CLI</code> using the  <code>--profile</code> option. Values from these files will be passed to your environment variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy myStack --profile user1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using values from the credentials and configuration files, you can also hard-code environment values in your CDK code. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const envEU = { account: '238383838383', region: 'eu-west-1' };
const envUSA = { account: '837873873873', region: 'us-west-2' };

new MyFirstStack(app, 'first-stack-us', { env: envUSA });
new MyFirstStack(app, 'first-stack-eu', { env: envEU });</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="environments-learn">2.12.1. Learn more</h4>
<div class="paragraph">
<p>To get started with using environments with the AWS CDK, see  <a href="#configure-env">Configure environments to use with the AWS CDK</a>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="bootstrapping">2.13. AWS CDK bootstrapping</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p><em>Bootstrapping</em> is the process of preparing your AWS environment for usage with the AWS Cloud Development Kit (AWS CDK). Before you deploy a CDK stack into an AWS environment, the environment must first be bootstrapped.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Bootstrapping</em> is the process of preparing your AWS environment for usage with the AWS Cloud Development Kit (AWS CDK). Before you deploy a CDK stack into an AWS environment, the environment must first be bootstrapped.</p>
</div>
<div class="sect3">
<h4 id="bootstrapping-what">2.13.1. What is bootstrapping?</h4>
<div class="paragraph">
<p>Bootstrapping prepares your AWS environment by provisioning specific AWS resources in your environment that are used by the AWS CDK. These resources are commonly referred to as your  <em>bootstrap resources</em>. They include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Amazon Simple Storage Service (Amazon S3) bucket</strong> – Used to store your CDK project files, such as AWS Lambda function code and assets.</p>
</li>
<li>
<p><strong>Amazon Elastic Container Registry (Amazon ECR) repository</strong> – Used primarily to store <code class="noloc">Docker</code> images.</p>
</li>
<li>
<p><strong>AWS Identity and Access Management (IAM) roles</strong> – Configured to grant permissions needed by the AWS CDK to perform deployments. For more information about the IAM roles created during bootstrapping, see <a href="#bootstrapping-env-roles">IAM roles created during bootstrapping</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-how">2.13.2. How does bootstrapping work?</h4>
<div class="paragraph">
<p><em>Resources and their configuration that are used by the CDK are defined in an AWS CloudFormation template. This template is created and managed by the CDK team. For the latest version of this template, see  <code class="path"><a href="https://github.com/aws/aws-cdk-cli/blob/main/packages/aws-cdk/lib/api/bootstrap/bootstrap-template.yaml">bootstrap-template.yaml</a></code> in the  aws-cdk-cli <code class="noloc">GitHub</code> repository</em>.</p>
</div>
<div class="paragraph">
<p>To bootstrap an environment, you use the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>)  <code>cdk bootstrap</code> command. The CDK <code class="noloc">CLI</code> retrieves the template and deploys it to AWS CloudFormation as a stack, known as the  <em>bootstrap stack</em>. By default, the stack name is <code>CDKToolkit</code>. By deploying this template, CloudFormation provisions the resources in your environment. After deployment, the bootstrap stack will appear in the AWS CloudFormation console of your environment.</p>
</div>
<div class="paragraph">
<p>You can also customize bootstrapping by modifying the template or by using CDK <code class="noloc">CLI</code> options with the  <code>cdk bootstrap</code> command.</p>
</div>
<div class="paragraph">
<p>AWS environments are independent. Each environment that you want to use with the AWS CDK must first be bootstrapped.</p>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-learn">2.13.3. Learn more</h4>
<div class="paragraph">
<p>For instructions on bootstrapping your environment, see  <a href="#bootstrapping-env">Bootstrap your environment for use with the AWS CDK</a>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="resources">2.14. Resources and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p><em>Resources</em> are what you configure to use AWS services in your applications. Resources are a feature of AWS CloudFormation. By configuring resources and their properties in a CloudFormation template, you can deploy to CloudFormation to provision your resources. With the AWS Cloud Development Kit (AWS CDK), you can configure resources through constructs. You then deploy your CDK app, which involves synthesizing a AWS CloudFormation template and deploying to AWS CloudFormation to provision your resources.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Resources</em> are what you configure to use AWS services in your applications. Resources are a feature of AWS CloudFormation. By configuring resources and their properties in a AWS CloudFormation template, you can deploy to AWS CloudFormation to provision your resources. With the AWS Cloud Development Kit (AWS CDK), you can configure resources through constructs. You then deploy your CDK app, which involves synthesizing a AWS CloudFormation template and deploying to AWS CloudFormation to provision your resources.</p>
</div>
<div class="sect3">
<h4 id="resources-configure">2.14.1. Configuring resources using constructs</h4>
<div class="paragraph">
<p>As described in  <a href="#constructs">AWS CDK Constructs</a>, the AWS CDK provides a rich class library of constructs, called <em>AWS constructs</em>, that represent all AWS resources.</p>
</div>
<div class="paragraph">
<p>To create an instance of a resource using its corresponding construct, pass in the scope as the first argument, the logical ID of the construct, and a set of configuration properties (props). For example, here&#8217;s how to create an Amazon SQS queue with AWS KMS encryption using the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html">sqs.Queue</a> construct from the AWS Construct Library.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as sqs from '@aws-cdk/aws-sqs';

new sqs.Queue(this, 'MyQueue', {
    encryption: sqs.QueueEncryption.KMS_MANAGED
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const sqs = require('@aws-cdk/aws-sqs');

new sqs.Queue(this, 'MyQueue', {
    encryption: sqs.QueueEncryption.KMS_MANAGED
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_sqs as sqs

sqs.Queue(self, "MyQueue", encryption=sqs.QueueEncryption.KMS_MANAGED)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.sqs.*;

Queue.Builder.create(this, "MyQueue").encryption(
        QueueEncryption.KMS_MANAGED).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.SQS;

new Queue(this, "MyQueue", new QueueProps
{
    Encryption = QueueEncryption.KMS_MANAGED
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  sqs "github.com/aws/aws-cdk-go/awscdk/v2/awssqs"
)

sqs.NewQueue(stack, jsii.String("MyQueue"), &amp;sqs.QueueProps{
  Encryption: sqs.QueueEncryption_KMS_MANAGED,
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some configuration props are optional, and in many cases have default values. In some cases, all props are optional, and the last argument can be omitted entirely.</p>
</div>
<div class="sect4">
<h5 id="resources-attributes">Resource attributes</h5>
<div class="paragraph">
<p>Most resources in the AWS Construct Library expose attributes, which are resolved at deployment time by AWS CloudFormation. Attributes are exposed in the form of properties on the resource classes with the type name as a prefix. The following example shows how to get the URL of an Amazon SQS queue using the  <code>queueUrl</code> (Python: <code>queue_url</code>) property.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as sqs from '@aws-cdk/aws-sqs';

const queue = new sqs.Queue(this, 'MyQueue');
const url = queue.queueUrl; // =&gt; A string representing a deploy-time value</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const sqs = require('@aws-cdk/aws-sqs');

const queue = new sqs.Queue(this, 'MyQueue');
const url = queue.queueUrl; // =&gt; A string representing a deploy-time value</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_sqs as sqs

queue = sqs.Queue(self, "MyQueue")
url = queue.queue_url # =&gt; A string representing a deploy-time value</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Queue queue = new Queue(this, "MyQueue");
String url = queue.getQueueUrl();    // =&gt; A string representing a deploy-time value</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var queue = new Queue(this, "MyQueue");
var url = queue.QueueUrl; // =&gt; A string representing a deploy-time value</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  sqs "github.com/aws/aws-cdk-go/awscdk/v2/awssqs"
)

queue := sqs.NewQueue(stack, jsii.String("MyQueue"), &amp;sqs.QueueProps{})
url := queue.QueueUrl() // =&gt; A string representing a deploy-time value</code></pre>
</div>
</div>
<div class="paragraph">
<p>See  <a href="#tokens">Tokens and the AWS CDK</a> for information about how the AWS CDK encodes deploy-time attributes as strings.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-referencing">2.14.2. Referencing resources</h4>
<div class="paragraph">
<p>When configuring resources, you will often have to reference properties of another resource. The following are examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An Amazon Elastic Container Service (Amazon ECS) resource requires a reference to the cluster on which it runs.</p>
</li>
<li>
<p>An Amazon CloudFront distribution requires a reference to the Amazon Simple Storage Service (Amazon S3) bucket containing the source code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can reference resources in any of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By passing a resource defined in your CDK app, either in the same stack or in a different one</p>
</li>
<li>
<p>By passing a proxy object referencing a resource defined in your AWS account, created from a unique identifier of the resource (such as an ARN)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the property of a construct represents a construct for another resource, its type is that of the interface type of the construct. For example, the Amazon ECS construct takes a property  <code>cluster</code> of type <code>ecs.ICluster</code>. Another example, is the CloudFront distribution construct that takes a property <code>sourceBucket</code> (Python: <code>source_bucket</code>) of type <code>s3.IBucket</code>.</p>
</div>
<div class="paragraph">
<p>You can directly pass any resource object of the proper type defined in the same AWS CDK app. The following example defines an Amazon ECS cluster and then uses it to define an Amazon ECS service.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cluster = new ecs.Cluster(this, 'Cluster', { /*...*/ });

const service = new ecs.Ec2Service(this, 'Service', { cluster: cluster });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cluster = new ecs.Cluster(this, 'Cluster', { /*...*/ });

const service = new ecs.Ec2Service(this, 'Service', { cluster: cluster });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">cluster = ecs.Cluster(self, "Cluster")

service = ecs.Ec2Service(self, "Service", cluster=cluster)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Cluster cluster = new Cluster(this, "Cluster");
Ec2Service service = new Ec2Service(this, "Service",
        new Ec2ServiceProps.Builder().cluster(cluster).build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var cluster = new Cluster(this, "Cluster");
var service = new Ec2Service(this, "Service", new Ec2ServiceProps { Cluster = cluster });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  ecs "github.com/aws/aws-cdk-go/awscdk/v2/awsecs"
)

cluster := ecs.NewCluster(stack, jsii.String("MyCluster"), &amp;ecs.ClusterProps{})
service := ecs.NewEc2Service(stack, jsii.String("MyService"), &amp;ecs.Ec2ServiceProps{
  Cluster: cluster,
})</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="resource-stack">Referencing resources in a different stack</h5>
<div class="paragraph">
<p>You can refer to resources in a different stack as long as they are defined in the same app and are in the same AWS environment. The following pattern is generally used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Store a reference to the construct as an attribute of the stack that produces the resource. (To get a reference to the current construct&#8217;s stack, use <code>Stack.of(this)</code>.)</p>
</li>
<li>
<p>Pass this reference to the constructor of the stack that consumes the resource as a parameter or a property. The consuming stack then passes it as a property to any construct that needs it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example defines a stack  <code>stack1</code>. This stack defines an Amazon S3 bucket and stores a reference to the bucket construct as an attribute of the stack. Then the app defines a second stack, <code>stack2</code>, which accepts a bucket at instantiation. <code>stack2</code> might, for example, define an AWS Glue Table that uses the bucket for data storage.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const prod = { account: '123456789012', region: 'us-east-1' };

const stack1 = new StackThatProvidesABucket(app, 'Stack1', { env: prod });

// stack2 will take a property { bucket: IBucket }
const stack2 = new StackThatExpectsABucket(app, 'Stack2', {
  bucket: stack1.bucket,
  env: prod
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const prod = { account: '123456789012', region: 'us-east-1' };

const stack1 = new StackThatProvidesABucket(app, 'Stack1', { env: prod });

// stack2 will take a property { bucket: IBucket }
const stack2 = new StackThatExpectsABucket(app, 'Stack2', {
  bucket: stack1.bucket,
  env: prod
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">prod = core.Environment(account="123456789012", region="us-east-1")

stack1 = StackThatProvidesABucket(app, "Stack1", env=prod)

# stack2 will take a property "bucket"
stack2 = StackThatExpectsABucket(app, "Stack2", bucket=stack1.bucket, env=prod)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Helper method to build an environment
static Environment makeEnv(String account, String region) {
    return Environment.builder().account(account).region(region)
            .build();
}

App app = new App();

Environment prod = makeEnv("123456789012", "us-east-1");

StackThatProvidesABucket stack1 = new StackThatProvidesABucket(app, "Stack1",
        StackProps.builder().env(prod).build());

// stack2 will take an argument "bucket"
StackThatExpectsABucket stack2 = new StackThatExpectsABucket(app, "Stack,",
        StackProps.builder().env(prod).build(), stack1.bucket);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Amazon.CDK.Environment makeEnv(string account, string region)
{
    return new Amazon.CDK.Environment { Account = account, Region = region };
}

var prod = makeEnv(account: "123456789012", region: "us-east-1");

var stack1 = new StackThatProvidesABucket(app, "Stack1", new StackProps { Env = prod });

// stack2 will take a property "bucket"
var stack2 = new StackThatExpectsABucket(app, "Stack2", new StackProps { Env = prod,
    bucket = stack1.Bucket});</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the AWS CDK determines that the resource is in the same environment, but in a different stack, it automatically synthesizes AWS CloudFormation  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-stack-exports.html">exports</a> in the producing stack and an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-importvalue.html">Fn::ImportValue</a> in the consuming stack to transfer that information from one stack to the other.</p>
</div>
<div class="sect5">
<h6 id="resources-deadlock">Resolving dependency deadlocks</h6>
<div class="paragraph">
<p>Referencing a resource from one stack in a different stack creates a dependency between the two stacks. This makes sure that they&#8217;re deployed in the right order. After the stacks are deployed, this dependency is concrete. After that, removing the use of the shared resource from the consuming stack can cause an unexpected deployment failure. This happens if there is another dependency between the two stacks that force them to be deployed in the same order. It can also happen without a dependency if the producing stack is simply chosen by the CDK Toolkit to be deployed first. The AWS CloudFormation export is removed from the producing stack because it&#8217;s no longer needed, but the exported resource is still being used in the consuming stack because its update is not yet deployed. Therefore, deploying the producer stack fails.</p>
</div>
<div class="paragraph">
<p>To break this deadlock, remove the use of the shared resource from the consuming stack. (This removes the automatic export from the producing stack.) Next, manually add the same export to the producing stack using exactly the same logical ID as the automatically generated export. Remove the use of the shared resource in the consuming stack and deploy both stacks. Then, remove the manual export (and the shared resource if it&#8217;s no longer needed) and deploy both stacks again. The stack&#8217;s <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#exportwbrvalueexportedvalue-options">exportValue()</a></code> method is a convenient way to create the manual export for this purpose. (See the example in the linked method reference.)</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="resources-external">Referencing resources in your AWS account</h5>
<div class="paragraph">
<p>Suppose you want to use a resource already available in your AWS account in your AWS CDK app. This might be a resource that was defined through the console, an AWS SDK, directly with AWS CloudFormation, or in a different AWS CDK application. You can turn the resource&#8217;s ARN (or another identifying attribute, or group of attributes) into a proxy object. The proxy object serves as a reference to the resource by calling a static factory method on the resource&#8217;s class.</p>
</div>
<div class="paragraph">
<p>When you create such a proxy, the external resource <strong>does not</strong> become a part of your AWS CDK app. Therefore, changes you make to the proxy in your AWS CDK app do not affect the deployed resource. The proxy can, however, be passed to any AWS CDK method that requires a resource of that type.</p>
</div>
<div class="paragraph">
<p>The following example shows how to reference a bucket based on an existing bucket with the ARN <strong>arn:aws:s3:::amzn-s3-demo-bucket1</strong>, and an Amazon Virtual Private Cloud based on an existing VPC having a specific ID.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Construct a proxy for a bucket by its name (must be same account)
s3.Bucket.fromBucketName(this, 'MyBucket', 'amzn-s3-demo-bucket1');

// Construct a proxy for a bucket by its full ARN (can be another account)
s3.Bucket.fromBucketArn(this, 'MyBucket', 'arn:aws:s3:::amzn-s3-demo-bucket1');

// Construct a proxy for an existing VPC from its attribute(s)
ec2.Vpc.fromVpcAttributes(this, 'MyVpc', {
  vpcId: 'vpc-1234567890abcde',
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Construct a proxy for a bucket by its name (must be same account)
s3.Bucket.fromBucketName(this, 'MyBucket', 'amzn-s3-demo-bucket1');

// Construct a proxy for a bucket by its full ARN (can be another account)
s3.Bucket.fromBucketArn(this, 'MyBucket', 'arn:aws:s3:::amzn-s3-demo-bucket1');

// Construct a proxy for an existing VPC from its attribute(s)
ec2.Vpc.fromVpcAttributes(this, 'MyVpc', {
  vpcId: 'vpc-1234567890abcde'
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Construct a proxy for a bucket by its name (must be same account)
s3.Bucket.from_bucket_name(self, "MyBucket", "amzn-s3-demo-bucket1")

# Construct a proxy for a bucket by its full ARN (can be another account)
s3.Bucket.from_bucket_arn(self, "MyBucket", "arn:aws:s3:::amzn-s3-demo-bucket1")

# Construct a proxy for an existing VPC from its attribute(s)
ec2.Vpc.from_vpc_attributes(self, "MyVpc", vpc_id="vpc-1234567890abcdef")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Construct a proxy for a bucket by its name (must be same account)
Bucket.fromBucketName(this, "MyBucket", "amzn-s3-demo-bucket1");

// Construct a proxy for a bucket by its full ARN (can be another account)
Bucket.fromBucketArn(this, "MyBucket",
        "arn:aws:s3:::amzn-s3-demo-bucket1");

// Construct a proxy for an existing VPC from its attribute(s)
Vpc.fromVpcAttributes(this, "MyVpc", VpcAttributes.builder()
        .vpcId("vpc-1234567890abcdef").build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Construct a proxy for a bucket by its name (must be same account)
Bucket.FromBucketName(this, "MyBucket", "amzn-s3-demo-bucket1");

// Construct a proxy for a bucket by its full ARN (can be another account)
Bucket.FromBucketArn(this, "MyBucket", "arn:aws:s3:::amzn-s3-demo-bucket1");

// Construct a proxy for an existing VPC from its attribute(s)
Vpc.FromVpcAttributes(this, "MyVpc", new VpcAttributes
{
    VpcId = "vpc-1234567890abcdef"
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// Define a proxy for a bucket by its name (must be same account)
s3.Bucket_FromBucketName(stack, jsii.String("MyBucket"), jsii.String("amzn-s3-demo-bucket1"))

// Define a proxy for a bucket by its full ARN (can be another account)
s3.Bucket_FromBucketArn(stack, jsii.String("MyBucket"), jsii.String("arn:aws:s3:::amzn-s3-demo-bucket1"))

// Define a proxy for an existing VPC from its attributes
ec2.Vpc_FromVpcAttributes(stack, jsii.String("MyVpc"), &amp;ec2.VpcAttributes{
  VpcId: jsii.String("vpc-1234567890abcde"),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a closer look at the  <a href="https://docs.aws.amazon.com/cdk/api/v1/docs/@aws-cdk_aws-ec2.Vpc.html#static-fromwbrlookupscope-id-options">Vpc.fromLookup()</a> method. Because the <code>ec2.Vpc</code> construct is complex, there are many ways you might want to select the VPC to be used with your CDK app. To address this, the VPC construct has a <code>fromLookup</code> static method (Python: <code>from_lookup</code>) that lets you look up the desired Amazon VPC by querying your AWS account at synthesis time.</p>
</div>
<div class="paragraph">
<p>To use <code>Vpc.fromLookup()</code>, the system that synthesizes the stack must have access to the account that owns the Amazon VPC. This is because the CDK Toolkit queries the account to find the right Amazon VPC at synthesis time.</p>
</div>
<div class="paragraph">
<p>Furthermore, <code>Vpc.fromLookup()</code> works only in stacks that are defined with an explicit <strong>account</strong> and <strong>region</strong> (see <a href="#environments">Environments for the AWS CDK</a>). If the AWS CDK tries to look up an Amazon VPC from an <a href="#stack-api">environment-agnostic stack</a>, the CDK Toolkit doesn&#8217;t know which environment to query to find the VPC.</p>
</div>
<div class="paragraph">
<p>You must provide <code>Vpc.fromLookup()</code> attributes sufficient to uniquely identify a VPC in your AWS account. For example, there can only ever be one default VPC, so it&#8217;s sufficient to specify the VPC as the default.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">ec2.Vpc.fromLookup(this, 'DefaultVpc', {
  isDefault: true
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">ec2.Vpc.fromLookup(this, 'DefaultVpc', {
  isDefault: true
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ec2.Vpc.from_lookup(self, "DefaultVpc", is_default=True)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Vpc.fromLookup(this, "DefaultVpc", VpcLookupOptions.builder()
        .isDefault(true).build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Vpc.FromLookup(this, id = "DefaultVpc", new VpcLookupOptions { IsDefault = true });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">ec2.Vpc_FromLookup(this, jsii.String("DefaultVpc"), &amp;ec2.VpcLookupOptions{
  IsDefault: jsii.Bool(true),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the  <code>tags</code> property to query for VPCs by tag. You can add tags to the Amazon VPC at the time of its creation by using AWS CloudFormation or the AWS CDK. You can edit tags at any time after creation by using the AWS Management Console, the AWS CLI, or an AWS SDK. In addition to any tags you add yourself, the AWS CDK automatically adds the following tags to all VPCs it creates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Name</em> – The name of the VPC.</p>
</li>
<li>
<p><em>aws-cdk:subnet-name</em> – The name of the subnet.</p>
</li>
<li>
<p><em>aws-cdk:subnet-type</em> – The type of the subnet: Public, Private, or Isolated.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>ec2.Vpc.fromLookup(this, 'PublicVpc',
    {tags: {'aws-cdk:subnet-type': "Public"}});</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">ec2.Vpc.fromLookup(this, 'PublicVpc',
    {tags: {'aws-cdk:subnet-type': "Public"}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ec2.Vpc.from_lookup(self, "PublicVpc",
    tags={"aws-cdk:subnet-type": "Public"})</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Vpc.fromLookup(this, "PublicVpc", VpcLookupOptions.builder()
        .tags(java.util.Map.of("aws-cdk:subnet-type", "Public"))  // Java 9 or later
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Vpc.FromLookup(this, id = "PublicVpc", new VpcLookupOptions
     { Tags = new Dictionary&lt;string, string&gt; { ["aws-cdk:subnet-type"] = "Public" });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">ec2.Vpc_FromLookup(this, jsii.String("DefaultVpc"), &amp;ec2.VpcLookupOptions{
  Tags: &amp;map[string]*string{"aws-cdk:subnet-type": jsii.String("Public")},
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results of  <code>Vpc.fromLookup()</code> are cached in the project&#8217;s <code class="path">cdk.context.json</code> file. (See  <a href="#context">Context values and the AWS CDK</a>.) Commit this file to version control so that your app will continue to refer to the same Amazon VPC. This works even if you later change the attributes of your VPCs in a way that would result in a different VPC being selected. This is particularly important if you&#8217;re deploying the stack in an environment that doesn&#8217;t have access to the AWS account that defines the VPC, such as <a href="#cdk-pipeline">CDK Pipelines</a>.</p>
</div>
<div class="paragraph">
<p>Although you can use an external resource anywhere you&#8217;d use a similar resource defined in your AWS CDK app, you cannot modify it. For example, calling <code>addToResourcePolicy</code> (Python: <code>add_to_resource_policy</code>) on an external <code>s3.Bucket</code> does nothing.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-physical-names">2.14.3. Resource physical names</h4>
<div class="paragraph">
<p>The logical names of resources in AWS CloudFormation are different from the names of resources that are shown in the AWS Management Console after they&#8217;re deployed by AWS CloudFormation. The AWS CDK calls these final names  <em>physical names</em>.</p>
</div>
<div class="paragraph">
<p>For example, AWS CloudFormation might create the Amazon S3 bucket with the logical ID <code>Stack2MyBucket4DD88B4F</code> and the physical name <code>stack2MyBucket4dd88b4f-iuv1rbv9z3to</code>.</p>
</div>
<div class="paragraph">
<p>You can specify a physical name when creating constructs that represent resources by using the property <code class="replaceable">&lt;resourceType&gt;</code>Name. The following example creates an Amazon S3 bucket with the physical name <code>amzn-s3-demo-bucket</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'MyBucket', {
  bucketName: 'amzn-s3-demo-bucket',
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'MyBucket', {
  bucketName: 'amzn-s3-demo-bucket'
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = s3.Bucket(self, "MyBucket", bucket_name="amzn-s3-demo-bucket")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = Bucket.Builder.create(this, "MyBucket")
        .bucketName("amzn-s3-demo-bucket").build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new Bucket(this, "MyBucket", new BucketProps { BucketName = "amzn-s3-demo-bucket" });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">bucket := s3.NewBucket(this, jsii.String("MyBucket"), &amp;s3.BucketProps{
  BucketName: jsii.String("amzn-s3-demo-bucket"),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assigning physical names to resources has some disadvantages in AWS CloudFormation. Most importantly, any changes to deployed resources that require a resource replacement, such as changes to a resource&#8217;s properties that are immutable after creation, will fail if a resource has a physical name assigned. If you end up in that state, the only solution is to delete the AWS CloudFormation stack, then deploy the AWS CDK app again. See the  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-name.html">AWS CloudFormation documentation</a> for details.</p>
</div>
<div class="paragraph">
<p>In some cases, such as when creating an AWS CDK app with cross-environment references, physical names are required for the AWS CDK to function correctly. In those cases, if you don&#8217;t want to bother with coming up with a physical name yourself, you can let the AWS CDK name it for you. To do so, use the special value <code>PhysicalName.GENERATE_IF_NEEDED</code>, as follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'MyBucket', {
  bucketName: core.PhysicalName.GENERATE_IF_NEEDED,
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'MyBucket', {
  bucketName: core.PhysicalName.GENERATE_IF_NEEDED
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = s3.Bucket(self, "MyBucket",
                         bucket_name=core.PhysicalName.GENERATE_IF_NEEDED)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = Bucket.Builder.create(this, "MyBucket")
        .bucketName(PhysicalName.GENERATE_IF_NEEDED).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new Bucket(this, "MyBucket", new BucketProps
    { BucketName = PhysicalName.GENERATE_IF_NEEDED });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">bucket := s3.NewBucket(this, jsii.String("MyBucket"), &amp;s3.BucketProps{
  BucketName: awscdk.PhysicalName_GENERATE_IF_NEEDED(),
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-identifiers">2.14.4. Passing unique resource identifiers</h4>
<div class="paragraph">
<p>Whenever possible, you should pass resources by reference, as described in the previous section. However, there are cases where you have no other choice but to refer to a resource by one of its attributes. Example use cases include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you are using low-level AWS CloudFormation resources.</p>
</li>
<li>
<p>When you need to expose resources to the runtime components of an AWS CDK application, such as when referring to Lambda functions through environment variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These identifiers are available as attributes on the resources, such as the following.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">bucket.bucketName
lambdaFunc.functionArn
securityGroup.groupArn</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">bucket.bucketName
lambdaFunc.functionArn
securityGroup.groupArn</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">bucket.bucket_name
lambda_func.function_arn
security_group_arn</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The Java AWS CDK binding uses getter methods for attributes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bucket.getBucketName()
lambdaFunc.getFunctionArn()
securityGroup.getGroupArn()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">bucket.BucketName
lambdaFunc.FunctionArn
securityGroup.GroupArn</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">bucket.BucketName()
fn.FunctionArn()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to pass a generated bucket name to an AWS Lambda function.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'Bucket');

new lambda.Function(this, 'MyLambda', {
  // ...
  environment: {
    BUCKET_NAME: bucket.bucketName,
  },
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new s3.Bucket(this, 'Bucket');

new lambda.Function(this, 'MyLambda', {
  // ...
  environment: {
    BUCKET_NAME: bucket.bucketName
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = s3.Bucket(self, "Bucket")

lambda.Function(self, "MyLambda", environment=dict(BUCKET_NAME=bucket.bucket_name))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final Bucket bucket = new Bucket(this, "Bucket");

Function.Builder.create(this, "MyLambda")
        .environment(java.util.Map.of(    // Java 9 or later
                "BUCKET_NAME", bucket.getBucketName()))
        .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new Bucket(this, "Bucket");

new Function(this, "MyLambda", new FunctionProps
{
    Environment = new Dictionary&lt;string, string&gt;
    {
        ["BUCKET_NAME"] = bucket.BucketName
    }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">bucket := s3.NewBucket(this, jsii.String("Bucket"), &amp;s3.BucketProps{})
lambda.NewFunction(this, jsii.String("MyLambda"), &amp;lambda.FunctionProps{
  Environment: &amp;map[string]*string{"BUCKET_NAME": bucket.BucketName()},
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-grants">2.14.5. Granting permissions between resources</h4>
<div class="paragraph">
<p>Higher-level constructs make least-privilege permissions achievable by offering simple, intent-based APIs to express permission requirements. For example, many L2 constructs offer grant methods that you can use to grant an entity (such as an IAM role or user) permission to work with the resource, without having to manually create IAM permission statements.</p>
</div>
<div class="paragraph">
<p>The following example creates the permissions to allow a Lambda function&#8217;s execution role to read and write objects to a particular Amazon S3 bucket. If the Amazon S3 bucket is encrypted with an AWS KMS key, this method also grants permissions to the Lambda function&#8217;s execution role to decrypt with the key.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">if (bucket.grantReadWrite(func).success) {
  // ...
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">if ( bucket.grantReadWrite(func).success) {
  // ...
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">if bucket.grant_read_write(func).success:
    # ...</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">if (bucket.grantReadWrite(func).getSuccess()) {
    // ...
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">if (bucket.GrantReadWrite(func).Success)
{
    // ...
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">if *bucket.GrantReadWrite(function, nil).Success() {
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The grant methods return an  <code>iam.Grant</code> object. Use the <code>success</code> attribute of the <code>Grant</code> object to determine whether the grant was effectively applied (for example, it may not have been applied on <a href="#resources-referencing">external resources</a>). You can also use the <code>assertSuccess</code> (Python: <code>assert_success</code>) method of the <code>Grant</code> object to enforce that the grant was successfully applied.</p>
</div>
<div class="paragraph">
<p>If a specific grant method isn&#8217;t available for the particular use case, you can use a generic grant method to define a new grant with a specified list of actions.</p>
</div>
<div class="paragraph">
<p>The following example shows how to grant a Lambda function access to the Amazon DynamoDB <code>CreateBackup</code> action.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">table.grant(func, 'dynamodb:CreateBackup');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">table.grant(func, 'dynamodb:CreateBackup');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">table.grant(func, "dynamodb:CreateBackup")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">table.grant(func, "dynamodb:CreateBackup");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">table.Grant(func, "dynamodb:CreateBackup");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">table := dynamodb.NewTable(this, jsii.String("MyTable"), &amp;dynamodb.TableProps{})
table.Grant(function, jsii.String("dynamodb:CreateBackup"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many resources, such as Lambda functions, require a role to be assumed when executing code. A configuration property enables you to specify an  <code>iam.IRole</code>. If no role is specified, the function automatically creates a role specifically for this use. You can then use grant methods on the resources to add statements to the role.</p>
</div>
<div class="paragraph">
<p>The grant methods are built using lower-level APIs for handling with IAM policies. Policies are modeled as <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyDocument.html">PolicyDocument</a> objects. Add statements directly to roles (or a construct&#8217;s attached role) using the <code>addToRolePolicy</code> method (Python: <code>add_to_role_policy</code>), or to a resource&#8217;s policy (such as a <code>Bucket</code> policy) using the <code>addToResourcePolicy</code> (Python: <code>add_to_resource_policy</code>) method.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-metrics">2.14.6. Resource metrics and alarms</h4>
<div class="paragraph">
<p>Many resources emit CloudWatch metrics that can be used to set up monitoring dashboards and alarms. Higher-level constructs have metric methods that let you access the metrics without looking up the correct name to use.</p>
</div>
<div class="paragraph">
<p>The following example shows how to define an alarm when the <code>ApproximateNumberOfMessagesNotVisible</code> of an Amazon SQS queue exceeds 100.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cw from '@aws-cdk/aws-cloudwatch';
import * as sqs from '@aws-cdk/aws-sqs';
import { Duration } from '@aws-cdk/core';

const queue = new sqs.Queue(this, 'MyQueue');

const metric = queue.metricApproximateNumberOfMessagesNotVisible({
  label: 'Messages Visible (Approx)',
  period: Duration.minutes(5),
  // ...
});
metric.createAlarm(this, 'TooManyMessagesAlarm', {
  comparisonOperator: cw.ComparisonOperator.GREATER_THAN_THRESHOLD,
  threshold: 100,
  // ...
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cw = require('@aws-cdk/aws-cloudwatch');
const sqs = require('@aws-cdk/aws-sqs');
const { Duration } = require('@aws-cdk/core');

const queue = new sqs.Queue(this, 'MyQueue');

const metric = queue.metricApproximateNumberOfMessagesNotVisible({
  label: 'Messages Visible (Approx)',
  period: Duration.minutes(5)
  // ...
});
metric.createAlarm(this, 'TooManyMessagesAlarm', {
  comparisonOperator: cw.ComparisonOperator.GREATER_THAN_THRESHOLD,
  threshold: 100
  // ...
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_cloudwatch as cw
import aws_cdk.aws_sqs as sqs
from aws_cdk.core import Duration

queue = sqs.Queue(self, "MyQueue")
metric = queue.metric_approximate_number_of_messages_not_visible(
    label="Messages Visible (Approx)",
    period=Duration.minutes(5),
    # ...
)
metric.create_alarm(self, "TooManyMessagesAlarm",
    comparison_operator=cw.ComparisonOperator.GREATER_THAN_THRESHOLD,
    threshold=100,
    # ...
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.core.Duration;
import software.amazon.awscdk.services.sqs.Queue;
import software.amazon.awscdk.services.cloudwatch.Metric;
import software.amazon.awscdk.services.cloudwatch.MetricOptions;
import software.amazon.awscdk.services.cloudwatch.CreateAlarmOptions;
import software.amazon.awscdk.services.cloudwatch.ComparisonOperator;

Queue queue = new Queue(this, "MyQueue");

Metric metric = queue
        .metricApproximateNumberOfMessagesNotVisible(MetricOptions.builder()
                .label("Messages Visible (Approx)")
                .period(Duration.minutes(5)).build());

metric.createAlarm(this, "TooManyMessagesAlarm", CreateAlarmOptions.builder()
                .comparisonOperator(ComparisonOperator.GREATER_THAN_THRESHOLD)
                .threshold(100)
                // ...
                .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using cdk = Amazon.CDK;
using cw = Amazon.CDK.AWS.CloudWatch;
using sqs = Amazon.CDK.AWS.SQS;

var queue = new sqs.Queue(this, "MyQueue");
var metric = queue.MetricApproximateNumberOfMessagesNotVisible(new cw.MetricOptions
{
    Label = "Messages Visible (Approx)",
    Period = cdk.Duration.Minutes(5),
    // ...
});
metric.CreateAlarm(this, "TooManyMessagesAlarm", new cw.CreateAlarmOptions
{
    ComparisonOperator = cw.ComparisonOperator.GREATER_THAN_THRESHOLD,
    Threshold = 100,
    // ..
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  cw "github.com/aws/aws-cdk-go/awscdk/v2/awscloudwatch"
  sqs "github.com/aws/aws-cdk-go/awscdk/v2/awssqs"
)

queue := sqs.NewQueue(this, jsii.String("MyQueue"), &amp;sqs.QueueProps{})
metric := queue.MetricApproximateNumberOfMessagesNotVisible(&amp;cw.MetricOptions{
  Label: jsii.String("Messages Visible (Approx)"),
  Period: awscdk.Duration_Minutes(jsii.Number(5)),
})

metric.CreateAlarm(this, jsii.String("TooManyMessagesAlarm"), &amp;cw.CreateAlarmOptions{
  ComparisonOperator: cw.ComparisonOperator_GREATER_THAN_THRESHOLD,
  Threshold: jsii.Number(100),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is no method for a particular metric, you can use the general metric method to specify the metric name manually.</p>
</div>
<div class="paragraph">
<p>Metrics can also be added to CloudWatch dashboards. See <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudwatch-readme.html">CloudWatch</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="resources-traffic">2.14.7. Network traffic</h4>
<div class="paragraph">
<p>In many cases, you must enable permissions on a network for an application to work, such as when the compute infrastructure needs to access the persistence layer. Resources that establish or listen for connections expose methods that enable traffic flows, including setting security group rules or network ACLs.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.IConnectable.html">IConnectable</a> resources have a <code>connections</code> property that is the gateway to network traffic rules configuration.</p>
</div>
<div class="paragraph">
<p>You enable data to flow on a given network path by using <code>allow</code> methods. The following example enables HTTPS connections to the web and incoming connections from the Amazon EC2 Auto Scaling group <code>fleet2</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as asg from '@aws-cdk/aws-autoscaling';
import * as ec2 from '@aws-cdk/aws-ec2';

const fleet1: asg.AutoScalingGroup = asg.AutoScalingGroup(/*...*/);

// Allow surfing the (secure) web
fleet1.connections.allowTo(new ec2.Peer.anyIpv4(), new ec2.Port({ fromPort: 443, toPort: 443 }));

const fleet2: asg.AutoScalingGroup = asg.AutoScalingGroup(/*...*/);
fleet1.connections.allowFrom(fleet2, ec2.Port.AllTraffic());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const asg = require('@aws-cdk/aws-autoscaling');
const ec2 = require('@aws-cdk/aws-ec2');

const fleet1 = asg.AutoScalingGroup();

// Allow surfing the (secure) web
fleet1.connections.allowTo(new ec2.Peer.anyIpv4(), new ec2.Port({ fromPort: 443, toPort: 443 }));

const fleet2 = asg.AutoScalingGroup();
fleet1.connections.allowFrom(fleet2, ec2.Port.AllTraffic());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_autoscaling as asg
import aws_cdk.aws_ec2 as ec2

fleet1 = asg.AutoScalingGroup( ... )

# Allow surfing the (secure) web
fleet1.connections.allow_to(ec2.Peer.any_ipv4(),
  ec2.Port(PortProps(from_port=443, to_port=443)))

fleet2 = asg.AutoScalingGroup( ... )
fleet1.connections.allow_from(fleet2, ec2.Port.all_traffic())</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.autoscaling.AutoScalingGroup;
import software.amazon.awscdk.services.ec2.Peer;
import software.amazon.awscdk.services.ec2.Port;

AutoScalingGroup fleet1 = AutoScalingGroup.Builder.create(this, "MyFleet")
        /* ... */.build();

// Allow surfing the (secure) Web
fleet1.getConnections().allowTo(Peer.anyIpv4(),
        Port.Builder.create().fromPort(443).toPort(443).build());

AutoScalingGroup fleet2 = AutoScalingGroup.Builder.create(this, "MyFleet2")
        /* ... */.build();
fleet1.getConnections().allowFrom(fleet2, Port.allTraffic());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using cdk = Amazon.CDK;
using asg = Amazon.CDK.AWS.AutoScaling;
using ec2 = Amazon.CDK.AWS.EC2;

// Allow surfing the (secure) Web
var fleet1 = new asg.AutoScalingGroup(this, "MyFleet", new asg.AutoScalingGroupProps { /* ... */ });
fleet1.Connections.AllowTo(ec2.Peer.AnyIpv4(), new ec2.Port(new ec2.PortProps
  { FromPort = 443, ToPort = 443 });

var fleet2 = new asg.AutoScalingGroup(this, "MyFleet2", new asg.AutoScalingGroupProps { /* ... */ });
fleet1.Connections.AllowFrom(fleet2, ec2.Port.AllTraffic());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  autoscaling "github.com/aws/aws-cdk-go/awscdk/v2/awsautoscaling"
  ec2 "github.com/aws/aws-cdk-go/awscdk/v2/awsec2"
)

fleet1 := autoscaling.NewAutoScalingGroup(this, jsii.String("MyFleet1"), &amp;autoscaling.AutoScalingGroupProps{})
fleet1.Connections().AllowTo(ec2.Peer_AnyIpv4(),ec2.NewPort(&amp;ec2.PortProps{ FromPort: jsii.Number(443), ToPort: jsii.Number(443) }),jsii.String("secure web"))

fleet2 := autoscaling.NewAutoScalingGroup(this, jsii.String("MyFleet2"), &amp;autoscaling.AutoScalingGroupProps{})
fleet1.Connections().AllowFrom(fleet2, ec2.Port_AllTraffic(),jsii.String("all traffic"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Certain resources have default ports associated with them. Examples include the listener of a load balancer on the public port, and the ports on which the database engine accepts connections for instances of an Amazon RDS database. In such cases, you can enforce tight network control without having to manually specify the port. To do so, use the  <code>allowDefaultPortFrom</code> and <code>allowToDefaultPort</code> methods (Python: <code>allow_default_port_from</code>, <code>allow_to_default_port</code>).</p>
</div>
<div class="paragraph">
<p>The following example shows how to enable connections from any IPV4 address, and a connection from an Auto Scaling group to access a database.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">listener.connections.allowDefaultPortFromAnyIpv4('Allow public access');

fleet.connections.allowToDefaultPort(rdsDatabase, 'Fleet can access database');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">listener.connections.allowDefaultPortFromAnyIpv4('Allow public access');

fleet.connections.allowToDefaultPort(rdsDatabase, 'Fleet can access database');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">listener.connections.allow_default_port_from_any_ipv4("Allow public access")

fleet.connections.allow_to_default_port(rds_database, "Fleet can access database")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">listener.getConnections().allowDefaultPortFromAnyIpv4("Allow public access");

fleet.getConnections().AllowToDefaultPort(rdsDatabase, "Fleet can access database");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">listener.Connections.AllowDefaultPortFromAnyIpv4("Allow public access");

fleet.Connections.AllowToDefaultPort(rdsDatabase, "Fleet can access database");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">listener.Connections().AllowDefaultPortFromAnyIpv4(jsii.String("Allow public Access"))
fleet.Connections().AllowToDefaultPort(rdsDatabase, jsii.String("Fleet can access database"))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-events">2.14.8. Event handling</h4>
<div class="paragraph">
<p>Some resources can act as event sources. Use the  <code>addEventNotification</code> method (Python: <code>add_event_notification</code>) to register an event target to a particular event type emitted by the resource. In addition to this, <code>addXxxNotification</code> methods offer a simple way to register a handler for common event types.</p>
</div>
<div class="paragraph">
<p>The following example shows how to trigger a Lambda function when an object is added to an Amazon S3 bucket.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as s3nots from '@aws-cdk/aws-s3-notifications';

const handler = new lambda.Function(this, 'Handler', { /*…*/ });
const bucket = new s3.Bucket(this, 'Bucket');
bucket.addObjectCreatedNotification(new s3nots.LambdaDestination(handler));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const s3nots = require('@aws-cdk/aws-s3-notifications');

const handler = new lambda.Function(this, 'Handler', { /*…*/ });
const bucket = new s3.Bucket(this, 'Bucket');
bucket.addObjectCreatedNotification(new s3nots.LambdaDestination(handler));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_s3_notifications as s3_nots

handler = lambda_.Function(self, "Handler", ...)
bucket = s3.Bucket(self, "Bucket")
bucket.add_object_created_notification(s3_nots.LambdaDestination(handler))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.s3.notifications.LambdaDestination;

Function handler = Function.Builder.create(this, "Handler")/* ... */.build();
Bucket bucket = new Bucket(this, "Bucket");
bucket.addObjectCreatedNotification(new LambdaDestination(handler));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using lambda = Amazon.CDK.AWS.Lambda;
using s3 = Amazon.CDK.AWS.S3;
using s3Nots = Amazon.CDK.AWS.S3.Notifications;

var handler = new lambda.Function(this, "Handler", new lambda.FunctionProps { .. });
var bucket = new s3.Bucket(this, "Bucket");
bucket.AddObjectCreatedNotification(new s3Nots.LambdaDestination(handler));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  s3 "github.com/aws/aws-cdk-go/awscdk/v2/awss3"
  s3nots "github.com/aws/aws-cdk-go/awscdk/v2/awss3notifications"
)

handler := lambda.NewFunction(this, jsii.String("MyFunction"), &amp;lambda.FunctionProps{})
bucket := s3.NewBucket(this, jsii.String("Bucket"), &amp;s3.BucketProps{})
bucket.AddObjectCreatedNotification(s3nots.NewLambdaDestination(handler), nil)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resources-removal">2.14.9. Removal policies</h4>
<div class="paragraph">
<p>Resources that maintain persistent data, such as databases, Amazon S3 buckets, and Amazon ECR registries, have a  <em>removal policy</em>. The removal policy indicates whether to delete persistent objects when the AWS CDK stack that contains them is destroyed. The values specifying the removal policy are available through the <code>RemovalPolicy</code> enumeration in the AWS CDK <code>core</code> module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Resources besides those that store data persistently might also have a <code>removalPolicy</code> that is used for a different purpose. For example, a Lambda function version uses a <code>removalPolicy</code> attribute to determine whether a given version is retained when a new version is deployed. These have different meanings and defaults compared to the removal policy on an Amazon S3 bucket or DynamoDB table.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemovalPolicy.RETAIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keep the contents of the resource when destroying the stack (default). The resource is orphaned from the stack and must be deleted manually. If you attempt to re-deploy the stack while the resource still exists, you will receive an error message due to a name conflict.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RemovalPolicy.DESTROY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resource will be destroyed along with the stack.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>AWS CloudFormation does not remove Amazon S3 buckets that contain files even if their removal policy is set to  <code>DESTROY</code>. Attempting to do so is an AWS CloudFormation error. To have the AWS CDK delete all files from the bucket before destroying it, set the bucket&#8217;s <code>autoDeleteObjects</code> property to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Following is an example of creating an Amazon S3 bucket with <code>RemovalPolicy</code> of <code>DESTROY</code> and <code>autoDeleteOjbects</code> set to <code>true</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from '@aws-cdk/core';
import * as s3 from '@aws-cdk/aws-s3';

export class CdkTestStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const bucket = new s3.Bucket(this, 'Bucket', {
      removalPolicy: cdk.RemovalPolicy.DESTROY,
      autoDeleteObjects: true
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('@aws-cdk/core');
const s3 = require('@aws-cdk/aws-s3');

class CdkTestStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const bucket = new s3.Bucket(this, 'Bucket', {
      removalPolicy: cdk.RemovalPolicy.DESTROY,
      autoDeleteObjects: true
    });
  }
}

module.exports = { CdkTestStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.core as cdk
import aws_cdk.aws_s3 as s3

class CdkTestStack(cdk.stack):
    def __init__(self, scope: cdk.Construct, id: str, **kwargs):
        super().__init__(scope, id, **kwargs)

        bucket = s3.Bucket(self, "Bucket",
            removal_policy=cdk.RemovalPolicy.DESTROY,
            auto_delete_objects=True)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">software.amazon.awscdk.core.*;
import software.amazon.awscdk.services.s3.*;

public class CdkTestStack extends Stack {
    public CdkTestStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkTestStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Bucket.Builder.create(this, "Bucket")
                .removalPolicy(RemovalPolicy.DESTROY)
                .autoDeleteObjects(true).build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.S3;

public CdkTestStack(Construct scope, string id, IStackProps props) : base(scope, id, props)
{
    new Bucket(this, "Bucket", new BucketProps {
        RemovalPolicy = RemovalPolicy.DESTROY,
        AutoDeleteObjects = true
    });
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/jsii-runtime-go"
  s3 "github.com/aws/aws-cdk-go/awscdk/v2/awss3"
)

s3.NewBucket(this, jsii.String("Bucket"), &amp;s3.BucketProps{
  RemovalPolicy: awscdk.RemovalPolicy_DESTROY,
  AutoDeleteObjects: jsii.Bool(true),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also apply a removal policy directly to the underlying AWS CloudFormation resource via the  <code>applyRemovalPolicy()</code> method. This method is available on some stateful resources that do not have a <code>removalPolicy</code> property in their L2 resource&#8217;s props. Examples include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS CloudFormation stacks</p>
</li>
<li>
<p>Amazon Cognito user pools</p>
</li>
<li>
<p>Amazon DocumentDB database instances</p>
</li>
<li>
<p>Amazon EC2 volumes</p>
</li>
<li>
<p>Amazon OpenSearch Service domains</p>
</li>
<li>
<p>Amazon FSx file systems</p>
</li>
<li>
<p>Amazon SQS queues</p>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>const resource = bucket.node.findChild('Resource') as cdk.CfnResource;
resource.applyRemovalPolicy(cdk.RemovalPolicy.DESTROY);</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const resource = bucket.node.findChild('Resource');
resource.applyRemovalPolicy(cdk.RemovalPolicy.DESTROY);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">resource = bucket.node.find_child('Resource')
resource.apply_removal_policy(cdk.RemovalPolicy.DESTROY);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnResource resource = (CfnResource)bucket.node.findChild("Resource");
resource.applyRemovalPolicy(cdk.RemovalPolicy.DESTROY);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var resource = (CfnResource)bucket.node.findChild('Resource');
resource.ApplyRemovalPolicy(cdk.RemovalPolicy.DESTROY);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The AWS CDK&#8217;s  <code>RemovalPolicy</code> translates to AWS CloudFormation&#8217;s <code>DeletionPolicy</code>. However, the default in AWS CDK is to retain the data, which is the opposite of the AWS CloudFormation default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="identifiers">2.15. Identifiers and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>When building AWS Cloud Development Kit (AWS CDK) apps, you will use many types of identifiers and names. To use the AWS CDK effectively and avoid errors, it is important to understand the types of identifiers.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>When building AWS Cloud Development Kit (AWS CDK) apps, you will use many types of identifiers and names. To use the AWS CDK effectively and avoid errors, it is important to understand the types of identifiers.</p>
</div>
<div class="paragraph">
<p>Identifiers must be unique within the scope in which they are created; they do not need to be globally unique in your AWS CDK application.</p>
</div>
<div class="paragraph">
<p>If you attempt to create an identifier with the same value within the same scope, the AWS CDK throws an exception.</p>
</div>
<div class="sect3">
<h4 id="identifiers-construct-ids">2.15.1. Construct IDs</h4>
<div class="paragraph">
<p>The most common identifier,  <code>id</code>, is the identifier passed as the second argument when instantiating a construct object. This identifier, like all identifiers, only needs to be unique within the scope in which it is created, which is the first argument when instantiating a construct object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>id</code> of a stack is also the identifier that you use to refer to it in the <a href="#cli">AWS CDK CLI reference</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s look at an example where we have two constructs with the identifier  <code>MyBucket</code> in our app. The first is defined in the scope of the stack with the identifier <code>Stack1</code>. The second is defined in the scope of a stack with the identifier <code>Stack2</code>. Because they&#8217;re defined in different scopes, this doesn&#8217;t cause any conflict, and they can coexist in the same app without issues.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { App, Stack, StackProps } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

class MyStack extends Stack {
  constructor(scope: Construct, id: string, props: StackProps = {}) {
    super(scope, id, props);

    new s3.Bucket(this, 'MyBucket');
  }
}

const app = new App();
new MyStack(app, 'Stack1');
new MyStack(app, 'Stack2');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { App , Stack } = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');

class MyStack extends Stack {
  constructor(scope, id, props = {}) {
    super(scope, id, props);

    new s3.Bucket(this, 'MyBucket');
  }
}

const app = new App();
new MyStack(app, 'Stack1');
new MyStack(app, 'Stack2');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import App, Construct, Stack, StackProps
from constructs import Construct
from aws_cdk import aws_s3 as s3

class MyStack(Stack):

    def __init__(self, scope: Construct, id: str, **kwargs):

        super().__init__(scope, id, **kwargs)
        s3.Bucket(self, "MyBucket")

app = App()
MyStack(app, 'Stack1')
MyStack(app, 'Stack2')</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// MyStack.java
package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.constructs.Construct;
import software.amazon.awscdk.services.s3.Bucket;

public class MyStack extends Stack {
    public MyStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);
        new Bucket(this, "MyBucket");
    }
}

// Main.java
package com.myorg;

import software.amazon.awscdk.App;

public class Main {
    public static void main(String[] args) {
        App app = new App();
        new MyStack(app, "Stack1");
        new MyStack(app, "Stack2");
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using constructs;
using Amazon.CDK.AWS.S3;

public class MyStack : Stack
{
    public MyStack(Construct scope, string id, IStackProps props) : base(scope, id, props)
    {
        new Bucket(this, "MyBucket");
    }
}

class Program
{
    static void Main(string[] args)
    {
        var app = new App();
        new MyStack(app, "Stack1");
        new MyStack(app, "Stack2");
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-paths">2.15.2. Paths</h4>
<div class="paragraph">
<p>The constructs in an AWS CDK application form a hierarchy rooted in the  <code>App</code> class. We refer to the collection of IDs from a given construct, its parent construct, its grandparent, and so on to the root of the construct tree, as a <em>path</em>.</p>
</div>
<div class="paragraph">
<p>The AWS CDK typically displays paths in your templates as a string. The IDs from the levels are separated by slashes, starting at the node immediately under the root <code>App</code> instance, which is usually a stack. For example, the paths of the two Amazon S3 bucket resources in the previous code example are <code class="path">Stack1/MyBucket</code> and  <code class="path">Stack2/MyBucket</code>.</p>
</div>
<div class="paragraph">
<p>You can access the path of any construct programmatically, as shown in the following example. This gets the path of <code>myConstruct</code> (or <code>my_construct</code>, as Python developers would write it). Since IDs must be unique within the scope they are created, their paths are always unique within an AWS CDK application.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const path: string = myConstruct.node.path;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const path = myConstruct.node.path;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">path = my_construct.node.path</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String path = myConstruct.getNode().getPath();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string path = myConstruct.Node.Path;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-unique-ids">2.15.3. Unique IDs</h4>
<div class="paragraph">
<p>AWS CloudFormation requires that all logical IDs in a template be unique. Because of this, the AWS CDK must be able to generate a unique identifier for each construct in an application. Resources have paths that are globally unique (the names of all scopes from the stack to a specific resource). Therefore, the AWS CDK generates the necessary unique identifiers by concatenating the elements of the path and adding an 8-digit hash. (The hash is necessary to distinguish distinct paths, such as  <code>A/B/C</code> and <code>A/BC</code>, that would result in the same AWS CloudFormation identifier. AWS CloudFormation identifiers are alphanumeric and cannot contain slashes or other separator characters.) The AWS CDK calls this string the <em>unique ID</em> of the construct.</p>
</div>
<div class="paragraph">
<p>In general, your AWS CDK app should not need to know about unique IDs. You can, however, access the unique ID of any construct programmatically, as shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const uid: string = Names.uniqueId(myConstruct);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const uid = Names.uniqueId(myConstruct);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">uid = Names.unique_id(my_construct)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String uid = Names.uniqueId(myConstruct);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string uid = Names.Uniqueid(myConstruct);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <em>address</em> is another kind of unique identifier that uniquely distinguishes CDK resources. Derived from the SHA-1 hash of the path, it is not human-readable. However, its constant, relatively short length (always 42 hexadecimal characters) makes it useful in situations where the "traditional" unique ID might be too long. Some constructs may use the address in the synthesized AWS CloudFormation template instead of the unique ID. Again, your app generally should not need to know about its constructs' addresses, but you can retrieve a construct&#8217;s address as follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const addr: string = myConstruct.node.addr;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const addr = myConstruct.node.addr;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">addr = my_construct.node.addr</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String addr = myConstruct.getNode().getAddr();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string addr = myConstruct.Node.Addr;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identifiers-logical-ids">2.15.4. Logical IDs</h4>
<div class="paragraph">
<p>Unique IDs serve as the  <em>logical identifiers</em> (or <em>logical names</em>) of resources in the generated AWS CloudFormation templates for constructs that represent AWS resources.</p>
</div>
<div class="paragraph">
<p>For example, the Amazon S3 bucket in the previous example that is created within <code>Stack2</code> results in an <code>AWS::S3::Bucket</code> resource. The resource&#8217;s logical ID is <code>Stack2MyBucket4DD88B4F</code> in the resulting AWS CloudFormation template. (For details on how this identifier is generated, see <a href="#identifiers-unique-ids">Unique IDs</a>.)</p>
</div>
<div class="sect4">
<h5 id="identifiers-logical-id-stability">Logical ID stability</h5>
<div class="paragraph">
<p>Avoid changing the logical ID of a resource after it has been created. AWS CloudFormation identifies resources by their logical ID. Therefore, if you change the logical ID of a resource, AWS CloudFormation creates a new resource with the new logical ID, then deletes the existing one. Depending on the type of resource, this might cause service interruption, data loss, or both.</p>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="tokens">2.16. Tokens and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>In the AWS Cloud Development Kit (AWS CDK), <em>tokens</em> are placeholders for values that aren&#8217;t known when defining constructs or synthesizing stacks. These values will be fully resolved at deployment, when your actual infrastructure is created. When developing AWS CDK applications, you will work with tokens to manage these values across your application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In the AWS Cloud Development Kit (AWS CDK),  <em>tokens</em> are placeholders for values that aren&#8217;t known when defining constructs or synthesizing stacks. These values will be fully resolved at deployment, when your actual infrastructure is created. When developing AWS CDK applications, you will work with tokens to manage these values across your application.</p>
</div>
<div class="sect3">
<h4 id="tokens-example">2.16.1. Token example</h4>
<div class="paragraph">
<p>The following is an example of a CDK stack that defines a construct for an Amazon Simple Storage Service (Amazon S3) bucket. Since the name of our bucket is not yet known, the value for  <code>bucketName</code> is stored as a token:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

export class CdkDemoAppStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define an S3 bucket
    const myBucket = new s3.Bucket(this, 'myBucket');

    // Store value of the S3 bucket name
    const myBucketName = myBucket.bucketName;

    // Print the current value for the S3 bucket name at synthesis
    console.log("myBucketName: " + bucketName);
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');

class CdkDemoAppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define an S3 bucket
    const myBucket = new s3.Bucket(this, 'myBucket');

    // Store value of the S3 bucket name
    const myBucketName = myBucket.bucketName;

    // Print the current value for the S3 bucket name at synthesis
    console.log("myBucketName: " + myBucketName);
  }
}

module.exports = { CdkDemoAppStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Stack
)
from constructs import Construct
from aws_cdk import aws_s3 as s3

class CdkDemoAppStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define an S3 bucket
        my_bucket = s3.Bucket(self, "myBucket")

        # Store the value of the S3 bucket name
        my_bucket_name = my_bucket.bucket_name

        # Print the current value for the S3 bucket name at synthesis
        print(f"myBucketName: {my_bucket_name}")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.s3.Bucket;

import java.util.Map;

public class CdkDemoAppStack extends Stack {
    public CdkDemoAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define an S3 bucket
        Bucket myBucket = Bucket.Builder.create(this, "myBucket")
            .build();

        // Store the token for the bucket name
        String myBucketName = myBucket.getBucketName();

        // Print the token at synthesis
        System.out.println("myBucketName: " + myBucketName);
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.S3;

namespace CdkDemoApp
{
    public class CdkDemoAppStack : Stack
    {
        internal CdkDemoAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define an S3 bucket
            var myBucket = new Bucket(this, "myBucket");

            // Store the token for the bucket name
            var myBucketName = myBucket.BucketName;

            // Print the token at synthesis
            System.Console.WriteLine($"myBucketName: {myBucketName}");
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"fmt"

	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/aws-cdk-go/awscdk/v2/awss3"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

type CdkDemoAppStackProps struct {
	awscdk.StackProps
}

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// Define an S3 bucket
	myBucket := awss3.NewBucket(stack, jsii.String("myBucket"), &amp;awss3.BucketProps{})

	// Store the token for the bucket name
	myBucketName := myBucket.BucketName()

	// Print the token at synthesis
	fmt.Println("myBucketName: ", *myBucketName)

	return stack
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code> to synthesize our stack, the value for <code>myBucketName</code> will be displayed in the token format of <code>${Token[TOKEN.[replaceable]</code>1234<code>]}</code>. This token format is a result of how the AWS CDK encodes tokens. In this example, the token is encoded as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk synth --quiet
myBucketName: ${Token[TOKEN.21]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the value for our bucket name is not known at synthesis, the token is rendered as  <code>myBucket[replaceable]</code>&lt;unique-hash&gt;````. Our AWS CloudFormation template uses the <code>Ref</code> intrinsic function to reference its value, which will be known at deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  myBucket5AF9C99B:
    # ...
Outputs:
  bucketNameOutput:
    Description: The name of the S3 bucket
    Value:
      Ref: myBucket5AF9C99B</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on how the unique hash is generated, see  <a href="#how-synth-default-logical-ids">Generated logical IDs in your AWS CloudFormation template</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tokens-passing">2.16.2. Passing tokens</h4>
<div class="paragraph">
<p>Tokens can be passed around as if they were the actual value they represent. The following is an example that passes the token for our bucket name to a construct for an AWS Lambda function:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';
import * as lambda from 'aws-cdk-lib/aws-lambda';

export class CdkDemoAppStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define an S3 bucket
    const myBucket = new s3.Bucket(this, 'myBucket');

    // ...

    // Define a Lambda function
    const myFunction = new lambda.Function(this, "myFunction", {
      runtime: lambda.Runtime.NODEJS_20_X,
      handler: "index.handler",
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
      `),
      functionName: myBucketName + "Function", // Pass token for the S3 bucket name
      environment: {
        BUCKET_NAME: myBucketName, // Pass token for the S3 bucket name
      }
    });
  }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');
const lambda = require('aws-cdk-lib/aws-lambda');

class CdkDemoAppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define an S3 bucket
    const myBucket = new s3.Bucket(this, 'myBucket');

    // ...

    // Define a Lambda function
    const myFunction = new lambda.Function(this, 'myFunction', {
      runtime: lambda.Runtime.NODEJS_20_X,
      handler: 'index.handler',
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
      `),
      functionName: myBucketName + 'Function', // Pass token for the S3 bucket name
      environment: {
        BUCKET_NAME: myBucketName, // Pass token for the S3 bucket name
      }
    });
  }
}

module.exports = { CdkDemoAppStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Stack
)
from constructs import Construct
from aws_cdk import aws_s3 as s3
from aws_cdk import aws_lambda as _lambda

class CdkDemoAppStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define an S3 bucket
        my_bucket = s3.Bucket(self, "myBucket")

        # ...

        # Define a Lambda function
        my_function = _lambda.Function(self, "myFunction",
            runtime=_lambda.Runtime.NODEJS_20_X,
            handler="index.handler",
            code=_lambda.Code.from_inline("""
                exports.handler = async function(event) {
                  return {
                    statusCode: 200,
                    body: JSON.stringify('Hello World!'),
                  };
                };
            """),
            function_name=f"{my_bucket_name}Function",  # Pass token for the S3 bucket name
            environment={
                "BUCKET_NAME": my_bucket_name  # Pass token for the S3 bucket name
            }
        )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.lambda.Code;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;

import java.util.Map;

public class CdkDemoAppStack extends Stack {
    public CdkDemoAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define an S3 bucket
        Bucket myBucket = Bucket.Builder.create(this, "myBucket")
            .build();

        // ...

        // Define a Lambda function
        Function myFunction = Function.Builder.create(this, "myFunction")
            .runtime(Runtime.NODEJS_20_X)
            .handler("index.handler")
            .code(Code.fromInline(
                "exports.handler = async function(event) {" +
                "return {" +
                "statusCode: 200," +
                "body: JSON.stringify('Hello World!')," +
                "};" +
                "};"
            ))
            .functionName(myBucketName + "Function") // Pass the token for the s3 bucket to the function construct
            .environment(Map.of("BUCKET_NAME", myBucketName))  // Pass the bucket name as environment variable
            .build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.S3;
using Amazon.CDK.AWS.Lambda;
using System;
using System.Collections.Generic;

namespace CdkDemoApp
{
    public class CdkDemoAppStack : Stack
    {
        internal CdkDemoAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define an S3 bucket
            var myBucket = new Bucket(this, "myBucket");

            // ...

            // Define a Lambda function
            var myFunction = new Function(this, "myFunction", new FunctionProps
            {
                 Runtime = Runtime.NODEJS_20_X,
                 Handler = "index.handler",
                 Code = Code.FromInline(@"
                     exports.handler = async function(event) {
                       return {
                         statusCode: 200,
                         body: JSON.stringify('Hello World!'),
                       };
                     };
                 "),
                 // Pass the token for the S3 bucket name
                 Environment = new Dictionary&lt;string, string&gt;
                 {
                     { "BUCKET_NAME", myBucketName }
                 },
                 FunctionName = $"{myBucketName}Function" // Pass the token for the s3 bucket to the function construct
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"fmt"

	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
	"github.com/aws/aws-cdk-go/awscdk/v2/awss3"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

type CdkDemoAppStackProps struct {
	awscdk.StackProps
}

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// Define an S3 bucket
	myBucket := awss3.NewBucket(stack, jsii.String("myBucket"), &amp;awss3.BucketProps{})

	// ...

	// Define a Lambda function
	myFunction := awslambda.NewFunction(stack, jsii.String("myFunction"), &amp;awslambda.FunctionProps{
		Runtime: awslambda.Runtime_NODEJS_20_X(),
		Handler: jsii.String("index.handler"),
		Code: awslambda.Code_FromInline(jsii.String(`
			exports.handler = async function(event) {
				return {
					statusCode: 200,
					body: JSON.stringify('Hello World!'),
				};
			};
		`)),
		FunctionName: jsii.String(fmt.Sprintf("%sFunction", *myBucketName)), // Pass the token for the S3 bucket to the function name
		Environment: &amp;map[string]*string{
			"BUCKET_NAME": myBucketName,
		},
	})

	return stack
}
// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we synthesize our template, the  <code>Ref</code> and <code>Fn::Join</code> intrinsic functions are used to specify the values, which will be known at deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  myBucket5AF9C99B:
    Type: AWS::S3::Bucket
    # ...
  myFunction884E1557:
    Type: AWS::Lambda::Function
    Properties:
      # ...
      Environment:
        Variables:
          BUCKET_NAME:
            Ref: myBucket5AF9C99B
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: myBucket5AF9C99B
            - Function
      # ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tokens-work">2.16.3. How token encodings work</h4>
<div class="paragraph">
<p>Tokens are objects that implement the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.IResolvable.html">IResolvable</a></code> interface, which contains a single <code>resolve</code> method. During synthesis, the AWS CDK calls this method to produce the final value for tokens in your CloudFormation template.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You&#8217;ll rarely work directly with the <code>IResolvable</code> interface. You will most likely only see string-encoded versions of tokens.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="tokens-work-types">Token encoding types</h5>
<div class="paragraph">
<p>Tokens participate in the synthesis process to produce arbitrary values of any type. Other functions typically only accept arguments of basic types, such as  <code>string</code> or <code>number</code>. To use tokens in these cases, you can encode them into one of three types by using static methods on the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Token.html">cdk.Token</a></code> class.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Token.html#static-aswbrstringvalue-options">Token.asString</a> to generate a string encoding (or call <code>.toString()</code> on the token object).</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Token.html#static-aswbrlistvalue-options">Token.asList</a> to generate a list encoding.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Token.html#static-aswbrnumbervalue">Token.asNumber</a> to generate a numeric encoding.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These take an arbitrary value, which can be an  <code>IResolvable</code>, and encode them into a primitive value of the indicated type.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because any one of the previous types can potentially be an encoded token, be careful when you parse or try to read their contents. For example, if you attempt to parse a string to extract a value from it, and the string is an encoded token, your parsing fails. Similarly, if you try to query the length of an array or perform math operations with a number, you must first verify that they aren&#8217;t encoded tokens.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tokens-check">2.16.4. How to check for tokens in your app</h4>
<div class="paragraph">
<p>To check whether a value has an unresolved token in it, call the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Token.html#static-iswbrunresolvedobj">Token.isUnresolved</a></code> (Python: <code>is_unresolved</code>) method. The following is an example that checks if the value for our Amazon S3 bucket name is a token. If its not a token, we then validate the length of the bucket name:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// ...

export class CdkDemoAppStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define an S3 bucket
    const myBucket = new s3.Bucket(this, 'myBucket');
    // ...

    // Check if bucket name is a token. If not, check if length is less than 10 characters
    if (cdk.Token.isUnresolved(myBucketName)) {
      console.log("Token identified.");
    } else if (!cdk.Token.isUnresolved(myBucketName) &amp;&amp; myBucketName.length &gt; 10) {
      throw new Error('Maximum length for name is 10 characters.');
    };

    // ...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration, Token, CfnOutput } = require('aws-cdk-lib');
// ...

class CdkDemoAppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define an S3 bucket
    const myBucket = new s3.Bucket(this, 'myBucket');

    // ...

    // Check if bucket name is a token. If not, check if length is less than 10 characters
    if (Token.isUnresolved(myBucketName)) {
      console.log("Token identified.");
    } else if (!Token.isUnresolved(myBucketName) &amp;&amp; myBucketName.length &gt; 10) {
      throw new Error('Maximum length for name is 10 characters.');
    };

    // ...</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Stack,
    Token
)
# ...

class CdkDemoAppStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define an S3 bucket
        my_bucket = s3.Bucket(self, "myBucket")

        # ...

        # Check if bucket name is a token. If not, check if length is less than 10 characters
        if Token.is_unresolved(my_bucket_name):
            print("Token identified.")
        elif not Token.is_unresolved(my_bucket_name) and len(my_bucket_name) &lt; 10:
            raise ValueError("Maximum length for name is 10 characters.")

        # ...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// ...
import software.amazon.awscdk.Token;
// ...

public class CdkDemoAppStack extends Stack {
    public CdkDemoAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define an S3 bucket
        Bucket myBucket = Bucket.Builder.create(this, "myBucket")
            .build();

        // ...

        // Check if the bucket name is a token. If not, check if length is less than 10 characters
        if (Token.isUnresolved(myBucketName)) {
            System.out.println("Token identified.");
        } else if (!Token.isUnresolved(myBucketName) &amp;&amp; myBucketName.length() &gt; 10) {
            throw new IllegalArgumentException("Maximum length for name is 10 characters.");
        }

        // ...
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.S3;
using Amazon.CDK.AWS.Lambda;
using System;
using System.Collections.Generic;

namespace CdkDemoApp
{
    public class CdkDemoAppStack : Stack
    {
        internal CdkDemoAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define an S3 bucket
            var myBucket = new Bucket(this, "myBucket");

            // ...

            // Check if bucket name is a token. If not, check if length is less than 10 characters
            if (Token.IsUnresolved(myBucketName))
            {
                System.Console.WriteLine("Token identified.");
            }
            else if (!Token.IsUnresolved(myBucketName) &amp;&amp; myBucketName.Length &gt; 10)
            {
                throw new System.Exception("Maximum length for name is 10 characters.");
            }

            // ...</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// ...

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// Define an S3 bucket
	myBucket := awss3.NewBucket(stack, jsii.String("myBucket"), &amp;awss3.BucketProps{})

	// ...

	// Check if the bucket name is unresolved (a token)
	if tokenUnresolved := awscdk.Token_IsUnresolved(myBucketName); tokenUnresolved != nil &amp;&amp; *tokenUnresolved {
		fmt.Println("Token identified.")
	} else if tokenUnresolved != nil &amp;&amp; !*tokenUnresolved &amp;&amp; len(*myBucketName) &gt; 10 {
		panic("Maximum length for name is 10 characters.")
	}

	// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, <code>myBucketName</code> is identified as a token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk synth --quiet
Token identified.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use token encodings to escape the type system. For example, you could string-encode a token that produces a number value at synthesis time. If you use these functions, it&#8217;s your responsibility to make sure that your template resolves to a usable state after synthesis.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="tokens-string">2.16.5. Working with string-encoded tokens</h4>
<div class="paragraph">
<p>String-encoded tokens look like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">${TOKEN[Bucket.Name.1234]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>They can be passed around like regular strings, and can be concatenated, as shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const functionName = bucket.bucketName + 'Function';</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const functionName = bucket.bucketName + 'Function';</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">function_name = bucket.bucket_name + "Function"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String functionName = bucket.getBucketName().concat("Function");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string functionName = bucket.BucketName + "Function";</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">functionName := *bucket.BucketName() + "Function"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use string interpolation, if your language supports it, as shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const functionName = `${bucket.bucketName}Function`;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const functionName = `${bucket.bucketName}Function`;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">function_name = f"{bucket.bucket_name}Function"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String functionName = String.format("%sFunction". bucket.getBucketName());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">string functionName = $"${bucket.bucketName}Function";</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use <code>fmt.Sprintf</code> for similar functionality:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">functionName := fmt.Sprintf("%sFunction", *bucket.BucketName())</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Avoid manipulating the string in other ways. For example, taking a substring of a string is likely to break the string token.</p>
</div>
</div>
<div class="sect3">
<h4 id="tokens-list">2.16.6. Working with list-encoded tokens</h4>
<div class="paragraph">
<p>List-encoded tokens look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">["#{TOKEN[Stack.NotificationArns.1234]}"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only safe thing to do with these lists is pass them directly to other constructs. Tokens in string list form cannot be concatenated, nor can an element be taken from the token. The only safe way to manipulate them is by using AWS CloudFormation intrinsic functions like  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-select.html">Fn.select</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tokens-number">2.16.7. Working with number-encoded tokens</h4>
<div class="paragraph">
<p>Number-encoded tokens are a set of tiny negative floating-point numbers that look like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">-1.8881545897087626e+289</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with list tokens, you cannot modify the number value, as doing so is likely to break the number token.</p>
</div>
<div class="paragraph">
<p>The following is an example of a construct that contains a token encoded as a number:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Stack, Duration, StackProps } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as rds from 'aws-cdk-lib/aws-rds';
import * as ec2 from 'aws-cdk-lib/aws-ec2';

export class CdkDemoAppStack extends Stack {
  constructor(scope: Construct, id: string, props?: StackProps) {
    super(scope, id, props);

    // Define a new VPC
    const vpc = new ec2.Vpc(this, 'MyVpc', {
      maxAzs: 3,  // Maximum number of availability zones to use
    });

    // Define an RDS database cluster
    const dbCluster = new rds.DatabaseCluster(this, 'MyRDSCluster', {
      engine: rds.DatabaseClusterEngine.AURORA,
      instanceProps: {
        vpc,
      },
    });

    // Get the port token (this is a token encoded as a number)
    const portToken = dbCluster.clusterEndpoint.port;

    // Print the value for our token at synthesis
    console.log("portToken: " + portToken);
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');
const lambda = require('aws-cdk-lib/aws-lambda');
const rds = require('aws-cdk-lib/aws-rds');
const ec2 = require('aws-cdk-lib/aws-ec2');

class CdkDemoAppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define a new VPC
    const vpc = new ec2.Vpc(this, 'MyVpc', {
      maxAzs: 3,  // Maximum number of availability zones to use
    });

    // Define an RDS database cluster
    const dbCluster = new rds.DatabaseCluster(this, 'MyRDSCluster', {
      engine: rds.DatabaseClusterEngine.AURORA,
      instanceProps: {
        vpc,
      },
    });

    // Get the port token (this is a token encoded as a number)
    const portToken = dbCluster.clusterEndpoint.port;

    // Print the value for our token at synthesis
    console.log("portToken: " + portToken);
  }
}

module.exports = { CdkDemoAppStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Duration,
    Stack,
)
from aws_cdk import aws_rds as rds
from aws_cdk import aws_ec2 as ec2
from constructs import Construct

class CdkDemoAppStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define a new VPC
        vpc = ec2.Vpc(self, 'MyVpc',
            max_azs=3  # Maximum number of availability zones to use
        )

        # Define an RDS database cluster
        db_cluster = rds.DatabaseCluster(self, 'MyRDSCluster',
            engine=rds.DatabaseClusterEngine.AURORA,
            instance_props=rds.InstanceProps(
                vpc=vpc
            )
        )

        # Get the port token (this is a token encoded as a number)
        port_token = db_cluster.cluster_endpoint.port

        # Print the value for our token at synthesis
        print(f"portToken: {port_token}")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.ec2.Vpc;
import software.amazon.awscdk.services.rds.DatabaseCluster;
import software.amazon.awscdk.services.rds.DatabaseClusterEngine;
import software.amazon.awscdk.services.rds.InstanceProps;

public class CdkDemoAppStack extends Stack {
    public CdkDemoAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define a new VPC
        Vpc vpc = Vpc.Builder.create(this, "MyVpc")
            .maxAzs(3) // Maximum number of availability zones to use
            .build();

        // Define an RDS database cluster
        DatabaseCluster dbCluster = DatabaseCluster.Builder.create(this, "MyRDSCluster")
            .engine(DatabaseClusterEngine.AURORA)
            .instanceProps(InstanceProps.builder()
                .vpc(vpc)
                .build())
            .build();

        // Get the port token (this is a token encoded as a number)
        Number portToken = dbCluster.getClusterEndpoint().getPort();

        // Print the value for our token at synthesis
        System.out.println("portToken: " + portToken);
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.EC2;
using Amazon.CDK.AWS.RDS;
using System;
using System.Collections.Generic;

namespace CdkDemoApp
{
    public class CdkDemoAppStack : Stack
    {
        internal CdkDemoAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define a new VPC
            var vpc = new Vpc(this, "MyVpc", new VpcProps
            {
                MaxAzs = 3  // Maximum number of availability zones to use
            });

            // Define an RDS database cluster
            var dbCluster = new DatabaseCluster(this, "MyRDSCluster", new DatabaseClusterProps
            {
                Engine = DatabaseClusterEngine.AURORA,  // Remove parentheses
                InstanceProps = new Amazon.CDK.AWS.RDS.InstanceProps // Specify RDS InstanceProps
                {
                    Vpc = vpc
                }
            });

            // Get the port token (this is a token encoded as a number)
            var portToken = dbCluster.ClusterEndpoint.Port;

            // Print the value for our token at synthesis
            System.Console.WriteLine($"portToken: {portToken}");
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"fmt"

	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/aws-cdk-go/awscdk/v2/awsec2"
	"github.com/aws/aws-cdk-go/awscdk/v2/awsrds"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

type CdkDemoAppStackProps struct {
	awscdk.StackProps
}

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// Define a new VPC
	vpc := awsec2.NewVpc(stack, jsii.String("MyVpc"), &amp;awsec2.VpcProps{
		MaxAzs: jsii.Number(3), // Maximum number of availability zones to use
	})

	// Define an RDS database cluster
	dbCluster := awsrds.NewDatabaseCluster(stack, jsii.String("MyRDSCluster"), &amp;awsrds.DatabaseClusterProps{
		Engine: awsrds.DatabaseClusterEngine_AURORA(),
		InstanceProps: &amp;awsrds.InstanceProps{
			Vpc: vpc,
		},
	})

	// Get the port token (this is a token encoded as a number)
	portToken := dbCluster.ClusterEndpoint().Port()

	// Print the value for our token at synthesis
	fmt.Println("portToken: ", portToken)

	return stack
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, the value for <code>portToken</code> is displayed as a number-encoded token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk synth --quiet
portToken: -1.8881545897087968e+289</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="tokens-number-pass">Pass number-encoded tokens</h5>
<div class="paragraph">
<p>When you pass number-encoded tokens to other constructs, it may make sense to convert them to strings first. For example, if you want to use the value of a number-encoded string as part of a concatenated string, converting it helps with readability.</p>
</div>
<div class="paragraph">
<p>In the following example, <code>portToken</code> is a number-encoded token that we want to pass to our Lambda function as part of <code>connectionString</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Stack, Duration, CfnOutput, StackProps } from 'aws-cdk-lib';
// ...
import * as lambda from 'aws-cdk-lib/aws-lambda';

export class CdkDemoAppStack extends Stack {
  constructor(scope: Construct, id: string, props?: StackProps) {
    super(scope, id, props);

    // Define a new VPC
    // ...

    // Define an RDS database cluster
    // ...

    // Get the port token (this is a token encoded as a number)
    const portToken = dbCluster.clusterEndpoint.port;

    // ...

    // Example connection string with the port token as a number
    const connectionString = `jdbc:mysql://mydb.cluster.amazonaws.com:${portToken}/mydatabase`;

    // Use the connection string as an environment variable in a Lambda function
    const myFunction = new lambda.Function(this, 'MyLambdaFunction', {
      runtime: lambda.Runtime.NODEJS_20_X,
      handler: 'index.handler',
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
      `),
      environment: {
        DATABASE_CONNECTION_STRING: connectionString,  // Using the port token as part of the string
      },
    });

    // Output the value of our connection string at synthesis
    console.log("connectionString: " + connectionString);

    // Output the connection string
    new CfnOutput(this, 'ConnectionString', {
      value: connectionString,
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration, CfnOutput } = require('aws-cdk-lib');
// ...
const lambda = require('aws-cdk-lib/aws-lambda');

class CdkDemoAppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define a new VPC
    // ...

    // Define an RDS database cluster
    // ...

    // Get the port token (this is a token encoded as a number)
    const portToken = dbCluster.clusterEndpoint.port;

    // ...

    // Example connection string with the port token as a number
    const connectionString = `jdbc:mysql://mydb.cluster.amazonaws.com:${portToken}/mydatabase`;

    // Use the connection string as an environment variable in a Lambda function
    const myFunction = new lambda.Function(this, 'MyLambdaFunction', {
      runtime: lambda.Runtime.NODEJS_20_X,
      handler: 'index.handler',
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
      `),
      environment: {
        DATABASE_CONNECTION_STRING: connectionString,  // Using the port token as part of the string
      },
    });

    // Output the value of our connection string at synthesis
    console.log("connectionString: " + connectionString);

    // Output the connection string
    new CfnOutput(this, 'ConnectionString', {
      value: connectionString,
    });
  }
}

module.exports = { CdkDemoAppStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Duration,
    Stack,
    CfnOutput,
)
from aws_cdk import aws_lambda as _lambda
# ...

class CdkDemoAppStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define a new VPC
        # ...

        # Define an RDS database cluster
        # ...

        # Get the port token (this is a token encoded as a number)
        port_token = db_cluster.cluster_endpoint.port

        # ...

        # Example connection string with the port token as a number
        connection_string = f"jdbc:mysql://mydb.cluster.amazonaws.com:{port_token}/mydatabase"

        # Use the connection string as an environment variable in a Lambda function
        my_function = _lambda.Function(self, 'MyLambdaFunction',
            runtime=_lambda.Runtime.NODEJS_20_X,
            handler='index.handler',
            code=_lambda.Code.from_inline("""
                exports.handler = async function(event) {
                    return {
                        statusCode: 200,
                        body: JSON.stringify('Hello World!'),
                    };
                };
            """),
            environment={
                'DATABASE_CONNECTION_STRING': connection_string  # Using the port token as part of the string
            }
        )

        # Output the value of our connection string at synthesis
        print(f"connectionString: {connection_string}")

        # Output the connection string
        CfnOutput(self, 'ConnectionString',
            value=connection_string
        )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// ...
import software.amazon.awscdk.CfnOutput;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;
import software.amazon.awscdk.services.lambda.Code;

import java.util.Map;

public class CdkDemoAppStack extends Stack {
    public CdkDemoAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define a new VPC
        // ...

        // Define an RDS database cluster
        // ...

        // Get the port token (this is a token encoded as a number)
        Number portToken = dbCluster.getClusterEndpoint().getPort();

        // ...

        // Example connection string with the port token as a number
        String connectionString = "jdbc:mysql://mydb.cluster.amazonaws.com:" + portToken + "/mydatabase";

        // Use the connection string as an environment variable in a Lambda function
        Function myFunction = Function.Builder.create(this, "MyLambdaFunction")
            .runtime(Runtime.NODEJS_20_X)
            .handler("index.handler")
            .code(Code.fromInline(
                "exports.handler = async function(event) {\n" +
                "  return {\n" +
                "    statusCode: 200,\n" +
                "    body: JSON.stringify('Hello World!'),\n" +
                "  };\n" +
                "};"))
            .environment(Map.of(
                "DATABASE_CONNECTION_STRING", connectionString // Using the port token as part of the string
            ))
            .build();

        // Output the value of our connection string at synthesis
        System.out.println("connectionString: " + connectionString);

        // Output the connection string
        CfnOutput.Builder.create(this, "ConnectionString")
            .value(connectionString)
            .build();
    }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// ...
using Amazon.CDK.AWS.Lambda;

namespace CdkDemoApp
{
    public class CdkDemoAppStack : Stack
    {
        internal CdkDemoAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define a new VPC
            // ...

            // Define an RDS database cluster
            var dbCluster = new DatabaseCluster(this, "MyRDSCluster", new DatabaseClusterProps
            // ...

            // Get the port token (this is a token encoded as a number)
            var portToken = dbCluster.ClusterEndpoint.Port;

            // ...

            // Example connection string with the port token as a number
            var connectionString = $"jdbc:mysql://mydb.cluster.amazonaws.com:{portToken}/mydatabase";

            // Use the connection string as an environment variable in a Lambda function
            var myFunction = new Function(this, "MyLambdaFunction", new FunctionProps
            {
                Runtime = Runtime.NODEJS_20_X,
                Handler = "index.handler",
                Code = Code.FromInline(@"
                    exports.handler = async function(event) {
                        return {
                            statusCode: 200,
                            body: JSON.stringify('Hello World!'),
                        };
                    };
                "),
                Environment = new Dictionary&lt;string, string&gt;
                {
                    { "DATABASE_CONNECTION_STRING", connectionString }  // Using the port token as part of the string
                }
            });

            // Output the value of our connection string at synthesis
            Console.WriteLine($"connectionString: {connectionString}");

            // Output the connection string
            new CfnOutput(this, "ConnectionString", new CfnOutputProps
            {
                Value = connectionString
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// ...
	"github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
)

type CdkDemoAppStackProps struct {
	awscdk.StackProps
}

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// Define a new VPC
	// ...

	// Define an RDS database cluster
	// ...

	// Get the port token (this is a token encoded as a number)
	portToken := dbCluster.ClusterEndpoint().Port()

	// ...

	// Example connection string with the port token as a number
	 connectionString := fmt.Sprintf("jdbc:mysql://mydb.cluster.amazonaws.com:%s/mydatabase", portToken)

	// Use the connection string as an environment variable in a Lambda function
	myFunction := awslambda.NewFunction(stack, jsii.String("MyLambdaFunction"), &amp;awslambda.FunctionProps{
		Runtime: awslambda.Runtime_NODEJS_20_X(),
		Handler: jsii.String("index.handler"),
		Code: awslambda.Code_FromInline(jsii.String(`
			exports.handler = async function(event) {
				return {
					statusCode: 200,
					body: JSON.stringify('Hello World!'),
				};
			};
		`)),
		Environment: &amp;map[string]*string{
			"DATABASE_CONNECTION_STRING": jsii.String(connectionString), // Using the port token as part of the string
		},
	})

	// Output the value of our connection string at synthesis
	fmt.Println("connectionString: ", connectionString)

	// Output the connection string
	awscdk.NewCfnOutput(stack, jsii.String("ConnectionString"), &amp;awscdk.CfnOutputProps{
		Value: jsii.String(connectionString),
	})

	return stack
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we pass this value to  <code>connectionString</code>, the output value when we run <code>cdk synth</code> may be confusing due to the number-encoded string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk synth --quiet
connectionString: jdbc:mysql://mydb.cluster.amazonaws.com:-1.888154589708796e+289/mydatabase</code></pre>
</div>
</div>
<div class="paragraph">
<p>To convert a number-encoded token to a string, use  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Tokenization.html#static-stringifywbrnumberx">cdk.Tokenization.stringifyNumber(token)</a></code>. In the following example, we convert the number-encoded token to a string before defining our connection string:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Stack, Duration, Tokenization, CfnOutput, StackProps } from 'aws-cdk-lib';
// ...

export class CdkDemoAppStack extends Stack {
  constructor(scope: Construct, id: string, props?: StackProps) {
    super(scope, id, props);

    // Define a new VPC
    // ...

    // Define an RDS database cluster
    // ...

    // Get the port token (this is a token encoded as a number)
    const portToken = dbCluster.clusterEndpoint.port;

    // ...

    // Convert the encoded number to an encoded string for use in the connection string
    const portAsString = Tokenization.stringifyNumber(portToken);

    // Example connection string with the port token as a string
    const connectionString = `jdbc:mysql://mydb.cluster.amazonaws.com:${portAsString}/mydatabase`;

    // Use the connection string as an environment variable in a Lambda function
    const myFunction = new lambda.Function(this, 'MyLambdaFunction', {
      // ...
      environment: {
        DATABASE_CONNECTION_STRING: connectionString,  // Using the port token as part of the string
      },
    });

    // Output the value of our connection string at synthesis
    console.log("connectionString: " + connectionString);

    // Output the connection string
    new CfnOutput(this, 'ConnectionString', {
      value: connectionString,
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration, Tokenization, CfnOutput } = require('aws-cdk-lib');
// ...

class CdkDemoAppStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define a new VPC
    // ...

    // Define an RDS database cluster
    // ...

    // Get the port token (this is a token encoded as a number)
    const portToken = dbCluster.clusterEndpoint.port;

    // ...

    // Convert the encoded number to an encoded string for use in the connection string
    const portAsString = Tokenization.stringifyNumber(portToken);

    // Example connection string with the port token as a string
    const connectionString = `jdbc:mysql://mydb.cluster.amazonaws.com:${portAsString}/mydatabase`;

    // Use the connection string as an environment variable in a Lambda function
    const myFunction = new lambda.Function(this, 'MyLambdaFunction', {
      // ...
      environment: {
        DATABASE_CONNECTION_STRING: connectionString,  // Using the port token as part of the string
      },
    });

    // Output the value of our connection string at synthesis
    console.log("connectionString: " + connectionString);

    // Output the connection string
    new CfnOutput(this, 'ConnectionString', {
      value: connectionString,
    });
  }
}

module.exports = { CdkDemoAppStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Duration,
    Stack,
    Tokenization,
    CfnOutput,
)
# ...

class CdkDemoAppStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define a new VPC
        # ...

        # Define an RDS database cluster
        # ...

        # Get the port token (this is a token encoded as a number)
        port_token = db_cluster.cluster_endpoint.port

        # Convert the encoded number to an encoded string for use in the connection string
        port_as_string = Tokenization.stringify_number(port_token)

        # Example connection string with the port token as a string
        connection_string = f"jdbc:mysql://mydb.cluster.amazonaws.com:{port_as_string}/mydatabase"

        # Use the connection string as an environment variable in a Lambda function
        my_function = _lambda.Function(self, 'MyLambdaFunction',
            # ...
            environment={
                'DATABASE_CONNECTION_STRING': connection_string  # Using the port token as part of the string
            }
        )

        # Output the value of our connection string at synthesis
        print(f"connectionString: {connection_string}")

        # Output the connection string
        CfnOutput(self, 'ConnectionString',
            value=connection_string
        )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// ...
import software.amazon.awscdk.Tokenization;

public class CdkDemoAppStack extends Stack {
    public CdkDemoAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define a new VPC
        // ...

        // Define an RDS database cluster
        // ...

        // Get the port token (this is a token encoded as a number)
        Number portToken = dbCluster.getClusterEndpoint().getPort();

        // ...

        // Convert the encoded number to an encoded string for use in the connection string
        String portAsString = Tokenization.stringifyNumber(portToken);

        // Example connection string with the port token as a string
        String connectionString = "jdbc:mysql://mydb.cluster.amazonaws.com:" + portAsString + "/mydatabase";

        // Use the connection string as an environment variable in a Lambda function
        Function myFunction = Function.Builder.create(this, "MyLambdaFunction")
            // ...
            .environment(Map.of(
                "DATABASE_CONNECTION_STRING", connectionString // Using the port token as part of the string
            ))
            .build();

        // Output the value of our connection string at synthesis
        System.out.println("connectionString: " + connectionString);

        // Output the connection string
        CfnOutput.Builder.create(this, "ConnectionString")
            .value(connectionString)
            .build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// ...

namespace CdkDemoApp
{
    public class CdkDemoAppStack : Stack
    {
        internal CdkDemoAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define a new VPC
            // ...

            // Define an RDS database cluster
            // ...

            // Get the port token (this is a token encoded as a number)
            var portToken = dbCluster.ClusterEndpoint.Port;

            // ...

            // Convert the encoded number to an encoded string for use in the connection string
            var portAsString = Tokenization.StringifyNumber(portToken);

            // Example connection string with the port token as a string
            var connectionString = $"jdbc:mysql://mydb.cluster.amazonaws.com:{portAsString}/mydatabase";

            // Use the connection string as an environment variable in a Lambda function
            var myFunction = new Function(this, "MyLambdaFunction", new FunctionProps
            {
                // ...
                Environment = new Dictionary&lt;string, string&gt;
                {
                    { "DATABASE_CONNECTION_STRING", connectionString }  // Using the port token as part of the string
                }
            });

            // Output the value of our connection string at synthesis
            Console.WriteLine($"connectionString: {connectionString}");

            // Output the connection string
            new CfnOutput(this, "ConnectionString", new CfnOutputProps
            {
                Value = connectionString
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// ...

func NewCdkDemoAppStack(scope constructs.Construct, id string, props *CdkDemoAppStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	// Define a new VPC
	// ...

	// Define an RDS database cluster
	// ...

	// Get the port token (this is a token encoded as a number)
	portToken := dbCluster.ClusterEndpoint().Port()

	// ...

	// Convert the encoded number to an encoded string for use in the connection string
	portAsString := awscdk.Tokenization_StringifyNumber(portToken)

	// Example connection string with the port token as a string
	connectionString := fmt.Sprintf("jdbc:mysql://mydb.cluster.amazonaws.com:%s/mydatabase", portAsString)

	// Use the connection string as an environment variable in a Lambda function
	myFunction := awslambda.NewFunction(stack, jsii.String("MyLambdaFunction"), &amp;awslambda.FunctionProps{
		// ...
		Environment: &amp;map[string]*string{
			"DATABASE_CONNECTION_STRING": jsii.String(connectionString), // Using the port token as part of the string
		},
	})

	// Output the value of our connection string at synthesis
	fmt.Println("connectionString: ", connectionString)

	// Output the connection string
	awscdk.NewCfnOutput(stack, jsii.String("ConnectionString"), &amp;awscdk.CfnOutputProps{
		Value: jsii.String(connectionString),
	})

	fmt.Println(myFunction)

	return stack
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, the value for our connection string is represented in a cleaner and clearer format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth --quiet
connectionString: jdbc:mysql://mydb.cluster.amazonaws.com:${Token[TOKEN.242]}/mydatabase</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tokens-lazy">2.16.8. Lazy values</h4>
<div class="paragraph">
<p>In addition to representing deploy-time values, such as AWS CloudFormation  <a href="#parameters">parameters</a>, tokens are also commonly used to represent synthesis-time lazy values. These are values for which the final value will be determined before synthesis has completed, but not at the point where the value is constructed. Use tokens to pass a literal string or number value to another construct, while the actual value at synthesis time might depend on some calculation that has yet to occur.</p>
</div>
<div class="paragraph">
<p>You can construct tokens representing synth-time lazy values using static methods on the <code>Lazy</code> class, such as <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Lazy.html#static-stringproducer-options">Lazy.string</a></code> and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Lazy.html#static-numberproducer">Lazy.number</a></code>. These methods accept an object whose <code>produce</code> property is a function that accepts a context argument and returns the final value when called.</p>
</div>
<div class="paragraph">
<p>The following example creates an Auto Scaling group whose capacity is determined after its creation.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">let actualValue: number;

new AutoScalingGroup(this, 'Group', {
  desiredCapacity: Lazy.numberValue({
    produce(context) {
      return actualValue;
    }
  })
});

// At some later point
actualValue = 10;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">let actualValue;

new AutoScalingGroup(this, 'Group', {
  desiredCapacity: Lazy.numberValue({
    produce(context) {
      return (actualValue);
    }
  })
});

// At some later point
actualValue = 10;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class Producer:
    def __init__(self, func):
        self.produce = func

actual_value = None

AutoScalingGroup(self, "Group",
    desired_capacity=Lazy.number_value(Producer(lambda context: actual_value))
)

# At some later point
actual_value = 10</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">double actualValue = 0;

class ProduceActualValue implements INumberProducer {

    @Override
    public Number produce(IResolveContext context) {
        return actualValue;
    }
}

AutoScalingGroup.Builder.create(this, "Group")
    .desiredCapacity(Lazy.numberValue(new ProduceActualValue())).build();

// At some later point
actualValue = 10;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class NumberProducer : INumberProducer
{
    Func&lt;Double&gt; function;

    public NumberProducer(Func&lt;Double&gt; function)
    {
        this.function = function;
    }

    public Double Produce(IResolveContext context)
    {
        return function();
    }
}

double actualValue = 0;

new AutoScalingGroup(this, "Group", new AutoScalingGroupProps
{
    DesiredCapacity = Lazy.NumberValue(new NumberProducer(() =&gt; actualValue))
});

// At some later point
actualValue = 10;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tokens-json">2.16.9. Converting to JSON</h4>
<div class="paragraph">
<p>Sometimes you want to produce a JSON string of arbitrary data, and you may not know whether the data contains tokens. To properly JSON-encode any data structure, regardless of whether it contains tokens, use the method  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#towbrjsonwbrstringobj-space">stack.toJsonString</a></code>, as shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const stack = Stack.of(this);
const str = stack.toJsonString({
  value: bucket.bucketName
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const stack = Stack.of(this);
const str = stack.toJsonString({
  value: bucket.bucketName
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">stack = Stack.of(self)
string = stack.to_json_string(dict(value=bucket.bucket_name))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Stack stack = Stack.of(this);
String stringVal = stack.toJsonString(java.util.Map.of(    // Map.of requires Java 9+
        put("value", bucket.getBucketName())));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var stack = Stack.Of(this);
var stringVal = stack.ToJsonString(new Dictionary&lt;string, string&gt;
{
    ["value"] = bucket.BucketName
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="parameters">2.17. Parameters and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p><em>Parameters</em> are custom values that are supplied at deployment time.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Parameters</em> are custom values that are supplied at deployment time. <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">Parameters</a> are a feature of AWS CloudFormation. Since the AWS Cloud Development Kit (AWS CDK) synthesizes AWS CloudFormation templates, it also offers support for deployment-time parameters.</p>
</div>
<div class="sect3">
<h4 id="parameters-about">2.17.1. About parameters</h4>
<div class="paragraph">
<p>Using the AWS CDK, you can define parameters, which can then be used in the properties of constructs you create. You can also deploy stacks that contain parameters.</p>
</div>
<div class="paragraph">
<p>When deploying the AWS CloudFormation template using the AWS CDK <code class="noloc">CLI</code>, you provide the parameter values on the command line. If you deploy the template through the AWS CloudFormation console, you are prompted for the parameter values.</p>
</div>
<div class="paragraph">
<p>In general, we recommend against using AWS CloudFormation parameters with the AWS CDK. The usual ways to pass values into AWS CDK apps are <a href="#context">context values</a> and environment variables. Because they are not available at synthesis time, parameter values cannot be easily used for flow control and other purposes in your CDK app.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To do control flow with parameters, you can use <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.CfnCondition.html">CfnCondition</a> constructs, although this is awkward compared to native <code>if</code> statements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using parameters requires you to be mindful of how the code you&#8217;re writing behaves at deployment time, and also at synthesis time. This makes it harder to understand and reason about your AWS CDK application, in many cases for little benefit.</p>
</div>
<div class="paragraph">
<p>Generally, it&#8217;s better to have your CDK app accept necessary information in a well-defined way and use it directly to declare constructs in your CDK app. An ideal AWS CDK–generated AWS CloudFormation template is concrete, with no values remaining to be specified at deployment time.</p>
</div>
<div class="paragraph">
<p>There are, however, use cases to which AWS CloudFormation parameters are uniquely suited. If you have separate teams defining and deploying infrastructure, for example, you can use parameters to make the generated templates more widely useful. Also, because the AWS CDK supports AWS CloudFormation parameters, you can use the AWS CDK with AWS services that use AWS CloudFormation templates (such as Service Catalog). These AWS services use parameters to configure the template that&#8217;s being deployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-learn">2.17.2. Learn more</h4>
<div class="paragraph">
<p>For instructions on developing CDK apps with parameters, see  <a href="#get-cfn-param">Use CloudFormation parameters to get a CloudFormation value</a>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="tagging">2.18. Tags and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Tags are informational key-value elements that you can add to constructs in your AWS CDK app. A tag applied to a given construct also applies to all of its taggable children. Tags are included in the AWS CloudFormation template synthesized from your app and are applied to the AWS resources it deploys. You can use tags to identify and categorize resources for the following purposes:</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Tags are informational key-value elements that you can add to constructs in your AWS CDK app. A tag applied to a given construct also applies to all of its taggable children. Tags are included in the AWS CloudFormation template synthesized from your app and are applied to the AWS resources it deploys. You can use tags to identify and categorize resources for the following purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simplifying management</p>
</li>
<li>
<p>Cost allocation</p>
</li>
<li>
<p>Access control</p>
</li>
<li>
<p>Any other purposes that you devise</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about how you can use tags with your AWS resources, see  <a href="https://docs.aws.amazon.com/whitepapers/latest/tagging-best-practices/tagging-best-practices.html">Best Practices for Tagging AWS Resources</a> in the <em>AWS Whitepaper</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tagging-use">2.18.1. Using tags</h4>
<div class="paragraph">
<p>The  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Tags.html">Tags</a> class includes the static method <code>of()</code>, through which you can add tags to, or remove tags from, the specified construct.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Tags.html#addkey-value-props">Tags.of(SCOPE).add()</a> applies a new tag to the given construct and all of its children.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Tags.html#removekey-props">Tags.of(SCOPE).remove()</a> removes a tag from the given construct and any of its children, including tags a child construct may have applied to itself.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Tagging is implemented using  <a href="#aspects">Aspects and the AWS CDK</a>. Aspects are a way to apply an operation (such as tagging) to all constructs in a given scope.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example applies the tag  <strong>key</strong> with the value <strong>value</strong> to a construct.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).add('key', 'value');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).add('key', 'value');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Tags.of(my_construct).add("key", "value")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tags.of(myConstruct).add("key", "value");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Tags.Of(myConstruct).Add("key", "value");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Tags_Of(myConstruct).Add(jsii.String("key"), jsii.String("value"), &amp;awscdk.TagProps{})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example deletes the tag  <strong>key</strong> from a construct.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).remove('key');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).remove('key');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Tags.of(my_construct).remove("key")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tags.of(myConstruct).remove("key");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Tags.Of(myConstruct).Remove("key");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Tags_Of(myConstruct).Remove(jsii.String("key"), &amp;awscdk.TagProps{})</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using  <code>Stage</code> constructs, apply the tag at the <code>Stage</code> level or below. Tags are not applied across <code>Stage</code> boundaries.</p>
</div>
</div>
<div class="sect3">
<h4 id="w94aac13c77c17">2.18.2. Tag priorities</h4>
<div class="paragraph">
<p>The AWS CDK applies and removes tags recursively. If there are conflicts, the tagging operation with the highest priority wins. (Priorities are set using the optional  <code>priority</code> property.) If the priorities of two operations are the same, the tagging operation closest to the bottom of the construct tree wins. By default, applying a tag has a priority of 100 (except for tags added directly to an AWS CloudFormation resource, which has a priority of 50). The default priority for removing a tag is 200.</p>
</div>
<div class="paragraph">
<p>The following applies a tag with a priority of 300 to a construct.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).add('key', 'value', {
  priority: 300
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).add('key', 'value', {
  priority: 300
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Tags.of(my_construct).add("key", "value", priority=300)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tags.of(myConstruct).add("key", "value", TagProps.builder()
        .priority(300).build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Tags.Of(myConstruct).Add("key", "value", new TagProps { Priority = 300 });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Tags_Of(myConstruct).Add(jsii.String("key"), jsii.String("value"), &amp;awscdk.TagProps{
  Priority: jsii.Number(300),
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tagging-props">2.18.3. Optional properties</h4>
<div class="paragraph">
<p>Tags support  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.TagProps.html">properties</a> that fine-tune how tags are applied to, or removed from, resources. All properties are optional.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>applyToLaunchedInstances</code> (Python: <code>apply_to_launched_instances</code>)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Available for add() only. By default, tags are applied to instances launched in an Auto Scaling group. Set this property to <strong>false</strong> to ignore instances launched in an Auto Scaling group.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>includeResourceTypes</code>/<code>excludeResourceTypes</code> (Python: <code>include_resource_types</code>/<code>exclude_resource_types</code>)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use these to manipulate tags only on a subset of resources, based on AWS CloudFormation resource types. By default, the operation is applied to all resources in the construct subtree, but this can be changed by including or excluding certain resource types. Exclude takes precedence over include, if both are specified.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>priority</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use this to set the priority of this operation with respect to other <code>Tags.add()</code> and <code>Tags.remove()</code> operations. Higher values take precedence over lower values. The default is 100 for add operations (50 for tags applied directly to AWS CloudFormation resources) and 200 for remove operations.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following example applies the tag  <strong>tagname</strong> with the value <strong>value</strong> and priority <strong>100</strong> to resources of type <strong>AWS::Xxx::Yyy</strong> in the construct. It doesn&#8217;t apply the tag to instances launched in an Amazon EC2 Auto Scaling group or to resources of type <strong>AWS::Xxx::Zzz</strong>. (These are placeholders for two arbitrary but different AWS CloudFormation resource types.)</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).add('tagname', 'value', {
  applyToLaunchedInstances: false,
  includeResourceTypes: ['AWS::Xxx::Yyy'],
  excludeResourceTypes: ['AWS::Xxx::Zzz'],
  priority: 100,
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).add('tagname', 'value', {
  applyToLaunchedInstances: false,
  includeResourceTypes: ['AWS::Xxx::Yyy'],
  excludeResourceTypes: ['AWS::Xxx::Zzz'],
  priority: 100
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Tags.of(my_construct).add("tagname", "value",
    apply_to_launched_instances=False,
    include_resource_types=["AWS::Xxx::Yyy"],
    exclude_resource_types=["AWS::Xxx::Zzz"],
    priority=100)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tags.of(myConstruct).add("tagname", "value", TagProps.builder()
                .applyToLaunchedInstances(false)
                .includeResourceTypes(Arrays.asList("AWS::Xxx::Yyy"))
                .excludeResourceTypes(Arrays.asList("AWS::Xxx::Zzz"))
                .priority(100).build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Tags.Of(myConstruct).Add("tagname", "value", new TagProps
{
    ApplyToLaunchedInstances = false,
    IncludeResourceTypes = ["AWS::Xxx::Yyy"],
    ExcludeResourceTypes = ["AWS::Xxx::Zzz"],
    Priority = 100
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Tags_Of(myConstruct).Add(jsii.String("tagname"), jsii.String("value"), &amp;awscdk.TagProps{
  ApplyToLaunchedInstances: jsii.Bool(false),
  IncludeResourceTypes:     &amp;[]*string{jsii.String("AWS::Xxx:Yyy")},
  ExcludeResourceTypes:     &amp;[]*string{jsii.String("AWS::Xxx:Zzz")},
  Priority:                 jsii.Number(100),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example removes the tag  <strong>tagname</strong> with priority <strong>200</strong> from resources of type <strong>AWS::Xxx::Yyy</strong> in the construct, but not from resources of type <strong>AWS::Xxx::Zzz</strong>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).remove('tagname', {
  includeResourceTypes: ['AWS::Xxx::Yyy'],
  excludeResourceTypes: ['AWS::Xxx::Zzz'],
  priority: 200,
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(myConstruct).remove('tagname', {
  includeResourceTypes: ['AWS::Xxx::Yyy'],
  excludeResourceTypes: ['AWS::Xxx::Zzz'],
  priority: 200
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Tags.of(my_construct).remove("tagname",
    include_resource_types=["AWS::Xxx::Yyy"],
    exclude_resource_types=["AWS::Xxx::Zzz"],
    priority=200,)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tags.of((myConstruct).remove("tagname", TagProps.builder()
        .includeResourceTypes(Arrays.asList("AWS::Xxx::Yyy"))
        .excludeResourceTypes(Arrays.asList("AWS::Xxx::Zzz"))
        .priority(100).build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Tags.Of(myConstruct).Remove("tagname", new TagProps
{
    IncludeResourceTypes = ["AWS::Xxx::Yyy"],
    ExcludeResourceTypes = ["AWS::Xxx::Zzz"],
    Priority = 100
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Tags_Of(myConstruct).Remove(jsii.String("tagname"), &amp;awscdk.TagProps{
  IncludeResourceTypes: &amp;[]*string{jsii.String("AWS::Xxx:Yyy")},
  ExcludeResourceTypes: &amp;[]*string{jsii.String("AWS::Xxx:Zzz")},
  Priority:             jsii.Number(200),
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tagging-example">2.18.4. Example</h4>
<div class="paragraph">
<p>The following example adds the tag key  <strong>StackType</strong> with value <strong>TheBest</strong> to any resource created within the <code>Stack</code> named <code>MarketingSystem</code>. Then it removes it again from all resources except Amazon EC2 VPC subnets. The result is that only the subnets have the tag applied.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { App, Stack, Tags } from 'aws-cdk-lib';

const app = new App();
const theBestStack = new Stack(app, 'MarketingSystem');

// Add a tag to all constructs in the stack
Tags.of(theBestStack).add('StackType', 'TheBest');

// Remove the tag from all resources except subnet resources
Tags.of(theBestStack).remove('StackType', {
  excludeResourceTypes: ['AWS::EC2::Subnet']
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { App, Stack, Tags } = require('aws-cdk-lib');

const app = new App();
const theBestStack = new Stack(app, 'MarketingSystem');

// Add a tag to all constructs in the stack
Tags.of(theBestStack).add('StackType', 'TheBest');

// Remove the tag from all resources except subnet resources
Tags.of(theBestStack).remove('StackType', {
  excludeResourceTypes: ['AWS::EC2::Subnet']
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import App, Stack, Tags

app = App();
the_best_stack = Stack(app, 'MarketingSystem')

# Add a tag to all constructs in the stack
Tags.of(the_best_stack).add("StackType", "TheBest")

# Remove the tag from all resources except subnet resources
Tags.of(the_best_stack).remove("StackType",
    exclude_resource_types=["AWS::EC2::Subnet"])</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.App;
import software.amazon.awscdk.Tags;

// Add a tag to all constructs in the stack
Tags.of(theBestStack).add("StackType", "TheBest");

// Remove the tag from all resources except subnet resources
Tags.of(theBestStack).remove("StackType", TagProps.builder()
        .excludeResourceTypes(Arrays.asList("AWS::EC2::Subnet"))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;

var app = new App();
var theBestStack = new Stack(app, 'MarketingSystem');

// Add a tag to all constructs in the stack
Tags.Of(theBestStack).Add("StackType", "TheBest");

// Remove the tag from all resources except subnet resources
Tags.Of(theBestStack).Remove("StackType", new TagProps
{
    ExcludeResourceTypes = ["AWS::EC2::Subnet"]
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import "github.com/aws/aws-cdk-go/awscdk/v2"
app := awscdk.NewApp(nil)
theBestStack := awscdk.NewStack(app, jsii.String("MarketingSystem"), &amp;awscdk.StackProps{})

// Add a tag to all constructs in the stack
awscdk.Tags_Of(theBestStack).Add(jsii.String("StackType"), jsii.String("TheBest"), &amp;awscdk.TagProps{})

// Remove the tag from all resources except subnet resources
awscdk.Tags_Of(theBestStack).Add(jsii.String("StackType"), jsii.String("TheBest"), &amp;awscdk.TagProps{
  ExcludeResourceTypes: &amp;[]*string{jsii.String("AWS::EC2::Subnet")},
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code achieves the same result. Consider which approach (inclusion or exclusion) makes your intent clearer.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(theBestStack).add('StackType', 'TheBest',
  { includeResourceTypes: ['AWS::EC2::Subnet']});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Tags.of(theBestStack).add('StackType', 'TheBest',
  { includeResourceTypes: ['AWS::EC2::Subnet']});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Tags.of(the_best_stack).add("StackType", "TheBest",
    include_resource_types=["AWS::EC2::Subnet"])</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tags.of(theBestStack).add("StackType", "TheBest", TagProps.builder()
        .includeResourceTypes(Arrays.asList("AWS::EC2::Subnet"))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Tags.Of(theBestStack).Add("StackType", "TheBest", new TagProps {
    IncludeResourceTypes = ["AWS::EC2::Subnet"]
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Tags_Of(theBestStack).Add(jsii.String("StackType"), jsii.String("TheBest"), &amp;awscdk.TagProps{
  IncludeResourceTypes: &amp;[]*string{jsii.String("AWS::EC2::Subnet")},
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tagging-single">2.18.5. Tagging single constructs</h4>
<div class="paragraph">
<p><code>Tags.of(scope).add(key, value)</code> is the standard way to add tags to constructs in the AWS CDK. Its tree-walking behavior, which recursively tags all taggable resources under the given scope, is almost always what you want. Sometimes, however, you need to tag a specific, arbitrary construct (or constructs).</p>
</div>
<div class="paragraph">
<p>One such case involves applying tags whose value is derived from some property of the construct being tagged. The standard tagging approach recursively applies the same key and value to all matching resources in the scope. However, here the value could be different for each tagged construct.</p>
</div>
<div class="paragraph">
<p>Tags are implemented using <a href="#aspects">aspects</a>, and the CDK calls the tag&#8217;s <code>visit()</code> method for each construct under the scope you specified using <code>Tags.of(scope)</code>. We can call <code>Tag.visit()</code> directly to apply a tag to a single construct.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new cdk.Tag(key, value).visit(scope);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new cdk.Tag(key, value).visit(scope);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">cdk.Tag(key, value).visit(scope)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Tag.Builder.create(key, value).build().visit(scope);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new Tag(key, value).Visit(scope);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.NewTag(key, value, &amp;awscdk.TagProps{}).Visit(scope)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can tag all constructs under a scope but let the values of the tags derive from properties of each construct. To do so, write an aspect and apply the tag in the aspect&#8217;s  <code>visit()</code> method as shown in the preceding example. Then, add the aspect to the desired scope using <code>Aspects.of(scope).add(aspect)</code>.</p>
</div>
<div class="paragraph">
<p>The following example applies a tag to each resource in a stack containing the resource&#8217;s path.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class PathTagger implements cdk.IAspect {
  visit(node: IConstruct) {
    new cdk.Tag("aws-cdk-path", node.node.path).visit(node);
  }
}

stack = new MyStack(app);
cdk.Aspects.of(stack).add(new PathTagger())</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class PathTagger {
  visit(node) {
    new cdk.Tag("aws-cdk-path", node.node.path).visit(node);
  }
}

stack = new MyStack(app);
cdk.Aspects.of(stack).add(new PathTagger())</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@jsii.implements(cdk.IAspect)
class PathTagger:
    def visit(self, node: IConstruct):
        cdk.Tag("aws-cdk-path", node.node.path).visit(node)

stack = MyStack(app)
cdk.Aspects.of(stack).add(PathTagger())</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final class PathTagger implements IAspect {
	public void visit(IConstruct node) {
		Tag.Builder.create("aws-cdk-path", node.getNode().getPath()).build().visit(node);
	}
}

stack stack = new MyStack(app);
Aspects.of(stack).add(new PathTagger());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public class PathTagger : IAspect
{
    public void Visit(IConstruct node)
    {
        new Tag("aws-cdk-path", node.Node.Path).Visit(node);
    }
}

var stack = new MyStack(app);
Aspects.Of(stack).Add(new PathTagger);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The logic of conditional tagging, including priorities, resource types, and so on, is built into the  <code>Tag</code> class. You can use these features when applying tags to arbitrary resources; the tag is not applied if the conditions aren&#8217;t met. Also, the <code>Tag</code> class only tags taggable resources, so you don&#8217;t need to test whether a construct is taggable before applying a tag.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="assets">2.19. Assets and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Assets are local files, directories, or Docker images.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Assets are local files, directories, or Docker images that can be bundled into AWS CDK libraries and apps. For example, an asset might be a directory that contains the handler code for an AWS Lambda function. Assets can represent any artifact that the app needs to operate.</p>
</div>
<div class="paragraph">
<p>The following tutorial video provides a comprehensive overview of CDK assets, and explains how you can use them in your insfrastructure as code (IaC).</p>
</div>
<div class="videoblock text-center">
<div class="content">
<iframe width="480" height="390" src="https://www.youtube.com/embed/jHNtXQmkKfw?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>You add assets through APIs that are exposed by specific AWS constructs. For example, when you define a  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda.Function.html">lambda.Function</a> construct, the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda.Function.html#code">code</a> property lets you pass an <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda.Code.html#static-fromwbrassetpath-options">asset</a> (directory). <code>Function</code> uses assets to bundle the contents of the directory and use it for the function&#8217;s code. Similarly, <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecs.ContainerImage.html#static-fromwbrassetdirectory-props">ecs.ContainerImage.fromAsset</a> uses a Docker image built from a local directory when defining an Amazon ECS task definition.</p>
</div>
<div class="sect3">
<h4 id="assets-details">2.19.1. Assets in detail</h4>
<div class="paragraph">
<p>When you refer to an asset in your app, the  <a href="#deploy-how-synth-assemblies">cloud assembly</a> that&#8217;s synthesized from your application includes metadata information with instructions for the AWS CDK CLI. The instructions include where to find the asset on the local disk and what type of bundling to perform based on the asset type, such as a directory to compress (zip) or a Docker image to build.</p>
</div>
<div class="paragraph">
<p>The AWS CDK generates a source hash for assets. This can be used at construction time to determine whether the contents of an asset have changed.</p>
</div>
<div class="paragraph">
<p>By default, the AWS CDK creates a copy of the asset in the cloud assembly directory, which defaults to <code class="path">cdk.out</code>, under the source hash. This way, the cloud assembly is self-contained, so if it moved over to a different host for deployment, it can still be deployed. See  <a href="#deploy-how-synth-assemblies">Cloud assemblies</a> for details.</p>
</div>
<div class="paragraph">
<p>When the AWS CDK deploys an app that references assets (either directly by the app code or through a library), the AWS CDK CLI first prepares and publishes the assets to an Amazon S3 bucket or Amazon ECR repository. (The S3 bucket or repository is created during bootstrapping.) Only then are the resources defined in the stack deployed.</p>
</div>
<div class="paragraph">
<p>This section describes the low-level APIs available in the framework.</p>
</div>
</div>
<div class="sect3">
<h4 id="assets-types">2.19.2. Asset types</h4>
<div class="paragraph">
<p>The AWS CDK supports the following types of assets:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Amazon S3 assets</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>These are local files and directories that the AWS CDK uploads to Amazon S3.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Docker Image</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>These are Docker images that the AWS CDK uploads to Amazon ECR.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These asset types are explained in the following sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="assets-types-s3">2.19.3. Amazon S3 assets</h4>
<div class="paragraph">
<p>You can define local files and directories as assets, and the AWS CDK packages and uploads them to Amazon S3 through the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_assets-readme.html">aws-s3-assets</a> module.</p>
</div>
<div class="paragraph">
<p>The following example defines a local directory asset and a file asset.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Asset } from 'aws-cdk-lib/aws-s3-assets';

// Archived and uploaded to Amazon S3 as a .zip file
const directoryAsset = new Asset(this, "SampleZippedDirAsset", {
  path: path.join(__dirname, "sample-asset-directory")
});

// Uploaded to Amazon S3 as-is
const fileAsset = new Asset(this, 'SampleSingleFileAsset', {
  path: path.join(__dirname, 'file-asset.txt')
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Asset } = require('aws-cdk-lib/aws-s3-assets');

// Archived and uploaded to Amazon S3 as a .zip file
const directoryAsset = new Asset(this, "SampleZippedDirAsset", {
  path: path.join(__dirname, "sample-asset-directory")
});

// Uploaded to Amazon S3 as-is
const fileAsset = new Asset(this, 'SampleSingleFileAsset', {
  path: path.join(__dirname, 'file-asset.txt')
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import os.path
dirname = os.path.dirname(__file__)

from aws_cdk.aws_s3_assets import Asset

# Archived and uploaded to Amazon S3 as a .zip file
directory_asset = Asset(self, "SampleZippedDirAsset",
  path=os.path.join(dirname, "sample-asset-directory")
)

# Uploaded to Amazon S3 as-is
file_asset = Asset(self, 'SampleSingleFileAsset',
  path=os.path.join(dirname, 'file-asset.txt')
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.File;

import software.amazon.awscdk.services.s3.assets.Asset;

// Directory where app was started
File startDir = new File(System.getProperty("user.dir"));

// Archived and uploaded to Amazon S3 as a .zip file
Asset directoryAsset = Asset.Builder.create(this, "SampleZippedDirAsset")
                .path(new File(startDir, "sample-asset-directory").toString()).build();

// Uploaded to Amazon S3 as-is
Asset fileAsset = Asset.Builder.create(this, "SampleSingleFileAsset")
                .path(new File(startDir, "file-asset.txt").toString()).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using System.IO;
using Amazon.CDK.AWS.S3.Assets;

// Archived and uploaded to Amazon S3 as a .zip file
var directoryAsset = new Asset(this, "SampleZippedDirAsset", new AssetProps
{
    Path = Path.Combine(Directory.GetCurrentDirectory(), "sample-asset-directory")
});

// Uploaded to Amazon S3 as-is
var fileAsset = new Asset(this, "SampleSingleFileAsset", new AssetProps
{
    Path = Path.Combine(Directory.GetCurrentDirectory(), "file-asset.txt")
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

awss3assets.NewAsset(stack, jsii.String("SampleZippedDirAsset"), &amp;awss3assets.AssetProps{
  Path: jsii.String(path.Join(dirName, "sample-asset-directory")),
})

awss3assets.NewAsset(stack, jsii.String("SampleSingleFileAsset"), &amp;awss3assets.AssetProps{
  Path: jsii.String(path.Join(dirName, "file-asset.txt")),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In most cases, you don&#8217;t need to directly use the APIs in the  <code>aws-s3-assets</code> module. Modules that support assets, such as <code>aws-lambda</code>, have convenience methods so that you can use assets. For Lambda functions, the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda.Code.html#static-fromwbrassetpath-options">fromAsset()</a> static method enables you to specify a directory or a .zip file in the local file system.</p>
</div>
<div class="sect4">
<h5 id="assets-types-s3-lambda">Lambda function example</h5>
<div class="paragraph">
<p>A common use case is creating Lambda functions with the handler code as an Amazon S3 asset.</p>
</div>
<div class="paragraph">
<p>The following example uses an Amazon S3 asset to define a Python handler in the local directory <code class="path">handler</code>. It also creates a Lambda function with the local directory asset as the  <code>code</code> property. Following is the Python code for the handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def lambda_handler(event, context):
  message = 'Hello World!'
  return {
    'message': message
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code for the main AWS CDK app should look like the following.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Constructs } from 'constructs';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as path from 'path';

export class HelloAssetStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    new lambda.Function(this, 'myLambdaFunction', {
      code: lambda.Code.fromAsset(path.join(__dirname, 'handler')),
      runtime: lambda.Runtime.PYTHON_3_6,
      handler: 'index.lambda_handler'
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const lambda = require('aws-cdk-lib/aws-lambda');
const path = require('path');

class HelloAssetStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    new lambda.Function(this, 'myLambdaFunction', {
      code: lambda.Code.fromAsset(path.join(__dirname, 'handler')),
      runtime: lambda.Runtime.PYTHON_3_6,
      handler: 'index.lambda_handler'
    });
  }
}

module.exports = { HelloAssetStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import Stack
from constructs import Construct
from aws_cdk import aws_lambda as lambda_

import os.path
dirname = os.path.dirname(__file__)

class HelloAssetStack(Stack):
    def __init__(self, scope: Construct, id: str, **kwargs):
        super().__init__(scope, id, **kwargs)

        lambda_.Function(self, 'myLambdaFunction',
            code=lambda_.Code.from_asset(os.path.join(dirname, 'handler')),
            runtime=lambda_.Runtime.PYTHON_3_6,
            handler="index.lambda_handler")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.File;

import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;

public class HelloAssetStack extends Stack {

    public HelloAssetStack(final App scope, final String id) {
        this(scope, id, null);
    }

    public HelloAssetStack(final App scope, final String id, final StackProps props) {
        super(scope, id, props);

        File startDir = new File(System.getProperty("user.dir"));

        Function.Builder.create(this, "myLambdaFunction")
                .code(Code.fromAsset(new File(startDir, "handler").toString()))
                .runtime(Runtime.PYTHON_3_6)
                .handler("index.lambda_handler").build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.Lambda;
using System.IO;

public class HelloAssetStack : Stack
{
    public HelloAssetStack(Construct scope, string id, StackProps props) : base(scope, id, props)
    {
        new Function(this, "myLambdaFunction", new FunctionProps
        {
            Code = Code.FromAsset(Path.Combine(Directory.GetCurrentDirectory(), "handler")),
            Runtime = Runtime.PYTHON_3_6,
            Handler = "index.lambda_handler"
        });
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "os"
  "path"

  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
  "github.com/aws/aws-cdk-go/awscdk/v2/awss3assets"
  "github.com/aws/constructs-go/constructs/v10"
  "github.com/aws/jsii-runtime-go"
)

func HelloAssetStack(scope constructs.Construct, id string, props *HelloAssetStackProps) awscdk.Stack {
  var sprops awscdk.StackProps
  if props != nil {
    sprops = props.StackProps
  }
  stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

  dirName, err := os.Getwd()
  if err != nil {
    panic(err)
  }

  awslambda.NewFunction(stack, jsii.String("myLambdaFunction"), &amp;awslambda.FunctionProps{
    Code: awslambda.AssetCode_FromAsset(jsii.String(path.Join(dirName, "handler")), &amp;awss3assets.AssetOptions{}),
    Runtime: awslambda.Runtime_PYTHON_3_6(),
    Handler: jsii.String("index.lambda_handler"),
  })

  return stack
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <code>Function</code> method uses assets to bundle the contents of the directory and use it for the function&#8217;s code.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Java <code class="path">.jar</code> files are ZIP files with a different extension. These are uploaded as-is to Amazon S3, but when deployed as a Lambda function, the files they contain are extracted, which you might not want. To avoid this, place the  <code class="path">.jar</code> file in a directory and specify that directory as the asset.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="assets-types-s3-deploy">Deploy-time attributes example</h5>
<div class="paragraph">
<p>Amazon S3 asset types also expose  <a href="#resources-attributes">deploy-time attributes</a> that can be referenced in AWS CDK libraries and apps. The AWS CDK CLI command <strong class="command">cdk synth</strong> displays asset properties as AWS CloudFormation parameters.</p>
</div>
<div class="paragraph">
<p>The following example uses deploy-time attributes to pass the location of an image asset into a Lambda function as environment variables. (The kind of file doesn&#8217;t matter; the PNG image used here is only an example.)</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Asset } from 'aws-cdk-lib/aws-s3-assets';
import * as path from 'path';

const imageAsset = new Asset(this, "SampleAsset", {
  path: path.join(__dirname, "images/my-image.png")
});

new lambda.Function(this, "myLambdaFunction", {
  code: lambda.Code.asset(path.join(__dirname, "handler")),
  runtime: lambda.Runtime.PYTHON_3_6,
  handler: "index.lambda_handler",
  environment: {
    'S3_BUCKET_NAME': imageAsset.s3BucketName,
    'S3_OBJECT_KEY': imageAsset.s3ObjectKey,
    'S3_OBJECT_URL': imageAsset.s3ObjectUrl
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Asset } = require('aws-cdk-lib/aws-s3-assets');
const path = require('path');

const imageAsset = new Asset(this, "SampleAsset", {
  path: path.join(__dirname, "images/my-image.png")
});

new lambda.Function(this, "myLambdaFunction", {
  code: lambda.Code.asset(path.join(__dirname, "handler")),
  runtime: lambda.Runtime.PYTHON_3_6,
  handler: "index.lambda_handler",
  environment: {
    'S3_BUCKET_NAME': imageAsset.s3BucketName,
    'S3_OBJECT_KEY': imageAsset.s3ObjectKey,
    'S3_OBJECT_URL': imageAsset.s3ObjectUrl
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import os.path

import aws_cdk.aws_lambda as lambda_
from aws_cdk.aws_s3_assets import Asset

dirname = os.path.dirname(__file__)

image_asset = Asset(self, "SampleAsset",
    path=os.path.join(dirname, "images/my-image.png"))

lambda_.Function(self, "myLambdaFunction",
    code=lambda_.Code.asset(os.path.join(dirname, "handler")),
    runtime=lambda_.Runtime.PYTHON_3_6,
    handler="index.lambda_handler",
    environment=dict(
        S3_BUCKET_NAME=image_asset.s3_bucket_name,
        S3_OBJECT_KEY=image_asset.s3_object_key,
        S3_OBJECT_URL=image_asset.s3_object_url))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.File;

import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;
import software.amazon.awscdk.services.s3.assets.Asset;

public class FunctionStack extends Stack {
    public FunctionStack(final App scope, final String id, final StackProps props) {
        super(scope, id, props);

        File startDir = new File(System.getProperty("user.dir"));

        Asset imageAsset = Asset.Builder.create(this, "SampleAsset")
                .path(new File(startDir, "images/my-image.png").toString()).build())

        Function.Builder.create(this, "myLambdaFunction")
                .code(Code.fromAsset(new File(startDir, "handler").toString()))
                .runtime(Runtime.PYTHON_3_6)
                .handler("index.lambda_handler")
                .environment(java.util.Map.of(    // Java 9 or later
                    "S3_BUCKET_NAME", imageAsset.getS3BucketName(),
                    "S3_OBJECT_KEY", imageAsset.getS3ObjectKey(),
                    "S3_OBJECT_URL", imageAsset.getS3ObjectUrl()))
                .build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.Lambda;
using Amazon.CDK.AWS.S3.Assets;
using System.IO;
using System.Collections.Generic;

var imageAsset = new Asset(this, "SampleAsset", new AssetProps
{
    Path = Path.Combine(Directory.GetCurrentDirectory(), @"images\my-image.png")
});

new Function(this, "myLambdaFunction", new FunctionProps
{
    Code = Code.FromAsset(Path.Combine(Directory.GetCurrentDirectory(), "handler")),
    Runtime = Runtime.PYTHON_3_6,
    Handler = "index.lambda_handler",
    Environment = new Dictionary&lt;string, string&gt;
    {
        ["S3_BUCKET_NAME"] = imageAsset.S3BucketName,
        ["S3_OBJECT_KEY"] = imageAsset.S3ObjectKey,
        ["S3_OBJECT_URL"] = imageAsset.S3ObjectUrl
    }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "os"
  "path"

  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
  "github.com/aws/aws-cdk-go/awscdk/v2/awss3assets"
)

dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

imageAsset := awss3assets.NewAsset(stack, jsii.String("SampleAsset"), &amp;awss3assets.AssetProps{
  Path: jsii.String(path.Join(dirName, "images/my-image.png")),
})

awslambda.NewFunction(stack, jsii.String("myLambdaFunction"), &amp;awslambda.FunctionProps{
  Code: awslambda.AssetCode_FromAsset(jsii.String(path.Join(dirName, "handler"))),
  Runtime: awslambda.Runtime_PYTHON_3_6(),
  Handler: jsii.String("index.lambda_handler"),
  Environment: &amp;map[string]*string{
    "S3_BUCKET_NAME": imageAsset.S3BucketName(),
    "S3_OBJECT_KEY": imageAsset.S3ObjectKey(),
    "S3_URL": imageAsset.S3ObjectUrl(),
  },
})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assets-types-s3-permissions">Permissions</h5>
<div class="paragraph">
<p>If you use Amazon S3 assets directly through the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_assets-readme.html">aws-s3-assets</a> module, IAM roles, users, or groups, and you need to read assets in runtime, then grant those assets IAM permissions through the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_assets.Asset.html#grantwbrreadgrantee">asset.grantRead</a> method.</p>
</div>
<div class="paragraph">
<p>The following example grants an IAM group read permissions on a file asset.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Asset } from 'aws-cdk-lib/aws-s3-assets';
import * as path from 'path';

const asset = new Asset(this, 'MyFile', {
  path: path.join(__dirname, 'my-image.png')
});

const group = new iam.Group(this, 'MyUserGroup');
asset.grantRead(group);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Asset } = require('aws-cdk-lib/aws-s3-assets');
const path = require('path');

const asset = new Asset(this, 'MyFile', {
  path: path.join(__dirname, 'my-image.png')
});

const group = new iam.Group(this, 'MyUserGroup');
asset.grantRead(group);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk.aws_s3_assets import Asset
import aws_cdk.aws_iam as iam

import os.path
dirname = os.path.dirname(__file__)

        asset = Asset(self, "MyFile",
            path=os.path.join(dirname, "my-image.png"))

        group = iam.Group(self, "MyUserGroup")
        asset.grant_read(group)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.File;

import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.iam.Group;
import software.amazon.awscdk.services.s3.assets.Asset;

public class GrantStack extends Stack {
    public GrantStack(final App scope, final String id, final StackProps props) {
        super(scope, id, props);

        File startDir = new File(System.getProperty("user.dir"));

        Asset asset = Asset.Builder.create(this, "SampleAsset")
                .path(new File(startDir, "images/my-image.png").toString()).build();

        Group group = new Group(this, "MyUserGroup");
        asset.grantRead(group);   }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.IAM;
using Amazon.CDK.AWS.S3.Assets;
using System.IO;

var asset = new Asset(this, "MyFile", new AssetProps {
    Path = Path.Combine(Path.Combine(Directory.GetCurrentDirectory(), @"images\my-image.png"))
});

var group = new Group(this, "MyUserGroup");
asset.GrantRead(group);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "os"
  "path"

  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/aws-cdk-go/awscdk/v2/awsiam"
  "github.com/aws/aws-cdk-go/awscdk/v2/awss3assets"
)

dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

asset := awss3assets.NewAsset(stack, jsii.String("MyFile"), &amp;awss3assets.AssetProps{
  Path: jsii.String(path.Join(dirName, "my-image.png")),
})

group := awsiam.NewGroup(stack, jsii.String("MyUserGroup"), &amp;awsiam.GroupProps{})

asset.GrantRead(group)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assets-types-docker">2.19.4. Docker image assets</h4>
<div class="paragraph">
<p>The AWS CDK supports bundling local Docker images as assets through the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecr_assets-readme.html">aws-ecr-assets</a> module.</p>
</div>
<div class="paragraph">
<p>The following example defines a Docker image that is built locally and pushed to Amazon ECR. Images are built from a local Docker context directory (with a Dockerfile) and uploaded to Amazon ECR by the AWS CDK CLI or your app&#8217;s CI/CD pipeline. The images can be naturally referenced in your AWS CDK app.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { DockerImageAsset } from 'aws-cdk-lib/aws-ecr-assets';

const asset = new DockerImageAsset(this, 'MyBuildImage', {
  directory: path.join(__dirname, 'my-image')
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { DockerImageAsset } = require('aws-cdk-lib/aws-ecr-assets');

const asset = new DockerImageAsset(this, 'MyBuildImage', {
  directory: path.join(__dirname, 'my-image')
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk.aws_ecr_assets import DockerImageAsset

import os.path
dirname = os.path.dirname(__file__)

asset = DockerImageAsset(self, 'MyBuildImage',
    directory=os.path.join(dirname, 'my-image'))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.ecr.assets.DockerImageAsset;

File startDir = new File(System.getProperty("user.dir"));

DockerImageAsset asset = DockerImageAsset.Builder.create(this, "MyBuildImage")
            .directory(new File(startDir, "my-image").toString()).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using System.IO;
using Amazon.CDK.AWS.ECR.Assets;

var asset = new DockerImageAsset(this, "MyBuildImage", new DockerImageAssetProps
{
    Directory = Path.Combine(Directory.GetCurrentDirectory(), "my-image")
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "os"
  "path"

  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/aws-cdk-go/awscdk/v2/awsecrassets"
)

dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

asset := awsecrassets.NewDockerImageAsset(stack, jsii.String("MyBuildImage"), &amp;awsecrassets.DockerImageAssetProps{
  Directory: jsii.String(path.Join(dirName, "my-image")),
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <code class="path">my-image</code> directory must include a Dockerfile. The AWS CDK CLI builds a Docker image from  <code class="path">my-image</code>, pushes it to an Amazon ECR repository, and specifies the name of the repository as an AWS CloudFormation parameter to your stack. Docker image asset types expose  <a href="#resources-attributes">deploy-time attributes</a> that can be referenced in AWS CDK libraries and apps. The AWS CDK CLI command <strong class="command">cdk synth</strong> displays asset properties as AWS CloudFormation parameters.</p>
</div>
<div class="sect4">
<h5 id="assets-types-docker-ecs">Amazon ECS task definition example</h5>
<div class="paragraph">
<p>A common use case is to create an Amazon ECS  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecs.TaskDefinition.html">TaskDefinition</a> to run Docker containers. The following example specifies the location of a Docker image asset that the AWS CDK builds locally and pushes to Amazon ECR.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as ecs from 'aws-cdk-lib/aws-ecs';
import * as ecr_assets from 'aws-cdk-lib/aws-ecr-assets';
import * as path from 'path';

const taskDefinition = new ecs.FargateTaskDefinition(this, "TaskDef", {
  memoryLimitMiB: 1024,
  cpu: 512
});

const asset = new ecr_assets.DockerImageAsset(this, 'MyBuildImage', {
  directory: path.join(__dirname, 'my-image')
});

taskDefinition.addContainer("my-other-container", {
  image: ecs.ContainerImage.fromDockerImageAsset(asset)
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ecs = require('aws-cdk-lib/aws-ecs');
const ecr_assets = require('aws-cdk-lib/aws-ecr-assets');
const path = require('path');

const taskDefinition = new ecs.FargateTaskDefinition(this, "TaskDef", {
  memoryLimitMiB: 1024,
  cpu: 512
});

const asset = new ecr_assets.DockerImageAsset(this, 'MyBuildImage', {
  directory: path.join(__dirname, 'my-image')
});

taskDefinition.addContainer("my-other-container", {
  image: ecs.ContainerImage.fromDockerImageAsset(asset)
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_ecs as ecs
import aws_cdk.aws_ecr_assets as ecr_assets

import os.path
dirname = os.path.dirname(__file__)

task_definition = ecs.FargateTaskDefinition(self, "TaskDef",
    memory_limit_mib=1024,
    cpu=512)

asset = ecr_assets.DockerImageAsset(self, 'MyBuildImage',
    directory=os.path.join(dirname, 'my-image'))

task_definition.add_container("my-other-container",
    image=ecs.ContainerImage.from_docker_image_asset(asset))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.File;

import software.amazon.awscdk.services.ecs.FargateTaskDefinition;
import software.amazon.awscdk.services.ecs.ContainerDefinitionOptions;
import software.amazon.awscdk.services.ecs.ContainerImage;

import software.amazon.awscdk.services.ecr.assets.DockerImageAsset;

File startDir = new File(System.getProperty("user.dir"));

FargateTaskDefinition taskDefinition = FargateTaskDefinition.Builder.create(
        this, "TaskDef").memoryLimitMiB(1024).cpu(512).build();

DockerImageAsset asset = DockerImageAsset.Builder.create(this, "MyBuildImage")
            .directory(new File(startDir, "my-image").toString()).build();

taskDefinition.addContainer("my-other-container",
        ContainerDefinitionOptions.builder()
            .image(ContainerImage.fromDockerImageAsset(asset))
            .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using System.IO;
using Amazon.CDK.AWS.ECS;
using Amazon.CDK.AWS.Ecr.Assets;

var taskDefinition = new FargateTaskDefinition(this, "TaskDef", new FargateTaskDefinitionProps
{
    MemoryLimitMiB = 1024,
    Cpu = 512
});

var asset = new DockerImageAsset(this, "MyBuildImage", new DockerImageAssetProps
{
    Directory = Path.Combine(Directory.GetCurrentDirectory(), "my-image")
});

taskDefinition.AddContainer("my-other-container", new ContainerDefinitionOptions
{
    Image = ContainerImage.FromDockerImageAsset(asset)
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "os"
  "path"

  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/aws-cdk-go/awscdk/v2/awsecrassets"
  "github.com/aws/aws-cdk-go/awscdk/v2/awsecs"
)

dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

taskDefinition := awsecs.NewTaskDefinition(stack, jsii.String("TaskDef"), &amp;awsecs.TaskDefinitionProps{
  MemoryMiB: jsii.String("1024"),
  Cpu: jsii.String("512"),
})

asset := awsecrassets.NewDockerImageAsset(stack, jsii.String("MyBuildImage"), &amp;awsecrassets.DockerImageAssetProps{
  Directory: jsii.String(path.Join(dirName, "my-image")),
})

taskDefinition.AddContainer(jsii.String("MyOtherContainer"), &amp;awsecs.ContainerDefinitionOptions{
  Image: awsecs.ContainerImage_FromDockerImageAsset(asset),
})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assets-types-docker-deploy">Deploy-time attributes example</h5>
<div class="paragraph">
<p>The following example shows how to use the deploy-time attributes  <code>repository</code> and <code>imageUri</code> to create an Amazon ECS task definition with the AWS Fargate launch type. Note that the Amazon ECR repo lookup requires the image&#8217;s tag, not its URI, so we snip it from the end of the asset&#8217;s URI.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as ecs from 'aws-cdk-lib/aws-ecs';
import * as path from 'path';
import { DockerImageAsset } from 'aws-cdk-lib/aws-ecr-assets';

const asset = new DockerImageAsset(this, 'my-image', {
  directory: path.join(__dirname, "..", "demo-image")
});

const taskDefinition = new ecs.FargateTaskDefinition(this, "TaskDef", {
  memoryLimitMiB: 1024,
  cpu: 512
});

taskDefinition.addContainer("my-other-container", {
  image: ecs.ContainerImage.fromEcrRepository(asset.repository, asset.imageUri.split(":").pop())
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ecs = require('aws-cdk-lib/aws-ecs');
const path = require('path');
const { DockerImageAsset } = require('aws-cdk-lib/aws-ecr-assets');

const asset = new DockerImageAsset(this, 'my-image', {
  directory: path.join(__dirname, "..", "demo-image")
});

const taskDefinition = new ecs.FargateTaskDefinition(this, "TaskDef", {
  memoryLimitMiB: 1024,
  cpu: 512
});

taskDefinition.addContainer("my-other-container", {
  image: ecs.ContainerImage.fromEcrRepository(asset.repository, asset.imageUri.split(":").pop())
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_ecs as ecs
from aws_cdk.aws_ecr_assets import DockerImageAsset

import os.path
dirname = os.path.dirname(__file__)

asset = DockerImageAsset(self, 'my-image',
    directory=os.path.join(dirname, "..", "demo-image"))

task_definition = ecs.FargateTaskDefinition(self, "TaskDef",
    memory_limit_mib=1024, cpu=512)

task_definition.add_container("my-other-container",
    image=ecs.ContainerImage.from_ecr_repository(
        asset.repository, asset.image_uri.rpartition(":")[-1]))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import java.io.File;

import software.amazon.awscdk.services.ecr.assets.DockerImageAsset;

import software.amazon.awscdk.services.ecs.FargateTaskDefinition;
import software.amazon.awscdk.services.ecs.ContainerDefinitionOptions;
import software.amazon.awscdk.services.ecs.ContainerImage;

File startDir = new File(System.getProperty("user.dir"));

DockerImageAsset asset = DockerImageAsset.Builder.create(this, "my-image")
            .directory(new File(startDir, "demo-image").toString()).build();

FargateTaskDefinition taskDefinition = FargateTaskDefinition.Builder.create(
        this, "TaskDef").memoryLimitMiB(1024).cpu(512).build();

// extract the tag from the asset's image URI for use in ECR repo lookup
String imageUri = asset.getImageUri();
String imageTag = imageUri.substring(imageUri.lastIndexOf(":") + 1);

taskDefinition.addContainer("my-other-container",
        ContainerDefinitionOptions.builder().image(ContainerImage.fromEcrRepository(
                asset.getRepository(), imageTag)).build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using System.IO;
using Amazon.CDK.AWS.ECS;
using Amazon.CDK.AWS.ECR.Assets;

var asset = new DockerImageAsset(this, "my-image", new DockerImageAssetProps {
    Directory = Path.Combine(Directory.GetCurrentDirectory(), "demo-image")
});

var taskDefinition = new FargateTaskDefinition(this, "TaskDef", new FargateTaskDefinitionProps
{
    MemoryLimitMiB = 1024,
    Cpu = 512
});

taskDefinition.AddContainer("my-other-container", new ContainerDefinitionOptions
{
    Image = ContainerImage.FromEcrRepository(asset.Repository, asset.ImageUri.Split(":").Last())
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
  "os"
  "path"

  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/aws-cdk-go/awscdk/v2/awsecrassets"
  "github.com/aws/aws-cdk-go/awscdk/v2/awsecs"
)

dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

asset := awsecrassets.NewDockerImageAsset(stack, jsii.String("MyImage"), &amp;awsecrassets.DockerImageAssetProps{
  Directory: jsii.String(path.Join(dirName, "demo-image")),
})

taskDefinition := awsecs.NewFargateTaskDefinition(stack, jsii.String("TaskDef"), &amp;awsecs.FargateTaskDefinitionProps{
  MemoryLimitMiB: jsii.Number(1024),
  Cpu: jsii.Number(512),
})

taskDefinition.AddContainer(jsii.String("MyOtherContainer"), &amp;awsecs.ContainerDefinitionOptions{
  Image: awsecs.ContainerImage_FromEcrRepository(asset.Repository(), asset.ImageTag()),
})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assets-types-docker-build">Build arguments example</h5>
<div class="paragraph">
<p>You can provide customized build arguments for the Docker build step through the  <code>buildArgs</code> (Python: <code>build_args</code>) property option when the AWS CDK CLI builds the image during deployment.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const asset = new DockerImageAsset(this, 'MyBuildImage', {
  directory: path.join(__dirname, 'my-image'),
  buildArgs: {
    HTTP_PROXY: 'http://10.20.30.2:1234'
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const asset = new DockerImageAsset(this, 'MyBuildImage', {
  directory: path.join(__dirname, 'my-image'),
  buildArgs: {
    HTTP_PROXY: 'http://10.20.30.2:1234'
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">asset = DockerImageAsset(self, "MyBuildImage",
    directory=os.path.join(dirname, "my-image"),
    build_args=dict(HTTP_PROXY="http://10.20.30.2:1234"))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">DockerImageAsset asset = DockerImageAsset.Builder.create(this, "my-image"),
            .directory(new File(startDir, "my-image").toString())
            .buildArgs(java.util.Map.of(    // Java 9 or later
                "HTTP_PROXY", "http://10.20.30.2:1234"))
            .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var asset = new DockerImageAsset(this, "MyBuildImage", new DockerImageAssetProps {
    Directory = Path.Combine(Directory.GetCurrentDirectory(), "my-image"),
    BuildArgs = new Dictionary&lt;string, string&gt;
    {
        ["HTTP_PROXY"] = "http://10.20.30.2:1234"
    }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">dirName, err := os.Getwd()
if err != nil {
  panic(err)
}

asset := awsecrassets.NewDockerImageAsset(stack, jsii.String("MyBuildImage"), &amp;awsecrassets.DockerImageAssetProps{
  Directory: jsii.String(path.Join(dirName, "my-image")),
  BuildArgs: &amp;map[string]*string{
    "HTTP_PROXY": jsii.String("http://10.20.30.2:1234"),
  },
})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assets-types-docker-permissions">Permissions</h5>
<div class="paragraph">
<p>If you use a module that supports Docker image assets, such as  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecs-readme.html">aws-ecs</a>, the AWS CDK manages permissions for you when you use assets directly or through <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecs.ContainerImage.html#static-fromwbrecrwbrrepositoryrepository-tag">ContainerImage.fromEcrRepository</a> (Python: <code>from_ecr_repository</code>). If you use Docker image assets directly, make sure that the consuming principal has permissions to pull the image.</p>
</div>
<div class="paragraph">
<p>In most cases, you should use <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecr.Repository.html#grantwbrpullgrantee">asset.repository.grantPull</a> method (Python: <code>grant_pull</code>. This modifies the IAM policy of the principal to enable it to pull images from this repository. If the principal that is pulling the image is not in the same account, or if it&#8217;s an AWS service that doesn&#8217;t assume a role in your account (such as AWS CodeBuild), you must grant pull permissions on the resource policy and not on the principal&#8217;s policy. Use the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ecr.Repository.html#addwbrtowbrresourcewbrpolicystatement">asset.repository.addToResourcePolicy</a> method (Python: <code>add_to_resource_policy</code>) to grant the appropriate principal permissions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assets-cfn">2.19.5. AWS CloudFormation resource metadata</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section is relevant only for construct authors. In certain situations, tools need to know that a certain CFN resource is using a local asset. For example, you can use the AWS SAM CLI to invoke Lambda functions locally for debugging purposes. See  <a href="#sam">AWS SAM integration</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable such use cases, external tools consult a set of metadata entries on AWS CloudFormation resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>aws:asset:path</code> – Points to the local path of the asset.</p>
</li>
<li>
<p><code>aws:asset:property</code> – The name of the resource property where the asset is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these two metadata entries, tools can identify that assets are used by a certain resource, and enable advanced local experiences.</p>
</div>
<div class="paragraph">
<p>To add these metadata entries to a resource, use the <code>asset.addResourceMetadata</code> (Python: <code>add_resource_metadata</code>)  method.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="permissions">2.20. Permissions and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Construct Library uses a few common, widely implemented idioms to manage access and permissions. The IAM module provides you with the tools you need to use these idioms.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS Construct Library uses a few common, widely implemented idioms to manage access and permissions. The IAM module provides you with the tools you need to use these idioms.</p>
</div>
<div class="paragraph">
<p>AWS CDK uses AWS CloudFormation to deploy changes. Every deployment involves an actor (either a developer, or an automated system) that starts a AWS CloudFormation deployment. In the course of doing this, the actor will assume one or more IAM Identities (user or roles) and optionally pass a role to AWS CloudFormation.</p>
</div>
<div class="paragraph">
<p>If you use AWS IAM Identity Center to authenticate as a user, then the single sign-on provider supplies short-lived session credentials that authorize you to act as a pre-defined IAM role. To learn how the AWS CDK obtains AWS credentials from IAM Identity Center authentication, see <a href="https://docs.aws.amazon.com/sdkref/latest/guide/understanding-sso.html">Understand IAM Identity Center authentication</a> in the <em>AWS SDKs and Tools Reference Guide</em>.</p>
</div>
<div class="sect3">
<h4 id="permissions-principals">2.20.1. Principals</h4>
<div class="paragraph">
<p>An IAM principal is an authenticated AWS entity representing a user, service, or application that can call AWS APIs. The AWS Construct Library supports specifying principals in several flexible ways to grant them access your AWS resources.</p>
</div>
<div class="paragraph">
<p>In security contexts, the term "principal" refers specifically to authenticated entities such as users. Objects like groups and roles do not <em>represent</em> users (and other authenticated entities) but rather <em>identify</em> them indirectly for the purpose of granting permissions.</p>
</div>
<div class="paragraph">
<p>For example, if you create an IAM group, you can grant the group (and thus its members) write access to an Amazon RDS table. However, the group itself is not a principal because it doesn&#8217;t represent a single entity (also, you cannot log in to a group).</p>
</div>
<div class="paragraph">
<p>In the CDK&#8217;s IAM library, classes that directly or indirectly identify principals implement the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.IPrincipal.html">IPrincipal</a> interface, allowing these objects to be used interchangeably in access policies. However, not all of them are principals in the security sense. These objects include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IAM resources such as <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html">Role</a></code>, <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.User.html">User</a></code>, and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Group.html">Group</a></code></p>
</li>
<li>
<p>Service principals (<code>new iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.ServicePrincipal.html[ServicePrincipal]('service.amazonaws.com')</code>)</p>
</li>
<li>
<p>Federated principals (<code>new iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.FederatedPrincipal.html[FederatedPrincipal]('cognito-identity.amazonaws.com')</code>)</p>
</li>
<li>
<p>Account principals (<code>new iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.AccountPrincipal.html[AccountPrincipal]('0123456789012'))</code></p>
</li>
<li>
<p>Canonical user principals (<code>new iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.CanonicalUserPrincipal.html[CanonicalUserPrincipal]('79a59d[&#8230;&#8203;]7ef2be')</code>)</p>
</li>
<li>
<p>AWS Organizations principals (<code>new iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.OrganizationPrincipal.html[OrganizationPrincipal]('org-id')</code>)</p>
</li>
<li>
<p>Arbitrary ARN principals (<code>new iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.ArnPrincipal.html[ArnPrincipal](res.arn)</code>)</p>
</li>
<li>
<p>An <code>iam.https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.CompositePrincipal.html[CompositePrincipal](principal1, principal2, &#8230;&#8203;)</code> to trust multiple principals</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="permissions-grants">2.20.2. Grants</h4>
<div class="paragraph">
<p>Every construct that represents a resource that can be accessed, such as an Amazon S3 bucket or Amazon DynamoDB table, has methods that grant access to another entity. All such methods have names starting with  <strong>grant</strong>.</p>
</div>
<div class="paragraph">
<p>For example, Amazon S3 buckets have the methods <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#grantwbrreadidentity-objectskeypattern">grantRead</a></code> and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#grantwbrreadwbrwriteidentity-objectskeypattern">grantReadWrite</a></code> (Python: <code>grant_read</code>, <code>grant_read_write</code>) to enable read and read/write access, respectively, from an entity to the bucket. The entity doesn&#8217;t have to know exactly which Amazon S3 IAM permissions are required to perform these operations.</p>
</div>
<div class="paragraph">
<p>The first argument of a <strong>grant</strong> method is always of type <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.IGrantable.html">IGrantable</a>. This interface represents entities that can be granted permissions. That is, it represents resources with roles, such as the IAM objects <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html">Role</a></code>, <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.User.html">User</a></code>, and <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.User.html">Group</a></code>.</p>
</div>
<div class="paragraph">
<p>Other entities can also be granted permissions. For example, later in this topic, we show how to grant a CodeBuild project access to an Amazon S3 bucket. Generally, the associated role is obtained via a <code>role</code> property on the entity being granted access.</p>
</div>
<div class="paragraph">
<p>Resources that use execution roles, such as <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda.Function.html">lambda.Function</a></code>, also implement <code>IGrantable</code>, so you can grant them access directly instead of granting access to their role. For example, if <code>bucket</code> is an Amazon S3 bucket, and <code>function</code> is a Lambda function, the following code grants the function read access to the bucket.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.grantRead(function);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.grantRead(function);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket.grant_read(function)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bucket.grantRead(function);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">bucket.GrantRead(function);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes permissions must be applied while your stack is being deployed. One such case is when you grant an AWS CloudFormation custom resource access to some other resource. The custom resource will be invoked during deployment, so it must have the specified permissions at deployment time.</p>
</div>
<div class="paragraph">
<p>Another case is when a service verifies that the role you pass to it has the right policies applied. (A number of AWS services do this to make sure that you didn&#8217;t forget to set the policies.) In those cases, the deployment might fail if the permissions are applied too late.</p>
</div>
<div class="paragraph">
<p>To force the grant&#8217;s permissions to be applied before another resource is created, you can add a dependency on the grant itself, as shown here. Though the return value of grant methods is commonly discarded, every grant method in fact returns an <code>iam.Grant</code> object.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const grant = bucket.grantRead(lambda);
const custom = new CustomResource(...);
custom.node.addDependency(grant);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const grant = bucket.grantRead(lambda);
const custom = new CustomResource(...);
custom.node.addDependency(grant);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">grant = bucket.grant_read(function)
custom = CustomResource(...)
custom.node.add_dependency(grant)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Grant grant = bucket.grantRead(function);
CustomResource custom = new CustomResource(...);
custom.node.addDependency(grant);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var grant = bucket.GrantRead(function);
var custom = new CustomResource(...);
custom.node.AddDependency(grant);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="permissions-roles">2.20.3. Roles</h4>
<div class="paragraph">
<p>The IAM package contains a  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html">Role</a></code> construct that represents IAM roles. The following code creates a new role, trusting the Amazon EC2 service.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as iam from 'aws-cdk-lib/aws-iam';

const role = new iam.Role(this, 'Role', {
  assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),   // required
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const iam = require('aws-cdk-lib/aws-iam');

const role = new iam.Role(this, 'Role', {
  assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com')   // required
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_iam as iam

role = iam.Role(self, "Role",
          assumed_by=iam.ServicePrincipal("ec2.amazonaws.com")) # required</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.iam.Role;
import software.amazon.awscdk.services.iam.ServicePrincipal;

Role role = Role.Builder.create(this, "Role")
        .assumedBy(new ServicePrincipal("ec2.amazonaws.com")).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.IAM;

var role = new Role(this, "Role", new RoleProps
{
    AssumedBy = new ServicePrincipal("ec2.amazonaws.com"),   // required
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add permissions to a role by calling the role&#8217;s  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html#addwbrtowbrpolicystatement">addToPolicy</a></code> method (Python: <code>add_to_policy</code>), passing in a <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyStatement.html">PolicyStatement</a></code> that defines the rule to be added. The statement is added to the role&#8217;s default policy; if it has none, one is created.</p>
</div>
<div class="paragraph">
<p>The following example adds a <code>Deny</code> policy statement to the role for the actions <code>ec2:SomeAction</code> and <code>s3:AnotherAction</code> on the resources <code>bucket</code> and <code>otherRole</code> (Python: <code>other_role</code>), under the condition that the authorized service is AWS CodeBuild.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">role.addToPolicy(new iam.PolicyStatement({
  effect: iam.Effect.DENY,
  resources: [bucket.bucketArn, otherRole.roleArn],
  actions: ['ec2:SomeAction', 's3:AnotherAction'],
  conditions: {StringEquals: {
    'ec2:AuthorizedService': 'codebuild.amazonaws.com',
}}}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">role.addToPolicy(new iam.PolicyStatement({
  effect: iam.Effect.DENY,
  resources: [bucket.bucketArn, otherRole.roleArn],
  actions: ['ec2:SomeAction', 's3:AnotherAction'],
  conditions: {StringEquals: {
    'ec2:AuthorizedService': 'codebuild.amazonaws.com'
}}}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">role.add_to_policy(iam.PolicyStatement(
    effect=iam.Effect.DENY,
    resources=[bucket.bucket_arn, other_role.role_arn],
    actions=["ec2:SomeAction", "s3:AnotherAction"],
    conditions={"StringEquals": {
        "ec2:AuthorizedService": "codebuild.amazonaws.com"}}
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">role.addToPolicy(PolicyStatement.Builder.create()
        .effect(Effect.DENY)
        .resources(Arrays.asList(bucket.getBucketArn(), otherRole.getRoleArn()))
        .actions(Arrays.asList("ec2:SomeAction", "s3:AnotherAction"))
        .conditions(java.util.Map.of(    // Map.of requires Java 9 or later
            "StringEquals", java.util.Map.of(
                "ec2:AuthorizedService", "codebuild.amazonaws.com")))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">role.AddToPolicy(new PolicyStatement(new PolicyStatementProps
{
    Effect = Effect.DENY,
    Resources = new string[] { bucket.BucketArn, otherRole.RoleArn },
    Actions = new string[] { "ec2:SomeAction", "s3:AnotherAction" },
    Conditions = new Dictionary&lt;string, object&gt;
    {
        ["StringEquals"] = new Dictionary&lt;string, string&gt;
        {
            ["ec2:AuthorizedService"] = "codebuild.amazonaws.com"
        }
    }
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, we&#8217;ve created a new  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyStatement.html">PolicyStatement</a></code> inline with the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html#addwbrtowbrpolicystatement">addToPolicy</a></code> (Python: <code>add_to_policy</code>) call. You can also pass in an existing policy statement or one you&#8217;ve modified. The <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyStatement.html">PolicyStatement</a> object has <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyStatement.html#methods">numerous methods</a> for adding principals, resources, conditions, and actions.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re using a construct that requires a role to function correctly, you can do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass in an existing role when instantiating the construct object.</p>
</li>
<li>
<p>Let the construct create a new role for you, trusting the appropriate service principal. The following example uses such a construct: a CodeBuild project.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>import * as codebuild from 'aws-cdk-lib/aws-codebuild';

// imagine roleOrUndefined is a function that might return a Role object
// under some conditions, and undefined under other conditions
const someRole: iam.IRole | undefined = roleOrUndefined();

const project = new codebuild.Project(this, 'Project', {
  // if someRole is undefined, the Project creates a new default role,
  // trusting the codebuild.amazonaws.com service principal
  role: someRole,
});</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const codebuild = require('aws-cdk-lib/aws-codebuild');

// imagine roleOrUndefined is a function that might return a Role object
// under some conditions, and undefined under other conditions
const someRole = roleOrUndefined();

const project = new codebuild.Project(this, 'Project', {
  // if someRole is undefined, the Project creates a new default role,
  // trusting the codebuild.amazonaws.com service principal
  role: someRole
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_codebuild as codebuild

# imagine role_or_none is a function that might return a Role object
# under some conditions, and None under other conditions
some_role = role_or_none();

project = codebuild.Project(self, "Project",
# if role is None, the Project creates a new default role,
# trusting the codebuild.amazonaws.com service principal
role=some_role)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.iam.Role;
import software.amazon.awscdk.services.codebuild.Project;

// imagine roleOrNull is a function that might return a Role object
// under some conditions, and null under other conditions
Role someRole = roleOrNull();

// if someRole is null, the Project creates a new default role,
// trusting the codebuild.amazonaws.com service principal
Project project = Project.Builder.create(this, "Project")
        .role(someRole).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.CodeBuild;

// imagine roleOrNull is a function that might return a Role object
// under some conditions, and null under other conditions
var someRole = roleOrNull();

// if someRole is null, the Project creates a new default role,
// trusting the codebuild.amazonaws.com service principal
var project = new Project(this, "Project", new ProjectProps
{
    Role = someRole
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the object is created, the role (whether the role passed in or the default one created by the construct) is available as the property  <code>role</code>. However, this property is not available on external resources. Therefore, these constructs have an <code>addToRolePolicy</code> (Python: <code>add_to_role_policy</code>) method.</p>
</div>
<div class="paragraph">
<p>The method does nothing if the construct is an external resource, and it calls the <code>addToPolicy</code> (Python: <code>add_to_policy</code>) method of the <code>role</code> property otherwise. This saves you the trouble of handling the undefined case explicitly.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// project is imported into the CDK application
const project = codebuild.Project.fromProjectName(this, 'Project', 'ProjectName');

// project is imported, so project.role is undefined, and this call has no effect
project.addToRolePolicy(new iam.PolicyStatement({
  effect: iam.Effect.ALLOW,   // ... and so on defining the policy
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// project is imported into the CDK application
const project = codebuild.Project.fromProjectName(this, 'Project', 'ProjectName');

// project is imported, so project.role is undefined, and this call has no effect
project.addToRolePolicy(new iam.PolicyStatement({
  effect: iam.Effect.ALLOW   // ... and so on defining the policy
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># project is imported into the CDK application
project = codebuild.Project.from_project_name(self, 'Project', 'ProjectName')

# project is imported, so project.role is undefined, and this call has no effect
project.add_to_role_policy(iam.PolicyStatement(
  effect=iam.Effect.ALLOW,   # ... and so on defining the policy
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// project is imported into the CDK application
Project project = Project.fromProjectName(this, "Project", "ProjectName");

// project is imported, so project.getRole() is null, and this call has no effect
project.addToRolePolicy(PolicyStatement.Builder.create()
        .effect(Effect.ALLOW)   // .. and so on defining the policy
        .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// project is imported into the CDK application
var project = Project.FromProjectName(this, "Project", "ProjectName");

// project is imported, so project.role is null, and this call has no effect
project.AddToRolePolicy(new PolicyStatement(new PolicyStatementProps
{
    Effect = Effect.ALLOW, // ... and so on defining the policy
}));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="permissions-resource-policies">2.20.4. Resource policies</h4>
<div class="paragraph">
<p>A few resources in AWS, such as Amazon S3 buckets and IAM roles, also have a resource policy. These constructs have an  <code>addToResourcePolicy</code> method (Python: <code>add_to_resource_policy</code>), which takes a <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.PolicyStatement.html">PolicyStatement</a></code> as its argument. Every policy statement added to a resource policy must specify at least one principal.</p>
</div>
<div class="paragraph">
<p>In the following example, the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html" class="bare">https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html</a><code class="Amazon S3 bucket">bucket</code> grants a role with the <code>s3:SomeAction</code> permission to itself.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.addToResourcePolicy(new iam.PolicyStatement({
  effect: iam.Effect.ALLOW,
  actions: ['s3:SomeAction'],
  resources: [bucket.bucketArn],
  principals: [role]
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.addToResourcePolicy(new iam.PolicyStatement({
  effect: iam.Effect.ALLOW,
  actions: ['s3:SomeAction'],
  resources: [bucket.bucketArn],
  principals: [role]
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket.add_to_resource_policy(iam.PolicyStatement(
    effect=iam.Effect.ALLOW,
    actions=["s3:SomeAction"],
    resources=[bucket.bucket_arn],
    principals=role))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bucket.addToResourcePolicy(PolicyStatement.Builder.create()
        .effect(Effect.ALLOW)
        .actions(Arrays.asList("s3:SomeAction"))
        .resources(Arrays.asList(bucket.getBucketArn()))
        .principals(Arrays.asList(role))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">bucket.AddToResourcePolicy(new PolicyStatement(new PolicyStatementProps
{
    Effect = Effect.ALLOW,
    Actions = new string[] { "s3:SomeAction" },
    Resources = new string[] { bucket.BucketArn },
    Principals = new IPrincipal[] { role }
}));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="permissions-existing">2.20.5. Using external IAM objects</h4>
<div class="paragraph">
<p>If you have defined an IAM user, principal, group, or role outside your AWS CDK app, you can use that IAM object in your AWS CDK app. To do so, create a reference to it using its ARN or its name. (Use the name for users, groups, and roles.) The returned reference can then be used to grant permissions or to construct policy statements as explained previously.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For users, call <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.User.html#static-fromwbruserwbrarnscope-id-userarn">User.fromUserArn()</a></code> or <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.User.html#static-fromwbruserwbrnamescope-id-username">User.fromUserName()</a></code>. <code>User.fromUserAttributes()</code> is also available, but currently provides the same functionality as <code>User.fromUserArn()</code>.</p>
</li>
<li>
<p>For principals, instantiate an <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.ArnPrincipal.html">ArnPrincipal</a></code> object.</p>
</li>
<li>
<p>For groups, call <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Group.html#static-fromwbrgroupwbrarnscope-id-grouparn">Group.fromGroupArn()</a></code> or <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Group.html#static-fromwbrgroupwbrnamescope-id-groupname">Group.fromGroupName()</a></code>.</p>
</li>
<li>
<p>For roles, call <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html#static-fromwbrrolewbrarnscope-id-rolearn-options">Role.fromRoleArn()</a></code> or <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Role.html#static-fromwbrrolewbrnamescope-id-rolename">Role.fromRoleName()</a></code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Policies (including managed policies) can be used in similar fashion using the following methods. You can use references to these objects anywhere an IAM policy is required.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.Policy.html#static-fromwbrpolicywbrnamescope-id-policyname">Policy.fromPolicyName</a></code></p>
</li>
<li>
<p><code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.ManagedPolicy.html#static-fromwbrmanagedwbrpolicywbrarnscope-id-managedpolicyarn">ManagedPolicy.fromManagedPolicyArn</a></code></p>
</li>
<li>
<p><code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.ManagedPolicy.html#static-fromwbrmanagedwbrpolicywbrnamescope-id-managedpolicyname">ManagedPolicy.fromManagedPolicyName</a></code></p>
</li>
<li>
<p><code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_iam.ManagedPolicy.html#static-fromwbrawswbrmanagedwbrpolicywbrnamemanagedpolicyname">ManagedPolicy.fromAwsManagedPolicyName</a></code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As with all references to external AWS resources, you cannot modify external IAM objects in your CDK app.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="context">2.21. Context values and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Context values are key-value pairs that can be associated with an app, stack, or construct. They may be supplied to your app from a file (usually either <code class="path">cdk.json</code> or  <code class="path">cdk.context.json</code> in your project directory) or on the command line.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Context values are key-value pairs that can be associated with an app, stack, or construct. They may be supplied to your app from a file (usually either  <code class="path">cdk.json</code> or  <code class="path">cdk.context.json</code> in your project directory) or on the command line.</p>
</div>
<div class="paragraph">
<p>The CDK Toolkit uses context to cache values retrieved from your AWS account during synthesis. Values include the Availability Zones in your account or the Amazon Machine Image (AMI) IDs currently available for Amazon EC2 instances. Because these values are provided by your AWS account, they can change between runs of your CDK application. This makes them a potential source of unintended change. The CDK Toolkit&#8217;s caching behavior "freezes" these values for your CDK app until you decide to accept the new values.</p>
</div>
<div class="paragraph">
<p>Imagine the following scenario without context caching. Let&#8217;s say you specified "latest Amazon Linux" as the AMI for your Amazon EC2 instances, and a new version of this AMI was released. Then, the next time you deployed your CDK stack, your already-deployed instances would be using the outdated ("wrong") AMI and would need to be upgraded. Upgrading would result in replacing all your existing instances with new ones, which would probably be unexpected and undesired.</p>
</div>
<div class="paragraph">
<p>Instead, the CDK records your account&#8217;s available AMIs in your project&#8217;s <code class="path">cdk.context.json</code> file, and uses the stored value for future synthesis operations. This way, the list of AMIs is no longer a potential source of change. You can also be sure that your stacks will always synthesize to the same AWS CloudFormation templates.</p>
</div>
<div class="paragraph">
<p>Not all context values are cached values from your AWS environment. <a href="#featureflags">AWS CDK feature flags</a> are also context values. You can also create your own context values for use by your apps or constructs.</p>
</div>
<div class="paragraph">
<p>Context keys are strings. Values may be any type supported by JSON: numbers, strings, arrays, or objects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your constructs create their own context values, incorporate your library&#8217;s package name in its keys so they won&#8217;t conflict with other packages' context values.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many context values are associated with a particular AWS environment, and a given CDK app can be deployed in more than one environment. The key for such values includes the AWS account and Region so that values from different environments do not conflict.</p>
</div>
<div class="paragraph">
<p>The following context key illustrates the format used by the AWS CDK, including the account and Region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>availability-zones:account=123456789012:region=eu-central-1</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cached context values are managed by the AWS CDK and its constructs, including constructs you may write. Do not add or change cached context values by manually editing files. It can be useful, however, to review  <code>cdk.context.json</code> occasionally to see what values are being cached. Context values that don&#8217;t represent cached values should be stored under the <code>context</code> key of <code class="path">cdk.json</code>. This way, they won&#8217;t be cleared when cached values are cleared.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="context-construct">2.21.1. Sources of context values</h4>
<div class="paragraph">
<p>Context values can be provided to your AWS CDK app in six different ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatically from the current AWS account.</p>
</li>
<li>
<p>Through the <strong class="command">--context</strong> option to the <strong class="command">cdk</strong> command. (These values are always strings.)</p>
</li>
<li>
<p>In the project&#8217;s <code class="path">cdk.context.json</code> file.</p>
</li>
<li>
<p>In the <code>context</code> key of the project&#8217;s <code class="path">cdk.json</code> file.</p>
</li>
<li>
<p>In the <code>context</code> key of your <code class="path">~/.cdk.json</code> file.</p>
</li>
<li>
<p>In your AWS CDK app using the <code>construct.node.setContext()</code> method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The project file  <code class="path">cdk.context.json</code> is where the AWS CDK caches context values retrieved from your AWS account. This practice avoids unexpected changes to your deployments when, for example, a new Availability Zone is introduced. The AWS CDK does not write context data to any of the other files listed.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because they&#8217;re part of your application&#8217;s state, <code class="path">cdk.json</code> and  <code class="path">cdk.context.json</code> must be committed to source control along with the rest of your app&#8217;s source code. Otherwise, deployments in other environments (for example, a CI pipeline) might produce inconsistent results.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Context values are scoped to the construct that created them; they are visible to child constructs, but not to parents or siblings. Context values that are set by the AWS CDK Toolkit (the  <strong class="command">cdk</strong> command) can be set automatically, from a file, or from the <strong class="command">--context</strong> option. Context values from these sources are implicitly set on the <code>App</code> construct. Therefore, they&#8217;re visible to every construct in every stack in the app.</p>
</div>
<div class="paragraph">
<p>Your app can read a context value using the <code>construct.node.tryGetContext</code> method. If the requested entry isn&#8217;t found on the current construct or any of its parents, the result is <code>undefined</code>. (Alternatively, the result could be your language&#8217;s equivalent, such as <code>None</code> in Python.)</p>
</div>
</div>
<div class="sect3">
<h4 id="context-methods">2.21.2. Context methods</h4>
<div class="paragraph">
<p>The AWS CDK supports several context methods that enable AWS CDK apps to obtain contextual information from the AWS environment. For example, you can get a list of Availability Zones that are available in a given AWS account and Region, using the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#availabilityzones">stack.availabilityZones</a> method.</p>
</div>
<div class="paragraph">
<p>The following are the context methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_route53.HostedZone.html#static-fromwbrlookupscope-id-query">HostedZone.fromLookup</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Gets the hosted zones in your account.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#availabilityzones">stack.availabilityZones</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Gets the supported Availability Zones.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ssm.StringParameter.html#static-valuewbrfromwbrlookupscope-parametername">StringParameter.valueFromLookup</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Gets a value from the current Region&#8217;s Amazon EC2 Systems Manager Parameter Store.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Vpc.html#static-fromwbrlookupscope-id-options">Vpc.fromLookup</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Gets the existing Amazon Virtual Private Clouds in your accounts.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.LookupMachineImage.html">LookupMachineImage</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Looks up a machine image for use with a NAT instance in an Amazon Virtual Private Cloud.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a required context value isn&#8217;t available, the AWS CDK app notifies the CDK Toolkit that the context information is missing. Next, the CLI queries the current AWS account for the information and stores the resulting context information in the  <code class="path">cdk.context.json</code> file. Then, it executes the AWS CDK app again with the context values.</p>
</div>
</div>
<div class="sect3">
<h4 id="context-viewing">2.21.3. Viewing and managing context</h4>
<div class="paragraph">
<p>Use the  <strong class="command">cdk context</strong> command to view and manage the information in your <code class="path">cdk.context.json</code> file. To see this information, use the  <strong class="command">cdk context</strong> command without any options. The output should be something like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Context found in cdk.json:

┌───┬─────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────┐
│ # │ Key                                                         │ Value                                                   │
├───┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────┤
│ 1 │ availability-zones:account=123456789012:region=eu-central-1 │ [ "eu-central-1a", "eu-central-1b", "eu-central-1c" ]   │
├───┼─────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────┤
│ 2 │ availability-zones:account=123456789012:region=eu-west-1    │ [ "eu-west-1a", "eu-west-1b", "eu-west-1c" ]            │
└───┴─────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────────────┘

Runto remove a context key. If it is a cached value, it will be refreshed on the next.</pre>
</div>
</div>
<div class="paragraph">
<p>To remove a context value, run  <strong class="command">cdk context --reset</strong>, specifying the value&#8217;s corresponding key or number. The following example removes the value that corresponds to the second key in the preceding example. This value represents the list of Availability Zones in the Europe (Ireland) Region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk context --reset 2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Context value
availability-zones:account=123456789012:region=eu-west-1
reset. It will be refreshed on the next SDK synthesis run.</pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, if you want to update to the latest version of the Amazon Linux AMI, use the preceding example to do a controlled update of the context value and reset it. Then, synthesize and deploy your app again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth</code></pre>
</div>
</div>
<div class="paragraph">
<p>To clear all of the stored context values for your app, run  <strong class="command">cdk context --clear</strong>, as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk context --clear</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only context values stored in  <code class="path">cdk.context.json</code> can be reset or cleared. The AWS CDK does not touch other context values. Therefore, to protect a context value from being reset using these commands, you might copy the value to  <code class="path">cdk.json</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="context-cli">2.21.4. AWS CDK Toolkit  <code>--context</code> flag</h4>
<div class="paragraph">
<p>Use the  <code>--context</code> (<code>-c</code> for short) option to pass runtime context values to your CDK app during synthesis or deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth --context key=value MyStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify multiple context values, repeat the  <strong class="command">--context</strong> option any number of times, providing one key-value pair each time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth --context key1=value1 --context key2=value2 MyStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>When synthesizing multiple stacks, the specified context values are passed to all stacks. To provide different context values to individual stacks, either use different keys for the values, or use multiple  <strong class="command">cdk synth</strong> or <strong class="command">cdk deploy</strong> commands.</p>
</div>
<div class="paragraph">
<p>Context values passed from the command line are always strings. If a value is usually of some other type, your code must be prepared to convert or parse the value. You might have non-string context values provided in other ways (for example, in <code class="path">cdk.context.json</code>). To make sure this kind of value works as expected, confirm that the value is a string before converting it.</p>
</div>
</div>
<div class="sect3">
<h4 id="context-example">2.21.5. Example</h4>
<div class="paragraph">
<p>Following is an example of using an existing Amazon VPC using AWS CDK context.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import * as ec2 from 'aws-cdk-lib/aws-ec2';
import { Construct } from 'constructs';

export class ExistsVpcStack extends cdk.Stack {

  constructor(scope: Construct, id: string, props?: cdk.StackProps) {

    super(scope, id, props);

    const vpcid = this.node.tryGetContext('vpcid');
    const vpc = ec2.Vpc.fromLookup(this, 'VPC', {
      vpcId: vpcid,
    });

    const pubsubnets = vpc.selectSubnets({subnetType: ec2.SubnetType.PUBLIC});

    new cdk.CfnOutput(this, 'publicsubnets', {
      value: pubsubnets.subnetIds.toString(),
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const ec2 = require('aws-cdk-lib/aws-ec2');

class ExistsVpcStack extends cdk.Stack {

  constructor(scope, id, props) {

    super(scope, id, props);

    const vpcid = this.node.tryGetContext('vpcid');
    const vpc = ec2.Vpc.fromLookup(this, 'VPC', {
      vpcId: vpcid
    });

    const pubsubnets = vpc.selectSubnets({subnetType: ec2.SubnetType.PUBLIC});

    new cdk.CfnOutput(this, 'publicsubnets', {
      value: pubsubnets.subnetIds.toString()
    });
  }
}

module.exports = { ExistsVpcStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
import aws_cdk.aws_ec2 as ec2
from constructs import Construct

class ExistsVpcStack(cdk.Stack):

    def __init__(scope: Construct, id: str, **kwargs):

        super().__init__(scope, id, **kwargs)

        vpcid = self.node.try_get_context("vpcid")
        vpc = ec2.Vpc.from_lookup(self, "VPC", vpc_id=vpcid)

        pubsubnets = vpc.select_subnets(subnetType=ec2.SubnetType.PUBLIC)

        cdk.CfnOutput(self, "publicsubnets",
            value=pubsubnets.subnet_ids.to_string())</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.CfnOutput;

import software.amazon.awscdk.services.ec2.Vpc;
import software.amazon.awscdk.services.ec2.VpcLookupOptions;
import software.amazon.awscdk.services.ec2.SelectedSubnets;
import software.amazon.awscdk.services.ec2.SubnetSelection;
import software.amazon.awscdk.services.ec2.SubnetType;
import software.constructs.Construct;

public class ExistsVpcStack extends Stack {
    public ExistsVpcStack(Construct context, String id) {
        this(context, id, null);
    }

    public ExistsVpcStack(Construct context, String id, StackProps props) {
        super(context, id, props);

        String vpcId = (String)this.getNode().tryGetContext("vpcid");
        Vpc vpc = (Vpc)Vpc.fromLookup(this, "VPC", VpcLookupOptions.builder()
                .vpcId(vpcId).build());

        SelectedSubnets pubSubNets = vpc.selectSubnets(SubnetSelection.builder()
                .subnetType(SubnetType.PUBLIC).build());

        CfnOutput.Builder.create(this, "publicsubnets")
                .value(pubSubNets.getSubnetIds().toString()).build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.EC2;
using Constructs;

class ExistsVpcStack : Stack
{
    public ExistsVpcStack(Construct scope, string id, StackProps props) : base(scope, id, props)
    {
        var vpcId = (string)this.Node.TryGetContext("vpcid");
        var vpc = Vpc.FromLookup(this, "VPC", new VpcLookupOptions
        {
            VpcId = vpcId
        });

        SelectedSubnets pubSubNets = vpc.SelectSubnets([new SubnetSelection
        {
            SubnetType = SubnetType.PUBLIC
        }]);

        new CfnOutput(this, "publicsubnets", new CfnOutputProps {
            Value = pubSubNets.SubnetIds.ToString()
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use  <strong class="command">cdk diff</strong> to see the effects of passing in a context value on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk diff -c vpcid=vpc-0cb9c31031d0d3e22</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Stack ExistsvpcStack
Outputs
[+] Output publicsubnets publicsubnets: {"Value":"subnet-06e0ea7dd302d3e8f,subnet-01fc0acfb58f3128f"}</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting context values can be viewed as shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk context -j</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "vpc-provider:account=123456789012:filter.vpc-id=vpc-0cb9c31031d0d3e22:region=us-east-1": {
    "vpcId": "vpc-0cb9c31031d0d3e22",
    "availabilityZones": [
      "us-east-1a",
      "us-east-1b"
    ],
    "privateSubnetIds": [
      "subnet-03ecfc033225be285",
      "subnet-0cded5da53180ebfa"
    ],
    "privateSubnetNames": [
      "Private"
    ],
    "privateSubnetRouteTableIds": [
      "rtb-0e955393ced0ada04",
      "rtb-05602e7b9f310e5b0"
    ],
    "publicSubnetIds": [
      "subnet-06e0ea7dd302d3e8f",
      "subnet-01fc0acfb58f3128f"
    ],
    "publicSubnetNames": [
      "Public"
    ],
    "publicSubnetRouteTableIds": [
      "rtb-00d1fdfd823c82289",
      "rtb-04bb1969b42969bcb"
    ]
  }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="featureflags">2.22. AWS CDK feature flags</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS CDK uses <em>feature flags</em> to enable potentially breaking behaviors in a release. Flags are stored as <a href="#context">Context values and the AWS CDK</a> values in <code class="path">cdk.json</code> (or  <code class="path">~/.cdk.json</code>). They are not removed by the  <strong class="command">cdk context --reset</strong> or <strong class="command">cdk context --clear</strong> commands.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS CDK uses  <em>feature flags</em> to enable potentially breaking behaviors in a release. Flags are stored as <a href="#context">Context values and the AWS CDK</a> values in <code class="path">cdk.json</code> (or  <code class="path">~/.cdk.json</code>). They are not removed by the  <strong class="command">cdk context --reset</strong> or <strong class="command">cdk context --clear</strong> commands.</p>
</div>
<div class="paragraph">
<p>Feature flags are disabled by default. Existing projects that do not specify the flag will continue to work as before with later AWS CDK releases. New projects created using <strong class="command">cdk init</strong> include flags enabling all features available in the release that created the project. Edit <code class="path">cdk.json</code> to disable any flags for which you prefer the earlier behavior. You can also add flags to enable new behaviors after upgrading the AWS CDK.</p>
</div>
<div class="paragraph">
<p>A list of all current feature flags can be found on the AWS CDK GitHub repository in <a href="https://github.com/aws/aws-cdk/blob/main/packages/aws-cdk-lib/cx-api/FEATURE_FLAGS.md">FEATURE_FLAGS.md</a>. See the <code class="path">CHANGELOG</code> in a given release for a description of any new feature flags added in that release.</p>
</div>
<div class="sect3">
<h4 id="featureflags-disabling">2.22.1. Reverting to v1 behavior</h4>
<div class="paragraph">
<p>In CDK v2, the defaults for some feature flags have been changed with respect to v1. You can set these back to  <code>false</code> to revert to specific AWS CDK v1 behavior. Use the <code>cdk diff</code> command to inspect the changes to your synthesized template to see if any of these flags are needed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@aws-cdk/core:newStyleStackSynthesis</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the new stack synthesis method, which assumes bootstrap resources with well-known names. Requires <a href="#bootstrapping">modern bootstrapping</a>, but in turn allows CI/CD via <a href="#cdk-pipeline">CDK Pipelines</a> and cross-account deployments out of the box.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>@aws-cdk/aws-apigateway:usagePlanKeyOrderInsensitiveId</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If your application uses multiple Amazon API Gateway API keys and associates them to usage plans.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>@aws-cdk/aws-rds:lowercaseDbIdentifier</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If your application uses Amazon RDS database instance or database clusters, and explicitly specifies the identifier for these.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>@aws-cdk/aws-cloudfront:defaultSecurityPolicyTLSv1.2_2021</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If your application uses the TLS_V1_2_2019 security policy with Amazon CloudFront distributions. CDK v2 uses security policy TLSv1.2_2021 by default.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>@aws-cdk/core:stackRelativeExports</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If your application uses multiple stacks and you refer to resources from one stack in another, this determines whether absolute or relative path is used to construct AWS CloudFormation exports.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>@aws-cdk/aws-lambda:recognizeVersionProps</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If set to <code>false</code>, the CDK includes metadata when detecting whether a Lambda function has changed. This can cause deployment failures when only the metadata has changed, since duplicate versions are not allowed. There is no need to revert this flag if you&#8217;ve made at least one change to all Lambda Functions in your application.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The syntax for reverting these flags in  <code class="path">cdk.json</code> is shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "context": {
    "@aws-cdk/core:newStyleStackSynthesis": false,
    "@aws-cdk/aws-apigateway:usagePlanKeyOrderInsensitiveId": false,
    "@aws-cdk/aws-cloudfront:defaultSecurityPolicyTLSv1.2_2021": false,
    "@aws-cdk/aws-rds:lowercaseDbIdentifier": false,
    "@aws-cdk/core:stackRelativeExports": false,
    "@aws-cdk/aws-lambda:recognizeVersionProps": false
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="aspects">2.23. Aspects and the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Aspects are a way to apply an operation to all constructs in a given scope. The aspect could modify the constructs, such as by adding tags. Or it could verify something about the state of the constructs, such as making sure that all buckets are encrypted.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Aspects are a way to apply an operation to all constructs in a given scope. The aspect could modify the constructs, such as by adding tags. Or it could verify something about the state of the constructs, such as making sure that all buckets are encrypted.</p>
</div>
<div class="paragraph">
<p>To apply an aspect to a construct and all constructs in the same scope, call <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Aspects.html#static-ofscope" class="bare">https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Aspects.html#static-ofscope</a><code class="Aspects">.of([replaceable]</code>SCOPE<code>).add()</code> with a new aspect, as shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Aspects.of(myConstruct).add(new SomeAspect(...));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Aspects.of(myConstruct).add(new SomeAspect(...));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">Aspects.of(my_construct).add(SomeAspect(...))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Aspects.of(myConstruct).add(new SomeAspect(...));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Aspects.Of(myConstruct).add(new SomeAspect(...));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">awscdk.Aspects_Of(stack).Add(awscdk.NewTag(...))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CDK uses aspects to  <a href="#tagging">tag resources</a>, but the framework can also be used for other purposes. For example, you can use it to validate or change the AWS CloudFormation resources that are defined for you by higher-level constructs.</p>
</div>
<div class="sect3">
<h4 id="aspects-detail">2.23.1. Aspects in detail</h4>
<div class="paragraph">
<p>Aspects employ the  <a href="https://en.wikipedia.org/wiki/Visitor_pattern">visitor pattern</a>. An aspect is a class that implements the following interface.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">interface IAspect {
   visit(node: IConstruct): void;}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>JavaScript doesn&#8217;t have interfaces as a language feature. Therefore, an aspect is simply an instance of a class having a <code>visit</code> method that accepts the node to be operated on.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Python doesn&#8217;t have interfaces as a language feature. Therefore, an aspect is simply an instance of a class having a <code>visit</code> method that accepts the node to be operated on.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface IAspect {
    public void visit(Construct node);
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">public interface IAspect
{
    void Visit(IConstruct node);
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">type IAspect interface {
  Visit(node constructs.IConstruct)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you call  <code>Aspects.of([replaceable]</code>SCOPE<code>).add(&#8230;&#8203;)</code>, the construct adds the aspect to an internal list of aspects. You can obtain the list with <code>Aspects.of([replaceable]</code>SCOPE<code>)</code>.</p>
</div>
<div class="paragraph">
<p>During the <a href="#deploy-how-synth-app">prepare phase</a>, the AWS CDK calls the <code>visit</code> method of the object for the construct and each of its children in top-down order.</p>
</div>
<div class="paragraph">
<p>The <code>visit</code> method is free to change anything in the construct. In strongly typed languages, cast the received construct to a more specific type before accessing construct-specific properties or methods.</p>
</div>
<div class="paragraph">
<p>Aspects don&#8217;t propagate across <code>Stage</code> construct boundaries, because <code>Stages</code> are self-contained and immutable after definition. Apply aspects on the <code>Stage</code> construct itself (or lower) if you want them to visit constructs inside the <code>Stage</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="aspects-example">2.23.2. Example</h4>
<div class="paragraph">
<p>The following example validates that all buckets created in the stack have versioning enabled. The aspect adds an error annotation to the constructs that fail the validation. This results in the  <strong class="command">synth</strong> operation failing and prevents deploying the resulting cloud assembly.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class BucketVersioningChecker implements IAspect {
  public visit(node: IConstruct): void {
    // See that we're dealing with a CfnBucket
    if (node instanceof s3.CfnBucket) {

      // Check for versioning property, exclude the case where the property
      // can be a token (IResolvable).
      if (!node.versioningConfiguration
        || (!Tokenization.isResolvable(node.versioningConfiguration)
            &amp;&amp; node.versioningConfiguration.status !== 'Enabled')) {
        Annotations.of(node).addError('Bucket versioning is not enabled');
      }
    }
  }
}

// Later, apply to the stack
Aspects.of(stack).add(new BucketVersioningChecker());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class BucketVersioningChecker {
   visit(node) {
    // See that we're dealing with a CfnBucket
    if ( node instanceof s3.CfnBucket) {

      // Check for versioning property, exclude the case where the property
      // can be a token (IResolvable).
      if (!node.versioningConfiguration
        || !Tokenization.isResolvable(node.versioningConfiguration)
            &amp;&amp; node.versioningConfiguration.status !== 'Enabled')) {
        Annotations.of(node).addError('Bucket versioning is not enabled');
      }
    }
  }
}

// Later, apply to the stack
Aspects.of(stack).add(new BucketVersioningChecker());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@jsii.implements(cdk.IAspect)
class BucketVersioningChecker:

  def visit(self, node):
    # See that we're dealing with a CfnBucket
    if isinstance(node, s3.CfnBucket):

      # Check for versioning property, exclude the case where the property
      # can be a token (IResolvable).
      if (not node.versioning_configuration or
              not Tokenization.is_resolvable(node.versioning_configuration)
                  and node.versioning_configuration.status != "Enabled"):
          Annotations.of(node).add_error('Bucket versioning is not enabled')

# Later, apply to the stack
Aspects.of(stack).add(BucketVersioningChecker())</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class BucketVersioningChecker implements IAspect
{
    @Override
    public void visit(Construct node)
    {
        // See that we're dealing with a CfnBucket
        if (node instanceof CfnBucket)
        {
            CfnBucket bucket = (CfnBucket)node;
            Object versioningConfiguration = bucket.getVersioningConfiguration();
            if (versioningConfiguration == null ||
                    !Tokenization.isResolvable(versioningConfiguration.toString()) &amp;&amp;
                    !versioningConfiguration.toString().contains("Enabled"))
                Annotations.of(bucket.getNode()).addError("Bucket versioning is not enabled");
        }
    }
}


// Later, apply to the stack
Aspects.of(stack).add(new BucketVersioningChecker());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">class BucketVersioningChecker : Amazon.Jsii.Runtime.Deputy.DeputyBase, IAspect
{
    public void Visit(IConstruct node)
    {
        // See that we're dealing with a CfnBucket
        if (node is CfnBucket)
        {
            var bucket = (CfnBucket)node;
            if (bucket.VersioningConfiguration is null ||
                    !Tokenization.IsResolvable(bucket.VersioningConfiguration) &amp;&amp;
                    !bucket.VersioningConfiguration.ToString().Contains("Enabled"))
                Annotations.Of(bucket.Node).AddError("Bucket versioning is not enabled");
        }
    }
}

// Later, apply to the stack
Aspects.Of(stack).add(new BucketVersioningChecker());</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="prerequisites">3. AWS CDK prerequisites</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Complete prerequisites before getting started with the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Complete all prerequisites before getting started with the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="sect2">
<h3 id="prerequisites-account">3.1. Set up your AWS account</h3>
<div class="paragraph">
<p>If you or your organization are new to AWS, you must set up your AWS account. This includes signing up for an AWS account, securing your root user, determining your method of managing users, and creating an administrative user. To manage users, you can use AWS Identity and Access Management (IAM) or AWS IAM Identity Center. We recommend that you use IAM Identity Center. For more information, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html">What is IAM?</a> in the <em>IAM User Guide</em>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html">What is IAM Identity Center?</a> in the <em>AWS IAM Identity Center User Guide</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After setting up an AWS account, you should have an administrative user and the ability to create and manage additional users using IAM or IAM Identity Center.</p>
</div>
<div class="paragraph">
<p>Before moving forward, we recommend that you take time to learn the recommended best practices in AWS Identity and Access Management. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/IAMBestPracticesAndUseCases.html">Security best practices and use cases in AWS Identity and Access Management</a> in the <em>IAM User Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites-cli">3.2. Install and configure the AWS CLI</h3>
<div class="paragraph">
<p>When you develop AWS CDK applications on your local machine, you will use the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>) to interact with AWS, such as deploying applications to provision your AWS resources. To interact with AWS outside of the AWS Management Console, you must configure security credentials on your local machine. To do this, we recommend that you install and use the AWS Command Line Interface (AWS CLI).</p>
</div>
<div class="paragraph">
<p>For instructions on installing the AWS CLI, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">Install or update to the latest version of the AWS CLI</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>How you configure security credentials will depend on how you or your organization manages users. For instructions, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-authentication.html">Authentication and access credentials</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>After installing and configuring the AWS CLI, you should have the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The AWS CLI installed on your local machine.</p>
</li>
<li>
<p>Credentials configured in a <code class="path">config</code> on your local machine using the AWS CLI.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites-node">3.3. Install <code class="noloc">Node.js</code> and programming language prerequisites</h3>
<div class="paragraph">
<p>All AWS CDK developers, regardless of the supported programming language that you will use, require  <a href="https://nodejs.org/en/download/">Node.js</a> 14.15.0 or later. All supported programming languages use the same backend, which runs on <code class="noloc">Node.js</code>. We recommend a version in  <a href="https://nodejs.org/en/about/releases/">active long-term support</a>. If your organization has a different recommendation, follow their guidance.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Node.js versions 13.0.0 through 13.6.0 are not compatible with the AWS CDK due to compatibility issues with its dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other programming language prerequisites depend on the language that you will use to develop AWS CDK applications:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>TypeScript 3.8 or later (<code>npm -g install typescript</code>)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>No additional requirements</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Python 3.7 or later including <code>pip</code> and <code>virtualenv</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
<div class="ulist">
<ul>
<li>
<p>Java Development Kit (JDK) 8 (a.k.a. 1.8) or later</p>
</li>
<li>
<p>Apache Maven 3.5 or later</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java IDE recommended (we use Eclipse in some examples in this guide). IDE must be able to import Maven projects. Check to make sure that your project is set to use Java 1.8. Set the JAVA_HOME environment variable to the path where you have installed the JDK.</p>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>.NET Core 3.1 or later, or .NET 6.0 or later.</p>
<div class="paragraph">
<p>Visual Studio 2019 (any edition) or Visual Studio Code recommended.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Go 1.1.8 or later.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Third-party language deprecation</div>
<div class="paragraph">
<p>Each language version is only supported until it is  <code class="noloc">EOL</code> (End Of Life) and is subject to change with prior notice.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites-next">3.4. Next steps</h3>
<div class="paragraph">
<p>To get started with the AWS CDK, see  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="getting-started">4. Getting started with the AWS CDK</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Get started with the AWS Cloud Development Kit (AWS CDK) by installing and configuring the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>). Then, use the CDK  <code class="noloc">CLI</code> to create your first CDK app, bootstrap your AWS environment, and deploy your application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Get started with the AWS Cloud Development Kit (AWS CDK) by installing and configuring the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>). Then, use the CDK  <code class="noloc">CLI</code> to create your first CDK app, bootstrap your AWS environment, and deploy your application.</p>
</div>
<div class="sect2">
<h3 id="getting-started-prerequisites">4.1. Prerequisites</h3>
<div class="paragraph">
<p>Before getting started with the AWS CDK, complete all prerequisites. These prerequisites are required for those that are new to AWS or new to programming. For instructions, see  <a href="#prerequisites">AWS CDK prerequisites</a>.</p>
</div>
<div class="paragraph">
<p>We recommend that you have a basic understanding of what the AWS CDK is. For more information, see <a href="#home">What is the AWS CDK?</a> and <a href="#core-concepts">Learn AWS CDK core concepts</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-install">4.2. Install the AWS CDK <code class="noloc">CLI</code></h3>
<div class="paragraph">
<p>Use the  <code class="noloc">Node</code> Package Manager to install the CDK  <code class="noloc">CLI</code>. We recommend that you install it globally using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ npm install -g aws-cdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install a specific version of the CDK  <code class="noloc">CLI</code>, use the following command structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ npm install -g aws-cdk@X.YY.Z</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use multiple versions of the AWS CDK, consider installing a matching version of the CDK  <code class="noloc">CLI</code> in individual CDK projects. To do this, remove the  <code>-g</code> option from the <code>npm install</code> command. Then, use <code>npx aws-cdk</code> to invoke the CDK <code class="noloc">CLI</code>. This will run a local version if it exists. Otherwise, the globally installed version will be used.</p>
</div>
<div class="sect3">
<h4 id="getting-started-install-troubleshoot">4.2.1. Troubleshoot a CDK <code class="noloc">CLI</code> installation</h4>
<div class="paragraph">
<p>If you get a permission error, and have administrator access on your system, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ sudo npm install -g aws-cdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you receive an error message, try uninstalling the CDK  <code class="noloc">CLI</code> by running the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ npm uninstall -g aws-cdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, repeat steps to reinstall the CDK  <code class="noloc">CLI</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-started-install-verify">4.2.2. Verify a successful CDK <code class="noloc">CLI</code> installation</h4>
<div class="paragraph">
<p>Run the following command to verify a successful installation. The AWS CDK  <code class="noloc">CLI</code> should output the version number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk --version</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-configure">4.3. Configure the AWS CDK <code class="noloc">CLI</code></h3>
<div class="paragraph">
<p>After installing the CDK  <code class="noloc">CLI</code>, you can start using it to develop applications on your local machine. To interact with AWS, such as deploying applications, you must have security credentials configured on your local machine with permissions to perform any actions that you initiate.</p>
</div>
<div class="paragraph">
<p>To configure security credentials on your local machine, you use the AWS CLI. How you configure security credentials depends on how you manage users. For instructions, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-authentication.html">Authentication and access credentials</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> will automatically use the security credentials that you configure with the AWS CLI. For example, if you are an IAM Identity Center user, you can use the  <code>aws configure sso</code> command to configure security credentials. If you are an IAM user, you can use the <code>aws configure</code> command. The AWS CLI will guide you through configuring security credentials on your local machine and save the necessary information in your <code class="path">config</code> and  <code class="path">credentials</code> files. Then, when you use the CDK  <code class="noloc">CLI</code>, such as deploying an application with  <code>cdk deploy</code>, the CDK <code class="noloc">CLI</code> will use your configured security credentials.</p>
</div>
<div class="paragraph">
<p>Just like the AWS CLI, the CDK <code class="noloc">CLI</code> will use your  <code>default</code> profile by default. You can specify a profile using the CDK <code class="noloc">CLI</code><code><a href="#ref-cli-cmd-options-profile">--profile</a></code> option. For more information on using security credentials with the CDK <code class="noloc">CLI</code>, see  <a href="#configure-access">Configure security credentials for the AWS CDK CLI</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-tools">4.4. (Optional) Install additional AWS CDK tools</h3>
<div class="paragraph">
<p>The  <a href="https://aws.amazon.com/visualstudiocode/">AWS Toolkit for Visual Studio Code</a> is an open source plug-in for Visual Studio Code that helps you create, debug, and deploy applications on AWS. The toolkit provides an integrated experience for developing AWS CDK applications. It includes the AWS CDK Explorer feature to list your AWS CDK projects and browse the various components of the CDK application. For instructions, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/toolkit-for-vscode/latest/userguide/setup-toolkit.html">Installing the AWS Toolkit for Visual Studio Code</a>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/toolkit-for-vscode/latest/userguide/cdk-explorer.html">AWS CDK for VS Code</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-app">4.5. Create your first CDK app</h3>
<div class="paragraph">
<p>You&#8217;re now ready to get started with using the AWS CDK by creating your first CDK app. For instructions, see  <a href="#hello-world">Tutorial: Create your first AWS CDK app</a>.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="hello-world">4.6. Tutorial: Create your first AWS CDK app</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Get started with the AWS Cloud Development Kit (AWS CDK) by using the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>) to develop your first CDK app, bootstrap your AWS environment, and deploy your application on AWS.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Get started with using the AWS Cloud Development Kit (AWS CDK) by using the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>) to develop your first CDK app, bootstrap your AWS environment, and deploy your application on AWS.</p>
</div>
<div class="sect3">
<h4 id="hello-world-prerequisites">4.6.1. Prerequisites</h4>
<div class="paragraph">
<p>Before starting this tutorial, complete all set up steps in  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-about">4.6.2. About this tutorial</h4>
<div class="paragraph">
<p>In this tutorial, you will create and deploy a simple application on AWS using the AWS CDK. The application consists of an  <a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html">AWS Lambda function</a> that returns a <code>Hello World!</code> message when invoked. The function will be invoked through a <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-urls.html">Lambda function URL</a> that serves as a dedicated HTTP(S) endpoint for your Lambda function.</p>
</div>
<div class="paragraph">
<p>Through this tutorial, you will perform the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Create your project</strong> – Create a CDK project using the CDK <code class="noloc">CLI</code><code>cdk init</code> command.</p>
</li>
<li>
<p><strong>Configure your AWS environment</strong> – Configure the AWS environment that you will deploy your application into.</p>
</li>
<li>
<p><strong>Bootstrap your AWS environment</strong> – Prepare your AWS environment for deployment by bootstrapping it using the CDK <code class="noloc">CLI</code><code>cdk bootstrap</code> command.</p>
</li>
<li>
<p><strong>Develop your app</strong> – Use constructs from the AWS Construct Library to define your Lambda function and Lambda function URL resources.</p>
</li>
<li>
<p><strong>Prepare your app for deployment</strong> – Use the CDK <code class="noloc">CLI</code> to build your app and synthesize an AWS CloudFormation template.</p>
</li>
<li>
<p><strong>Deploy your app</strong> – Use the CDK <code class="noloc">CLI</code><code>cdk deploy</code> command to deploy your application and provision your AWS resources.</p>
</li>
<li>
<p><strong>Interact with your application</strong> – Interact with your deployed Lambda function on AWS by invoking it and receiving a response.</p>
</li>
<li>
<p><strong>Modify your app</strong> – Modify your Lambda function and deploy to implement your changes.</p>
</li>
<li>
<p><strong>Delete your app</strong> – Delete all resources that you created by using the CDK <code class="noloc">CLI</code><code>cdk destroy</code> command.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-create">4.6.3. Step 1: Create your CDK project</h4>
<div class="paragraph">
<p>In this step, you create a new CDK project. A CDK project should be in its own directory, with its own local module dependencies.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a starting directory of your choice, create and navigate to a directory named <code class="path">hello-cdk</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir hello-cdk &amp;&amp; cd hello-cdk</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Be sure to name your project directory <code class="path">hello-cdk</code>,  <em>exactly as shown here</em>. The CDK <code class="noloc">CLI</code> uses this directory name to name things within your CDK code. If you use a different directory name, you will run into issues during this tutorial.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the <code class="path">hello-cdk</code> directory, initialize a new CDK project using the CDK  <code class="noloc">CLI</code><code>cdk init</code> command. Specify the <code>app</code> template and your preferred programming language with the <code>--language</code> option:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cdk init app --language typescript</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language javascript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language python</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>After the app has been created, also enter the following two commands. These activate the app&#8217;s  <code class="noloc">Python</code> virtual environment and installs the AWS CDK core dependencies.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ source .venv/bin/activate # On Windows, run `.\venv\Scripts\activate` instead
$ python -m pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language java</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>If you are using an IDE, you can now open or import the project. In  <code class="noloc">Eclipse</code>, for example, choose  <strong>File</strong> &gt;  <strong>Import</strong> &gt;  <strong>Maven</strong> &gt;  <strong>Existing Maven Projects</strong>. Make sure that the project settings are set to use Java 8 (1.8).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>If you are using Visual Studio, open the solution file in the  <code class="path">src</code> directory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language go</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>After the app has been created, also enter the following command to install the AWS Construct Library modules that the app requires.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ go get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <code>cdk init</code> command creates a structure of files and folders within the <code class="path">hello-cdk</code> directory to help organize the source code for your CDK app. This structure of files and folders is called your CDK  <em>project</em>. Take a moment to explore your CDK project.</p>
</div>
<div class="paragraph">
<p>If you have <code class="noloc">Git</code> installed, each project you create using  <code>cdk init</code> is also initialized as a <code class="noloc">Git</code> repository.</p>
</div>
<div class="paragraph">
<p>During project initialization, the CDK <code class="noloc">CLI</code> creates a CDK app containing a single CDK stack. The CDK app instance is created using the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.App.html">App</a></code> construct. The following is a portion of this code from your CDK application file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">bin/hello-cdk.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { HelloCdkStack } from '../lib/hello-cdk-stack';

const app = new cdk.App();
new HelloCdkStack(app, 'HelloCdkStack', {
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">bin/hello-cdk.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

const cdk = require('aws-cdk-lib');
const { HelloCdkStack } = require('../lib/hello-cdk-stack');

const app = new cdk.App();
new HelloCdkStack(app, 'HelloCdkStack', {
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">app.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os

import aws_cdk as cdk

from hello_cdk.hello_cdk_stack import HelloCdkStack


app = cdk.App()
HelloCdkStack(app, "HelloCdkStack",)

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkApp.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

import java.util.Arrays;

public class HelloCdkApp {
  public static void main(final String[] args) {
    App app = new App();

    new HelloCdkStack(app, "HelloCdkStack", StackProps.builder()
      .build());

    app.synth();
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/HelloCdk/Program.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using System;
using System.Collections.Generic;
using System.Linq;

namespace HelloCdk
{
  sealed class Program
  {
    public static void Main(string[] args)
    {
      var app = new App();
      new HelloCdkStack(app, "HelloCdkStack", new StackProps
      {});
      app.Synth();
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello-cdk.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/constructs-go/constructs/v10"
  "github.com/aws/jsii-runtime-go"
)

// ...

func main() {
  defer jsii.Close()

  app := awscdk.NewApp(nil)

  NewHelloCdkStack(app, "HelloCdkStack", &amp;HelloCdkStackProps{
    awscdk.StackProps{
      Env: env(),
    },
  })

  app.Synth(nil)
}

// ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The CDK stack is created using the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> construct. The following is a portion of this code from your CDK stack file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

export class HelloCdkStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define your constructs here

  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack } = require('aws-cdk-lib');

class HelloCdkStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define your constructs here

  }
}

module.exports = { HelloCdkStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello_cdk/hello_cdk_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
  Stack,
)
from constructs import Construct

class HelloCdkStack(Stack):

  def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
    super().__init__(scope, construct_id, **kwargs)

    # Define your constructs here</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class HelloCdkStack extends Stack {
  public HelloCdkStack(final Construct scope, final String id) {
    this(scope, id, null);
  }

  public HelloCdkStack(final Construct scope, final String id, final StackProps props) {
    super(scope, id, props);

    // Define your constructs here
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/HelloCdk/HelloCdkStack.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace HelloCdk
{
  public class HelloCdkStack : Stack
  {
    internal HelloCdkStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
    {
      // Define your constructs here
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello-cdk.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/constructs-go/constructs/v10"
  "github.com/aws/jsii-runtime-go"
)

type HelloCdkStackProps struct {
  awscdk.StackProps
}

func NewHelloCdkStack(scope constructs.Construct, id string, props *HelloCdkStackProps) awscdk.Stack {
  var sprops awscdk.StackProps
  if props != nil {
    sprops = props.StackProps
  }
  stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

  return stack
}

// ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-configure">4.6.4. Step 2: Configure your AWS environment</h4>
<div class="paragraph">
<p>In this step, you configure the AWS environment for your CDK stack. By doing this, you specify which environment your CDK stack will be deployed to.</p>
</div>
<div class="paragraph">
<p>First, determine the AWS environment that you want to use. An AWS environment consists of an AWS account and AWS Region.</p>
</div>
<div class="paragraph">
<p>When you use the AWS CLI to configure security credentials on your local machine, you can then use the AWS CLI to obtain AWS environment information for a specific profile.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following AWS CLI command to get the AWS account ID for your <code>default</code> profile:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws sts get-caller-identity --query "Account" --output text</code></pre>
</div>
</div>
</li>
<li>
<p>If you prefer to use a named profile, provide the name of your profile using the <code>--profile</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws sts get-caller-identity --profile your-profile-name --query "Account" --output text</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following AWS CLI command to get the Region that you configured for your <code>default</code> profile:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws configure get region</code></pre>
</div>
</div>
</li>
<li>
<p>If you prefer to use a named profile, provide the name of your profile using the <code>--profile</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws configure get region --profile your-profile-name</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next, you will configure the AWS environment for your CDK stack by modifying the  <code>HelloCdkStack</code> instance in your <em>application file</em>. For this tutorial, you will hard code your AWS environment information. This is recommended for production environments. For information on other ways to configure environments, see <a href="#configure-env">Configure environments to use with the AWS CDK</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your <em>application file</em>, use the <code>env</code> property of the <code>Stack</code> construct to configure your environment. The following is an example:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">bin/hello-cdk.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { HelloCdkStack } from '../lib/hello-cdk-stack';

const app = new cdk.App();
new HelloCdkStack(app, 'HelloCdkStack', {
  env: { account: '123456789012', region: 'us-east-1' },
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">bin/hello-cdk.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

const cdk = require('aws-cdk-lib');
const { HelloCdkStack } = require('../lib/hello-cdk-stack');

const app = new cdk.App();
new HelloCdkStack(app, 'HelloCdkStack', {
  env: { account: '123456789012', region: 'us-east-1' },
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">app.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os

import aws_cdk as cdk

from hello_cdk.hello_cdk_stack import HelloCdkStack


app = cdk.App()
HelloCdkStack(app, "HelloCdkStack",
  env=cdk.Environment(account='123456789012', region='us-east-1'),
  )

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkApp.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

import java.util.Arrays;

public class HelloCdkApp {
    public static void main(final String[] args) {
        App app = new App();

        new HelloCdkStack(app, "HelloCdkStack", StackProps.builder()
                .env(Environment.builder()
                        .account("123456789012")
                        .region("us-east-1")
                        .build())

                .build());

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/HelloCdk/Program.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using System;
using System.Collections.Generic;
using System.Linq;

namespace HelloCdk
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            var app = new App();
            new HelloCdkStack(app, "HelloCdkStack", new StackProps
            {
                Env = new Amazon.CDK.Environment
                {
                    Account = "123456789012",
                    Region = "us-east-1",
                }
            });
            app.Synth();
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello-cdk.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/constructs-go/constructs/v10"
  "github.com/aws/jsii-runtime-go"
)

// ...

func main() {
  defer jsii.Close()

  app := awscdk.NewApp(nil)

  NewHelloCdkStack(app, "HelloCdkStack", &amp;HelloCdkStackProps{
    awscdk.StackProps{
      Env: env(),
    },
  })

  app.Synth(nil)
}

func env() *awscdk.Environment {
	return &amp;awscdk.Environment{
		Account: jsii.String("123456789012"),
		Region:  jsii.String("us-east-1"),
	}
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-bootstrap">4.6.5. Step 3: Bootstrap your AWS environment</h4>
<div class="paragraph">
<p>In this step, you bootstrap the AWS environment that you configured in the previous step. This prepares your environment for CDK deployments.</p>
</div>
<div class="paragraph">
<p>To bootstrap your environment, run the following from the root of your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap</code></pre>
</div>
</div>
<div class="paragraph">
<p>By bootstrapping from the root of your CDK project, you don&#8217;t have to provide any additional information. The CDK  <code class="noloc">CLI</code> obtains environment information from your project. When you bootstrap outside of a CDK project, you must provide environment information with the  <code>cdk bootstrap</code> command. For more information, see <a href="#bootstrapping-env">Bootstrap your environment for use with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-build">4.6.6. Step 4: Build your CDK app</h4>
<div class="paragraph">
<p>In most programming environments, you build or compile code after making changes. This isn&#8217;t necessary with the AWS CDK since the CDK  <code class="noloc">CLI</code> will automatically perform this step. However, you can still build manually when you want to catch syntax and type errors. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ npm run build

&gt; hello-cdk@0.1.0 build
&gt; tsc</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>No build step is necessary.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>No build step is necessary.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mvn compile -q</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Or press  <code>Control-B</code> in Eclipse (other Java IDEs may vary)</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ dotnet build src</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Or press F6 in Visual Studio</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ go build</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-list">4.6.7. Step 5: List the CDK stacks in your app</h4>
<div class="paragraph">
<p>At this point, you should have a CDK app containing a single CDK stack. To verify, use the CDK  <code class="noloc">CLI</code><code>cdk list</code> command to display your stacks. The output should display a single stack named <code>HelloCdkStack</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk list
HelloCdkStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t see this output, verify that you are in the correct working directory of your project and try again. If you still don&#8217;t see your stack, repeat  <a href="#hello-world-create">Step 1: Create your CDK project</a> and try again.</p>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-function">4.6.8. Step 6: Define your Lambda function</h4>
<div class="paragraph">
<p>In this step, you import the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda-readme.html">aws_lambda</a></code> module from the AWS Construct Library and use the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda.Function.html">Function</a></code> L2 construct.</p>
</div>
<div class="paragraph">
<p>Modify your CDK stack file as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
// Import the Lambda module
import * as lambda from 'aws-cdk-lib/aws-lambda';

export class HelloCdkStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define the Lambda function resource
    const myFunction = new lambda.Function(this, "HelloWorldFunction", {
      runtime: lambda.Runtime.NODEJS_20_X, // Provide any supported Node.js runtime
      handler: "index.handler",
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
      `),
    });
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack } = require('aws-cdk-lib');
// Import the Lambda module
const lambda = require('aws-cdk-lib/aws-lambda');

class HelloCdkStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define the Lambda function resource
    const myFunction = new lambda.Function(this, "HelloWorldFunction", {
      runtime: lambda.Runtime.NODEJS_20_X, // Provide any supported Node.js runtime
      handler: "index.handler",
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
      `),
    });

  }
}

module.exports = { HelloCdkStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello_cdk/hello_cdk_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
  Stack,
  aws_lambda as _lambda, # Import the Lambda module
)
from constructs import Construct

class HelloCdkStack(Stack):

  def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
    super().__init__(scope, construct_id, **kwargs)

    # Define the Lambda function resource
    my_function = _lambda.Function(
      self, "HelloWorldFunction",
      runtime = _lambda.Runtime.NODEJS_20_X, # Provide any supported Node.js runtime
      handler = "index.handler",
      code = _lambda.Code.from_inline(
        """
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };
        """
      ),
    )</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
// Import Lambda function
import software.amazon.awscdk.services.lambda.Code;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;

public class HelloCdkStack extends Stack {
  public HelloCdkStack(final Construct scope, final String id) {
    this(scope, id, null);
  }

  public HelloCdkStack(final Construct scope, final String id, final StackProps props) {
    super(scope, id, props);

    // Define the Lambda function resource
    Function myFunction = Function.Builder.create(this, "HelloWorldFunction")
      .runtime(Runtime.NODEJS_20_X) // Provide any supported Node.js runtime
      .handler("index.handler")
      .code(Code.fromInline(
        "exports.handler = async function(event) {" +
        " return {" +
        " statusCode: 200," +
        " body: JSON.stringify('Hello World!')" +
        " };" +
        "};"))
      .build();

  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
// Import the Lambda module
using Amazon.CDK.AWS.Lambda;

namespace HelloCdk
{
  public class HelloCdkStack : Stack
  {
    internal HelloCdkStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
    {
      // Define the Lambda function resource
      var myFunction = new Function(this, "HelloWorldFunction", new FunctionProps
      {
        Runtime = Runtime.NODEJS_20_X, // Provide any supported Node.js runtime
        Handler = "index.handler",
        Code = Code.FromInline(@"
          exports.handler = async function(event) {
            return {
              statusCode: 200,
              body: JSON.stringify('Hello World!'),
            };
          };
        "),
      });
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello-cdk.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
  "github.com/aws/aws-cdk-go/awscdk/v2"
  "github.com/aws/constructs-go/constructs/v10"
  "github.com/aws/jsii-runtime-go"
  // Import the Lambda module
  "github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
)

type HelloCdkStackProps struct {
  awscdk.StackProps
}

func NewHelloCdkStack(scope constructs.Construct, id string, props *HelloCdkStackProps) awscdk.Stack {
  var sprops awscdk.StackProps
  if props != nil {
    sprops = props.StackProps
  }
  stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

  // Define the Lambda function resource
  myFunction := awslambda.NewFunction(stack, jsii.String("HelloWorldFunction"), &amp;awslambda.FunctionProps{
    Runtime: awslambda.Runtime_NODEJS_20_X(), // Provide any supported Node.js runtime
    Handler: jsii.String("index.handler"),
    Code: awslambda.Code_FromInline(jsii.String(`
      exports.handler = async function(event) {
        return {
          statusCode: 200,
          body: JSON.stringify('Hello World!'),
        };
      };
    `)),
  })

  return stack
}

// ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Let&#8217;s take a closer look at the  <code>Function</code> construct. Like all constructs, the <code>Function</code> class takes three parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scope</strong> – Defines your <code>Stack</code> instance as the parent of the <code>Function</code> construct. All constructs that define AWS resources are created within the scope of a stack. You can define constructs inside of constructs, creating a hierarchy (tree). Here, and in most cases, the scope is <code>this</code> (<code>self</code> in <code class="noloc">Python</code>).</p>
</li>
<li>
<p><strong>Id</strong> – The construct ID of the <code>Function</code> within your AWS CDK app. This ID, plus a hash based on the function&#8217;s location within the stack, uniquely identifies the function during deployment. The AWS CDK also references this ID when you update the construct in your app and re-deploy to update the deployed resource. Here, your construct ID is <code>HelloWorldFunction</code>. Functions can also have a name, specified with the <code>functionName</code> property. This is different from the construct ID.</p>
</li>
<li>
<p><strong>props</strong> – A bundle of values that define properties of the function. Here you define the <code>runtime</code>, <code>handler</code>, and <code>code</code> properties.</p>
<div class="paragraph">
<p>Props are represented differently in the languages supported by the AWS CDK.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In <code class="noloc">TypeScript</code> and  <code class="noloc">JavaScript</code>,  <code>props</code> is a single argument and you pass in an object containing the desired properties.</p>
</li>
<li>
<p>In <code class="noloc">Python</code>, props are passed as keyword arguments.</p>
</li>
<li>
<p>In <code class="noloc">Java</code>, a Builder is provided to pass the props. There are two: one for  <code>FunctionProps</code>, and a second for <code>Function</code> to let you build the construct and its props object in one step. This code uses the latter.</p>
</li>
<li>
<p>In <code class="noloc">C#</code>, you instantiate a  <code>FunctionProps</code> object using an object initializer and pass it as the third parameter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a construct&#8217;s props are optional, you can omit the  <code>props</code> parameter entirely.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All constructs take these same three arguments, so it&#8217;s easy to stay oriented as you learn about new ones. And as you might expect, you can subclass any construct to extend it to suit your needs, or if you want to change its defaults.</p>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-url">4.6.9. Step 7: Define your Lambda function URL</h4>
<div class="paragraph">
<p>In this step, you use the  <code>addFunctionUrl</code> helper method of the <code>Function</code> construct to define a Lambda function URL. To output the value of this URL at deployment, you will create an AWS CloudFormation output using the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.CfnOutput.html">CfnOutput</a></code> construct.</p>
</div>
<div class="paragraph">
<p>Add the following to your CDK stack file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// ...

export class HelloCdkStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define the Lambda function resource
    // ...

    // Define the Lambda function URL resource
    const myFunctionUrl = myFunction.addFunctionUrl({
      authType: lambda.FunctionUrlAuthType.NONE,
    });

    // Define a CloudFormation output for your URL
    new cdk.CfnOutput(this, "myFunctionUrlOutput", {
      value: myFunctionUrl.url,
    })

  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, CfnOutput } = require('aws-cdk-lib');  // Import CfnOutput

class HelloCdkStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define the Lambda function resource
    // ...

    // Define the Lambda function URL resource
    const myFunctionUrl = myFunction.addFunctionUrl({
      authType: lambda.FunctionUrlAuthType.NONE,
    });

    // Define a CloudFormation output for your URL
    new CfnOutput(this, "myFunctionUrlOutput", {
      value: myFunctionUrl.url,
    })

  }
}

module.exports = { HelloCdkStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello_cdk/hello_cdk_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
  # ...
  CfnOutput # Import CfnOutput
)
from constructs import Construct

class HelloCdkStack(Stack):

  def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
    super().__init__(scope, construct_id, **kwargs)

    # Define the Lambda function resource
    # ...

    # Define the Lambda function URL resource
    my_function_url = my_function.add_function_url(
      auth_type = _lambda.FunctionUrlAuthType.NONE,
    )

    # Define a CloudFormation output for your URL
    CfnOutput(self, "myFunctionUrlOutput", value=my_function_url.url)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

// ...
// Import Lambda function URL
import software.amazon.awscdk.services.lambda.FunctionUrl;
import software.amazon.awscdk.services.lambda.FunctionUrlAuthType;
import software.amazon.awscdk.services.lambda.FunctionUrlOptions;
// Import CfnOutput
import software.amazon.awscdk.CfnOutput;

public class HelloCdkStack extends Stack {
  public HelloCdkStack(final Construct scope, final String id) {
    this(scope, id, null);
  }

  public HelloCdkStack(final Construct scope, final String id, final StackProps props) {
    super(scope, id, props);

    // Define the Lambda function resource
    // ...

    // Define the Lambda function URL resource
    FunctionUrl myFunctionUrl = myFunction.addFunctionUrl(FunctionUrlOptions.builder()
      .authType(FunctionUrlAuthType.NONE)
      .build());

    // Define a CloudFormation output for your URL
    CfnOutput.Builder.create(this, "myFunctionUrlOutput")
      .value(myFunctionUrl.getUrl())
      .build();
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// ...

namespace HelloCdk
{
  public class HelloCdkStack : Stack
  {
    internal HelloCdkStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
    {
      // Define the Lambda function resource
      // ...

      // Define the Lambda function URL resource
      var myFunctionUrl = myFunction.AddFunctionUrl(new FunctionUrlOptions
      {
        AuthType = FunctionUrlAuthType.NONE
      });

      // Define a CloudFormation output for your URL
      new CfnOutput(this, "myFunctionUrlOutput", new CfnOutputProps
      {
        Value = myFunctionUrl.Url
      });
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello-cdk.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// ...

func NewHelloCdkStack(scope constructs.Construct, id string, props *HelloCdkStackProps) awscdk.Stack {
  var sprops awscdk.StackProps
  if props != nil {
    sprops = props.StackProps
  }
  stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

  // Define the Lambda function resource
  // ...

  // Define the Lambda function URL resource
  myFunctionUrl := myFunction.AddFunctionUrl(&amp;awslambda.FunctionUrlOptions{
    AuthType: awslambda.FunctionUrlAuthType_NONE,
  })

  // Define a CloudFormation output for your URL
  awscdk.NewCfnOutput(stack, jsii.String("myFunctionUrlOutput"), &amp;awscdk.CfnOutputProps{
    Value: myFunctionUrl.Url(),
  })

  return stack
}

// ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To keep this tutorial simple, your Lambda function URL is defined without authentication. When deployed, this creates a publicly accessible endpoint that can be used to invoke your function. When you are done with this tutorial, follow  <a href="#hello-world-delete">Step 12: Delete your application</a> to delete these resources.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-synth">4.6.10. Step 8: Synthesize a CloudFormation template</h4>
<div class="paragraph">
<p>In this step, you prepare for deployment by synthesizing a CloudFormation template with the CDK  <code class="noloc">CLI</code><code>cdk synth</code> command. This command performs basic validation of your CDK code, runs your CDK app, and generates a CloudFormation template from your CDK stack.</p>
</div>
<div class="paragraph">
<p>If your app contains more than one stack, you must specify which stacks to synthesize. Since your app contains a single stack, the CDK <code class="noloc">CLI</code> automatically detects the stack to synthesize.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t synthesize a template, the CDK <code class="noloc">CLI</code> will automatically perform this step when you deploy. However, we recommend that you run this step before each deployment to check for synthesis errors.</p>
</div>
<div class="paragraph">
<p>Before synthesizing a template, you can optionally build your application to catch syntax and type errors. For instructions, see <a href="#hello-world-build">Step 4: Build your CDK app</a>.</p>
</div>
<div class="paragraph">
<p>To synthesize a CloudFormation template, run the following from the root of your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you receive an error like the following, verify that you are in the  <code class="path">hello-cdk</code> directory and try again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--app is required either in command-line, in cdk.json or in ~/.cdk.json</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If successful, the CDK  <code class="noloc">CLI</code> will output a  <code class="noloc">YAML</code>–formatted CloudFormation template to  <code>stdout</code> and save a <code class="noloc">JSON</code>–formatted template in the  <code class="path">cdk.out</code> directory of your project.</p>
</div>
<div class="paragraph">
<p>The following is an example output of the CloudFormation template:</p>
</div>
<details id="hello-world-synth-template">
<summary class="title">AWS CloudFormation template</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  HelloWorldFunctionServiceRoleunique-identifier:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: HelloCdkStack/HelloWorldFunction/ServiceRole/Resource
  HelloWorldFunctionunique-identifier:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: "

          \        exports.handler = async function(event) {

          \          return {

          \            statusCode: 200,

          \            body: JSON.stringify('Hello World!'),

          \          };

          \        };

          \      "
      Handler: index.handler
      Role:
        Fn::GetAtt:
          - HelloWorldFunctionServiceRoleunique-identifier
          - Arn
      Runtime: nodejs20.x
    DependsOn:
      - HelloWorldFunctionServiceRoleunique-identifier
    Metadata:
      aws:cdk:path: HelloCdkStack/HelloWorldFunction/Resource
  HelloWorldFunctionFunctionUrlunique-identifier:
    Type: AWS::Lambda::Url
    Properties:
      AuthType: NONE
      TargetFunctionArn:
        Fn::GetAtt:
          - HelloWorldFunctionunique-identifier
          - Arn
    Metadata:
      aws:cdk:path: HelloCdkStack/HelloWorldFunction/FunctionUrl/Resource
  HelloWorldFunctioninvokefunctionurlunique-identifier:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunctionUrl
      FunctionName:
        Fn::GetAtt:
          - HelloWorldFunctionunique-identifier
          - Arn
      FunctionUrlAuthType: NONE
      Principal: "*"
    Metadata:
      aws:cdk:path: HelloCdkStack/HelloWorldFunction/invoke-function-url
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:unique-identifier
    Metadata:
      aws:cdk:path: HelloCdkStack/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  myFunctionUrlOutput:
    Value:
      Fn::GetAtt:
        - HelloWorldFunctionFunctionUrlunique-identifier
        - FunctionUrl
Parameters:
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value&lt;String&gt;
    Default: /cdk-bootstrap/unique-identifier/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]
Rules:
  CheckBootstrapVersion:
    Assertions:
      - Assert:
          Fn::Not:
            - Fn::Contains:
                - - "1"
                  - "2"
                  - "3"
                  - "4"
                  - "5"
                - Ref: BootstrapVersion
        AssertDescription: CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Every generated template contains an  <code>AWS::CDK::Metadata</code> resource by default. The AWS CDK team uses this metadata to gain insight into AWS CDK usage and find ways to improve it. For details, including how to opt out of version reporting, see <a href="#version-reporting">Version reporting</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By defining a single L2 construct, the AWS CDK creates an extensive CloudFormation template containing your Lambda resources, along with the permissions and glue logic required for your resources to interact within your application.</p>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-deploy">4.6.11. Step 9: Deploy your CDK stack</h4>
<div class="paragraph">
<p>In this step, you use the CDK  <code class="noloc">CLI</code><code>cdk deploy</code> command to deploy your CDK stack. This command retrieves your generated CloudFormation template and deploys it through AWS CloudFormation, which provisions your resources as part of a CloudFormation stack.</p>
</div>
<div class="paragraph">
<p>From the root of your project, run the following. Confirm changes if prompted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy

✨  Synthesis time: 2.69s

HelloCdkStack:  start: Building unique-identifier:current_account-current_region
HelloCdkStack:  success: Built unique-identifier:current_account-current_region
HelloCdkStack:  start: Publishing unique-identifier:current_account-current_region
HelloCdkStack:  success: Published unique-identifier:current_account-current_region
This deployment will make potentially sensitive changes according to your current security approval level (--require-approval broadening).
Please confirm you intend to make the following modifications:

IAM Statement Changes
┌───┬───────────────────────────────────────┬────────┬──────────────────────────┬──────────────────────────────┬───────────┐
│   │ Resource                              │ Effect │ Action                   │ Principal                    │ Condition │
├───┼───────────────────────────────────────┼────────┼──────────────────────────┼──────────────────────────────┼───────────┤
│ + │ ${HelloWorldFunction.Arn}             │ Allow  │ lambda:InvokeFunctionUrl │ *                            │           │
├───┼───────────────────────────────────────┼────────┼──────────────────────────┼──────────────────────────────┼───────────┤
│ + │ ${HelloWorldFunction/ServiceRole.Arn} │ Allow  │ sts:AssumeRole           │ Service:lambda.amazonaws.com │           │
└───┴───────────────────────────────────────┴────────┴──────────────────────────┴──────────────────────────────┴───────────┘
IAM Policy Changes
┌───┬───────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────┐
│   │ Resource                          │ Managed Policy ARN                                                             │
├───┼───────────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
│ + │ ${HelloWorldFunction/ServiceRole} │ arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole │
└───┴───────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────┘
(NOTE: There may be security-related changes not in this list. See https://github.com/aws/aws-cdk/issues/1299)

Do you wish to deploy these changes (y/n)? y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to  <code>cdk synth</code>, you don&#8217;t have to specify the AWS CDK stack since the app contains a single stack.</p>
</div>
<div class="paragraph">
<p>During deployment, the CDK <code class="noloc">CLI</code> displays progress information as your stack is deployed. When complete, you can go to the  <a href="https://console.aws.amazon.com/cloudformation/home">AWS CloudFormation console</a> to view your <code>HelloCdkStack</code> stack. You can also go to the Lambda console to view your <code>HelloWorldFunction</code> resource.</p>
</div>
<div class="paragraph">
<p>When deployment completes, the CDK <code class="noloc">CLI</code> will output your endpoint URL. Copy this URL for the next step. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>...
HelloCdkStack: deploying... [1/1]
HelloCdkStack: creating CloudFormation changeset...

 ✅  HelloCdkStack

✨  Deployment time: 41.65s

Outputs:
HelloCdkStack.myFunctionUrlOutput = https://&lt;api-id&gt;.lambda-url.&lt;Region&gt;.on.aws/
Stack ARN:
arn:aws:cloudformation:Region:account-id:stack/HelloCdkStack/unique-identifier

✨  Total time: 44.34s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-interact">4.6.12. Step 10: Interact with your application on AWS</h4>
<div class="paragraph">
<p>In this step, you interact with your application on AWS by invoking your Lambda function through the function URL. When you access the URL, your Lambda function returns the  <code>Hello World!</code> message.</p>
</div>
<div class="paragraph">
<p>To invoke your function, access the function URL through your browser or from the command line. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ curl https://&lt;api-id&gt;.lambda-url.&lt;Region&gt;.on.aws/
"Hello World!"%</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-modify">4.6.13. Step 11: Modify your application</h4>
<div class="paragraph">
<p>In this step, you modify the message that the Lambda function returns when invoked. You perform a diff using the CDK  <code class="noloc">CLI</code><code>cdk diff</code> command to preview your changes and deploy to update your application. You then interact with your application on AWS to see your new message.</p>
</div>
<div class="paragraph">
<p>Modify the <code>myFunction</code> instance in your CDK stack file as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// ...

export class HelloCdkStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Modify the Lambda function resource
    const myFunction = new lambda.Function(this, "HelloWorldFunction", {
      runtime: lambda.Runtime.NODEJS_20_X, // Provide any supported Node.js runtime
      handler: "index.handler",
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello CDK!'),
          };
        };
      `),
    });

    // ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/hello-cdk-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// ...

class HelloCdkStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Modify the Lambda function resource
    const myFunction = new lambda.Function(this, "HelloWorldFunction", {
      runtime: lambda.Runtime.NODEJS_20_X, // Provide any supported Node.js runtime
      handler: "index.handler",
      code: lambda.Code.fromInline(`
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello CDK!'),
          };
        };
      `),
    });

    // ...

  }
}

module.exports = { HelloCdkStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">hello_cdk/hello_cdk_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># ...

class HelloCdkStack(Stack):

  def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
    super().__init__(scope, construct_id, **kwargs)

    # Modify the Lambda function resource
    my_function = _lambda.Function(
      self, "HelloWorldFunction",
      runtime = _lambda.Runtime.NODEJS_20_X, # Provide any supported Node.js runtime
      handler = "index.handler",
      code = _lambda.Code.from_inline(
        """
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello CDK!'),
          };
        };
        """
      ),
    )

    # ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/HelloCdkStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// ...

public class HelloCdkStack extends Stack {
  public HelloCdkStack(final Construct scope, final String id) {
    this(scope, id, null);
  }

  public HelloCdkStack(final Construct scope, final String id, final StackProps props) {
    super(scope, id, props);

    // Modify the Lambda function resource
    Function myFunction = Function.Builder.create(this, "HelloWorldFunction")
      .runtime(Runtime.NODEJS_20_X) // Provide any supported Node.js runtime
      .handler("index.handler")
      .code(Code.fromInline(
        "exports.handler = async function(event) {" +
        " return {" +
        " statusCode: 200," +
        " body: JSON.stringify('Hello CDK!')" +
        " };" +
        "};"))
      .build();

    // ...
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// ...

namespace HelloCdk
{
  public class HelloCdkStack : Stack
  {
    internal HelloCdkStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
    {
      // Modify the Lambda function resource
      var myFunction = new Function(this, "HelloWorldFunction", new FunctionProps
      {
        Runtime = Runtime.NODEJS_20_X, // Provide any supported Node.js runtime
        Handler = "index.handler",
        Code = Code.FromInline(@"
          exports.handler = async function(event) {
            return {
              statusCode: 200,
              body: JSON.stringify('Hello CDK!'),
            };
          };
        "),
      });

      // ...
    }
  }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// ...

type HelloCdkStackProps struct {
  awscdk.StackProps
}

func NewHelloCdkStack(scope constructs.Construct, id string, props *HelloCdkStackProps) awscdk.Stack {
  var sprops awscdk.StackProps
  if props != nil {
    sprops = props.StackProps
  }
  stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

  // Modify the Lambda function resource
  myFunction := awslambda.NewFunction(stack, jsii.String("HelloWorldFunction"), &amp;awslambda.FunctionProps{
    Runtime: awslambda.Runtime_NODEJS_20_X(), // Provide any supported Node.js runtime
    Handler: jsii.String("index.handler"),
    Code: awslambda.Code_FromInline(jsii.String(`
      exports.handler = async function(event) {
        return {
          statusCode: 200,
          body: JSON.stringify('Hello CDK!'),
        };
      };
    `)),
  })

// ...</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Currently, your code changes have not made any direct updates to your deployed Lambda resource. Your code defines the desired state of your resource. To modify your deployed resource, you will use the CDK  <code class="noloc">CLI</code> to synthesize the desired state into a new AWS CloudFormation template. Then, you will deploy your new CloudFormation template as a change set. Change sets make only the necessary changes to reach your new desired state.</p>
</div>
<div class="paragraph">
<p>To preview your changes, run the <code>cdk diff</code> command. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff
Stack HelloCdkStack
Hold on while we create a read-only change set to get a diff with accurate replacement information (use --no-change-set to use a less accurate but faster template-only diff)
Resources
[~] AWS::Lambda::Function HelloWorldFunction HelloWorldFunctionunique-identifier
 └─ [~] Code
     └─ [~] .ZipFile:
         ├─ [-]
                exports.handler = async function(event) {
                    return {
                      statusCode: 200,
                      body: JSON.stringify('Hello World!'),
                    };
                };

         └─ [+]
                exports.handler = async function(event) {
                    return {
                      statusCode: 200,
                      body: JSON.stringify('Hello CDK!'),
                    };
                };


✨  Number of stacks with differences: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create this diff, the CDK  <code class="noloc">CLI</code> queries your AWS account account for the latest AWS CloudFormation template for the  <code class="path">HelloCdkStack</code> stack. Then, it compares the latest template with the template it just synthesized from your app.</p>
</div>
<div class="paragraph">
<p>To implement your changes, run the <code>cdk deploy</code> command. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy

✨  Synthesis time: 2.12s

HelloCdkStack:  start: Building unique-identifier:current_account-current_region
HelloCdkStack:  success: Built unique-identifier:current_account-current_region
HelloCdkStack:  start: Publishing unique-identifier:current_account-current_region
HelloCdkStack:  success: Published unique-identifier:current_account-current_region
HelloCdkStack: deploying... [1/1]
HelloCdkStack: creating CloudFormation changeset...

 ✅  HelloCdkStack

✨  Deployment time: 26.96s

Outputs:
HelloCdkStack.myFunctionUrlOutput = https://unique-identifier.lambda-url.&lt;Region&gt;.on.aws/
Stack ARN:
arn:aws:cloudformation:Region:account-id:stack/HelloCdkStack/unique-identifier

✨  Total time: 29.07s</code></pre>
</div>
</div>
<div class="paragraph">
<p>To interact with your application, repeat  <a href="#hello-world-interact">Step 10: Interact with your application on AWS</a>. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ curl https://&lt;api-id&gt;.lambda-url.&lt;Region&gt;.on.aws/
"Hello CDK!"%</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-delete">4.6.14. Step 12: Delete your application</h4>
<div class="paragraph">
<p>In this step, you use the CDK  <code class="noloc">CLI</code><code>cdk destroy</code> command to delete your application. This command deletes the CloudFormation stack associated with your CDK stack, which includes the resources you created.</p>
</div>
<div class="paragraph">
<p>To delete your application, run the <code>cdk destroy</code> command and confirm your request to delete the application. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk destroy
Are you sure you want to delete: HelloCdkStack (y/n)? y
HelloCdkStack: destroying... [1/1]

 ✅  HelloCdkStack: destroyed</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hello-world-next-steps">4.6.15. Next steps</h4>
<div class="paragraph">
<p>Congratulations! You&#8217;ve completed this tutorial and have used the AWS CDK to successfully create, modify, and delete resources in the AWS Cloud. You&#8217;re now ready to begin using the AWS CDK.</p>
</div>
<div class="paragraph">
<p>To learn more about using the AWS CDK in your preferred programming language, see <a href="#work-with">Work with the AWS CDK library</a>.</p>
</div>
<div class="paragraph">
<p>For additional resources, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Try the <a href="https://cdkworkshop.com/">CDK Workshop</a> for a more in-depth tour involving a more complex project.</p>
</li>
<li>
<p>See the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">API reference</a> to begin exploring the CDK constructs available for your favorite AWS services.</p>
</li>
<li>
<p>Visit <a href="https://constructs.dev/search?q=&amp;cdk=aws-cdk&amp;cdkver=2&amp;sort=downloadsDesc&amp;offset=0">Construct Hub</a> to discover constructs created by AWS and others.</p>
</li>
<li>
<p>Explore <a href="https://github.com/aws-samples/aws-cdk-examples">Examples</a> of using the AWS CDK.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The AWS CDK is an open-source project. To contribute, see to  <a href="https://github.com/aws/aws-cdk/blob/main/CONTRIBUTING.md">Contributing to the AWS Cloud Development Kit (AWS CDK)</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="work-with">5. Work with the AWS CDK library</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Import and use the AWS Cloud Development Kit (AWS CDK) library to define your AWS Cloud infrastructure with a <a href="#languages">supported programming language</a>.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Import and use the AWS Cloud Development Kit (AWS CDK) library to define your AWS Cloud infrastructure with a  <a href="#languages">supported programming language</a>.</p>
</div>
<div class="sect2">
<h3 id="work-with-library">5.1. Import the AWS CDK Library</h3>
<div class="paragraph">
<p>The  <a href="#libraries">AWS CDK Library</a> is often referred to by its <code class="noloc">TypeScript</code> package name of  <code>aws-cdk-lib</code>. The actual package name varies by language. The following is an example of how to install and import the CDK Library:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&#8203;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&#8203;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&#8203;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&#8203;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&#8203;</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>&#8203;</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The  <code>construct</code> base class and supporting code is in the <code>constructs</code> library. Experimental constructs, where the API is still undergoing refinement, are distributed as separate modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="work-with-library-reference">5.2. Using the AWS CDK API Reference</h3>
<div class="paragraph">
<p>Use the  <a href="#libraries-reference">AWS CDK API reference</a> as you develop with the AWS CDK.</p>
</div>
<div class="paragraph">
<p>Each module&#8217;s reference material is broken into the following sections.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Overview</em>: Introductory material you&#8217;ll need to know to work with the service in the AWS CDK, including concepts and examples.</p>
</li>
<li>
<p><em>Constructs</em>: Library classes that represent one or more concrete AWS resources. These are the "curated" (L2) resources or patterns (L3 resources) that provide a high-level interface with sane defaults.</p>
</li>
<li>
<p><em>Classes</em>: Non-construct classes that provide functionality used by constructs in the module.</p>
</li>
<li>
<p><em>Structs</em>: Data structures (attribute bundles) that define the structure of composite values such as properties (the <code>props</code> argument of constructs) and options.</p>
</li>
<li>
<p><em>Interfaces</em>: Interfaces, whose names all begin with "I", define the absolute minimum functionality for the corresponding construct or other class. The CDK uses construct interfaces to represent AWS resources that are defined outside your AWS CDK app and referenced by methods such as <code>Bucket.fromBucketArn()</code>.</p>
</li>
<li>
<p><em>Enums</em>: Collections of named values for use in specifying certain construct parameters. Using an enumerated value allows the CDK to check these values for validity during synthesis.</p>
</li>
<li>
<p><em>CloudFormation Resources</em>: These L1 constructs, whose names begin with "Cfn", represent exactly the resources defined in the CloudFormation specification. They are automatically generated from that specification with each CDK release. Each L2 or L3 construct encapsulates one or more CloudFormation resources.</p>
</li>
<li>
<p><em>CloudFormation Property Types</em>: The collection of named values that define the properties for each CloudFormation Resource.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="work-with-library-interfaces">5.2.1. Interfaces compared with construct classes</h4>
<div class="paragraph">
<p>The AWS CDK uses interfaces in a specific way that may not be obvious even if you are familiar with interfaces as a programming concept.</p>
</div>
<div class="paragraph">
<p>The AWS CDK supports using resources defined outside CDK applications using methods such as <code>Bucket.fromBucketArn()</code>. External resources cannot be modified and may not have all the functionality available with resources defined in your CDK app using e.g. the <code>Bucket</code> class. Interfaces, then, represent the bare minimum functionality available in the CDK for a given AWS resource type, <em>including external resources.</em></p>
</div>
<div class="paragraph">
<p>When instantiating resources in your CDK app, then, you should always use concrete classes such as <code>Bucket</code>. When specifying the type of an argument you are accepting in one of your own constructs, use the interface type such as <code>IBucket</code> if you are prepared to deal with external resources (that is, you won&#8217;t need to change them). If you require a CDK-defined construct, specify the most general type you can use.</p>
</div>
<div class="paragraph">
<p>Some interfaces are minimum versions of properties or options bundles associated with specific classes, rather than constructs. Such interfaces can be useful when subclassing to accept arguments that you&#8217;ll pass on to your parent class. If you require one or more additional properties, you&#8217;ll want to implement or derive from this interface, or from a more specific type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some programming languages supported by the AWS CDK don&#8217;t have an interface feature. In these languages, interfaces are just ordinary classes. You can identify them by their names, which follow the pattern of an initial "I" followed by the name of some other construct (e.g. <code>IBucket</code>). The same rules apply.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="work-with-cdk-dependencies">5.3. Managing dependencies</h3>
<div class="paragraph">
<p>Dependencies for your AWS CDK app or library are managed using package management tools. These tools are commonly used with the programming languages.</p>
</div>
<div class="paragraph">
<p>Typically, the AWS CDK supports the language&#8217;s standard or official package management tool if there is one. Otherwise, the AWS CDK will support the language&#8217;s most popular or widely supported one. You may also be able to use other tools, especially if they work with the supported tools. However, official support for other tools is limited.</p>
</div>
<div class="paragraph">
<p>The AWS CDK supports the following package managers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Language</th>
<th class="tableblock halign-left valign-top">Supported package management tool</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TypeScript/JavaScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NPM (Node Package Manager) or Yarn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIP (Package Installer for Python)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maven</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NuGet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Go</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Go modules</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When you create a new project using the AWS CDK  <code class="noloc">CLI</code><code>cdk init</code> command, dependencies for the CDK core libraries and stable constructs are automatically specified.</p>
</div>
<div class="paragraph">
<p>For more information on managing dependencies for supported programming languages, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#work-with-cdk-typescript-dependencies">Managing dependencies in TypeScript</a>.</p>
</li>
<li>
<p><a href="#work-with-cdk-javascript-dependencies">Managing dependencies in JavaScript</a>.</p>
</li>
<li>
<p><a href="#work-with-cdk-python-dependencies">Managing dependencies in Python</a>.</p>
</li>
<li>
<p><a href="#work-with-cdk-java-dependencies">Managing dependencies in Java</a>.</p>
</li>
<li>
<p><a href="#work-with-cdk-csharp-dependencies">Managing dependencies in C#</a>.</p>
</li>
<li>
<p><a href="#work-with-cdk-go-dependencies">Managing dependencies in Go</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="work-with-cdk-compare">5.4. Comparing AWS CDK in  <code class="noloc">TypeScript</code> with other languages</h3>
<div class="paragraph">
<p>TypeScript was the first language supported for developing AWS CDK applications. Therefore, a substantial amount of example CDK code is written in TypeScript. If you are developing in another language, it might be useful to compare how AWS CDK code is implemented in TypeScript compared to your language of choice. This can help you use the examples throughout documentation.</p>
</div>
<div class="sect3">
<h4 id="work-with-cdk-compare-import">5.4.1. Importing a module</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript/JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>TypeScript supports importing either an entire namespace, or individual objects from a namespace. Each namespace includes constructs and other classes for use with a given AWS service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Import main CDK library as cdk
import * as cdk from 'aws-cdk-lib';   // ES6 import preferred in TS
const cdk = require('aws-cdk-lib');   // Node.js require() preferred in JS

// Import specific core CDK classes
import { Stack, App } from 'aws-cdk-lib';
const { Stack, App } = require('aws-cdk-lib');

// Import AWS S3 namespace as s3 into current namespace
import { aws_s3 as s3 } from 'aws-cdk-lib';   // TypeScript
const s3 = require('aws-cdk-lib/aws-s3');     // JavaScript

// Having imported cdk already as above, this is also valid
const s3 = cdk.aws_s3;

// Now use s3 to access the S3 types
const bucket = s3.Bucket(...);

// Selective import of s3.Bucket
import { Bucket } from 'aws-cdk-lib/aws-s3';        // TypeScript
const { Bucket } = require('aws-cdk-lib/aws-s3');   // JavaScript

// Now use Bucket to instantiate an S3 bucket
const bucket = Bucket(...);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Like TypeScript, Python supports namespaced module imports and selective imports. Namespaces in Python look like <strong>aws_cdk.</strong><em>xxx</em>, where <em>xxx</em> represents an AWS service name, such as <strong>s3</strong> for Amazon S3. (Amazon S3 is used in these examples).</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Import main CDK library as cdk
import aws_cdk as cdk

# Selective import of specific core classes
from aws_cdk import Stack, App

# Import entire module as s3 into current namespace
import aws_cdk.aws_s3 as s3

# s3 can now be used to access classes it contains
bucket = s3.Bucket(...)

# Selective import of s3.Bucket into current namespace
from aws_cdk.s3 import Bucket

# Bucket can now be used to instantiate a bucket
bucket = Bucket(...)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Java&#8217;s imports work differently from TypeScript&#8217;s. Each import statement imports either a single class name from a given package, or all classes defined in that package (using <code>\*</code>). Classes may be accessed using either the class name by itself if it has been imported, or the <em>qualified</em> class name including its package.</p>
<div class="paragraph">
<p>Libraries are named like <code>software.amazon.awscdk.services.xxx</code> for the AWS Construct Library (the main library is <code>software.amazon.awscdk</code>). The Maven group ID for AWS CDK packages is <code>software.amazon.awscdk</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Make certain core classes available
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.App;

// Make all Amazon S3 construct library classes available
import software.amazon.awscdk.services.s3.*;

// Make only Bucket and EventType classes available
import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.s3.EventType;

// An imported class may now be accessed using the simple class name (assuming that name
// does not conflict with another class)
Bucket bucket = Bucket.Builder.create(...).build();

// We can always use the qualified name of a class (including its package) even without an
// import directive
software.amazon.awscdk.services.s3.Bucket bucket =
    software.amazon.awscdk.services.s3.Bucket.Builder.create(...)
        .build();

// Java 10 or later can use var keyword to avoid typing the type twice
var bucket =
    software.amazon.awscdk.services.s3.Bucket.Builder.create(...)
        .build();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In C#, you import types with the <code>using</code> directive. There are two styles. One gives you access to all the types in the specified namespace by using their plain names. With the other, you can refer to the namespace itself by using an alias.</p>
<div class="paragraph">
<p>Packages are named like <code>Amazon.CDK.AWS.xxx</code> for AWS Construct Library packages. (The core module is <code>Amazon.CDK</code>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Make CDK base classes available under cdk
using cdk = Amazon.CDK;

// Make all Amazon S3 construct library classes available
using Amazon.CDK.AWS.S3;

// Now we can access any S3 type using its name
var bucket = new Bucket(...);

// Import the S3 namespace under an alias
using s3 = Amazon.CDK.AWS.S3;

// Now we can access an S3 type through the namespace alias
var bucket = new s3.Bucket(...);

// We can always use the qualified name of a type (including its namespace) even without a
// using directive
var bucket = new Amazon.CDK.AWS.S3.Bucket(...)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Each AWS Construct Library module is provided as a Go package.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
    "github.com/aws/aws-cdk-go/awscdk/v2"           // CDK core package
    "github.com/aws/aws-cdk-go/awscdk/v2/awss3"     // AWS S3 construct library module
)

// now instantiate a bucket
bucket := awss3.NewBucket(...)

// use aliases for brevity/clarity
import (
    cdk "github.com/aws/aws-cdk-go/awscdk/v2"           // CDK core package
    s3  "github.com/aws/aws-cdk-go/awscdk/v2/awss3"     // AWS S3 construct library module
)

bucket := s3.NewBucket(...)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-compare-class">5.4.2. Instantiating a construct</h4>
<div class="paragraph">
<p>AWS CDK construct classes have the same name in all supported languages. Most languages use the  <code>new</code> keyword to instantiate a class (Python and Go do not). Also, in most languages, the keyword <code>this</code> refers to the current instance. (Python uses <code>self</code> by convention.) You should pass a reference to the current instance as the <code>scope</code> parameter to every construct you create.</p>
</div>
<div class="paragraph">
<p>The third argument to an AWS CDK construct is <code>props</code>, an object containing attributes needed to build the construct. This argument may be optional, but when it is required, the supported languages handle it in idiomatic ways. The names of the attributes are also adapted to the language&#8217;s standard naming patterns.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript/JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Instantiate default Bucket
const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket');

// Instantiate Bucket with bucketName and versioned properties
const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket', {
  bucketName: 'amzn-s3-demo-bucket',
   versioned: true,
});

// Instantiate Bucket with websiteRedirect, which has its own sub-properties
const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket', {
  websiteRedirect: {host: 'aws.amazon.com'}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Python doesn&#8217;t use a <code>new</code> keyword when instantiating a class. The properties argument is represented using keyword arguments, and the arguments are named using <code>snake_case</code>.</p>
<div class="paragraph">
<p>If a props value is itself a bundle of attributes, it is represented by a class named after the property, which accepts keyword arguments for the subproperties.</p>
</div>
<div class="paragraph">
<p>In Python, the current instance is passed to methods as the first argument, which is named <code>self</code> by convention.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Instantiate default Bucket
bucket = s3.Bucket(self, "amzn-s3-demo-bucket")

# Instantiate Bucket with bucket_name and versioned properties
bucket = s3.Bucket(self, "amzn-s3-demo-bucket", bucket_name="amzn-s3-demo-bucket", versioned=true)

# Instantiate Bucket with website_redirect, which has its own sub-properties
bucket = s3.Bucket(self, "amzn-s3-demo-bucket", website_redirect=s3.WebsiteRedirect(
            host_name="aws.amazon.com"))</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In Java, the props argument is represented by a class named <code>XxxxProps</code> (for example, <code>BucketProps</code> for the <code>Bucket</code> construct&#8217;s props). You build the props argument using a builder pattern.</p>
<div class="paragraph">
<p>Each <code>XxxxProps</code> class has a builder. There is also a convenient builder for each construct that builds the props and the construct in one step, as shown in the following example.</p>
</div>
<div class="paragraph">
<p>Props are named the same as in TypeScript, using <code>camelCase</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Instantiate default Bucket
Bucket bucket = Bucket(self, "amzn-s3-demo-bucket");

// Instantiate Bucket with bucketName and versioned properties
Bucket bucket = Bucket.Builder.create(self, "amzn-s3-demo-bucket")
                      .bucketName("amzn-s3-demo-bucket").versioned(true)
                      .build();

# Instantiate Bucket with websiteRedirect, which has its own sub-properties
Bucket bucket = Bucket.Builder.create(self, "amzn-s3-demo-bucket")
                      .websiteRedirect(new websiteRedirect.Builder()
                          .hostName("aws.amazon.com").build())
                      .build();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In C#, props are specified using an object initializer to a class named <code>XxxxProps</code> (for example, <code>BucketProps</code> for the <code>Bucket</code> construct&#8217;s props).</p>
<div class="paragraph">
<p>Props are named similarly to TypeScript, except using <code>PascalCase</code>.</p>
</div>
<div class="paragraph">
<p>It is convenient to use the <code>var</code> keyword when instantiating a construct, so you don&#8217;t need to type the class name twice. However, your local code style guide may vary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Instantiate default Bucket
var bucket = Bucket(self, "amzn-s3-demo-bucket");

// Instantiate Bucket with BucketName and Versioned properties
var bucket =  Bucket(self, "amzn-s3-demo-bucket", new BucketProps {
                      BucketName = "amzn-s3-demo-bucket",
                      Versioned  = true});

// Instantiate Bucket with WebsiteRedirect, which has its own sub-properties
var bucket = Bucket(self, "amzn-s3-demo-bucket", new BucketProps {
                      WebsiteRedirect = new WebsiteRedirect {
                              HostName = "aws.amazon.com"
                      }});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To create a construct in Go, call the function <code>NewXxxxxx</code> where <code>Xxxxxxx</code> is the name of the construct. The constructs' properties are defined as a struct.</p>
<div class="paragraph">
<p>In Go, all construct parameters are pointers, including values like numbers, Booleans, and strings. Use the convenience functions like <code>jsii.String</code> to create these pointers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">	// Instantiate default Bucket
	bucket := awss3.NewBucket(stack, jsii.String("amzn-s3-demo-bucket"), nil)

	// Instantiate Bucket with BucketName and Versioned properties
	bucket1 := awss3.NewBucket(stack, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.BucketProps{
		BucketName: jsii.String("amzn-s3-demo-bucket"),
		Versioned:  jsii.Bool(true),
	})

	// Instantiate Bucket with WebsiteRedirect, which has its own sub-properties
	bucket2 := awss3.NewBucket(stack, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.BucketProps{
		WebsiteRedirect: &amp;awss3.RedirectTarget{
			HostName: jsii.String("aws.amazon.com"),
		}})</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-compare-members">5.4.3. Accessing members</h4>
<div class="paragraph">
<p>It is common to refer to attributes or properties of constructs and other AWS CDK classes and use these values as, for example, inputs to build other constructs. The naming differences described previously for methods apply here also. Furthermore, in Java, it is not possible to access members directly. Instead, a getter method is provided.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript/JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Names are <code>camelCase</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.bucketArn</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Names are <code>snake_case</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket.bucket_arn</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>A getter method is provided for each property; these names are <code>camelCase</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bucket.getBucketArn()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Names are <code>PascalCase</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.BucketArn</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Names are <code>PascalCase</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.BucketArn</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-compare-enums">5.4.4. Enum constants</h4>
<div class="paragraph">
<p>Enum constants are scoped to a class, and have uppercase names with underscores in all languages (sometimes referred to as  <code>SCREAMING_SNAKE_CASE</code>). Since class names also use the same casing in all supported languages except Go, qualified enum names are also the same in these languages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">s3.BucketEncryption.KMS_MANAGED</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Go, enum constants are attributes of the module namespace and are written as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">awss3.BucketEncryption_KMS_MANAGED</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-compare-object">5.4.5. Object interfaces</h4>
<div class="paragraph">
<p>The AWS CDK uses TypeScript object interfaces to indicate that a class implements an expected set of methods and properties. You can recognize an object interface because its name starts with  <code>I</code>. A concrete class indicates the interfaces that it implements by using the <code>implements</code> keyword.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript/JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>NOTE: JavaScript doesn&#8217;t have an interface feature. You can ignore the <code>implements</code> keyword and the class names following it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { IAspect, IConstruct } from 'aws-cdk-lib';

class MyAspect implements IAspect {
  public visit(node: IConstruct) {
    console.log('Visited', node.node.path);
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Python doesn&#8217;t have an interface feature. However, for the AWS CDK you can indicate interface implementation by decorating your class with <code>@jsii.implements(interface)</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import IAspect, IConstruct
import jsii

@jsii.implements(IAspect)
class MyAspect():
  def visit(self, node: IConstruct) -&gt; None:
    print("Visited", node.node.path)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.IAspect;
import software.amazon.awscdk.IConstruct;

public class MyAspect implements IAspect {
    public void visit(IConstruct node) {
        System.out.format("Visited %s", node.getNode().getPath());
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;

public class MyAspect : IAspect
{
    public void Visit(IConstruct node)
    {
        System.Console.WriteLine($"Visited ${node.Node.Path}");
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Go structs do not need to explicitly declare which interfaces they implement. The Go compiler determines implementation based on the methods and properties available on the structure. For example, in the following code, <code>MyAspect</code> implements the <code>IAspect</code> interface because it provides a <code>Visit</code> method that takes a construct.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">type MyAspect struct {
}

func (a MyAspect) Visit(node constructs.IConstruct) {
	fmt.Println("Visited", *node.Node().Path())
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="work-with-cdk-typescript">5.5. Working with the AWS CDK in TypeScript</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p><code class="noloc">TypeScript</code> is a fully-supported client language for the AWS CDK and is considered stable.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>TypeScript is a fully-supported client language for the AWS Cloud Development Kit (AWS CDK) and is considered stable. Working with the AWS CDK in TypeScript uses familiar tools, including Microsoft&#8217;s TypeScript compiler (<code>tsc</code>), <a href="https://nodejs.org/">Node.js</a> and the Node Package Manager (<code>npm</code>). You may also use <a href="https://yarnpkg.com/">Yarn</a> if you prefer, though the examples in this Guide use NPM. The modules comprising the AWS Construct Library are distributed via the NPM repository, <a href="https://www.npmjs.com/">npmjs.org</a>.</p>
</div>
<div class="paragraph">
<p>You can use any editor or IDE. Many AWS CDK developers use <a href="https://code.visualstudio.com/">Visual Studio Code</a> (or its open-source equivalent <a href="https://vscodium.com/">VSCodium</a>), which has excellent support for TypeScript.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="typescript-prerequisites">5.5.1. Get started with TypeScript</h4>
<div class="paragraph">
<p>To work with the AWS CDK, you must have an AWS account and credentials and have installed Node.js and the AWS CDK Toolkit. See  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>You also need TypeScript itself (version 3.8 or later). If you don&#8217;t already have it, you can install it using <code>npm</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm install -g typescript</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you get a permission error, and have administrator access on your system, try  <code>sudo npm install -g typescript</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keep TypeScript up to date with a regular  <code>npm update -g typescript</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Third-party language deprecation: language version is only supported until its EOL (End Of Life) shared by the vendor or community and is subject to change with prior notice.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="typescript-newproject">5.5.2. Creating a project</h4>
<div class="paragraph">
<p>You create a new AWS CDK project by invoking  <code>cdk init</code> in an empty directory. Use the <code>--language</code> option and specify <code>typescript</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-project
cd my-project
cdk init app --language typescript</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating a project also installs the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib-readme.html">aws-cdk-lib</a> module and its dependencies.</p>
</div>
<div class="paragraph">
<p><code>cdk init</code> uses the name of the project folder to name various elements of the project, including classes, subfolders, and files. Hyphens in the folder name are converted to underscores. However, the name should otherwise follow the form of a TypeScript identifier; for example, it should not start with a number or contain spaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="typescript-local">5.5.3. Using local  <code>tsc</code> and <code>cdk</code></h4>
<div class="paragraph">
<p>For the most part, this guide assumes you install TypeScript and the CDK Toolkit globally (<code>npm install -g typescript aws-cdk</code>), and the provided command examples (such as <code>cdk synth</code>) follow this assumption. This approach makes it easy to keep both components up to date, and since both take a strict approach to backward compatibility, there is generally little risk in always using the latest versions.</p>
</div>
<div class="paragraph">
<p>Some teams prefer to specify all dependencies within each project, including tools like the TypeScript compiler and the CDK Toolkit. This practice lets you pin these components to specific versions and ensure that all developers on your team (and your CI/CD environment) use exactly those versions. This eliminates a possible source of change, helping to make builds and deployments more consistent and repeatable.</p>
</div>
<div class="paragraph">
<p>The CDK includes dependencies for both TypeScript and the CDK Toolkit in the TypeScript project template&#8217;s <code class="path">package.json</code>, so if you want to use this approach, you don&#8217;t need to make any changes to your project. All you need to do is use slightly different commands for building your app and for issuing  <code>cdk</code> commands.</p>
</div>
<div class="paragraph">
<p><code>npx aws-cdk</code> runs the version of the CDK Toolkit installed locally in the current project, if one exists, falling back to the global installation, if any. If no global installation exists, <code>npx</code> downloads a temporary copy of the CDK Toolkit and runs that. You may specify an arbitrary version of the CDK Toolkit using the <code>@</code> syntax: <code>npx aws-cdk@2.0 --version</code> prints <code>2.0.0</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Set up an alias so you can use the <code>cdk</code> command with a local CDK Toolkit installation.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">alias cdk="npx aws-cdk"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">doskey cdk=npx aws-cdk $*</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="typescript-managemodules">5.5.4. Managing AWS Construct Library modules</h4>
<div class="paragraph">
<p>Use the Node Package Manager (<code>npm</code>) to install and update AWS Construct Library modules for use by your apps, as well as other packages you need. (You may use <code>yarn</code> instead of <code>npm</code> if you prefer.) <code>npm</code> also installs the dependencies for those modules automatically.</p>
</div>
<div class="paragraph">
<p>Most AWS CDK constructs are in the main CDK package, named <code>aws-cdk-lib</code>, which is a default dependency in new projects created by <strong class="command">cdk init</strong>. "Experimental" AWS Construct Library modules, where higher-level constructs are still under development, are named like <code>@aws-cdk/[replaceable]</code>SERVICE-NAME<code>-alpha</code>. The service name has an <em>aws-</em> prefix. If you&#8217;re unsure of a module&#8217;s name, <a href="https://www.npmjs.com/search?q=%40aws-cdk">search for it on NPM</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">CDK API Reference</a> also shows the package names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the command below installs the experimental module for AWS CodeStar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm install @aws-cdk/aws-codestar-alpha</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some services' Construct Library support is in more than one namespace. For example, besides  <code>aws-route53</code>, there are three additional Amazon Route 53 namespaces, <code>aws-route53-targets</code>, <code>aws-route53-patterns</code>, and <code>aws-route53resolver</code>.</p>
</div>
<div class="paragraph">
<p>Your project&#8217;s dependencies are maintained in <code class="path">package.json</code>. You can edit this file to lock some or all of your dependencies to a specific version or to allow them to be updated to newer versions under certain criteria. To update your project&#8217;s NPM dependencies to the latest permitted version according to the rules you specified in  <code class="path">package.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm update</code></pre>
</div>
</div>
<div class="paragraph">
<p>In TypeScript, you import modules into your code under the same name you use to install them using NPM. We recommend the following practices when importing AWS CDK classes and AWS Construct Library modules in your applications. Following these guidelines will help make your code consistent with other AWS CDK applications as well as easier to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use ES6-style <code>import</code> directives, not <code>require()</code>.</p>
</li>
<li>
<p>Generally, import individual classes from <code>aws-cdk-lib</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { App, Stack } from 'aws-cdk-lib';</code></pre>
</div>
</div>
</li>
<li>
<p>If you need many classes from <code>aws-cdk-lib</code>, you may use a namespace alias of <code>cdk</code> instead of importing the individual classes. Avoid doing both.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';</code></pre>
</div>
</div>
</li>
<li>
<p>Generally, import AWS service constructs using short namespace aliases.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { aws_s3 as s3 } from 'aws-cdk-lib';</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-typescript-dependencies">5.5.5. Managing dependencies in  <code class="noloc">TypeScript</code></h4>
<div class="paragraph">
<p>In  <code class="noloc">TypeScript</code> CDK projects, dependencies are specified in the  <code class="path">package.json</code> file in the project&#8217;s main directory. The core AWS CDK modules are in a single  <code class="noloc">NPM</code> package called  <code class="path">aws-cdk-lib</code>.</p>
</div>
<div class="paragraph">
<p>When you install a package using <strong class="command">npm install</strong>, NPM records the package in <code class="path">package.json</code> for you.</p>
</div>
<div class="paragraph">
<p>If you prefer, you may use Yarn in place of NPM. However, the CDK does not support Yarn&#8217;s plug-and-play mode, which is default mode in Yarn 2. Add the following to your project&#8217;s <code class="path">.yarnrc.yml</code> file to turn off this feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">nodeLinker: node-modules</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-typescript-dependencies-apps">CDK applications</h5>
<div class="paragraph">
<p>The following is an example  <code class="path">package.json</code> file generated by the  <code>cdk init --language typescript</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "my-package",
  "version": "0.1.0",
  "bin": {
    "my-package": "bin/my-package.js"
  },
  "scripts": {
    "build": "tsc",
    "watch": "tsc -w",
    "test": "jest",
    "cdk": "cdk"
  },
  "devDependencies": {
    "@types/jest": "^26.0.10",
    "@types/node": "10.17.27",
    "jest": "^26.4.2",
    "ts-jest": "^26.2.0",
    "aws-cdk": "2.16.0",
    "ts-node": "^9.0.0",
    "typescript": "~3.9.7"
  },
  "dependencies": {
    "aws-cdk-lib": "2.16.0",
    "constructs": "^10.0.0",
    "source-map-support": "^0.5.16"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For deployable CDK apps,  <code>aws-cdk-lib</code> must be specified in the <code>dependencies</code> section of <code class="path">package.json</code>. You can use a caret (^) version number specifier to indicate that you will accept later versions than the one specified as long as they are within the same major version.</p>
</div>
<div class="paragraph">
<p>For experimental constructs, specify exact versions for the alpha construct library modules, which have APIs that may change. Do not use ^ or ~ since later versions of these modules may bring API changes that can break your app.</p>
</div>
<div class="paragraph">
<p>Specify versions of libraries and tools needed to test your app (for example, the <code class="path">jest</code> testing framework) in the  <code>devDependencies</code> section of <code class="path">package.json</code>. Optionally, use ^ to specify that later compatible versions are acceptable.</p>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-typescript-dependencies-libraries">Third-party construct libraries</h5>
<div class="paragraph">
<p>If you&#8217;re developing a construct library, specify its dependencies using a combination of the  <code>peerDependencies</code> and <code>devDependencies</code> sections, as shown in the following example <code class="path">package.json</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "my-package",
  "version": "0.0.1",
  "peerDependencies": {
    "aws-cdk-lib": "^2.14.0",
    "@aws-cdk/aws-appsync-alpha": "2.10.0-alpha",
    "constructs": "^10.0.0"
  },
  "devDependencies": {
    "aws-cdk-lib": "2.14.0",
    "@aws-cdk/aws-appsync-alpha": "2.10.0-alpha",
    "constructs": "10.0.0",
    "jsii": "^1.50.0",
    "aws-cdk": "^2.14.0"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code>peerDependencies</code>, use a caret (^) to specify the lowest version of <code>aws-cdk-lib</code> that your library works with. This maximizes the compatibility of your library with a range of CDK versions. Specify exact versions for alpha construct library modules, which have APIs that may change. Using <code>peerDependencies</code> makes sure that there is only one copy of all CDK libraries in the <code class="path">node_modules</code> tree.</p>
</div>
<div class="paragraph">
<p>In <code>devDependencies</code>, specify the tools and libraries you need for testing, optionally with ^ to indicate that later compatible versions are acceptable. Specify exactly (without ^ or ~) the lowest versions of <code>aws-cdk-lib</code> and other CDK packages that you advertise your library be compatible with. This practice makes sure that your tests run against those versions. This way, if you inadvertently use a feature found only in newer versions, your tests can catch it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>peerDependencies</code> are installed automatically only by NPM 7 and later. If you are using NPM 6 or earlier, or if you are using Yarn, you must include the dependencies of your dependencies in <code>devDependencies</code>. Otherwise, they won&#8217;t be installed, and you will receive a warning about unresolved peer dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-typescript-dependencies-install">Installing and updating dependencies</h5>
<div class="paragraph">
<p>Run the following command to install your project&#8217;s dependencies.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NPM</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># Install the latest version of everything that matches the ranges in 'package.json'
npm install

# Install the same exact dependency versions as recorded in 'package-lock.json'
npm ci</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Yarn</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># Install the latest version of everything that matches the ranges in 'package.json'
yarn upgrade

# Install the same exact dependency versions as recorded in 'yarn.lock'
yarn install --frozen-lockfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>To update the installed modules, the preceding  <strong class="command">npm install</strong> and <strong class="command">yarn upgrade</strong> commands can be used. Either command updates the packages in <code class="path">node_modules</code> to the latest versions that satisfy the rules in  <code class="path">package.json</code>. However, they do not update  <code class="path">package.json</code> itself, which you might want to do to set a new minimum version. If you host your package on GitHub, you can configure  <a href="https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuring-dependabot-version-updates">Dependabot version updates</a> to automatically update <code class="path">package.json</code>. Alternatively, use  <a href="https://www.npmjs.com/package/npm-check-updates">npm-check-updates</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By design, when you install or update dependencies, NPM and Yarn choose the latest version of every package that satisfies the requirements specified in <code class="path">package.json</code>. There is always a risk that these versions may be broken (either accidentally or intentionally). Test thoroughly after updating your project&#8217;s dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="typescript-cdk-idioms">5.5.6. AWS CDK idioms in TypeScript</h4>
<div class="sect4">
<h5 id="typescript-props">Props</h5>
<div class="paragraph">
<p>All AWS Construct Library classes are instantiated using three arguments: the  <em>scope</em> in which the construct is being defined (its parent in the construct tree), an <em>id</em>, and <em>props</em>. Argument <em>props</em> is a bundle of key/value pairs that the construct uses to configure the AWS resources it creates. Other classes and methods also use the "bundle of attributes" pattern for arguments.</p>
</div>
<div class="paragraph">
<p>In TypeScript, the shape of <code>props</code> is defined using an interface that tells you the required and optional arguments and their types. Such an interface is defined for each kind of <code>props</code> argument, usually specific to a single construct or method. For example, the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">Bucket</a> construct (in the <code>aws-cdk-lib/aws-s3 module</code>) specifies a <code>props</code> argument conforming to the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketProps.html">BucketProps</a> interface.</p>
</div>
<div class="paragraph">
<p>If a property is itself an object, for example the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketProps.html#websiteredirect">websiteRedirect</a> property of <code>BucketProps</code>, that object will have its own interface to which its shape must conform, in this case <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.RedirectTarget.html">RedirectTarget</a>.</p>
</div>
<div class="paragraph">
<p>If you are subclassing an AWS Construct Library class (or overriding a method that takes a props-like argument), you can inherit from the existing interface to create a new one that specifies any new props your code requires. When calling the parent class or base method, generally you can pass the entire props argument you received, since any attributes provided in the object but not specified in the interface will be ignored.</p>
</div>
<div class="paragraph">
<p>A future release of the AWS CDK could coincidentally add a new property with a name you used for your own property. Passing the value you receive up the inheritance chain can then cause unexpected behavior. It&#8217;s safer to pass a shallow copy of the props you received with your property removed or set to <code>undefined</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">super(scope, name, {...props, encryptionKeys: undefined});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, name your properties so that it is clear that they belong to your construct. This way, it is unlikely they will collide with properties in future AWS CDK releases. If there are many of them, use a single appropriately-named object to hold them.</p>
</div>
</div>
<div class="sect4">
<h5 id="typescript-missing-values">Missing values</h5>
<div class="paragraph">
<p>Missing values in an object (such as props) have the value  <code>undefined</code> in TypeScript. Version 3.7 of the language introduced operators that simplify working with these values, making it easier to specify defaults and "short-circuit" chaining when an undefined value is reached. For more information about these features, see the <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html">TypeScript 3.7 Release Notes</a>, specifically the first two features, Optional Chaining and Nullish Coalescing.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="typescript-running">5.5.7. Build and run CDK apps</h4>
<div class="paragraph">
<p>Generally, you should be in the project&#8217;s root directory when building and running your application.</p>
</div>
<div class="paragraph">
<p>Node.js cannot run TypeScript directly; instead, your application is converted to JavaScript using the TypeScript compiler, <code>tsc</code>. The resulting JavaScript code is then executed.</p>
</div>
<div class="paragraph">
<p>The AWS CDK automatically does this whenever it needs to run your app. However, it can be useful to compile manually to check for errors and to run tests. To compile your TypeScript app manually, issue <code>[noloc]</code>npm run build````. You may also issue <code>npm run watch</code> to enter watch mode, in which the TypeScript compiler automatically rebuilds your app whenever you save changes to a source file.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="work-with-cdk-javascript">5.6. Working with the AWS CDK in JavaScript</h3>
<div class="paragraph">
<p><code class="noloc">JavaScript</code> is a fully-supported client language for the AWS CDK and is considered stable. Working with the AWS Cloud Development Kit (AWS CDK) in JavaScript uses familiar tools, including  <a href="https://nodejs.org/">Node.js</a> and the Node Package Manager (<code>npm</code>). You may also use <a href="https://yarnpkg.com/">Yarn</a> if you prefer, though the examples in this Guide use NPM. The modules comprising the AWS Construct Library are distributed via the NPM repository, <a href="https://www.npmjs.com/">npmjs.org</a>.</p>
</div>
<div class="paragraph">
<p>You can use any editor or IDE. Many AWS CDK developers use <a href="https://code.visualstudio.com/">Visual Studio Code</a> (or its open-source equivalent <a href="https://vscodium.com/">VSCodium</a>), which has good support for JavaScript.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="javascript-prerequisites">5.6.1. Get started with <code class="noloc">JavaScript</code></h4>
<div class="paragraph">
<p>To work with the AWS CDK, you must have an AWS account and credentials and have installed Node.js and the AWS CDK Toolkit. See  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>JavaScript AWS CDK applications require no additional prerequisites beyond these.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Third-party language deprecation: language version is only supported until its EOL (End Of Life) shared by the vendor or community and is subject to change with prior notice.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="javascript-newproject">5.6.2. Creating a project</h4>
<div class="paragraph">
<p>You create a new AWS CDK project by invoking  <code>cdk init</code> in an empty directory. Use the <code>--language</code> option and specify <code>javascript</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-project
cd my-project
cdk init app --language javascript</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating a project also installs the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib-readme.html">aws-cdk-lib</a> module and its dependencies.</p>
</div>
<div class="paragraph">
<p><code>cdk init</code> uses the name of the project folder to name various elements of the project, including classes, subfolders, and files. Hyphens in the folder name are converted to underscores. However, the name should otherwise follow the form of a JavaScript identifier; for example, it should not start with a number or contain spaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="javascript-local">5.6.3. Using local  <code>cdk</code></h4>
<div class="paragraph">
<p>For the most part, this guide assumes you install the CDK Toolkit globally (<code>npm install -g aws-cdk</code>), and the provided command examples (such as <code>cdk synth</code>) follow this assumption. This approach makes it easy to keep the CDK Toolkit up to date, and since the CDK takes a strict approach to backward compatibility, there is generally little risk in always using the latest version.</p>
</div>
<div class="paragraph">
<p>Some teams prefer to specify all dependencies within each project, including tools like the CDK Toolkit. This practice lets you pin such components to specific versions and ensure that all developers on your team (and your CI/CD environment) use exactly those versions. This eliminates a possible source of change, helping to make builds and deployments more consistent and repeatable.</p>
</div>
<div class="paragraph">
<p>The CDK includes a dependency for the CDK Toolkit in the JavaScript project template&#8217;s <code class="path">package.json</code>, so if you want to use this approach, you don&#8217;t need to make any changes to your project. All you need to do is use slightly different commands for building your app and for issuing  <code>cdk</code> commands.</p>
</div>
<div class="paragraph">
<p><code>npx aws-cdk</code> runs the version of the CDK Toolkit installed locally in the current project, if one exists, falling back to the global installation, if any. If no global installation exists, <code>npx</code> downloads a temporary copy of the CDK Toolkit and runs that. You may specify an arbitrary version of the CDK Toolkit using the <code>@</code> syntax: <code>npx aws-cdk@1.120 --version</code> prints <code>1.120.0</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Set up an alias so you can use the <code>cdk</code> command with a local CDK Toolkit installation.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">alias cdk="npx aws-cdk"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">doskey cdk=npx aws-cdk $*</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="javascript-managemodules">5.6.4. Managing AWS Construct Library modules</h4>
<div class="paragraph">
<p>Use the Node Package Manager (<code>npm</code>) to install and update AWS Construct Library modules for use by your apps, as well as other packages you need. (You may use <code>yarn</code> instead of <code>npm</code> if you prefer.) <code>npm</code> also installs the dependencies for those modules automatically.</p>
</div>
<div class="paragraph">
<p>Most AWS CDK constructs are in the main CDK package, named <code>aws-cdk-lib</code>, which is a default dependency in new projects created by <strong class="command">cdk init</strong>. "Experimental" AWS Construct Library modules, where higher-level constructs are still under development, are named like <code>aws-cdk-lib/[replaceable]</code>SERVICE-NAME<code>-alpha</code>. The service name has an <em>aws-</em> prefix. If you&#8217;re unsure of a module&#8217;s name, <a href="https://www.npmjs.com/search?q=%40aws-cdk">search for it on NPM</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">CDK API Reference</a> also shows the package names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the command below installs the experimental module for AWS CodeStar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm install @aws-cdk/aws-codestar-alpha</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some services' Construct Library support is in more than one namespace. For example, besides  <code>aws-route53</code>, there are three additional Amazon Route 53 namespaces, <code>aws-route53-targets</code>, <code>aws-route53-patterns</code>, and <code>aws-route53resolver</code>.</p>
</div>
<div class="paragraph">
<p>Your project&#8217;s dependencies are maintained in <code class="path">package.json</code>. You can edit this file to lock some or all of your dependencies to a specific version or to allow them to be updated to newer versions under certain criteria. To update your project&#8217;s NPM dependencies to the latest permitted version according to the rules you specified in  <code class="path">package.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm update</code></pre>
</div>
</div>
<div class="paragraph">
<p>In JavaScript, you import modules into your code under the same name you use to install them using NPM. We recommend the following practices when importing AWS CDK classes and AWS Construct Library modules in your applications. Following these guidelines will help make your code consistent with other AWS CDK applications as well as easier to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>require()</code>, not ES6-style <code>import</code> directives. Older versions of Node.js do not support ES6 imports, so using the older syntax is more widely compatible. (If you really want to use ES6 imports, use <a href="https://www.npmjs.com/package/esm">esm</a> to ensure your project is compatible with all supported versions of Node.js.)</p>
</li>
<li>
<p>Generally, import individual classes from <code>aws-cdk-lib</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { App, Stack } = require('aws-cdk-lib');</code></pre>
</div>
</div>
</li>
<li>
<p>If you need many classes from <code>aws-cdk-lib</code>, you may use a namespace alias of <code>cdk</code> instead of importing the individual classes. Avoid doing both.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');</code></pre>
</div>
</div>
</li>
<li>
<p>Generally, import AWS Construct Libraries using short namespace aliases.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { s3 } = require('aws-cdk-lib/aws-s3');</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-javascript-dependencies">5.6.5. Managing dependencies in  <code class="noloc">JavaScript</code></h4>
<div class="paragraph">
<p>In  <code class="noloc">JavaScript</code> CDK projects, dependencies are specified in the  <code class="path">package.json</code> file in the project&#8217;s main directory. The core AWS CDK modules are in a single  <code class="noloc">NPM</code> package called  <code class="path">aws-cdk-lib</code>.</p>
</div>
<div class="paragraph">
<p>When you install a package using <strong class="command">npm install</strong>, NPM records the package in <code class="path">package.json</code> for you.</p>
</div>
<div class="paragraph">
<p>If you prefer, you may use Yarn in place of NPM. However, the CDK does not support Yarn&#8217;s plug-and-play mode, which is default mode in Yarn 2. Add the following to your project&#8217;s <code class="path">.yarnrc.yml</code> file to turn off this feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">nodeLinker: node-modules</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-javascript-dependencies-apps">CDK applications</h5>
<div class="paragraph">
<p>The following is an example  <code class="path">package.json</code> file generated by the  <code>cdk init --language typescript</code> command. The file generated for JavaScript is similar, only without the TypeScript-related entries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "my-package",
  "version": "0.1.0",
  "bin": {
    "my-package": "bin/my-package.js"
  },
  "scripts": {
    "build": "tsc",
    "watch": "tsc -w",
    "test": "jest",
    "cdk": "cdk"
  },
  "devDependencies": {
    "@types/jest": "^26.0.10",
    "@types/node": "10.17.27",
    "jest": "^26.4.2",
    "ts-jest": "^26.2.0",
    "aws-cdk": "2.16.0",
    "ts-node": "^9.0.0",
    "typescript": "~3.9.7"
  },
  "dependencies": {
    "aws-cdk-lib": "2.16.0",
    "constructs": "^10.0.0",
    "source-map-support": "^0.5.16"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For deployable CDK apps,  <code>aws-cdk-lib</code> must be specified in the <code>dependencies</code> section of <code class="path">package.json</code>. You can use a caret (^) version number specifier to indicate that you will accept later versions than the one specified as long as they are within the same major version.</p>
</div>
<div class="paragraph">
<p>For experimental constructs, specify exact versions for the alpha construct library modules, which have APIs that may change. Do not use ^ or ~ since later versions of these modules may bring API changes that can break your app.</p>
</div>
<div class="paragraph">
<p>Specify versions of libraries and tools needed to test your app (for example, the <code class="path">jest</code> testing framework) in the  <code>devDependencies</code> section of <code class="path">package.json</code>. Optionally, use ^ to specify that later compatible versions are acceptable.</p>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-javascript-dependencies-libraries">Third-party construct libraries</h5>
<div class="paragraph">
<p>If you&#8217;re developing a construct library, specify its dependencies using a combination of the  <code>peerDependencies</code> and <code>devDependencies</code> sections, as shown in the following example <code class="path">package.json</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "my-package",
  "version": "0.0.1",
  "peerDependencies": {
    "aws-cdk-lib": "^2.14.0",
    "@aws-cdk/aws-appsync-alpha": "2.10.0-alpha",
    "constructs": "^10.0.0"
  },
  "devDependencies": {
    "aws-cdk-lib": "2.14.0",
    "@aws-cdk/aws-appsync-alpha": "2.10.0-alpha",
    "constructs": "10.0.0",
    "jsii": "^1.50.0",
    "aws-cdk": "^2.14.0"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code>peerDependencies</code>, use a caret (^) to specify the lowest version of <code>aws-cdk-lib</code> that your library works with. This maximizes the compatibility of your library with a range of CDK versions. Specify exact versions for alpha construct library modules, which have APIs that may change. Using <code>peerDependencies</code> makes sure that there is only one copy of all CDK libraries in the <code class="path">node_modules</code> tree.</p>
</div>
<div class="paragraph">
<p>In <code>devDependencies</code>, specify the tools and libraries you need for testing, optionally with ^ to indicate that later compatible versions are acceptable. Specify exactly (without ^ or ~) the lowest versions of <code>aws-cdk-lib</code> and other CDK packages that you advertise your library be compatible with. This practice makes sure that your tests run against those versions. This way, if you inadvertently use a feature found only in newer versions, your tests can catch it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>peerDependencies</code> are installed automatically only by NPM 7 and later. If you are using NPM 6 or earlier, or if you are using Yarn, you must include the dependencies of your dependencies in <code>devDependencies</code>. Otherwise, they won&#8217;t be installed, and you will receive a warning about unresolved peer dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-javascript-dependencies-install">Installing and updating dependencies</h5>
<div class="paragraph">
<p>Run the following command to install your project&#8217;s dependencies.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NPM</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># Install the latest version of everything that matches the ranges in 'package.json'
npm install

# Install the same exact dependency versions as recorded in 'package-lock.json'
npm ci</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Yarn</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># Install the latest version of everything that matches the ranges in 'package.json'
yarn upgrade

# Install the same exact dependency versions as recorded in 'yarn.lock'
yarn install --frozen-lockfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>To update the installed modules, the preceding  <strong class="command">npm install</strong> and <strong class="command">yarn upgrade</strong> commands can be used. Either command updates the packages in <code class="path">node_modules</code> to the latest versions that satisfy the rules in  <code class="path">package.json</code>. However, they do not update  <code class="path">package.json</code> itself, which you might want to do to set a new minimum version. If you host your package on GitHub, you can configure  <a href="https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/configuring-dependabot-version-updates">Dependabot version updates</a> to automatically update <code class="path">package.json</code>. Alternatively, use  <a href="https://www.npmjs.com/package/npm-check-updates">npm-check-updates</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By design, when you install or update dependencies, NPM and Yarn choose the latest version of every package that satisfies the requirements specified in <code class="path">package.json</code>. There is always a risk that these versions may be broken (either accidentally or intentionally). Test thoroughly after updating your project&#8217;s dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javascript-cdk-idioms">5.6.6. AWS CDK idioms in JavaScript</h4>
<div class="sect4">
<h5 id="javascript-props">Props</h5>
<div class="paragraph">
<p>All AWS Construct Library classes are instantiated using three arguments: the  <em>scope</em> in which the construct is being defined (its parent in the construct tree), an <em>id</em>, and <em>props</em>, a bundle of key/value pairs that the construct uses to configure the AWS resources it creates. Other classes and methods also use the "bundle of attributes" pattern for arguments.</p>
</div>
<div class="paragraph">
<p>Using an IDE or editor that has good JavaScript autocomplete will help avoid misspelling property names. If a construct is expecting an <code>encryptionKeys</code> property, and you spell it <code>encryptionkeys</code>, when instantiating the construct, you haven&#8217;t passed the value you intended. This can cause an error at synthesis time if the property is required, or cause the property to be silently ignored if it is optional. In the latter case, you may get a default behavior you intended to override. Take special care here.</p>
</div>
<div class="paragraph">
<p>When subclassing an AWS Construct Library class (or overriding a method that takes a props-like argument), you may want to accept additional properties for your own use. These values will be ignored by the parent class or overridden method, because they are never accessed in that code, so you can generally pass on all the props you received.</p>
</div>
<div class="paragraph">
<p>A future release of the AWS CDK could coincidentally add a new property with a name you used for your own property. Passing the value you receive up the inheritance chain can then cause unexpected behavior. It&#8217;s safer to pass a shallow copy of the props you received with your property removed or set to <code>undefined</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">super(scope, name, {...props, encryptionKeys: undefined});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, name your properties so that it is clear that they belong to your construct. This way, it is unlikely they will collide with properties in future AWS CDK releases. If there are many of them, use a single appropriately-named object to hold them.</p>
</div>
</div>
<div class="sect4">
<h5 id="javascript-missing-values">Missing values</h5>
<div class="paragraph">
<p>Missing values in an object (such as  <code>props</code>) have the value <code>undefined</code> in JavaScript. The usual techniques apply for dealing with these. For example, a common idiom for accessing a property of a value that may be undefined is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// a may be undefined, but if it is not, it may have an attribute b
// c is undefined if a is undefined, OR if a doesn't have an attribute b
let c = a &amp;&amp; a.b;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if  <code>a</code> could have some other "falsy" value besides <code>undefined</code>, it is better to make the test more explicit. Here, we&#8217;ll take advantage of the fact that <code>null</code> and <code>undefined</code> are equal to test for them both at once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">let c = a == null ? a : a.b;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Node.js 14.0 and later support new operators that can simplify the handling of undefined values. For more information, see the  <a href="https://github.com/tc39/proposal-optional-chaining/blob/master/README.md">optional chaining</a> and <a href="https://github.com/tc39/proposal-nullish-coalescing/blob/master/README.md">nullish coalescing</a> proposals.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javascript-using-typescript-examples">5.6.7. Using TypeScript examples with JavaScript</h4>
<div class="paragraph">
<p><a href="https://www.typescriptlang.org/">TypeScript</a> is the language we use to develop the AWS CDK, and it was the first language supported for developing applications, so many available AWS CDK code examples are written in TypeScript. These code examples can be a good resource for JavaScript developers; you just need to remove the TypeScript-specific parts of the code.</p>
</div>
<div class="paragraph">
<p>TypeScript snippets often use the newer ECMAScript <code>import</code> and <code>export</code> keywords to import objects from other modules and to declare the objects to be made available outside the current module. Node.js has just begun supporting these keywords in its latest releases. Depending on the version of Node.js you&#8217;re using (or wish to support), you might rewrite imports and exports to use the older syntax.</p>
</div>
<div class="paragraph">
<p>Imports can be replaced with calls to the <code>require()</code> function.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Bucket, BucketPolicy } from 'aws-cdk-lib/aws-s3';</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const { Bucket, BucketPolicy } = require('aws-cdk-lib/aws-s3');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exports can be assigned to the  <code>module.exports</code> object.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export class Stack1 extends cdk.Stack {
  // ...
}

export class Stack2 extends cdk.Stack {
  // ...
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class Stack1 extends cdk.Stack {
  // ...
}

class Stack2 extends cdk.Stack {
  // ...
}

module.exports = { Stack1, Stack2 }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An alternative to using the old-style imports and exports is to use the  <a href="https://www.npmjs.com/package/esm">esm</a> module.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you&#8217;ve got the imports and exports sorted, you can dig into the actual code. You may run into these commonly-used TypeScript features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type annotations</p>
</li>
<li>
<p>Interface definitions</p>
</li>
<li>
<p>Type conversions/casts</p>
</li>
<li>
<p>Access modifiers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type annotations may be provided for variables, class members, function parameters, and function return types. For variables, parameters, and members, types are specified by following the identifier with a colon and the type. Function return values follow the function signature and consist of a colon and the type.</p>
</div>
<div class="paragraph">
<p>To convert type-annotated code to JavaScript, remove the colon and the type. Class members must have some value in JavaScript; set them to <code>undefined</code> if they only have a type annotation in TypeScript.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var encrypted: boolean = true;

class myStack extends cdk.Stack {
    bucket: s3.Bucket;
    // ...
}

function makeEnv(account: string, region: string) : object {
    // ...
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var encrypted = true;

class myStack extends cdk.Stack {
    bucket = undefined;
    // ...
}

function makeEnv(account, region) {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In TypeScript, interfaces are used to give bundles of required and optional properties, and their types, a name. You can then use the interface name as a type annotation. TypeScript will make sure that the object you use as, for example, an argument to a function has the required properties of the right types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">interface myFuncProps {
    code: lambda.Code,
    handler?: string
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JavaScript does not have an interface feature, so once you&#8217;ve removed the type annotations, delete the interface declarations entirely.</p>
</div>
<div class="paragraph">
<p>When a function or method returns a general-purpose type (such as <code>object</code>), but you want to treat that value as a more specific child type to access properties or methods that are not part of the more general type&#8217;s interface, TypeScript lets you <em>cast</em> the value using <code>as</code> followed by a type or interface name. JavaScript doesn&#8217;t support (or need) this, so simply remove <code>as</code> and the following identifier. A less-common cast syntax is to use a type name in brackets, <code>&lt;LikeThis&gt;</code>; these casts, too, must be removed.</p>
</div>
<div class="paragraph">
<p>Finally, TypeScript supports the access modifiers <code>public</code>, <code>protected</code>, and <code>private</code> for members of classes. All class members in JavaScript are public. Simply remove these modifiers wherever you see them.</p>
</div>
<div class="paragraph">
<p>Knowing how to identify and remove these TypeScript features goes a long way toward adapting short TypeScript snippets to JavaScript. But it may be impractical to convert longer TypeScript examples in this fashion, since they are more likely to use other TypeScript features. For these situations, we recommend <a href="https://github.com/alangpierce/sucrase">Sucrase</a>. Sucrase won&#8217;t complain if code uses an undefined variable, for example, as <code>tsc</code> would. If it is syntactically valid, then with few exceptions, Sucrase can translate it to JavaScript. This makes it particularly valuable for converting snippets that may not be runnable on their own.</p>
</div>
</div>
<div class="sect3">
<h4 id="javascript-to-typescript">5.6.8. Migrating to TypeScript</h4>
<div class="paragraph">
<p>Many JavaScript developers move to  <a href="https://www.typescriptlang.org/">TypeScript</a> as their projects get larger and more complex. TypeScript is a superset of JavaScript&#8212;&#8203;all JavaScript code is valid TypeScript code, so no changes to your code are required&#8212;&#8203;and it is also a supported AWS CDK language. Type annotations and other TypeScript features are optional and can be added to your AWS CDK app as you find value in them. TypeScript also gives you early access to new JavaScript features, such as optional chaining and nullish coalescing, before they&#8217;re finalized&#8212;&#8203;and without requiring that you upgrade Node.js.</p>
</div>
<div class="paragraph">
<p>TypeScript&#8217;s "shape-based" interfaces, which define bundles of required and optional properties (and their types) within an object, allow common mistakes to be caught while you&#8217;re writing the code, and make it easier for your IDE to provide robust autocomplete and other real-time coding advice.</p>
</div>
<div class="paragraph">
<p>Coding in TypeScript does involve an additional step: compiling your app with the TypeScript compiler, <code>tsc</code>. For typical AWS CDK apps, compilation requires a few seconds at most.</p>
</div>
<div class="paragraph">
<p>The easiest way to migrate an existing JavaScript AWS CDK app to TypeScript is to create a new TypeScript project using <code>cdk init app --language typescript</code>, then copy your source files (and any other necessary files, such as assets like AWS Lambda function source code) to the new project. Rename your JavaScript files to end in <code>.ts</code> and begin developing in TypeScript.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="work-with-cdk-python">5.7. Working with the AWS CDK in Python</h3>
<div class="paragraph">
<p>Python is a fully-supported client language for the AWS Cloud Development Kit (AWS CDK) and is considered stable. Working with the AWS CDK in Python uses familiar tools, including the standard Python implementation (CPython), virtual environments with  <code>virtualenv</code>, and the Python package installer <code>pip</code>. The modules comprising the AWS Construct Library are distributed via <a href="https://pypi.org/search/?q=aws-cdk">pypi.org</a>. The Python version of the AWS CDK even uses Python-style identifiers (for example, <code>snake_case</code> method names).</p>
</div>
<div class="paragraph">
<p>You can use any editor or IDE. Many AWS CDK developers use <a href="https://code.visualstudio.com/">Visual Studio Code</a> (or its open-source equivalent <a href="https://vscodium.com/">VSCodium</a>), which has good support for Python via an <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">official extension</a>. The IDLE editor included with Python will suffice to get started. The Python modules for the AWS CDK do have type hints, which are useful for a linting tool or an IDE that supports type validation.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="python-prerequisites">5.7.1. Get started with <code class="noloc">Python</code></h4>
<div class="paragraph">
<p>To work with the AWS CDK, you must have an AWS account and credentials and have installed Node.js and the AWS CDK Toolkit. See  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>Python AWS CDK applications require Python 3.6 or later. If you don&#8217;t already have it installed, <a href="https://www.python.org/downloads/">download a compatible version</a> for your operating system at <a href="https://www.python.org/">python.org</a>. If you run Linux, your system may have come with a compatible version, or you may install it using your distro&#8217;s package manager (<code>yum</code>, <code>apt</code>, etc.). Mac users may be interested in <a href="https://brew.sh/">Homebrew</a>, a Linux-style package manager for macOS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Third-party language deprecation: language version is only supported until its EOL (End Of Life) shared by the vendor or community and is subject to change with prior notice.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Python package installer,  <code>pip</code>, and virtual environment manager, <code>virtualenv</code>, are also required. Windows installations of compatible Python versions include these tools. On Linux, <code>pip</code> and <code>virtualenv</code> may be provided as separate packages in your package manager. Alternatively, you may install them with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m ensurepip --upgrade
python -m pip install --upgrade pip
python -m pip install --upgrade virtualenv</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you encounter a permission error, run the above commands with the  <code>--user</code> flag so that the modules are installed in your user directory, or use <code>sudo</code> to obtain the permissions to install the modules system-wide.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is common for Linux distros to use the executable name <code>python3</code> for Python 3.x, and have <code>python</code> refer to a Python 2.x installation. Some distros have an optional package you can install that makes the <code>python</code> command refer to Python 3. Failing that, you can adjust the command used to run your application by editing <code>cdk.json</code> in the project&#8217;s main directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Windows, you may want to invoke Python (and  <strong class="command">pip</strong>) using the <strong class="command">py</strong> executable, the <a href="https://docs.python.org/3/using/windows.html#launcher">&gt;Python launcher for Windows</a>. Among other things, the launcher allows you to easily specify which installed version of Python you want to use.</p>
</div>
<div class="paragraph">
<p>If typing <strong class="command">python</strong> at the command line results in a message about installing Python from the Windows Store, even after installing a Windows version of Python, open Windows' Manage App Execution Aliases settings panel and turn off the two App Installer entries for Python.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="python-newproject">5.7.2. Creating a project</h4>
<div class="paragraph">
<p>You create a new AWS CDK project by invoking  <code>cdk init</code> in an empty directory. Use the <code>--language</code> option and specify <code>python</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-project
cd my-project
cdk init app --language python</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cdk init</code> uses the name of the project folder to name various elements of the project, including classes, subfolders, and files. Hyphens in the folder name are converted to underscores. However, the name should otherwise follow the form of a Python identifier; for example, it should not start with a number or contain spaces.</p>
</div>
<div class="paragraph">
<p>To work with the new project, activate its virtual environment. This allows the project&#8217;s dependencies to be installed locally in the project folder, instead of globally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">source .venv/bin/activate</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may recognize this as the Mac/Linux command to activate a virtual environment. The Python templates include a batch file,  <code>source.bat</code>, that allows the same command to be used on Windows. The traditional Windows command, <code>.\venv\Scripts\activate</code>, works, too.</p>
</div>
<div class="paragraph">
<p>If you initialized your AWS CDK project using CDK Toolkit v1.70.0 or earlier, your virtual environment is in the <code class="path">.env</code> directory instead of  <code class="path">.venv</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Activate the project&#8217;s virtual environment whenever you start working on it. Otherwise, you won&#8217;t have access to the modules installed there, and modules you install will go in the Python global module directory (or will result in a permission error).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After activating your virtual environment for the first time, install the app&#8217;s standard dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m pip install -r requirements.txt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="python-managemodules">5.7.3. Managing AWS Construct Library modules</h4>
<div class="paragraph">
<p>Use the Python package installer,  <strong class="command">pip</strong>, to install and update AWS Construct Library modules for use by your apps, as well as other packages you need. <strong class="command">pip</strong> also installs the dependencies for those modules automatically. If your system does not recognize <strong class="command">pip</strong> as a standalone command, invoke <strong class="command">pip</strong> as a Python module, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m pip PIP-COMMAND</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most AWS CDK constructs are in  <code>aws-cdk-lib</code>. Experimental modules are in separate modules named like <code>aws-cdk.[replaceable]</code>SERVICE-NAME<code>.alpha</code>. The service name includes an <em>aws</em> prefix. If you&#8217;re unsure of a module&#8217;s name, <a href="https://pypi.org/search/?q=aws-cdk">search for it at PyPI</a>. For example, the command below installs the AWS CodeStar library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m pip install aws-cdk.aws-codestar-alpha</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some services' constructs are in more than one namespace. For example, besides  <code>aws-cdk.aws-route53</code>, there are three additional Amazon Route 53 namespaces, named <code>aws-route53-targets</code>, <code>aws-route53-patterns</code>, and <code>aws-route53resolver</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/cdk/api/v2/python/index.html">Python edition of the CDK API Reference</a> also shows the package names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The names used for importing AWS Construct Library modules into your Python code look like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_s3 as s3
import aws_cdk.aws_lambda as lambda_</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend the following practices when importing AWS CDK classes and AWS Construct Library modules in your applications. Following these guidelines will help make your code consistent with other AWS CDK applications as well as easier to understand.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generally, import individual classes from top-level <code>aws_cdk</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import App, Construct</code></pre>
</div>
</div>
</li>
<li>
<p>If you need many classes from the <code>aws_cdk</code>, you may use a namespace alias of <code>cdk</code> instead of importing individual classes. Avoid doing both.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk</code></pre>
</div>
</div>
</li>
<li>
<p>Generally, import AWS Construct Libraries using short namespace aliases.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_s3 as s3</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After installing a module, update your project&#8217;s  <code class="path">requirements.txt</code> file, which lists your project&#8217;s dependencies. It is best to do this manually rather than using  <code>pip freeze</code>. <code>pip freeze</code> captures the current versions of all modules installed in your Python virtual environment, which can be useful when bundling up a project to be run elsewhere.</p>
</div>
<div class="paragraph">
<p>Usually, though, your <code class="path">requirements.txt</code> should list only top-level dependencies (modules that your app depends on directly) and not the dependencies of those libraries. This strategy makes updating your dependencies simpler.</p>
</div>
<div class="paragraph">
<p>You can edit <code class="path">requirements.txt</code> to allow upgrades; simply replace the  <code>==</code> preceding a version number with <code>~=</code> to allow upgrades to a higher compatible version, or remove the version requirement entirely to specify the latest available version of the module.</p>
</div>
<div class="paragraph">
<p>With <code class="path">requirements.txt</code> edited appropriately to allow upgrades, issue this command to upgrade your project&#8217;s installed modules at any time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">pip install --upgrade -r requirements.txt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-python-dependencies">5.7.4. Managing dependencies in  <code class="noloc">Python</code></h4>
<div class="paragraph">
<p>In Python, you specify dependencies by putting them in  <code class="path">requirements.txt</code> for applications or  <code class="path">setup.py</code> for construct libraries. Dependencies are then managed with the PIP tool. PIP is invoked in one of the following ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">pip command options
python -m pip command options</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <strong class="command">python -m pip</strong> invocation works on most systems; <strong class="command">pip</strong> requires that PIP&#8217;s executable be on the system path. If <strong class="command">pip</strong> doesn&#8217;t work, try replacing it with <strong class="command">python -m pip</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong class="command">cdk init --language python</strong> command creates a virtual environment for your new project. This lets each project have its own versions of dependencies, and also a basic <code class="path">requirements.txt</code> file. You must activate this virtual environment by running  <strong class="command">source .venv/bin/activate</strong> each time you begin working with the project. On Windows, run <strong class="command">.\venv\Scripts\activate</strong> instead</p>
</div>
<div class="sect4">
<h5 id="work-with-cdk-python-dependencies-apps">CDK applications</h5>
<div class="paragraph">
<p>The following is an example  <code class="path">requirements.txt</code> file. Because PIP does not have a dependency-locking feature, we recommend that you use the == operator to specify exact versions for all dependencies, as shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws-cdk-lib==2.14.0
aws-cdk.aws-appsync-alpha==2.10.0a0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Installing a module with  <strong class="command">pip install</strong> does not automatically add it to <code class="path">requirements.txt</code>. You must do that yourself. If you want to upgrade to a later version of a dependency, edit its version number in  <code class="path">requirements.txt</code>.</p>
</div>
<div class="paragraph">
<p>To install or update your project&#8217;s dependencies after creating or editing <code class="path">requirements.txt</code>, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The  <strong class="command">pip freeze</strong> command outputs the versions of all installed dependencies in a format that can be written to a text file. This can be used as a requirements file with <code class="path">pip install -r</code>. This file is convenient for pinning all dependencies (including transitive ones) to the exact versions that you tested with. To avoid problems when upgrading packages later, use a separate file for this, such as  <code class="path">freeze.txt</code> (not  <code class="path">requirements.txt</code>). Then, regenerate it when you upgrade your project&#8217;s dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="work-with-cdk-python-dependencies-libraries">Third-party construct libraries</h5>
<div class="paragraph">
<p>In libraries, dependencies are specified in  <code class="path">setup.py</code>, so that transitive dependencies are automatically downloaded when the package is consumed by an application. Otherwise, every application that wants to use your package needs to copy your dependencies into their  <code class="path">requirements.txt</code>. An example  <code class="path">setup.py</code> is shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from setuptools import setup

setup(
  name='my-package',
  version='0.0.1',
  install_requires=[
    'aws-cdk-lib==2.14.0',
  ],
  ...
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To work on the package for development, create or activate a virtual environment, then run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m pip install -e .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although PIP automatically installs transitive dependencies, there can only be one installed copy of any one package. The version that is specified highest in the dependency tree is selected; applications always have the last word in what version of packages get installed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="python-cdk-idioms">5.7.5. AWS CDK idioms in Python</h4>
<div class="sect4">
<h5 id="python-keywords">Language conflicts</h5>
<div class="paragraph">
<p>In Python,  <code>lambda</code> is a language keyword, so you cannot use it as a name for the AWS Lambda construct library module or Lambda functions. The Python convention for such conflicts is to use a trailing underscore, as in <code>lambda_</code>, in the variable name.</p>
</div>
<div class="paragraph">
<p>By convention, the second argument to AWS CDK constructs is named <code>id</code>. When writing your own stacks and constructs, calling a parameter <code>id</code> "shadows" the Python built-in function <code>id()</code>, which returns an object&#8217;s unique identifier. This function isn&#8217;t used very often, but if you should happen to need it in your construct, rename the argument, for example <code>construct_id</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="python-props">Arguments and properties</h5>
<div class="paragraph">
<p>All AWS Construct Library classes are instantiated using three arguments: the  <em>scope</em> in which the construct is being defined (its parent in the construct tree), an <em>id</em>, and <em>props</em>, a bundle of key/value pairs that the construct uses to configure the resources it creates. Other classes and methods also use the "bundle of attributes" pattern for arguments.</p>
</div>
<div class="paragraph">
<p><em>scope</em> and <em>id</em> should always be passed as positional arguments, not keyword arguments, because their names change if the construct accepts a property named <em>scope</em> or <em>id</em>.</p>
</div>
<div class="paragraph">
<p>In Python, props are expressed as keyword arguments. If an argument contains nested data structures, these are expressed using a class which takes its own keyword arguments at instantiation. The same pattern is applied to other method calls that take a structured argument.</p>
</div>
<div class="paragraph">
<p>For example, in a Amazon S3 bucket&#8217;s <code>add_lifecycle_rule</code> method, the <code>transitions</code> property is a list of <code>Transition</code> instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket.add_lifecycle_rule(
  transitions=[
    Transition(
      storage_class=StorageClass.GLACIER,
      transition_after=Duration.days(10)
    )
  ]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When extending a class or overriding a method, you may want to accept additional arguments for your own purposes that are not understood by the parent class. In this case you should accept the arguments you don&#8217;t care about using the  <code><strong>*kwargs</code> idiom, and use keyword-only arguments to accept the arguments you&#8217;re interested in. When calling the parent&#8217;s constructor or the overridden method, pass only the arguments it is expecting (often just <code>\</strong>*kwargs</code>). Passing arguments that the parent class or method doesn&#8217;t expect results in an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>class MyConstruct(Construct):
    def __init__(self, id, *, MyProperty=42, **kwargs):
        super().__init__(self, id, **kwargs)
        # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A future release of the AWS CDK could coincidentally add a new property with a name you used for your own property. This won&#8217;t cause any technical issues for users of your construct or method (since your property isn&#8217;t passed "up the chain," the parent class or overridden method will simply use a default value) but it may cause confusion. You can avoid this potential problem by naming your properties so they clearly belong to your construct. If there are many new properties, bundle them into an appropriately-named class and pass it as a single keyword argument.</p>
</div>
</div>
<div class="sect4">
<h5 id="python-missing-values">Missing values</h5>
<div class="paragraph">
<p>The AWS CDK uses  <code>None</code> to represent missing or undefined values. When working with <code>\**kwargs</code>, use the dictionary&#8217;s <code>get()</code> method to provide a default value if a property is not provided. Avoid using <code>kwargs[&#8230;&#8203;]</code>, as this raises <code>KeyError</code> for missing values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">encrypted = kwargs.get("encrypted")         # None if no property "encrypted" exists
encrypted = kwargs.get("encrypted", False)  # specify default of False if property is missing</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some AWS CDK methods (such as  <code>tryGetContext()</code> to get a runtime context value) may return <code>None</code>, which you will need to check explicitly.</p>
</div>
</div>
<div class="sect4">
<h5 id="python-interfaces">Using interfaces</h5>
<div class="paragraph">
<p>Python doesn&#8217;t have an interface feature as some other languages do, though it does have  <a href="https://docs.python.org/3/library/abc.html">abstract base classes</a>, which are similar. (If you&#8217;re not familiar with interfaces, Wikipedia has <a href="https://en.wikipedia.org/wiki/Interface_(computing)#In_object-oriented_languages">a good introduction</a>.) TypeScript, the language in which the AWS CDK is implemented, does provide interfaces, and constructs and other AWS CDK objects often require an object that adheres to a particular interface, rather than inheriting from a particular class. So the AWS CDK provides its own interface feature as part of the <a href="https://github.com/aws/jsii">JSII</a> layer.</p>
</div>
<div class="paragraph">
<p>To indicate that a class implements a particular interface, you can use the <code>@jsii.implements</code> decorator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import IAspect, IConstruct
import jsii

@jsii.implements(IAspect)
class MyAspect():
    def visit(self, node: IConstruct) -&gt; None:
        print("Visited", node.node.path)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="python-type-pitfalls">Type pitfalls</h5>
<div class="paragraph">
<p>Python uses dynamic typing, where all variables may refer to a value of any type. Parameters and return values may be annotated with types, but these are "hints" and are not enforced. This means that in Python, it is easy to pass the incorrect type of value to a AWS CDK construct. Instead of getting a type error during build, as you would from a statically-typed language, you may instead get a runtime error when the JSII layer (which translates between Python and the AWS CDK&#8217;s TypeScript core) is unable to deal with the unexpected type.</p>
</div>
<div class="paragraph">
<p>In our experience, the type errors Python programmers make tend to fall into these categories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Passing a single value where a construct expects a container (Python list or dictionary) or vice versa.</p>
</li>
<li>
<p>Passing a value of a type associated with a layer 1 (<code>CfnXxxxxx</code>) construct to a L2 or L3 construct, or vice versa.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The AWS CDK Python modules do include type annotations, so you can use tools that support them to help with types. If you are not using an IDE that supports these, such as  <a href="https://www.jetbrains.com/pycharm/">PyCharm</a>, you might want to call the <a href="http://mypy-lang.org/">MyPy</a> type validator as a step in your build process. There are also runtime type checkers that can improve error messages for type-related errors.</p>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="work-with-cdk-java">5.8. Working with the AWS CDK in Java</h3>
<div class="paragraph">
<p>Java is a fully-supported client language for the AWS CDK and is considered stable. You can develop AWS CDK applications in Java using familiar tools, including the JDK (Oracle&#8217;s, or an OpenJDK distribution such as Amazon Corretto) and Apache Maven.</p>
</div>
<div class="paragraph">
<p>The AWS CDK supports Java 8 and later. We recommend using the latest version you can, however, because later versions of the language include improvements that are particularly convenient for developing AWS CDK applications. For example, Java 9 introduces the <code>Map.of()</code> method (a convenient way to declare hashmaps that would be written as object literals in TypeScript). Java 10 introduces local type inference using the <code>var</code> keyword.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most code examples in this Developer Guide work with Java 8. A few examples use <code>Map.of()</code>; these examples include comments noting that they require Java 9.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use any text editor, or a Java IDE that can read Maven projects, to work on your AWS CDK apps. We provide  <a href="https://www.eclipse.org/downloads/">Eclipse</a> hints in this Guide, but IntelliJ IDEA, NetBeans, and other IDEs can import Maven projects and can be used for developing AWS CDK applications in Java.</p>
</div>
<div class="paragraph">
<p>It is possible to write AWS CDK applications in JVM-hosted languages other than Java (for example, Kotlin, Groovy, Clojure, or Scala), but the experience may not be particularly idiomatic, and we are unable to provide any support for these languages.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="java-prerequisites">5.8.1. Get started with <code class="noloc">Java</code></h4>
<div class="paragraph">
<p>To work with the AWS CDK, you must have an AWS account and credentials and have installed Node.js and the AWS CDK Toolkit. See  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>Java AWS CDK applications require Java 8 (v1.8) or later. We recommend <a href="https://aws.amazon.com/corretto/">Amazon Corretto</a>, but you can use any OpenJDK distribution or <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Oracle&#8217;s JDK</a>. You will also need <a href="https://maven.apache.org/download.cgi">Apache Maven</a> 3.5 or later. You can also use tools such as Gradle, but the application skeletons generated by the AWS CDK Toolkit are Maven projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Third-party language deprecation: language version is only supported until its EOL (End Of Life) shared by the vendor or community and is subject to change with prior notice.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-newproject">5.8.2. Creating a project</h4>
<div class="paragraph">
<p>You create a new AWS CDK project by invoking  <code>cdk init</code> in an empty directory. Use the <code>--language</code> option and specify <code>java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-project
cd my-project
cdk init app --language java</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cdk init</code> uses the name of the project folder to name various elements of the project, including classes, subfolders, and files. Hyphens in the folder name are converted to underscores. However, the name should otherwise follow the form of a Java identifier; for example, it should not start with a number or contain spaces.</p>
</div>
<div class="paragraph">
<p>The resulting project includes a reference to the <code>software.amazon.awscdk</code> Maven package. It and its dependencies are automatically installed by Maven.</p>
</div>
<div class="paragraph">
<p>If you are using an IDE, you can now open or import the project. In Eclipse, for example, choose <strong>File</strong> &gt;  <strong>Import</strong> &gt;  <strong>Maven</strong> &gt;  <strong>Existing Maven Projects</strong>. Make sure that the project settings are set to use Java 8 (1.8).</p>
</div>
</div>
<div class="sect3">
<h4 id="java-managemodules">5.8.3. Managing AWS Construct Library modules</h4>
<div class="paragraph">
<p>Use Maven to install AWS Construct Library packages, which are in the group  <code>software.amazon.awscdk</code>. Most constructs are in the artifact <code>aws-cdk-lib</code>, which is added to new Java projects by default. Modules for services whose higher-level CDK support is still being developed are in separate "experimental" packages, named with a short version (no AWS or Amazon prefix) of their service&#8217;s name. <a href="https://search.maven.org/search?q=software.amazon.awscdk">Search the Maven Central Repository</a> to find the names of all AWS CDK and AWS Construct Module libraries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/cdk/api/v2/java/index.html">Java edition of the CDK API Reference</a> also shows the package names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some services' AWS Construct Library support is in more than one namespace. For example, Amazon Route 53 has its functionality divided into  <code>software.amazon.awscdk.route53</code>, <code>route53-patterns</code>, <code>route53resolver</code>, and <code>route53-targets</code>.</p>
</div>
<div class="paragraph">
<p>The main AWS CDK package is imported in Java code as <code>software.amazon.awscdk</code>. Modules for the various services in the AWS Construct Library live under <code>software.amazon.awscdk.services</code> and are named similarly to their Maven package name. For example, the Amazon S3 module&#8217;s namespace is <code>software.amazon.awscdk.services.s3</code>.</p>
</div>
<div class="paragraph">
<p>We recommend writing a separate Java <code>import</code> statement for each AWS Construct Library class you use in each of your Java source files, and avoiding wildcard imports. You can always use a type&#8217;s fully-qualified name (including its namespace) without an <code>import</code> statement.</p>
</div>
<div class="paragraph">
<p>If your application depends on an experimental package, edit your project&#8217;s <code class="path">pom.xml</code> and add a new  <code>&lt;dependency&gt;</code> element in the <code>&lt;dependencies&gt;</code> container. For example, the following <code>&lt;dependency&gt;</code> element specifies the CodeStar experimental construct library module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">&lt;dependency&gt;
    &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
    &lt;artifactId&gt;codestar-alpha&lt;/artifactId&gt;
    &lt;version&gt;2.0.0-alpha.10&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use a Java IDE, it probably has features for managing Maven dependencies. We recommend editing  <code class="path">pom.xml</code> directly, however, unless you are absolutely sure the IDE&#8217;s functionality matches what you&#8217;d do by hand.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-java-dependencies">5.8.4. Managing dependencies in  <code class="noloc">Java</code></h4>
<div class="paragraph">
<p>In Java, dependencies are specified in  <code class="path">pom.xml</code> and installed using Maven. The  <code>&lt;dependencies&gt;</code> container includes a <code>&lt;dependency&gt;</code> element for each package. Following is a section of <code>pom.xml</code> for a typical CDK Java app.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
        &lt;artifactId&gt;aws-cdk-lib&lt;/artifactId&gt;
        &lt;version&gt;2.14.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
        &lt;artifactId&gt;appsync-alpha&lt;/artifactId&gt;
        &lt;version&gt;2.10.0-alpha.0&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Many Java IDEs have integrated Maven support and visual  <code class="path">pom.xml</code> editors, which you may find convenient for managing dependencies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Maven does not support dependency locking. Although it&#8217;s possible to specify version ranges in  <code class="path">pom.xml</code>, we recommend you always use exact versions to keep your builds repeatable.</p>
</div>
<div class="paragraph">
<p>Maven automatically installs transitive dependencies, but there can only be one installed copy of each package. The version that is specified highest in the POM tree is selected; applications always have the last word in what version of packages get installed.</p>
</div>
<div class="paragraph">
<p>Maven automatically installs or updates your dependencies whenever you build (<strong class="command">mvn compile</strong>) or package (<strong class="command">mvn package</strong>) your project. The CDK Toolkit does this automatically every time you run it, so generally there is no need to manually invoke Maven.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-cdk-idioms">5.8.5. AWS CDK idioms in Java</h4>
<div class="sect4">
<h5 id="java-props">Props</h5>
<div class="paragraph">
<p>All AWS Construct Library classes are instantiated using three arguments: the  <em>scope</em> in which the construct is being defined (its parent in the construct tree), an <em>id</em>, and <em>props</em>, a bundle of key/value pairs that the construct uses to configure the resources it creates. Other classes and methods also use the "bundle of attributes" pattern for arguments.</p>
</div>
<div class="paragraph">
<p>In Java, props are expressed using the <a href="https://en.wikipedia.org/wiki/Builder_pattern">Builder pattern</a>. Each construct type has a corresponding props type; for example, the <code>Bucket</code> construct (which represents an Amazon S3 bucket) takes as its props an instance of <code>BucketProps</code>.</p>
</div>
<div class="paragraph">
<p>The <code>BucketProps</code> class (like every AWS Construct Library props class) has an inner class called <code>Builder</code>. The <code>BucketProps.Builder</code> type offers methods to set the various properties of a <code>BucketProps</code> instance. Each method returns the <code>Builder</code> instance, so the method calls can be chained to set multiple properties. At the end of the chain, you call <code>build()</code> to actually produce the <code>BucketProps</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = new Bucket(this, "amzn-s3-demo-bucket", new BucketProps.Builder()
                           .versioned(true)
                           .encryption(BucketEncryption.KMS_MANAGED)
                           .build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Constructs, and other classes that take a props-like object as their final argument, offer a shortcut. The class has a  <code>Builder</code> of its own that instantiates it and its props object in one step. This way, you don&#8217;t need to explicitly instantiate (for example) both <code>BucketProps</code> and a <code>Bucket</code>--and you don&#8217;t need an import for the props type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = Bucket.Builder.create(this, "amzn-s3-demo-bucket")
                           .versioned(true)
                           .encryption(BucketEncryption.KMS_MANAGED)
                           .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deriving your own construct from an existing construct, you may want to accept additional properties. We recommend that you follow these builder patterns. However, this isn&#8217;t as simple as subclassing a construct class. You must provide the moving parts of the two new  <code>Builder</code> classes yourself. You may prefer to simply have your construct accept one or more additional arguments. You should provide additional constructors when an argument is optional.</p>
</div>
</div>
<div class="sect4">
<h5 id="java-generic-structures">Generic structures</h5>
<div class="paragraph">
<p>In some APIs, the AWS CDK uses JavaScript arrays or untyped objects as input to a method. (See, for example, AWS CodeBuild&#8217;s  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_codebuild.BuildSpec.html#static-fromwbrobjectvalue">BuildSpec.fromObject()</a> method.) In Java, these objects are represented as <code>java.util.Map&lt;String, Object&gt;</code>. In cases where the values are all strings, you can use <code>Map&lt;String, String&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Java does not provide a way to write literals for such containers like some other languages do. In Java 9 and later, you can use <a href="https://docs.oracle.com/javase/9/docs/api/java/util/Map.html#ofEntries-java.util.Map.Entry&#8230;&#8203;-">java.util.Map.of()</a> to conveniently define maps of up to ten entries inline with one of these calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">java.util.Map.of(
    "base-directory", "dist",
    "files", "LambdaStack.template.json"
 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create maps with more than ten entries, use  <a href="https://docs.oracle.com/javase/9/docs/api/java/util/Map.html#ofEntries-java.util.Map.Entry&#8230;&#8203;-">java.util.Map.ofEntries()</a>.</p>
</div>
<div class="paragraph">
<p>If you are using Java 8, you could provide your own methods similar to to these.</p>
</div>
<div class="paragraph">
<p>JavaScript arrays are represented as <code>List&lt;Object&gt;</code> or <code>List&lt;String&gt;</code> in Java. The method <code>java.util.Arrays.asList</code> is convenient for defining short <code>List</code>s.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;String&gt; cmds = Arrays.asList("cd lambda", "npm install", "npm install typescript")</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-missing-values">Missing values</h5>
<div class="paragraph">
<p>In Java, missing values in AWS CDK objects such as props are represented by  <code>null</code>. You must explicitly test any value that could be <code>null</code> to make sure it contains a value before doing anything with it. Java does not have "syntactic sugar" to help handle null values as some other languages do. You may find Apache ObjectUtil&#8217;s <a href="https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/ObjectUtils.html#defaultIfNull-T-T-">defaultIfNull</a> and <a href="https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/ObjectUtils.html#firstNonNull-T&#8230;&#8203;-">firstNonNull</a> useful in some situations. Alternatively, write your own static helper methods to make it easier to handle potentially null values and make your code more readable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-running">5.8.6. Build and run CDK applications</h4>
<div class="paragraph">
<p>The AWS CDK automatically compiles your app before running it. However, it can be useful to build your app manually to check for errors and to run tests. You can do this in your IDE (for example, press Control-B in Eclipse) or by issuing  <code>mvn compile</code> at a command prompt while in your project&#8217;s root directory.</p>
</div>
<div class="paragraph">
<p>Run any tests you&#8217;ve written by running <code>mvn test</code> at a command prompt.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="work-with-cdk-csharp">5.9. Working with the AWS CDK in C#</h3>
<div class="paragraph">
<p>.NET is a fully-supported client language for the AWS CDK and is considered stable. C# is the main .NET language for which we provide examples and support. You can choose to write AWS CDK applications in other .NET languages, such as Visual Basic or F#, but AWS offers limited support for using these languages with the CDK.</p>
</div>
<div class="paragraph">
<p>You can develop AWS CDK applications in C# using familiar tools including Visual Studio, Visual Studio Code, the <code>dotnet</code> command, and the NuGet package manager. The modules comprising the AWS Construct Library are distributed via <a href="https://www.nuget.org/packages?q=amazon.cdk.aws">nuget.org</a>.</p>
</div>
<div class="paragraph">
<p>We suggest using <a href="https://visualstudio.microsoft.com/downloads/">Visual Studio 2019</a> (any edition) on Windows to develop AWS CDK apps in C#.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="csharp-prerequisites">5.9.1. Get started with <code class="noloc">C#</code></h4>
<div class="paragraph">
<p>To work with the AWS CDK, you must have an AWS account and credentials and have installed Node.js and the AWS CDK Toolkit. See  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>C# AWS CDK applications require .NET Core v3.1 or later, available <a href="https://dotnet.microsoft.com/download/dotnet-core/3.1">here</a>.</p>
</div>
<div class="paragraph">
<p>The .NET toolchain includes <code>dotnet</code>, a command-line tool for building and running .NET applications and managing NuGet packages. Even if you work mainly in Visual Studio, this command can be useful for batch operations and for installing AWS Construct Library packages.</p>
</div>
</div>
<div class="sect3">
<h4 id="csharp-newproject">5.9.2. Creating a project</h4>
<div class="paragraph">
<p>You create a new AWS CDK project by invoking  <code>cdk init</code> in an empty directory. Use the <code>--language</code> option and specify <code>csharp</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-project
cd my-project
cdk init app --language csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cdk init</code> uses the name of the project folder to name various elements of the project, including classes, subfolders, and files. Hyphens in the folder name are converted to underscores. However, the name should otherwise follow the form of a C# identifier; for example, it should not start with a number or contain spaces.</p>
</div>
<div class="paragraph">
<p>The resulting project includes a reference to the <code>Amazon.CDK.Lib</code> NuGet package. It and its dependencies are installed automatically by NuGet.</p>
</div>
</div>
<div class="sect3">
<h4 id="csharp-managemodules">5.9.3. Managing AWS Construct Library modules</h4>
<div class="paragraph">
<p>The .NET ecosystem uses the NuGet package manager. The main CDK package, which contains the core classes and all stable service constructs, is  <code class="path">Amazon.CDK.Lib</code>. Experimental modules, where new functionality is under active development, are named like  <code class="path">Amazon.CDK.AWS.SERVICE-NAME.Alpha</code>, where the service name is a short name without an AWS or Amazon prefix. For example, the NuGet package name for the AWS IoT module is  <code class="path">Amazon.CDK.AWS.IoT.Alpha</code>. If you can&#8217;t find a package you want,  <a href="https://www.nuget.org/packages?q=amazon.cdk.aws">search Nuget.org</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/cdk/api/latest/dotnet/api/index.html">.NET edition of the CDK API Reference</a> also shows the package names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some services' AWS Construct Library support is in more than one module. For example, AWS IoT has a second module named  <code class="path">Amazon.CDK.AWS.IoT.Actions.Alpha</code>.</p>
</div>
<div class="paragraph">
<p>The AWS CDK&#8217;s main module, which you&#8217;ll need in most AWS CDK apps, is imported in C# code as <code>Amazon.CDK</code>. Modules for the various services in the AWS Construct Library live under <code>Amazon.CDK.AWS</code>. For example, the Amazon S3 module&#8217;s namespace is <code>Amazon.CDK.AWS.S3</code>.</p>
</div>
<div class="paragraph">
<p>We recommend writing C# <code>using</code> directives for the CDK core constructs and for each AWS service you use in each of your C# source files. You may find it convenient to use an alias for a namespace or type to help resolve name conflicts. You can always use a type&#8217;s fully-qualfiied name (including its namespace) without a <code>using</code> statement.</p>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-csharp-dependencies">5.9.4. Managing dependencies in  <code class="noloc">C#</code></h4>
<div class="paragraph">
<p>In C# AWS CDK apps, you manage dependencies using NuGet. NuGet has four standard, mostly equivalent interfaces. Use the one that suits your needs and working style. You can also use compatible tools, such as  <a href="https://fsprojects.github.io/Paket/">Paket</a> or <a href="https://www.myget.org/">MyGet</a> or even edit the <code class="path">.csproj</code> file directly.</p>
</div>
<div class="paragraph">
<p>NuGet does not let you specify version ranges for dependencies. Every dependency is pinned to a specific version.</p>
</div>
<div class="paragraph">
<p>After updating your dependencies, Visual Studio will use NuGet to retrieve the specified versions of each package the next time you build. If you are not using Visual Studio, use the <strong class="command">dotnet restore</strong> command to update your dependencies.</p>
</div>
<div class="sect4">
<h5 id="manage-dependencies-csharp-direct-edit">Editing the project file directly</h5>
<div class="paragraph">
<p>Your project&#8217;s  <code class="path">.csproj</code> file contains an  <code>&lt;ItemGroup&gt;</code> container that lists your dependencies as <code>&lt;PackageReference</code> elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;ItemGroup&gt;
    &lt;PackageReference Include="Amazon.CDK.Lib" Version="2.14.0" /&gt;
    &lt;PackageReference Include="Constructs" Version="%constructs-version%" /&gt;
&lt;/ItemGroup&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="manage-dependencies-csharp-vs-nuget-gui">The Visual Studio NuGet GUI</h5>
<div class="paragraph">
<p>Visual Studio&#8217;s NuGet tools are accessible from  <strong>Tools</strong> &gt;  <strong>NuGet Package Manager</strong> &gt;  <strong>Manage NuGet Packages for Solution</strong>. Use the  <strong>Browse</strong> tab to find the AWS Construct Library packages you want to install. You can choose the desired version, including prerelease versions of your modules, and add them to any of the open projects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All AWS Construct Library modules deemed "experimental" (see <a href="#versioning">AWS CDK versioning</a>) are flagged as prerelease in NuGet and have an <code>alpha</code> name suffix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/visual-studio-nuget.png" alt="NuGet package manager showing Amazon CDKAWS alpha packages for various services.">
</div>
</div>
<div class="paragraph">
<p>Look on the  <strong>Updates</strong> page to install new versions of your packages.</p>
</div>
</div>
<div class="sect4">
<h5 id="manage-dependencies-csharp-vs-nuget-console">The NuGet console</h5>
<div class="paragraph">
<p>The NuGet console is a PowerShell-based interface to NuGet that works in the context of a Visual Studio project. You can open it in Visual Studio by choosing  <strong>Tools</strong> &gt;  <strong>NuGet Package Manager</strong> &gt;  <strong>Package Manager Console</strong>. For more information about using this tool, see  <a href="https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-powershell">Install and Manage Packages with the Package Manager Console in Visual Studio</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="manage-dependencies-csharp-vs-dotnet-command">The  <code>dotnet</code> command</h5>
<div class="paragraph">
<p>The  <code>dotnet</code> command is the primary command line tool for working with Visual Studio C# projects. You can invoke it from any Windows command prompt. Among its many capabilities, <code>dotnet</code> can add NuGet dependencies to a Visual Studio project.</p>
</div>
<div class="paragraph">
<p>Assuming you&#8217;re in the same directory as the Visual Studio project (<code class="path">.csproj</code>) file, issue a command like the following to install a package. Because the main CDK library is included when you create a project, you only need to explicitly install experimental modules. Experimental modules require you to specify an explicit version number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">dotnet add package Amazon.CDK.AWS.IoT.Alpha -v VERSION-NUMBER</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can issue the command from another directory. To do so, include the path to the project file, or to the directory that contains it, after the  <code>add</code> keyword. The following example assumes that you are in your AWS CDK project&#8217;s main directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">dotnet add src/PROJECT-DIR package Amazon.CDK.AWS.IoT.Alpha -v VERSION-NUMBER</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install a specific version of a package, include the  <code>-v</code> flag and the desired version.</p>
</div>
<div class="paragraph">
<p>To update a package, issue the same <code>dotnet add</code> command you used to install it. For experimental modules, again, you must specify an explicit version number.</p>
</div>
<div class="paragraph">
<p>For more information about managing packages using the <code>dotnet</code> command, see <a href="https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-dotnet-cli">Install and Manage Packages Using the dotnet CLI</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="manage-dependencies-csharp-vs-nuget-command">The  <code>nuget</code> command</h5>
<div class="paragraph">
<p>The  <code>nuget</code> command line tool can install and update NuGet packages. However, it requires your Visual Studio project to be set up differently from the way <code>cdk init</code> sets up projects. (Technical details: <code>nuget</code> works with <code>Packages.config</code> projects, while <code>cdk init</code> creates a newer-style <code>PackageReference</code> project.)</p>
</div>
<div class="paragraph">
<p>We do not recommend the use of the <code>nuget</code> tool with AWS CDK projects created by <code>cdk init</code>. If you are using another type of project, and want to use <code>nuget</code>, see the <a href="https://docs.microsoft.com/en-us/nuget/reference/nuget-exe-cli-reference">NuGet CLI Reference</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="csharp-cdk-idioms">5.9.5. AWS CDK idioms in C#</h4>
<div class="sect4">
<h5 id="csharp-props">Props</h5>
<div class="paragraph">
<p>All AWS Construct Library classes are instantiated using three arguments: the  <em>scope</em> in which the construct is being defined (its parent in the construct tree), an <em>id</em>, and <em>props</em>, a bundle of key/value pairs that the construct uses to configure the resources it creates. Other classes and methods also use the "bundle of attributes" pattern for arguments.</p>
</div>
<div class="paragraph">
<p>In C#, props are expressed using a props type. In idiomatic C# fashion, we can use an object initializer to set the various properties. Here we&#8217;re creating an Amazon S3 bucket using the <code>Bucket</code> construct; its corresponding props type is <code>BucketProps</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new Bucket(this, "amzn-s3-demo-bucket", new BucketProps {
    Versioned = true
});</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Add the package  <code>Amazon.JSII.Analyzers</code> to your project to get required-values checking in your props definitions inside Visual Studio.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When extending a class or overriding a method, you may want to accept additional props for your own purposes that are not understood by the parent class. To do this, subclass the appropriate props type and add the new attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// extend BucketProps for use with MimeBucket
class MimeBucketProps : BucketProps {
    public string MimeType { get; set; }
}

// hypothetical bucket that enforces MIME type of objects inside it
class MimeBucket : Bucket {
     public MimeBucket( readonly Construct scope, readonly string id, readonly MimeBucketProps props=null) : base(scope, id, props) {
         // ...
     }
}

// instantiate our MimeBucket class
var bucket = new MimeBucket(this, "amzn-s3-demo-bucket", new MimeBucketProps {
    Versioned = true,
    MimeType = "image/jpeg"
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>When calling the parent class&#8217;s initializer or overridden method, you can generally pass the props you received. The new type is compatible with its parent, and extra props you added are ignored.</p>
</div>
<div class="paragraph">
<p>A future release of the AWS CDK could coincidentally add a new property with a name you used for your own property. This won&#8217;t cause any technical issues using your construct or method (since your property isn&#8217;t passed "up the chain," the parent class or overridden method will simply use a default value) but it may cause confusion for your construct&#8217;s users. You can avoid this potential problem by naming your properties so they clearly belong to your construct. If there are many new properties, bundle them into an appropriately-named class and pass them as a single property.</p>
</div>
</div>
<div class="sect4">
<h5 id="csharp-generic-structures">Generic structures</h5>
<div class="paragraph">
<p>In some APIs, the AWS CDK uses JavaScript arrays or untyped objects as input to a method. (See, for example, AWS CodeBuild&#8217;s  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_codebuild.BuildSpec.html">BuildSpec.fromObject()</a> method.) In C#, these objects are represented as <code>System.Collections.Generic.Dictionary&lt;String, Object&gt;</code>. In cases where the values are all strings, you can use <code>Dictionary&lt;String, String&gt;</code>. JavaScript arrays are represented as <code>object[]</code> or <code>string[]</code> array types in C#.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might define short aliases to make it easier to work with these specific dictionary types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using StringDict = System.Collections.Generic.Dictionary&lt;string, string&gt;;
using ObjectDict = System.Collections.Generic.Dictionary&lt;string, object&gt;;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="csharp-missing-values">Missing values</h5>
<div class="paragraph">
<p>In C#, missing values in AWS CDK objects such as props are represented by  <code>null</code>. The null-conditional member access operator <code>?.</code> and the null coalescing operator <code>??</code> are convenient for working with these values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// mimeType is null if props is null or if props.MimeType is null
string mimeType = props?.MimeType;

// mimeType defaults to text/plain. either props or props.MimeType can be null
string MimeType = props?.MimeType ?? "text/plain";</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="csharp-running">5.9.6. Build and run CDK appliations</h4>
<div class="paragraph">
<p>The AWS CDK automatically compiles your app before running it. However, it can be useful to build your app manually to check for errors and run tests. You can do this by pressing F6 in Visual Studio or by issuing  <code>dotnet build src</code> from the command line, where <code>src</code> is the directory in your project directory that contains the Visual Studio Solution (<code class="path">.sln</code>) file.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="work-with-cdk-go">5.10. Working with the AWS CDK in Go</h3>
<div class="paragraph">
<p>Go is a fully-supported client language for the AWS Cloud Development Kit (AWS CDK) and is considered stable. Working with the AWS CDK in Go uses familiar tools. The Go version of the AWS CDK even uses Go-style identifiers.</p>
</div>
<div class="paragraph">
<p>Unlike the other languages the CDK supports, Go is not a traditional object-oriented programming language. Go uses composition where other languages often leverage inheritance. We have tried to employ idiomatic Go approaches as much as possible, but there are places where the CDK may differ.</p>
</div>
<div class="paragraph">
<p>This topic provides guidance when working with the AWS CDK in Go. See the <a href="https://aws.amazon.com/blogs/developer/getting-started-with-the-aws-cloud-development-kit-and-go/">announcement blog post</a> for a walkthrough of a simple Go project for the AWS CDK.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="go-prerequisites">5.10.1. Get started with <code class="noloc">Go</code></h4>
<div class="paragraph">
<p>To work with the AWS CDK, you must have an AWS account and credentials and have installed Node.js and the AWS CDK Toolkit. See  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>The Go bindings for the AWS CDK use the standard <a href="https://golang.org/dl/">Go toolchain</a>, v1.18 or later. You can use the editor of your choice.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Third-party language deprecation: language version is only supported until its EOL (End Of Life) shared by the vendor or community and is subject to change with prior notice.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="go-newproject">5.10.2. Creating a project</h4>
<div class="paragraph">
<p>You create a new AWS CDK project by invoking  <code>cdk init</code> in an empty directory. Use the <code>--language</code> option and specify <code>go</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-project
cd my-project
cdk init app --language go</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cdk init</code> uses the name of the project folder to name various elements of the project, including classes, subfolders, and files. Hyphens in the folder name are converted to underscores. However, the name should otherwise follow the form of a Go identifier; for example, it should not start with a number or contain spaces.</p>
</div>
<div class="paragraph">
<p>The resulting project includes a reference to the core AWS CDK Go module, <code class="path">github.com/aws/aws-cdk-go/awscdk/v2</code>, in  <code class="path">go.mod</code>. Issue  <strong class="command">go get</strong> to install this and other required modules.</p>
</div>
</div>
<div class="sect3">
<h4 id="go-managemodules">5.10.3. Managing AWS Construct Library modules</h4>
<div class="paragraph">
<p>In most AWS CDK documentation and examples, the word "module" is often used to refer to AWS Construct Library modules, one or more per AWS service, which differs from idiomatic Go usage of the term. The CDK Construct Library is provided in one Go module with the individual Construct Library modules, which support the various AWS services, provided as Go packages within that module.</p>
</div>
<div class="paragraph">
<p>Some services' AWS Construct Library support is in more than one Construct Library module (Go package). For example, Amazon Route 53 has three Construct Library modules in addition to the main <code>awsroute53</code> package, named <code>awsroute53patterns</code>, <code>awsroute53resolver</code>, and <code>awsroute53targets</code>.</p>
</div>
<div class="paragraph">
<p>The AWS CDK&#8217;s core package, which you&#8217;ll need in most AWS CDK apps, is imported in Go code as <code>github.com/aws/aws-cdk-go/awscdk/v2</code>. Packages for the various services in the AWS Construct Library live under <code>github.com/aws/aws-cdk-go/awscdk/v2</code>. For example, the Amazon S3 module&#8217;s namespace is <code>github.com/aws/aws-cdk-go/awscdk/v2/awss3</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import (
        "github.com/aws/aws-cdk-go/awscdk/v2/awss3"
        // ...
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have imported the Construct Library modules (Go packages) for the services you want to use in your app, you access constructs in that module using, for example,  <code>awss3.Bucket</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-go-dependencies">5.10.4. Managing dependencies in  <code class="noloc">Go</code></h4>
<div class="paragraph">
<p>In Go, dependencies versions are defined in  <code class="path">go.mod</code>. The default  <code class="path">go.mod</code> is similar to the one shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">module my-package

go 1.16

require (
  github.com/aws/aws-cdk-go/awscdk/v2 v2.16.0
  github.com/aws/constructs-go/constructs/v10 v10.0.5
  github.com/aws/jsii-runtime-go v1.29.0
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Package names (modules, in Go parlance) are specified by URL with the required version number appended. Go&#8217;s module system does not support version ranges.</p>
</div>
<div class="paragraph">
<p>Issue the <strong class="command">go get</strong> command to install all required modules and update <code class="path">go.mod</code>. To see a list of available updates for your dependencies, issue  <strong class="command">go list -m -u all</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="go-cdk-idioms">5.10.5. AWS CDK idioms in Go</h4>
<div class="sect4">
<h5 id="go-naming">Field and method names</h5>
<div class="paragraph">
<p>Field and method names use camel casing (<code>likeThis</code>) in TypeScript, the CDK&#8217;s language of origin. In Go, these follow Go conventions, so are Pascal-cased (<code>LikeThis</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="go-cdk-jsii-close">Cleaning up</h5>
<div class="paragraph">
<p>In your  <code>main</code> method, use <code>defer jsii.Close()</code> to make sure your CDK app cleans up after itself.</p>
</div>
</div>
<div class="sect4">
<h5 id="go-missing-values">Missing values and pointer conversion</h5>
<div class="paragraph">
<p>In Go, missing values in AWS CDK objects such as property bundles are represented by  <code>nil</code>. Go doesn&#8217;t have nullable types; the only type that can contain <code>nil</code> is a pointer. To allow values to be optional, then, all CDK properties, arguments, and return values are pointers, even for primitive types. This applies to required values as well as optional ones, so if a required value later becomes optional, no breaking change in type is needed.</p>
</div>
<div class="paragraph">
<p>When passing literal values or expressions, use the following helper functions to create pointers to the values.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jsii.String</code></p>
</li>
<li>
<p><code>jsii.Number</code></p>
</li>
<li>
<p><code>jsii.Bool</code></p>
</li>
<li>
<p><code>jsii.Time</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For consistency, we recommend that you use pointers similarly when defining your own constructs, even though it may seem more convenient to, for example, receive your construct&#8217;s  <code>id</code> as a string rather than a pointer to a string.</p>
</div>
<div class="paragraph">
<p>When dealing with optional AWS CDK values, including primitive values as well as complex types, you should explicitly test pointers to make sure they are not <code>nil</code> before doing anything with them. Go does not have "syntactic sugar" to help handle empty or missing values as some other languages do. However, required values in property bundles and similar structures are guaranteed to exist (construction fails otherwise), so these values need not be <code>nil</code>-checked.</p>
</div>
</div>
<div class="sect4">
<h5 id="go-props">Constructs and Props</h5>
<div class="paragraph">
<p>Constructs, which represent one or more AWS resources and their associated attributes, are represented in Go as interfaces. For example,  <code>awss3.Bucket</code> is an interface. Every construct has a factory function, such as <code>awss3.NewBucket</code>, to return a struct that implements the corresponding interface.</p>
</div>
<div class="paragraph">
<p>All factory functions take three arguments: the <code>scope</code> in which the construct is being defined (its parent in the construct tree), an <code>id</code>, and <code>props</code>, a bundle of key/value pairs that the construct uses to configure the resources it creates. The "bundle of attributes" pattern is also used elsewhere in the AWS CDK.</p>
</div>
<div class="paragraph">
<p>In Go, props are represented by a specific struct type for each construct. For example, an <code>awss3.Bucket</code> takes a props argument of type <code>awss3.BucketProps</code>. Use a struct literal to write props arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">var bucket = awss3.NewBucket(stack, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.BucketProps{
    Versioned: jsii.Bool(true),
})</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="go-generic-structures">Generic structures</h5>
<div class="paragraph">
<p>In some places, the AWS CDK uses JavaScript arrays or untyped objects as input to a method. (See, for example, AWS CodeBuild&#8217;s  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_codebuild.BuildSpec.html#static-fromwbrobjectvalue">BuildSpec.fromObject()</a> method.) In Go, these objects are represented as slices and an empty interface, respectively.</p>
</div>
<div class="paragraph">
<p>The CDK provides variadic helper functions such as <code>jsii.Strings</code> for building slices containing primitive types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">jsii.Strings("One", "Two", "Three")</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="go-writing-constructs">Developing custom constructs</h5>
<div class="paragraph">
<p>In Go, it is usually more straightforward to write a new construct than to extend an existing one. First, define a new struct type, anonymously embedding one or more existing types if extension-like semantics are desired. Write methods for any new functionality you&#8217;re adding and the fields necessary to hold the data they need. Define a props interface if your construct needs one. Finally, write a factory function  <code>NewMyConstruct()</code> to return an instance of your construct.</p>
</div>
<div class="paragraph">
<p>If you are simply changing some default values on an existing construct or adding a simple behavior at instantiation, you don&#8217;t need all that plumbing. Instead, write a factory function that calls the factory function of the construct you&#8217;re "extending." In other CDK languages, for example, you might create a <code>TypedBucket</code> construct that enforces the type of objects in an Amazon S3 bucket by overriding the <code>s3.Bucket</code> type and, in your new type&#8217;s initializer, adding a bucket policy that allows only specified filename extensions to be added to the bucket. In Go, it is easier to simply write a <code>NewTypedBucket</code> that returns an <code>s3.Bucket</code> (instantiated using <code>s3.NewBucket</code>) to which you have added an appropriate bucket policy. No new construct type is necessary because the functionality is already available in the standard bucket construct; the new "construct" just provides a simpler way to configure it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="go-running">5.10.6. Building, synthesizing, and deploying</h4>
<div class="paragraph">
<p>The AWS CDK automatically compiles your app before running it. However, it can be useful to build your app manually to check for errors and to run tests. You can do this by issuing  <code>go build</code> at a command prompt while in your project&#8217;s root directory.</p>
</div>
<div class="paragraph">
<p>Run any tests you&#8217;ve written by running <code>go test</code> at a command prompt.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="best-practices">6. Best practices for developing and deploying cloud infrastructure with the AWS CDK</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the AWS CDK, developers or administrators can define their cloud infrastructure by using a supported programming language. CDK applications should be organized into logical units, such as API, database, and monitoring resources, and optionally have a pipeline for automated deployments. The logical units should be implemented as constructs including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Infrastructure (such as Amazon S3 buckets, Amazon RDS databases, or an Amazon VPC network)</p>
</li>
<li>
<p>Runtime code (such as AWS Lambda functions)</p>
</li>
<li>
<p>Configuration code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Stacks define the deployment model of these logical units. For a more detailed introduction to the concepts behind the CDK, see  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>The AWS CDK reflects careful consideration of the needs of our customers and internal teams and of the failure patterns that often arise during the deployment and ongoing maintenance of complex cloud applications. We discovered that failures are often related to "out-of-band" changes to an application that aren&#8217;t fully tested, such as configuration changes. Therefore, we developed the AWS CDK around a model in which your entire application is defined in code, not only business logic but also infrastructure and configuration. That way, proposed changes can be carefully reviewed, comprehensively tested in environments resembling production to varying degrees, and fully rolled back if something goes wrong.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/all-in-one.jpg" alt="Software development lifecycle icons representing infrastructure, application, source code, configuration, and deployment.">
</div>
</div>
<div class="paragraph">
<p>At deployment time, the AWS CDK synthesizes a cloud assembly that contains the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS CloudFormation templates that describe your infrastructure in all target environments</p>
</li>
<li>
<p>File assets that contain your runtime code and their supporting files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the CDK, every commit in your application&#8217;s main version control branch can represent a complete, consistent, deployable version of your application. Your application can then be deployed automatically whenever a change is made.</p>
</div>
<div class="paragraph">
<p>The philosophy behind the AWS CDK leads to our recommended best practices, which we have divided into four broad categories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#best-practices-organization">Organization best practices</a></p>
</li>
<li>
<p><a href="#best-practices-code">Coding best practices</a></p>
</li>
<li>
<p><a href="#best-practices-constructs">Construct best practices</a></p>
</li>
<li>
<p><a href="#best-practices-apps">Application best practices</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Also consider  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/best-practices.html">best practices for AWS CloudFormation</a> and the individual AWS services that you use, where applicable to CDK-defined infrastructure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="best-practices-organization">6.1. Organization best practices</h3>
<div class="paragraph">
<p>In the beginning stages of AWS CDK adoption, it&#8217;s important to consider how to set up your organization for success. It&#8217;s a best practice to have a team of experts responsible for training and guiding the rest of the company as they adopt the CDK. The size of this team might vary, from one or two people at a small company to a full-fledged Cloud Center of Excellence (CCoE) at a larger company. This team is responsible for setting standards and policies for cloud infrastructure at your company, and also for training and mentoring developers.</p>
</div>
<div class="paragraph">
<p>The CCoE might provide guidance on what programming languages should be used for cloud infrastructure. Details will vary from one organization to the next, but a good policy helps make sure that developers can understand and maintain the company&#8217;s cloud infrastructure.</p>
</div>
<div class="paragraph">
<p>The CCoE also creates a "landing zone" that defines your organizational units within AWS. A landing zone is a pre-configured, secure, scalable, multi-account AWS environment based on best practice blueprints. To tie together the services that make up your landing zone, you can use <a href="https://aws.amazon.com/controltower/">AWS Control Tower</a>, which configures and manages your entire multi-account system from a single user interface.</p>
</div>
<div class="paragraph">
<p>Development teams should be able to use their own accounts for testing and deploy new resources in these accounts as needed. Individual developers can treat these resources as extensions of their own development workstation. Using <a href="#cdk-pipeline">CDK Pipelines</a>, the AWS CDK applications can then be deployed via a CI/CD account to testing, integration, and production environments (each isolated in its own AWS Region or account). This is done by merging the developers' code into your organization&#8217;s canonical repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/best-practice-deploy-to-multiple-accounts.png" alt="Diagram showing deployment process from developer accounts to multiple target accounts via CI/CD pipeline.">
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-code">6.2. Coding best practices</h3>
<div class="paragraph">
<p>This section presents best practices for organizing your AWS CDK code. The following diagram shows the relationship between a team and that team&#8217;s code repositories, packages, applications, and construct libraries.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/code-organization.jpg" alt="Diagram showing team&#8217;s code organization: repository, package, CDK app or construct library.">
</div>
</div>
<div class="sect3">
<h4 id="best-practices-code-kiss">6.2.1. Start simple and add complexity only when you need it</h4>
<div class="paragraph">
<p>The guiding principle for most of our best practices is to keep things simple as possible&#8212;&#8203;but no simpler. Add complexity only when your requirements dictate a more complicated solution. With the AWS CDK, you can refactor your code as necessary to support new requirements. You don&#8217;t have to architect for all possible scenarios upfront.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-code-well-architected">6.2.2. Align with the AWS Well-Architected Framework</h4>
<div class="paragraph">
<p>The  <a href="https://aws.amazon.com/architecture/well-architected/">AWS Well-Architected</a> Framework defines a <em>component</em> as the code, configuration, and AWS resources that together deliver against a requirement. A component is often the unit of technical ownership, and is decoupled from other components. The term <em>workload</em> is used to identify a set of components that together deliver business value. A workload is usually the level of detail that business and technology leaders communicate about.</p>
</div>
<div class="paragraph">
<p>An AWS CDK application maps to a component as defined by the AWS Well-Architected Framework. AWS CDK apps are a mechanism to codify and deliver Well-Architected cloud application best practices. You can also create and share components as reusable code libraries through artifact repositories, such as AWS CodeArtifact.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-code-package">6.2.3. Every application starts with a single package in a single repository</h4>
<div class="paragraph">
<p>A single package is the entry point of your AWS CDK app. Here, you define how and where to deploy the different logical units of your application. You also define the CI/CD pipeline to deploy the application. The app&#8217;s constructs define the logical units of your solution.</p>
</div>
<div class="paragraph">
<p>Use additional packages for constructs that you use in more than one application. (Shared constructs should also have their own lifecycle and testing strategy.) Dependencies between packages in the same repository are managed by your repo&#8217;s build tooling.</p>
</div>
<div class="paragraph">
<p>Although it&#8217;s possible, we don&#8217;t recommend putting multiple applications in the same repository, especially when using automated deployment pipelines. Doing this increases the "blast radius" of changes during deployment. When there are multiple applications in a repository, changes to one application trigger deployment of the others (even if the others haven&#8217;t changed). Furthermore, a break in one application prevents the other applications from being deployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-code-repo">6.2.4. Move code into repositories based on code lifecycle or team ownership</h4>
<div class="paragraph">
<p>When packages begin to be used in multiple applications, move them to their own repository. This way, the packages can be referenced by application build systems that use them, and they can also be updated on cadences independent of the application lifecycles. However, at first it might make sense to put all shared constructs in one repository.</p>
</div>
<div class="paragraph">
<p>Also, move packages to their own repository when different teams are working on them. This helps enforce access control.</p>
</div>
<div class="paragraph">
<p>To consume packages across repository boundaries, you need a private package repository&#8212;&#8203;similar to NPM, PyPi, or Maven Central, but internal to your organization. You also need a release process that builds, tests, and publishes the package to the private package repository. <a href="https://docs.aws.amazon.com/codeartifact/latest/ug/">CodeArtifact</a> can host packages for most popular programming languages.</p>
</div>
<div class="paragraph">
<p>Dependencies on packages in the package repository are managed by your language&#8217;s package manager, such as NPM for TypeScript or JavaScript applications. Your package manager helps to make sure that builds are repeatable. It does this by recording the specific versions of every package that your application depends on. It also lets you upgrade those dependencies in a controlled manner.</p>
</div>
<div class="paragraph">
<p>Shared packages need a different testing strategy. For a single application, it might be good enough to deploy the application to a testing environment and confirm that it still works. But shared packages must be tested independently of the consuming application, as if they were being released to the public. (Your organization might choose to actually release some shared packages to the public.)</p>
</div>
<div class="paragraph">
<p>Keep in mind that a construct can be arbitrarily simple or complex. A <code>Bucket</code> is a construct, but <code>CameraShopWebsite</code> could be a construct, too.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-code-all">6.2.5. Infrastructure and runtime code live in the same package</h4>
<div class="paragraph">
<p>In addition to generating AWS CloudFormation templates for deploying infrastructure, the AWS CDK also bundles runtime assets like Lambda functions and Docker images and deploys them alongside your infrastructure. This makes it possible to combine the code that defines your infrastructure and the code that implements your runtime logic into a single construct. It&#8217;s a best practice to do this. These two kinds of code don&#8217;t need to live in separate repositories or even in separate packages.</p>
</div>
<div class="paragraph">
<p>To evolve the two kinds of code together, you can use a self-contained construct that completely describes a piece of functionality, including its infrastructure and logic. With a self-contained construct, you can test the two kinds of code in isolation, share and reuse the code across projects, and version all the code in sync.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-constructs">6.3. Construct best practices</h3>
<div class="paragraph">
<p>This section contains best practices for developing constructs. Constructs are reusable, composable modules that encapsulate resources. They&#8217;re the building blocks of AWS CDK apps.</p>
</div>
<div class="sect3">
<h4 id="best-practices-constructs-model">6.3.1. Model with constructs, deploy with stacks</h4>
<div class="paragraph">
<p>Stacks are the unit of deployment: everything in a stack is deployed together. So when building your application&#8217;s higher-level logical units from multiple AWS resources, represent each logical unit as a  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs.Construct.html">Construct</a>, not as a <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a>. Use stacks only to describe how your constructs should be composed and connected for your various deployment scenarios.</p>
</div>
<div class="paragraph">
<p>For example, if one of your logical units is a website, the constructs that make it up (such as an Amazon S3 bucket, API Gateway, Lambda functions, or Amazon RDS tables) should be composed into a single high-level construct. Then that construct should be instantiated in one or more stacks for deployment.</p>
</div>
<div class="paragraph">
<p>By using constructs for building and stacks for deploying, you improve reuse potential of your infrastructure and give yourself more flexibility in how it&#8217;s deployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-constructs-config">6.3.2. Configure with properties and methods, not environment variables</h4>
<div class="paragraph">
<p>Environment variable lookups inside constructs and stacks are a common anti-pattern. Both constructs and stacks should accept a properties object to allow for full configurability completely in code. Doing otherwise introduces a dependency on the machine that the code will run on, which creates yet more configuration information that you have to track and manage.</p>
</div>
<div class="paragraph">
<p>In general, environment variable lookups should be limited to the top level of an AWS CDK app. They should also be used to pass in information that&#8217;s needed for running in a development environment. For more information, see <a href="#environments">Environments for the AWS CDK</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-constructs-test">6.3.3. Unit test your infrastructure</h4>
<div class="paragraph">
<p>To consistently run a full suite of unit tests at build time in all environments, avoid network lookups during synthesis and model all your production stages in code. (These best practices are covered later.) If any single commit always results in the same generated template, you can trust the unit tests that you write to confirm that the generated templates look the way you expect. For more information, see  <a href="#testing">Test AWS CDK applications</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-constructs-logicalid">6.3.4. Don&#8217;t change the logical ID of stateful resources</h4>
<div class="paragraph">
<p>Changing the logical ID of a resource results in the resource being replaced with a new one at the next deployment. For stateful resources like databases and S3 buckets, or persistent infrastructure like an Amazon VPC, this is seldom what you want. Be careful about any refactoring of your AWS CDK code that could cause the ID to change. Write unit tests that assert that the logical IDs of your stateful resources remain static. The logical ID is derived from the  <code>id</code> you specify when you instantiate the construct, and the construct&#8217;s position in the construct tree. For more information, see <a href="#identifiers-logical-ids">Logical IDs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-constructs-compliance">6.3.5. Constructs aren&#8217;t enough for compliance</h4>
<div class="paragraph">
<p>Many enterprise customers write their own wrappers for L2 constructs (the "curated" constructs that represent individual AWS resources with built-in sane defaults and best practices). These wrappers enforce security best practices such as static encryption and specific IAM policies. For example, you might create a  <code>MyCompanyBucket</code> that you then use in your applications in place of the usual Amazon S3 <code>Bucket</code> construct. This pattern is useful for surfacing security guidance early in the software development lifecycle, but don&#8217;t rely on it as the sole means of enforcement.</p>
</div>
<div class="paragraph">
<p>Instead, use AWS features such as <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html">service control policies</a> and <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html">permission boundaries</a> to enforce your security guardrails at the organization level. Use <a href="#aspects">Aspects and the AWS CDK</a> or tools like <a href="https://github.com/aws-cloudformation/cloudformation-guard">CloudFormation Guard</a> to make assertions about the security properties of infrastructure elements before deployment. Use AWS CDK for what it does best.</p>
</div>
<div class="paragraph">
<p>Finally, keep in mind that writing your own "L2+" constructs might prevent your developers from taking advantage of AWS CDK packages such as <a href="https://docs.aws.amazon.com/solutions/latest/constructs/welcome.html">AWS Solutions Constructs</a> or third-party constructs from Construct Hub. These packages are typically built on standard AWS CDK constructs and won&#8217;t be able to use your wrapper constructs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best-practices-apps">6.4. Application best practices</h3>
<div class="paragraph">
<p>In this section we discuss how to write your AWS CDK applications, combining constructs to define how your AWS resources are connected.</p>
</div>
<div class="sect3">
<h4 id="best-practices-apps-synth">6.4.1. Make decisions at synthesis time</h4>
<div class="paragraph">
<p>Although AWS CloudFormation lets you make decisions at deployment time (using  <code>Conditions</code>, <code>{ Fn::If }</code>, and <code>Parameters</code>), and the AWS CDK gives you some access to these mechanisms, we recommend against using them. The types of values that you can use and the types of operations you can perform on them are limited compared to what&#8217;s available in a general-purpose programming language.</p>
</div>
<div class="paragraph">
<p>Instead, try to make all decisions, such as which construct to instantiate, in your AWS CDK application by using your programming language&#8217;s <code>if</code> statements and other features. For example, a common CDK idiom, iterating over a list and instantiating a construct with values from each item in the list, simply isn&#8217;t possible using AWS CloudFormation expressions.</p>
</div>
<div class="paragraph">
<p>Treat AWS CloudFormation as an implementation detail that the AWS CDK uses for robust cloud deployments, not as a language target. You&#8217;re not writing AWS CloudFormation templates in TypeScript or Python, you&#8217;re writing CDK code that happens to use CloudFormation for deployment.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-names">6.4.2. Use generated resource names, not physical names</h4>
<div class="paragraph">
<p>Names are a precious resource. Each name can only be used once. Therefore, if you hardcode a table name or bucket name into your infrastructure and application, you can&#8217;t deploy that piece of infrastructure twice in the same account. (The name we&#8217;re talking about here is the name specified by, for example, the  <code>bucketName</code> property on an Amazon S3 bucket construct.)</p>
</div>
<div class="paragraph">
<p>What&#8217;s worse, you can&#8217;t make changes to the resource that require it to be replaced. If a property can only be set at resource creation, such as the <code>KeySchema</code> of an Amazon DynamoDB table, then that property is immutable. Changing this property requires a new resource. However, the new resource must have the same name in order to be a true replacement. But it can&#8217;t have the same name while the existing resource is still using that name.</p>
</div>
<div class="paragraph">
<p>A better approach is to specify as few names as possible. If you omit resource names, the AWS CDK will generate them for you in a way that won&#8217;t cause problems. Suppose you have a table as a resource. You can then pass the generated table name as an environment variable into your AWS Lambda function. In your AWS CDK application, you can reference the table name as <code>table.tableName</code>. Alternatively, you can generate a configuration file on your Amazon EC2 instance on startup, or write the actual table name to the AWS Systems Manager Parameter Store so your application can read it from there.</p>
</div>
<div class="paragraph">
<p>If the place you need it is another AWS CDK stack, that&#8217;s even more straightforward. Supposing that one stack defines the resource and another stack needs to use it, the following applies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the two stacks are in the same AWS CDK app, pass a reference between the two stacks. For example, save a reference to the resource&#8217;s construct as an attribute of the defining stack (<code>this.stack.uploadBucket = amzn-s3-demo-bucket</code>). Then, pass that attribute to the constructor of the stack that needs the resource.</p>
</li>
<li>
<p>When the two stacks are in different AWS CDK apps, use a static <code>from</code> method to use an externally defined resource based on its ARN, name, or other attributes. (For example, use <code>Table.fromArn()</code> for a DynamoDB table). Use the <code>CfnOutput</code> construct to print the ARN or other required value in the output of <code>cdk deploy</code>, or look in the AWS Management Console. Alternatively, the second app can read the CloudFormation template generated by the first app and retrieve that value from the <code>Outputs</code> section.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-removal-logs">6.4.3. Define removal policies and log retention</h4>
<div class="paragraph">
<p>The AWS CDK attempts to keep you from losing data by defaulting to policies that retain everything you create. For example, the default removal policy on resources that contain data (such as Amazon S3 buckets and database tables) is not to delete the resource when it is removed from the stack. Instead, the resource is orphaned from the stack. Similarly, the CDK&#8217;s default is to retain all logs forever. In production environments, these defaults can quickly result in the storage of large amounts of data that you don&#8217;t actually need, and a corresponding AWS bill.</p>
</div>
<div class="paragraph">
<p>Consider carefully what you want these policies to be for each production resource and specify them accordingly. Use <a href="#aspects">Aspects and the AWS CDK</a> to validate the removal and logging policies in your stack.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-separate">6.4.4. Separate your application into multiple stacks as dictated by deployment requirements</h4>
<div class="paragraph">
<p>There is no hard and fast rule to how many stacks your application needs. You&#8217;ll usually end up basing the decision on your deployment patterns. Keep in mind the following guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s typically more straightforward to keep as many resources in the same stack as possible, so keep them together unless you know you want them separated.</p>
</li>
<li>
<p>Consider keeping stateful resources (like databases) in a separate stack from stateless resources. You can then turn on termination protection on the stateful stack. This way, you can freely destroy or create multiple copies of the stateless stack without risk of data loss.</p>
</li>
<li>
<p>Stateful resources are more sensitive to construct renaming&#8212;&#8203;renaming leads to resource replacement. Therefore, don&#8217;t nest stateful resources inside constructs that are likely to be moved around or renamed (unless the state can be rebuilt if lost, like a cache). This is another good reason to put stateful resources in their own stack.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-context">6.4.5. Commit  <code class="path">cdk.context.json</code> to avoid non-deterministic behavior</h4>
<div class="paragraph">
<p>Determinism is key to successful AWS CDK deployments. An AWS CDK app should have essentially the same result whenever it is deployed to a given environment.</p>
</div>
<div class="paragraph">
<p>Since your AWS CDK app is written in a general-purpose programming language, it can execute arbitrary code, use arbitrary libraries, and make arbitrary network calls. For example, you could use an AWS SDK to retrieve some information from your AWS account while synthesizing your app. Recognize that doing so will result in additional credential setup requirements, increased latency, and a chance, however small, of failure every time you run <code>cdk synth</code>.</p>
</div>
<div class="paragraph">
<p>Never modify your AWS account or resources during synthesis. Synthesizing an app should not have side effects. Changes to your infrastructure should happen only in the deployment phase, after the AWS CloudFormation template has been generated. This way, if there&#8217;s a problem, AWS CloudFormation can automatically roll back the change. To make changes that can&#8217;t be easily made within the AWS CDK framework, use <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.custom_resources-readme.html">custom resources</a> to execute arbitrary code at deployment time.</p>
</div>
<div class="paragraph">
<p>Even strictly read-only calls are not necessarily safe. Consider what happens if the value returned by a network call changes. What part of your infrastructure will that impact? What will happen to already-deployed resources? Following are two example situations in which a sudden change in values might cause a problem.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you provision an Amazon VPC to all available Availability Zones in a specified Region, and the number of AZs is two on deployment day, then your IP space gets split in half. If AWS launches a new Availability Zone the next day, the next deployment after that tries to split your IP space into thirds, requiring all subnets to be recreated. This probably won&#8217;t be possible because your Amazon EC2 instances are still running, and you&#8217;ll have to clean this up manually.</p>
</li>
<li>
<p>If you query for the latest Amazon Linux machine image and deploy an Amazon EC2 instance, and the next day a new image is released, a subsequent deployment picks up the new AMI and replaces all your instances. This might not be what you expected to happen.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These situations can be pernicious because the AWS-side change might occur after months or years of successful deployments. Suddenly your deployments are failing "for no reason" and you long ago forgot what you did and why.</p>
</div>
<div class="paragraph">
<p>Fortunately, the AWS CDK includes a mechanism called <em>context providers</em> to record a snapshot of non-deterministic values. This allows future synthesis operations to produce exactly the same template as they did when first deployed. The only changes in the new template are the changes that <em>you</em> made in your code. When you use a construct&#8217;s <code>.fromLookup()</code> method, the result of the call is cached in <code class="path">cdk.context.json</code>. You should commit this to version control along with the rest of your code to make sure that future executions of your CDK app use the same value. The CDK Toolkit includes commands to manage the context cache, so you can refresh specific entries when you need to. For more information, see  <a href="#context">Context values and the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>If you need some value (from AWS or elsewhere) for which there is no native CDK context provider, we recommend writing a separate script. The script should retrieve the value and write it to a file, then read that file in your CDK app. Run the script only when you want to refresh the stored value, not as part of your regular build process.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-roles">6.4.6. Let the AWS CDK manage roles and security groups</h4>
<div class="paragraph">
<p>With the AWS CDK construct library&#8217;s  <code>grant()</code> convenience methods, you can create AWS Identity and Access Management roles that grant access to one resource by another using minimally scoped permissions. For example, consider a line like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">amzn-s3-demo-bucket.grantRead(myLambda)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This single line adds a policy to the Lambda function&#8217;s role (which is also created for you). That role and its policies are more than a dozen lines of CloudFormation that you don&#8217;t have to write. The AWS CDK grants only the minimal permissions required for the function to read from the bucket.</p>
</div>
<div class="paragraph">
<p>If you require developers to always use predefined roles that were created by a security team, AWS CDK coding becomes much more complicated. Your teams could lose a lot of flexibility in how they design their applications. A better alternative is to use <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html">service control policies</a> and <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html">permission boundaries</a> to make sure that developers stay within the guardrails.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-stages">6.4.7. Model all production stages in code</h4>
<div class="paragraph">
<p>In traditional AWS CloudFormation scenarios, your goal is to produce a single artifact that is parameterized so that it can be deployed to various target environments after applying configuration values specific to those environments. In the CDK, you can, and should, build that configuration into your source code. Create a stack for your production environment, and create a separate stack for each of your other stages. Then, put the configuration values for each stack in the code. Use services like  <a href="https://aws.amazon.com/secrets-manager/">Secrets Manager</a> and <a href="https://aws.amazon.com/systems-manager/">Systems Manager</a> Parameter Store for sensitive values that you don&#8217;t want to check in to source control, using the names or ARNs of those resources.</p>
</div>
<div class="paragraph">
<p>When you synthesize your application, the cloud assembly created in the <code class="path">cdk.out</code> folder contains a separate template for each environment. Your entire build is deterministic. There are no out-of-band changes to your application, and any given commit always yields the exact same AWS CloudFormation template and accompanying assets. This makes unit testing much more reliable.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-apps-measure">6.4.8. Measure everything</h4>
<div class="paragraph">
<p>Achieving the goal of full continuous deployment, with no human intervention, requires a high level of automation. That automation is only possible with extensive amounts of monitoring. To measure all aspects of your deployed resources, create metrics, alarms, and dashboards. Don&#8217;t stop at measuring things like CPU usage and disk space. Also record your business metrics, and use those measurements to automate deployment decisions like rollbacks. Most of the L2 constructs in AWS CDK have convenience methods to help you create metrics, such as the  <code>metricUserErrors()</code> method on the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dynamodb.Table.html">dynamodb.Table</a> class.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="best-practices-security">6.5. AWS CDK security best practices</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) is a powerful tool that developers can use to configure AWS services and provision infrastructure on AWS. With any tool that provides such control and capabilities, organizations will need to establish policies and practices to ensure that the tool is being used in safe and secure ways. For example, organizations may want to restrict developer access to specific services to ensure that they can&#8217;t tamper with compliance or cost control measures that are configured in the account.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) is a powerful tool that developers can use to configure AWS services and provision infrastructure on AWS. With any tool that provides such control and capabilities, organizations will need to establish policies and practices to ensure that the tool is being used in safe and secure ways. For example, organizations may want to restrict developer access to specific services to ensure that they can&#8217;t tamper with compliance or cost control measures that are configured in the account.</p>
</div>
<div class="paragraph">
<p>Often, there can be a tension between security and productivity, and each organization needs to establish the proper balance for themselves. This topic provides security best practices for the AWS CDK that you can consider as you create and implement your own security policies. The following best practices are general guidelines and don&#8217;t represent a complete security solution. Because these best practices might not be appropriate or sufficient for your environment, treat them as helpful considerations rather than prescriptions.</p>
</div>
<div class="sect3">
<h4 id="best-practices-security-iam">6.5.1. Follow IAM security best practices</h4>
<div class="paragraph">
<p>AWS Identity and Access Management (IAM) is a web service that helps you securely control access to AWS resources. Organizations, individuals, and the AWS CDK use IAM to manage permissions that determine the actions that can be performed on AWS resources. When using IAM, follow the IAM security best practices. For more information, see  <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/IAMBestPracticesAndUseCases.html">Security best practices and use cases in AWS Identity and Access Management</a> in the <em>IAM User Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="best-practices-security-permissions">6.5.2. Manage permissions for the AWS CDK</h4>
<div class="paragraph">
<p>When you use the AWS CDK across your organization to develop and manage your infrastructure, you&#8217;ll want to consider the following scenarios where managing permissions will be important:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Permissions for AWS CDK deployments</strong> – These permissions determine who can make changes to your AWS resources and what changes they can make.</p>
</li>
<li>
<p><strong>Permissions between resources</strong> – These are the permissions that allow interactions between the AWS resources that you create and manage with the AWS CDK.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="best-practices-security-permissions-deployments">Manage permissions for AWS CDK deployments</h5>
<div class="paragraph">
<p>Developers use the AWS CDK to define infrastructure locally on their development machines. This infrastructure is implemented in AWS environments through deployments that typically involve using the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>). With deployments, you may want to control what changes developers can make in your environments. For example, you might have an Amazon Virtual Private Cloud (Amazon VPC) resource that you don&#8217;t want developers to modify.</p>
</div>
<div class="paragraph">
<p>By default, the CDK <code class="noloc">CLI</code> uses a combination of the actor&#8217;s security credentials and IAM roles that are created during bootstrapping to receive permissions for deployments. The actor&#8217;s security credentials are first used for authentication and IAM roles are then assumed to perform various actions during deployment, such as using the AWS CloudFormation service to create resources. For more information on how CDK deployments work, including the IAM roles that are used, see  <a href="#deploy">Deploy AWS CDK applications</a>.</p>
</div>
<div class="paragraph">
<p>To restrict who can perform deployments and the actions that can be performed during deployment, consider the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The actor&#8217;s security credentials are the first set of credentials used to authenticate to AWS. From here, the permissions used to perform actions during deployment are granted to the IAM roles that are assumed during the deployment workflow. You can restrict who can perform deployments by limiting who can assume these roles. You can also restrict the actions that can be performed during deployment by replacing these IAM roles with your own.</p>
</li>
<li>
<p>Permissions for performing deployments are given to the <code>DeploymentActionRole</code>. You can control permissions for who can perform deployments by limiting who can assume this role. By using a role for deployments, you can perform cross-account deployments since the role can be assumed by AWS identities in a different account. By default, all identities in the same AWS account with the appropriate <code>AssumeRole</code> policy statement can assume this role.</p>
</li>
<li>
<p>Permissions for creating and modifying resources through AWS CloudFormation are given to the <code>CloudFormationExecutionRole</code>. This role also requires permission to read from the bootstrap resources. You control the permissions that CDK deployments have by using a managed policy for the <code>CloudFormationExecutionRole</code> and optionally by configuring a permissions boundary. By default, this role has <code>AdministratorAccess</code> permissions with no permission boundary.</p>
</li>
<li>
<p>Permissions for interacting with bootstrap resources are given to the <code>FilePublishingRole</code> and <code>ImagePublishingRole</code>. The actor performing deployments must have permission to assume these roles. By default, all identities in the same AWS account with the appropriate <code>AssumeRole</code> policy statement can assume this role.</p>
</li>
<li>
<p>Permissions for accessing bootstrap resources to perform lookups are given to the <code>LookupRole</code>. The actor performing deployments must have permission to assume this role. By default, this role has <code>readOnly</code> access to the bootstrap resources. By default, all identities in the same AWS account with the appropriate <code>AssumeRole</code> policy statement can assume this role.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure the IAM identities in your AWS account with permission to assume these roles, add a policy with the following policy statement to the identities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "AssumeCDKRoles",
    "Effect": "Allow",
    "Action": "sts:AssumeRole",
    "Resource": "*",
    "Condition": {
      "StringEquals": {
        "iam:ResourceTag/aws-cdk:bootstrap-role": [
          "image-publishing",
          "file-publishing",
          "deploy",
          "lookup"
        ]
      }
    }
  }]
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="best-practices-security-permissions-deployments-roles">Modify the permissions for the roles assumed during deployment</h6>
<div class="paragraph">
<p>By modifying permissions for the roles assumed during deployment, you can manage the actions that can be performed during deployment. To modify permissions, you create your own IAM roles and specify them when bootstrapping your environment. When you customize bootstrapping, you will have to customize synthesis. For general instructions, see  <a href="#bootstrapping-customizing">Customize AWS CDK bootstrapping</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="best-practices-security-permissions-deployments-creds">Modify the security credentials and roles used during deployment</h6>
<div class="paragraph">
<p>The roles and bootstrap resources that are used during deployments are determined by the CDK stack synthesizer that you use. To modify this behavior, you can customize synthesis. For more information, see  <a href="#configure-synth">Configure and perform CDK stack synthesis</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="best-practices-security-permissions-deployments-least">Considerations for granting least privilege access</h6>
<div class="paragraph">
<p>Granting least privilege access is a security best practice that we recommend that you consider as you develop your security strategy. For more information, see  <a href="https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/sec_permissions_least_privileges.html">SEC03-BP02 Grant least privilege access</a> in the <em>AWS Well-Architected Framework Guide</em>.</p>
</div>
<div class="paragraph">
<p>Often, granting least privilege access involves restricting IAM policies to the minimum access necessary to perform a given task. Attempting to grant least privilege access through fine-grained permissions with the CDK using this approach can impact CDK deployments and cause you to have to create wider-scoped permissions than you&#8217;d like. The following are a few things to consider when using this approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determining an exhaustive list of permissions that allow developers to use the AWS CDK to provision infrastructure through CloudFormation is difficult and complex.</p>
</li>
<li>
<p>If you want to be fine-grained, permissions may become too long to fit within the maximum length of IAM policy documents.</p>
</li>
<li>
<p>Providing an incomplete set of permissions can severely impact developer productivity and deployments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the CDK, deployments are performed using CloudFormation. CloudFormation initiates a set of AWS API calls in order using the permissions that are provided. The permissions necessary at any point in time depends on many factors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The AWS services that are being modified. Specifically, the resources and properties that are being used and changed.</p>
</li>
<li>
<p>The current state of the CloudFormation stack.</p>
</li>
<li>
<p>Issues that may occur during deployments and if rollbacks are needed, which will require <code>Delete</code> permissions in addition to <code>Create</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the provided permissions are incomplete, manual intervention will be required. The following are a few examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you discover incomplete permissions during roll forward, you&#8217;ll need to pause deployment, and take time to discuss and provision new permissions before continuing.</p>
</li>
<li>
<p>If deployment rolls back and the permissions to apply the roll back are missing, it may leave your CloudFormation stack in a state that will require a lot of manual work to recover from.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since this approach can result in complications and severely limit developer productivity, we don&#8217;t recommend it. Instead, we recommend implementing guardrails and preventing bypass.</p>
</div>
</div>
<div class="sect5">
<h6 id="best-practices-security-permissions-deployments-guardrails">Implementing guardrails and preventing bypass</h6>
<div class="paragraph">
<p>You can implement guardrails, compliance rules, auditing, and monitoring by using services such as AWS Control Tower, AWS Config, AWS CloudTrail, AWS Security Hub, and others. With this approach, you grant developers permission to do everything, except tampering with the existing validation mechanisms. Developers have the freedom to implement changes quickly, as long as they stay within policy. This is the approach we recommend when using the AWS CDK. For more information on guardrails, see  <a href="https://docs.aws.amazon.com/wellarchitected/latest/management-and-governance-guide/controls.html">Controls</a> in the <em>Management and Governance Cloud Environment Guide</em>.</p>
</div>
<div class="paragraph">
<p>We also recommend using <em>permissions boundaries</em> or <em>service control policies (SCPs)</em> as a way of implementing guardrails. For more information on implementing permissions boundaries with the AWS CDK, see <a href="#customize-permissions-boundaries">Create and apply permissions boundaries for the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>If you are using any compliance control mechanisms, set them up during the bootstrapping phase. Make sure that the <code>CloudFormationExecutionRole</code> or developer-accessible identities have policies or permissions boundaries attached that prevent bypass of the mechanisms that you put in place. The appropriate policies depends on the specific mechanisms that you use.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="best-practices-security-permissions-resources">Manage permissions between resources provisioned by the AWS CDK</h5>
<div class="paragraph">
<p>How you manage permissions between resources that are provisioned by the AWS CDK depends on whether you allow the CDK to create roles and policies.</p>
</div>
<div class="paragraph">
<p>When you use L2 constructs from the AWS Construct Library to define your infrastructure, you can use the provided <code>grant</code> methods to provision permissions between resources. With <code>grant</code> methods, you specify the type of access you want between resources and the AWS CDK provisions least privilege IAM roles to accomplish your intent. This approach meets security requirements for most organizations while being efficient for developers. For more information, see <a href="#define-iam-l2">Define permissions for L2 constructs with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>If you want to work around this feature by replacing the automatically generated roles with manually created ones, consider the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your IAM roles will need to be manually created, slowing down application development.</p>
</li>
<li>
<p>When IAM roles need to be manually created and managed, people will often combine multiple logical roles into a single role to make them easier to manage. This runs counter to the least privilege principle.</p>
</li>
<li>
<p>Since these roles will need to be created before deployment, the resources that need to be referenced will not yet exist. Therefore, you&#8217;ll need to use wildcards, which runs counter to the least privilege principle.</p>
</li>
<li>
<p>A common workaround to using wildcards is to mandate that all resources be given a predictable name. However, this interferes with CloudFormation&#8217;s ability to replace resources when necessary and may slow down or block development. Because of this, we recommend that you allow CloudFormation to create unique resource names for you.</p>
</li>
<li>
<p>It will be impossible to perform continuous delivery since manual actions must be performed prior to every deployment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When organizations want to prevent the CDK from creating roles, it is usually to prevent developers from being able to create IAM roles. The concern is that by giving developers permission to create IAM roles using the AWS CDK, they could possibly elevate their own privileges. To mitigate against this, we recommend using  <em>permission boundaries</em> or <em>service control policies (SCPs)</em>. With permission boundaries, you can set limits for what developers and the CDK are allowed to do. For more information on using permission boundaries with the CDK, see <a href="#customize-permissions-boundaries">Create and apply permissions boundaries for the AWS CDK</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="migrating-v2">7. Migrating from AWS CDK v1 to AWS CDK v2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Version 2 of the AWS Cloud Development Kit (AWS CDK) is designed to make writing infrastructure as code in your preferred programming language easier. This topic describes the changes between v1 and v2 of the AWS CDK.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To identify stacks deployed with AWS CDK v1, use the <a href="https://www.npmjs.com/package/awscdk-v1-stack-finder">awscdk-v1-stack-finder</a> utility.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The main changes from AWS CDK v1 to CDK v2 are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS CDK v2 consolidates the stable parts of the AWS Construct Library, including the core library, into a single package, <code class="path">aws-cdk-lib</code>. Developers no longer need to install additional packages for the individual AWS services they use. This single-package approach also means that you don&#8217;t have to synchronize the versions of the various CDK library packages.</p>
<div class="paragraph">
<p>L1 (CfnXXXX) constructs, which represent the exact resources available in AWS CloudFormation, are always considered stable and so are included in <code class="path">aws-cdk-lib</code>.</p>
</div>
</li>
<li>
<p>Experimental modules, where we&#8217;re still working with the community to develop new <a href="#constructs-lib-levels">L2 or L3 constructs</a>, are not included in <code class="path">aws-cdk-lib</code>. Instead, they&#8217;re distributed as individual packages. Experimental packages are named with an  <code class="path">alpha</code> suffix and a semantic version number. The semantic version number matches the first version of the AWS Construct Library that they&#8217;re compatible with, also with an  <code class="path">alpha</code> suffix. Constructs move into  <code class="path">aws-cdk-lib</code> after being designated stable, permitting the main Construct Library to adhere to strict semantic versioning.</p>
<div class="paragraph">
<p>Stability is specified at the service level. For example, if we begin creating one or more <a href="#constructs-lib-levels">L2 constructs</a> for Amazon AppFlow, which at this writing has only L1 constructs, they first appear in a module named <code class="path">@aws-cdk/aws-appflow-alpha</code>. Then, they move to  <code class="path">aws-cdk-lib</code> when we feel that the new constructs meet the fundamental needs of customers.</p>
</div>
<div class="paragraph">
<p>Once a module has been designated stable and incorporated into <code class="path">aws-cdk-lib</code>, new APIs are added using the "BetaN" convention described in the next bullet.</p>
</div>
<div class="paragraph">
<p>A new version of each experimental module is released with every release of the AWS CDK. For the most part, however, they needn&#8217;t be kept in sync. You can upgrade <code class="path">aws-cdk-lib</code> or the experimental module whenever you want. The exception is that when two or more related experimental modules depend on each other, they must be the same version.</p>
</div>
</li>
<li>
<p>For stable modules to which new functionality is being added, new APIs (whether entirely new constructs or new methods or properties on an existing construct) receive a <code class="path">Beta1</code> suffix while work is in progress. (Followed by  <code class="path">Beta2</code>,  <code class="path">Beta3</code>, and so on when breaking changes are needed.) A version of the API without the suffix is added when the API is designated stable. All methods except the latest (whether beta or final) are then deprecated.</p>
<div class="paragraph">
<p>For example, if we add a new method <code>grantPower()</code> to a construct, it initially appears as <code>grantPowerBeta1()</code>. If breaking changes are needed (for example, a new required parameter or property), the next version of the method would be named <code>grantPowerBeta2()</code>, and so on. When work is complete and the API is finalized, the method <code>grantPower()</code> (with no suffix) is added, and the BetaN methods are deprecated.</p>
</div>
<div class="paragraph">
<p>All the beta APIs remain in the Construct Library until the next major version (3.0) release, and their signatures will not change. You&#8217;ll see deprecation warnings if you use them, so you should move to the final version of the API at your earliest convenience. However, no future AWS CDK 2.x releases will break your application.</p>
</div>
</li>
<li>
<p>The <code>Construct</code> class has been extracted from the AWS CDK into a separate library, along with related types. This is done to support efforts to apply the Construct Programming Model to other domains. If you are writing your own constructs or using related APIs, you must declare the <code class="path">constructs</code> module as a dependency and make minor changes to your imports. If you are using advanced features, such as hooking into the CDK app lifecycle, more changes may be needed. For full details,  <a href="https://github.com/aws/aws-cdk-rfcs/blob/master/text/0192-remove-constructs-compat.md#release-notes">see the RFC</a>.</p>
</li>
<li>
<p>Deprecated properties, methods, and types in AWS CDK v1.x and its Construct Library have been removed completely from the CDK v2 API. In most supported languages, these APIs produce warnings under v1.x, so you may have already migrated to the replacement APIs. A complete <a href="https://github.com/aws/aws-cdk/blob/master/DEPRECATED_APIs.md">list of deprecated APIs</a> in CDK v1.x is available on GitHub.</p>
</li>
<li>
<p>Behavior that was gated by feature flags in AWS CDK v1.x is enabled by default in CDK v2. The earlier feature flags are no longer needed, and in most cases they&#8217;re not supported. A few are still available to let you revert to CDK v1 behavior in very specific circumstances. For more information, see <a href="#migrating-v2-v1-upgrade-cdk-json">Updating feature flags</a>.</p>
</li>
<li>
<p>With CDK v2, the environments you deploy into must be bootstrapped using the modern bootstrap stack. The legacy bootstrap stack (the default under v1) is no longer supported. CDK v2 furthermore requires a new version of the modern stack. To upgrade your existing environments, re-bootstrap them. It is no longer necessary to set any feature flags or environment variables to use the modern bootstrap stack.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The modern bootstrap template effectively grants the permissions implied by the  <code>--cloudformation-execution-policies</code> to any AWS account in the <code>--trust</code> list. By default, this extends permissions to read and write to any resource in the bootstrapped account. Make sure to <a href="#bootstrapping-customizing">configure the bootstrapping stack</a> with policies and trusted accounts that you are comfortable with.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="migrating-v2-prerequisites">7.1. New prerequisites</h3>
<div class="paragraph">
<p>Most requirements for AWS CDK v2 are the same as for AWS CDK v1.x. Additional requirements are listed here.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For TypeScript developers, TypeScript 3.8 or later is required.</p>
</li>
<li>
<p>A new version of the CDK Toolkit is required for use with CDK v2. Now that CDK v2 is generally available, v2 is the default version when installing the CDK Toolkit. It is backward-compatible with CDK v1 projects, so you don&#8217;t need to keep the earlier version installed unless you want to create CDK v1 projects. To upgrade, issue <code>npm install -g aws-cdk</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migrating-v2-dp-upgrade">7.2. Upgrading from AWS CDK v2 Developer Preview</h3>
<div class="paragraph">
<p>If you&#8217;re using the CDK v2 Developer Preview, you have dependencies in your project on a Release Candidate version of the AWS CDK, such as  <code>2.0.0-rc1</code>. Update these to <code>2.0.0</code>, then update the modules installed in your project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>npm install</code> or <code>yarn install</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>npm install</code> or <code>yarn install</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">python -m pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mvn package</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">dotnet restore</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">go get</code></pre>
</div>
</div>
<div class="paragraph">
<p>After updating your dependencies, issue  <code>npm update -g aws-cdk</code> to update the CDK Toolkit to the release version.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrating-v2-v1-uppgrade">7.3. Migrating from AWS CDK v1 to CDK v2</h3>
<div class="paragraph">
<p>To migrate your app to AWS CDK v2, first update the feature flags in  <code class="path">cdk.json</code>. Then update your app&#8217;s dependencies and imports as necessary for the programming language that it&#8217;s written in.</p>
</div>
<div class="sect3">
<h4 id="migrating-v2-v1-recent-v1">7.3.1. Updating to a recent v1</h4>
<div class="paragraph">
<p>We are seeing a number of customers upgrading from an old version of AWS CDK v1 to the most recent version of v2 in one step. While it is certainly possible to do that, you would be both upgrading across multiple years of changes (that unfortunately may not all have had the same amount of evolution testing we have today), as well as upgrading across versions with new defaults and a different code organization.</p>
</div>
<div class="paragraph">
<p>For the safest upgrade experience and to more easily diagnose the sources of any unexpected changes, we recommend you separate those two steps: first upgrade to the latest v1 version, then make the switch to v2 afterwards.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrating-v2-v1-upgrade-cdk-json">7.3.2. Updating feature flags</h4>
<div class="paragraph">
<p>Remove the following v1 feature flags from  <code class="path">cdk.json</code> if they exist, as these are all active by default in AWS CDK v2. If their old effect is important for your infrastructure, you will need to make source code changes. See  <a href="https://github.com/aws/aws-cdk/blob/main/packages/%40aws-cdk/cx-api/FEATURE_FLAGS.md">the list of flags on GitHub</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@aws-cdk/core:enableStackNameDuplicates</code></p>
</li>
<li>
<p><code>aws-cdk:enableDiffNoFail</code></p>
</li>
<li>
<p><code>@aws-cdk/aws-ecr-assets:dockerIgnoreSupport</code></p>
</li>
<li>
<p><code>@aws-cdk/aws-secretsmanager:parseOwnedSecretName</code></p>
</li>
<li>
<p><code>@aws-cdk/aws-kms:defaultKeyPolicies</code></p>
</li>
<li>
<p><code>@aws-cdk/aws-s3:grantWriteWithoutAcl</code></p>
</li>
<li>
<p><code>@aws-cdk/aws-efs:defaultEncryptionAtRest</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A handful of v1 feature flags can be set to  <code>false</code> in order to revert to specific AWS CDK v1 behaviors; see <a href="#featureflags-disabling">Reverting to v1 behavior</a> or the list on GitHub for a complete reference.</p>
</div>
<div class="paragraph">
<p>For both types of flags, use the <code>cdk diff</code> command to inspect the changes to your synthesized template to see if the changes to any of these flags affect your infrastructure.</p>
</div>
</div>
<div class="sect3">
<h4 id="work-with-cdk-v2-cli">7.3.3. CDK Toolkit compatibility</h4>
<div class="paragraph">
<p>CDK v2 requires v2 or later of the CDK Toolkit. This version is backward-compatible with CDK v1 apps. Therefore, you can use a single globally installed version of CDK Toolkit with all your AWS CDK projects, whether they use v1 or v2. An exception is that CDK Toolkit v2 only creates CDK v2 projects.</p>
</div>
<div class="paragraph">
<p>If you need to create both v1 and v2 CDK projects, <strong>do not install CDK Toolkit v2 globally.</strong> (Remove it if you already have it installed: <code>npm remove -g aws-cdk</code>.) To invoke the CDK Toolkit, use <strong class="command">npx</strong> to run v1 or v2 of the CDK Toolkit as desired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx aws-cdk@1.x init app --language typescript
npx aws-cdk@2.x init app --language typescript</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Set up command line aliases so you can use the  <strong class="command">cdk</strong> and <strong class="command">cdk1</strong> commands to invoke the desired version of the CDK Toolkit.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">alias cdk1="npx aws-cdk@1.x"
alias cdk="npx aws-cdk@2.x"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">doskey cdk1=npx aws-cdk@1.x $*
doskey cdk=npx aws-cdk@2.x $*</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="migrating-v2-v1-upgrade-dependencies">7.3.4. Updating dependencies and imports</h4>
<div class="paragraph">
<p>Update your app&#8217;s dependencies, then install the new packages. Finally, update the imports in your code.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*
.Applications
For CDK apps, update <code class="path">package.json</code> as follows. Remove dependencies on v1-style individual stable modules and establish the lowest version of  <code class="path">aws-cdk-lib</code> you require for your application (2.0.0 here).</p>
<div class="paragraph">
<p>Experimental constructs are provided in separate, independently versioned packages with names that end in  <code class="path">alpha</code> and an alpha version number. The alpha version number corresponds to the first release of  <code class="path">aws-cdk-lib</code> with which they&#8217;re compatible. Here, we have pinned  <code class="path">aws-codestar</code> to v2.0.0-alpha.1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "dependencies": {
    "aws-cdk-lib": "^2.0.0",
    "@aws-cdk/aws-codestar-alpha": "2.0.0-alpha.1",
    "constructs": "^10.0.0"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Construct libraries</div>
<p>For construct libraries, establish the lowest version of <code class="path">aws-cdk-lib</code> you require for your application (2.0.0 here) and update  <code class="path">package.json</code> as follows.</p>
</div>
<div class="paragraph">
<p>Note that  <code class="path">aws-cdk-lib</code> appears both as a peer dependency and a dev dependency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "peerDependencies": {
    "aws-cdk-lib": "^2.0.0",
    "constructs": "^10.0.0"
  },
  "devDependencies": {
    "aws-cdk-lib": "^2.0.0",
    "constructs": "^10.0.0",
    "typescript": "~3.9.0"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should perform a major version bump on your library&#8217;s version number when releasing a v2-compatible library, because this is a breaking change for library consumers. It is not possible to support both CDK v1 and v2 with a single library. To continue to support customers who are still using v1, you could maintain the earlier release in parallel, or create a new package for v2.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It&#8217;s up to you how long you want to continue supporting AWS CDK v1 customers. You might take your cue from the lifecycle of CDK v1 itself, which entered maintenance on June 1, 2022 and will reach end-of-life on June 1, 2023. For full details, see <a href="https://github.com/aws/aws-cdk-rfcs/blob/master/text/0079-cdk-2.0.md#aws-cdk-maintenance-policy">AWS CDK Maintenance Policy</a>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<div class="title">Both libraries and apps</div>
<p>Install the new dependencies by running <code>npm install</code> or <code>yarn install</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Change your imports to import  <code>Construct</code> from the new <code class="path">constructs</code> module, core types such as  <code>App</code> and <code>Stack</code> from the top level of <code class="path">aws-cdk-lib</code>, and stable Construct Library modules for the services you use from namespaces under  <code class="path">aws-cdk-lib</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Construct } from 'constructs';
import { App, Stack } from 'aws-cdk-lib';                 // core constructs
import { aws_s3 as s3 } from 'aws-cdk-lib';               // stable module
import * as codestar from '@aws-cdk/aws-codestar-alpha';  // experimental module</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Update <code class="path">package.json</code> as follows. Remove dependencies on v1-style individual stable modules and establish the lowest version of  <code class="path">aws-cdk-lib</code> you require for your application (2.0.0 here).</p>
<div class="paragraph">
<p>Experimental constructs are provided in separate, independently versioned packages with names that end in <code class="path">alpha</code> and an alpha version number. The alpha version number corresponds to the first release of  <code class="path">aws-cdk-lib</code> with which they&#8217;re compatible. Here, we have pinned  <code class="path">aws-codestar</code> to v2.0.0-alpha.1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "dependencies": {
    "aws-cdk-lib": "^2.0.0",
    "@aws-cdk/aws-codestar-alpha": "2.0.0-alpha.1",
    "constructs": "^10.0.0"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install the new dependencies by running  <code>npm install</code> or <code>yarn install</code>.</p>
</div>
<div class="paragraph">
<p>Change your app&#8217;s imports to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Import <code>Construct</code> from the new <code class="path">constructs</code> module</p>
</li>
<li>
<p>Import core types, such as <code>App</code> and <code>Stack</code>, from the top level of <code class="path">aws-cdk-lib</code></p>
</li>
<li>
<p>Import AWS Construct Library modules from namespaces under <code class="path">aws-cdk-lib</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Construct } = require('constructs');
const { App, Stack } = require('aws-cdk-lib');              // core constructs
const s3 = require('aws-cdk-lib').aws_s3;                   // stable module
const codestar = require('@aws-cdk/aws-codestar-alpha');    // experimental module</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Update <code class="path">requirements.txt</code> or the  <code>install_requires</code> definition in <code>setup.py</code> as follows. Remove dependencies on v1-style individual stable modules.</p>
<div class="paragraph">
<p>Experimental constructs are provided in separate, independently versioned packages with names that end in <code class="path">alpha</code> and an alpha version number. The alpha version number corresponds to the first release of  <code class="path">aws-cdk-lib</code> with which they&#8217;re compatible. Here, we have pinned  <code class="path">aws-codestar</code> to v2.0.0alpha1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">install_requires=[
     "aws-cdk-lib&gt;=2.0.0",
     "constructs&gt;=10.0.0",
     "aws-cdk.aws-codestar-alpha&gt;=2.0.0alpha1",
     # ...
],</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Uninstall any other versions of AWS CDK modules already installed in your app&#8217;s virtual environment using <code>pip uninstall</code>. Then Install the new dependencies with <code>python -m pip install -r requirements.txt</code>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Change your app&#8217;s imports to do the following:</p>
</div>
<div class="paragraph">
<p>+
<strong> Import <code>Construct</code> from the new <code class="path">constructs</code> module
</strong> Import core types, such as <code>App</code> and <code>Stack</code>, from the top level of <code class="path">aws_cdk</code>
** Import AWS Construct Library modules from namespaces under <code class="path">aws_cdk</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from constructs import Construct
from aws_cdk import App, Stack                    # core constructs
from aws_cdk import aws_s3 as s3                  # stable module
import aws_cdk.aws_codestar_alpha as codestar     # experimental module

# ...

class MyConstruct(Construct):
    # ...

class MyStack(Stack):
    # ...

s3.Bucket(...)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">pom.xml</code>, remove all  <code>software.amazon.awscdk</code> dependencies for stable modules and replace them with dependencies on <code>software.constructs</code> (for <code>Construct</code>) and <code>software.amazon.awscdk</code>.</p>
<div class="paragraph">
<p>Experimental constructs are provided in separate, independently versioned packages with names that end in <code class="path">alpha</code> and an alpha version number. The alpha version number corresponds to the first release of  <code class="path">aws-cdk-lib</code> with which they&#8217;re compatible. Here, we have pinned  <code class="path">aws-codestar</code> to v2.0.0-alpha.1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
    &lt;artifactId&gt;aws-cdk-lib&lt;/artifactId&gt;
    &lt;version&gt;2.0.0&lt;/version&gt;
&lt;/dependency&gt;&lt;dependency&gt;
    &lt;groupId&gt;software.amazon.awscdk&lt;/groupId&gt;
    &lt;artifactId&gt;code-star-alpha&lt;/artifactId&gt;
    &lt;version&gt;2.0.0-alpha.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;software.constructs&lt;/groupId&gt;
    &lt;artifactId&gt;constructs&lt;/artifactId&gt;
    &lt;version&gt;10.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install the new dependencies by running  <code>mvn package</code>.</p>
</div>
<div class="paragraph">
<p>Change your code to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Import <code>Construct</code> from the new <code class="path">software.constructs</code> library</p>
</li>
<li>
<p>Import core classes, like <code>Stack</code> and <code>App</code>, from <code class="path">software.amazon.awscdk</code></p>
</li>
<li>
<p>Import service constructs from <code class="path">software.amazon.awscdk.services</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.App;
import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.codestar.alpha.GitHubRepository;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The most straightforward way to upgrade the dependencies of a C# CDK application is to edit the <code class="path">.csproj</code> file manually. Remove all stable  <code>Amazon.CDK.*</code> package references and replace them with references to the <code class="path">Amazon.CDK.Lib</code> and  <code class="path">Constructs</code> packages.</p>
<div class="paragraph">
<p>Experimental constructs are provided in separate, independently versioned packages with names that end in <code class="path">alpha</code> and an alpha version number. The alpha version number corresponds to the first release of  <code class="path">aws-cdk-lib</code> with which they&#8217;re compatible. Here, we have pinned  <code class="path">aws-codestar</code> to v2.0.0-alpha.1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;PackageReference Include="Amazon.CDK.Lib" Version="2.0.0" /&gt;
&lt;PackageReference Include="Amazon.CDK.AWS.Codestar.Alpha" Version="2.0.0-alpha.1" /&gt;
&lt;PackageReference Include="Constructs" Version="10.0.0" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install the new dependencies by running  <code>dotnet restore</code>.</p>
</div>
<div class="paragraph">
<p>Change the imports in your source files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Constructs;                   // for Construct class
using Amazon.CDK;                   // for core classes like App and Stack
using Amazon.CDK.AWS.S3;            // for stable constructs like Bucket
using Amazon.CDK.Codestar.Alpha;    // for experimental constructs</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Issue <strong class="command">go get</strong> to update your dependencies to the latest version and update your project&#8217;s <code class="path">.mod</code> file.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-v2-diff.title">7.4. Testing your migrated app before deploying</h3>
<div class="paragraph">
<p>Before deploying your stacks, use  <code>cdk diff</code> to check for unexpected changes to the resources. Changes to logical IDs (causing replacement of resources) are <strong>not</strong> expected.</p>
</div>
<div class="paragraph">
<p>Expected changes include but are not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to the <code>CDKMetadata</code> resource.</p>
</li>
<li>
<p>Updated asset hashes.</p>
</li>
<li>
<p>Changes related to the new-style stack synthesis. Applies if your app used the legacy stack synthesizer in v1.</p>
</li>
<li>
<p>The addition of a <code>CheckBootstrapVersion</code> rule.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unexpected changes are typically not caused by upgrading to AWS CDK v2 in itself. Usually, they&#8217;re the result of deprecated behavior that was previously changed by feature flags. This is a symptom of upgrading from a version of CDK earlier than about 1.85.x. You would see the same changes upgrading to the latest v1.x release. You can usually resolve this by doing the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upgrade your app to the latest v1.x release</p>
</li>
<li>
<p>Remove feature flags</p>
</li>
<li>
<p>Revise your code as necessary</p>
</li>
<li>
<p>Deploy</p>
</li>
<li>
<p>Upgrade to v2</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your upgraded app is undeployable after the two-stage upgrade,  <a href="https://github.com/aws/aws-cdk/issues/new/choose">report the issue</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you are ready to deploy the stacks in your app, consider deploying a copy first so you can test it. The easiest way to do this is to deploy it into a different Region. However, you can also change the IDs of your stacks. After testing, be sure to destroy the testing copy with  <strong class="command">cdk destroy</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrating-v2-trouble.title">7.5. Troubleshooting</h3>
<div class="paragraph">
<div class="title">TypeScript  <code>'from' expected</code> or <code>';' expected</code> error in imports</div>
<p>Upgrade to TypeScript 3.8 or later.</p>
</div>
<div class="paragraph">
<div class="title">Run 'cdk bootstrap'</div>
<p>If you see an error like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>❌  MyStack failed: Error: MyStack: SSM parameter /cdk-bootstrap/hnb659fds/version not found. Has the environment been bootstrapped? Please run 'cdk bootstrap' (see https://docs.aws.amazon.com/cdk/latest/guide/bootstrapping.html)
    at CloudFormationDeployments.validateBootstrapStackVersion (.../aws-cdk/lib/api/cloudformation-deployments.ts:323:13)
    at processTicksAndRejections (internal/process/task_queues.js:97:5)
MyStack: SSM parameter /cdk-bootstrap/hnb659fds/version not found. Has the environment been bootstrapped? Please run 'cdk bootstrap' (see https://docs.aws.amazon.com/cdk/latest/guide/bootstrapping.html)</pre>
</div>
</div>
<div class="paragraph">
<p>AWS CDK v2 requires an updated bootstrap stack, and furthermore, all v2 deployments require bootstrap resources. (With v1, you could deploy simple stacks without bootstrapping.) For complete details, see  <a href="#bootstrapping">AWS CDK bootstrapping</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="finding-v1-stacks.title">7.6. Finding v1 stacks</h3>
<div class="paragraph">
<p>When migrating your CDK application from v1 to v2, you might want to identify the deployed AWS CloudFormation stacks that were created using v1. To do this, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx awscdk-v1-stack-finder</code></pre>
</div>
</div>
<div class="paragraph">
<p>For usage details, see the awscdk-v1-stack-finder  <a href="https://github.com/cdklabs/awscdk-v1-stack-finder/blob/main/README.md">README</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="migrate">8. Migrate existing resources and AWS CloudFormation templates to the AWS CDK</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use the AWS Cloud Development Kit (AWS CDK) Command Line Interface (AWS CDK <code class="noloc">CLI</code>) to migrate deployed AWS resources, deployed AWS CloudFormation stacks, and local AWS CloudFormation templates to AWS CDK.</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CDK Migrate feature is in preview release for AWS CDK and is subject to change.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use the AWS Cloud Development Kit (AWS CDK) Command Line Interface (AWS CDK  <code class="noloc">CLI</code>) to migrate deployed AWS resources, deployed AWS CloudFormation stacks, and local AWS CloudFormation templates to AWS CDK.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect2">
<h3 id="migrate-intro">8.1. How migration works</h3>
<div class="paragraph">
<p>Use the AWS CDK  <code class="noloc">CLI</code><code>cdk migrate</code> command to migrate from the following sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deployed AWS resources.</p>
</li>
<li>
<p>Deployed AWS CloudFormation stacks.</p>
</li>
<li>
<p>Local AWS CloudFormation templates.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Deployed AWS resources</dt>
</dl>
</div>
</li>
<li>
<p>You can migrate deployed AWS resources from a specific environment (AWS account and AWS Region) that are not associated with an AWS CloudFormation stack.</p>
<div class="paragraph">
<p>The AWS CDK <code class="noloc">CLI</code> utilizes the  <em>IaC generator</em> service to scan for resources in your AWS environment to gather resource details. To learn more about IaC generator, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/generate-IaC.html">Generating templates for existing resources</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="paragraph">
<p>After gathering resource details, the AWS CDK <code class="noloc">CLI</code> creates a new CDK app that includes a single stack containing your migrated resources.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Deployed AWS CloudFormation stacks</dt>
</dl>
</div>
</li>
<li>
<p>You can migrate a single AWS CloudFormation stack into a new AWS CDK app. The AWS CDK <code class="noloc">CLI</code> will retrieve the AWS CloudFormation template of your stack and create a new CDK app. The CDK app will consist of a single stack that contains your migrated AWS CloudFormation stack.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Local AWS CloudFormation templates</dt>
</dl>
</div>
</li>
<li>
<p>You can migrate from a local AWS CloudFormation template. Local templates may or may not contain deployed resources. The AWS CDK <code class="noloc">CLI</code> will create a new CDK app that contains a single stack with your resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After migrating, you can manage, modify, and deploy your CDK app to AWS CloudFormation to provision or update your resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrate-benefits">8.2. Benefits of CDK Migrate</h3>
<div class="paragraph">
<p>Migrating resources into AWS CDK has historically been a manual process that requires time and expertise with AWS CloudFormation and AWS CDK to even begin. With CDK Migrate, the AWS CDK  <code class="noloc">CLI</code> facilitates a majority of the migration effort for you in a fraction of the time. CDK Migrate will quickly get you started with using the AWS CDK to develop and manage new and existing applications on AWS.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrate-considerations">8.3. Considerations</h3>
<div class="sect3">
<h4 id="migrate-considerations-general">8.3.1. General considerations</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">CDK Migrate vs. CDK Import</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <code>cdk import</code> command can import deployed resources into a new or existing CDK app. When importing, each resource will have to manually be defined as an L1 construct in your app. We recommend using <code>cdk import</code> to import one or more resources at a time into a new or existing CDK app. To learn more, see <a href="#cli-import">Import existing resources into a stack</a>.</p>
<div class="paragraph">
<p>The <code>cdk migrate</code> command migrates from deployed resources, deployed AWS CloudFormation stacks, or local AWS CloudFormation templates into a new CDK app. During migration, the AWS CDK <code class="noloc">CLI</code> uses  <code>cdk import</code> to import your resources into the new CDK app. The AWS CDK <code class="noloc">CLI</code> also generates L1 constructs for each resource for you. We recommend using  <code>cdk migrate</code> when importing from a supported migration source into a new AWS CDK app.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CDK Migrate creates L1 constructs only</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The newly created CDK app will include L1 constructs only. You can add higher-level constructs to your app after migration.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">CDK Migrate creates CDK apps that contain a single stack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The newly created CDK app will contain a single stack.</p>
<div class="paragraph">
<p>When migrating deployed resources, all migrated resources will be contained within a single stack in the new CDK app.</p>
</div>
<div class="paragraph">
<p>When migrating AWS CloudFormation stacks, you can only migrate a single AWS CloudFormation stack into a single stack in the new CDK app.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Migrating assets</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Project assets, such as AWS Lambda code, will not directly migrate into the new CDK app. After migration, you can specify asset values to include them in the CDK app.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Migrating stateful resources</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When migrating stateful resources, such as databases and Amazon Simple Storage Service (Amazon S3) buckets, you&#8217;d most often want to migrate the existing resource instead of creating a new resource.</p>
<div class="paragraph">
<p>To migrate and preserve stateful resources, do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify that your stateful resource supports import. For more information, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import-supported-resources.html">Resource type support</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</li>
<li>
<p>After migration, verify that the migrated resource&#8217;s logical ID in the new CDK app matches the logical ID of the deployed resource.</p>
</li>
<li>
<p>If migrating from an AWS CloudFormation stack, verify that the stack name in the new CDK app matches the AWS CloudFormation stack.</p>
</li>
<li>
<p>Deploy the CDK app using the same AWS account and AWS Region of the migrated resource.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="migrate-considerations-template">8.3.2. Considerations when migrating from an AWS CloudFormation template</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">CDK Migrate supports single template migration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When migrating AWS CloudFormation templates, you can select a single template to migrate. Nested templates are not supported.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Migrating templates with intrinsic functions</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When migrating from an AWS CloudFormation template that uses intrinsic functions, the AWS CDK <code class="noloc">CLI</code> will attempt to migrate your logic into the CDK app with the  <code>Fn</code> class. To learn more, see <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Fn.html">class Fn</a> in the <em>AWS Cloud Development Kit (AWS CDK) API Reference</em>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="migrate-considerations-resources">8.3.3. Considerations when migrating from deployed resources</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Scan limitations</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When scanning your environment for resources, IaC generator has specific limitations on the data it can retrieve and quota limitations when scanning. To learn more, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/generate-IaC.html#generate-template-considerations">Considerations</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrate-prerequisites">8.4. Prerequisites</h3>
<div class="paragraph">
<p>Before using the  <code>cdk migrate</code> command, complete all set up steps in <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrate-gs">8.5. Get started with CDK Migrate</h3>
<div class="paragraph">
<p>To begin, run the AWS CDK  <code class="noloc">CLI</code><code>cdk migrate</code> command from a directory of your choice. Provide required and optional options, depending on the type of migration you are performing.</p>
</div>
<div class="paragraph">
<p>For a full list and description of options that you can use with <code>cdk migrate</code>, see <a href="#ref-cli-cdk-migrate">cdk migrate</a>.</p>
</div>
<div class="paragraph">
<p>The following are some important options that you may want to provide.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Stack name</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The only required option is <code>--stack-name</code>. Use this option to specify a name for the stack that will be created within the AWS CDK app after migration. The stack name will also be used as the name of your AWS CloudFormation stack at deployment.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Language</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use <code>--language</code> to specify the programming language of the new CDK app.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">AWS account and AWS Region</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The AWS CDK <code class="noloc">CLI</code> retrieves AWS account and AWS Region information from default sources. For more information, see  <a href="#environments">Environments for the AWS CDK</a>. You can use <code>--account</code> and <code>--region</code> options with <code>cdk migrate</code> to provide other values.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Output directory of your new CDK project</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, the AWS CDK <code class="noloc">CLI</code> will create a new CDK project in your working directory and use the value you provide with  <code>--stack-name</code> to name the project folder. If a folder with the same name currently exists, the AWS CDK <code class="noloc">CLI</code> will overwrite that folder.</p>
<div class="paragraph">
<p>You can specify a different output path for the new CDK project folder with the <code>--output-path</code> option.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Migration source</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Provide an option to specify the source you are migrating from.</p>
<div class="ulist">
<ul>
<li>
<p><code>--from-path</code> – Migrate from a local AWS CloudFormation template.</p>
</li>
<li>
<p><code>--from-scan</code> – Migrate from deployed resources in an AWS account and AWS Region.</p>
</li>
<li>
<p><code>--from-stack</code> – Migrate from an AWS CloudFormation stack.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on your migration source, you can provide additional options to customize the  <code>cdk migrate</code> command.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="migrate-stack">8.6. Migrate from an AWS CloudFormation stack</h3>
<div class="paragraph">
<p>To migrate from a deployed AWS CloudFormation stack, provide the  <code>--from-stack</code> option. Provide the name of your deployed AWS CloudFormation stack with <code>--stack-name</code>. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate --from-stack --stack-name "myCloudFormationStack"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CDK  <code class="noloc">CLI</code> will do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the AWS CloudFormation template of your deployed stack.</p>
</li>
<li>
<p>Run <code>cdk init</code> to initialize a new CDK app.</p>
</li>
<li>
<p>Create a stack within the CDK app that contains your migrated AWS CloudFormation stack.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you migrate from a deployed AWS CloudFormation stack, the AWS CDK  <code class="noloc">CLI</code> attempts to match deployed resource logical IDs and the deployed AWS CloudFormation stack name to the migrated resources and stack in the new CDK app.</p>
</div>
<div class="paragraph">
<p>After migration, you can manage and modify your CDK app normally. When you deploy, AWS CloudFormation will identify the deployment as an AWS CloudFormation stack update due to the matching AWS CloudFormation stack name. Resources with matching logical IDs will be updated. For more information on deploying, see <a href="#migrate-manage">Manage and deploy your CDK app</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="migrate-template">8.7. Migrate from an AWS CloudFormation template</h3>
<div class="paragraph">
<p>CDK Migrate supports migrating from AWS CloudFormation templates formatted in  <code class="path">JSON</code> or  <code class="path">YAML</code>.</p>
</div>
<div class="paragraph">
<p>To migrate from a local AWS CloudFormation template, use the <code>--from-path</code> option and provide a path to the local template. You must also provide the required <code>--stack-name</code> option. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate --from-path "./template.json" --stack-name "myCloudFormationStack"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CDK  <code class="noloc">CLI</code> will do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve your local AWS CloudFormation template.</p>
</li>
<li>
<p>Run <code>cdk init</code> to initialize a new CDK app.</p>
</li>
<li>
<p>Create a stack within the CDK app that contains your migrated AWS CloudFormation template.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After migration, you can manage and modify your CDK app normally. At deployment, you have the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Update an AWS CloudFormation stack</strong> – If the local AWS CloudFormation template was previously deployed, you can update the deployed AWS CloudFormation stack.</p>
</li>
<li>
<p><strong>Deploy a new AWS CloudFormation stack</strong> – If the local AWS CloudFormation template was never deployed, or if you want to create a new stack from a previously deployed template, you can deploy a new AWS CloudFormation stack.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="migrate-template-sam">8.7.1. Migrate from an AWS SAM template</h4>
<div class="paragraph">
<p>To migrate from an AWS Serverless Application Model (AWS SAM) template, you must first convert it to an AWS CloudFormation template or deploy to create an AWS CloudFormation stack.</p>
</div>
<div class="paragraph">
<p>To convert an AWS SAM template to AWS CloudFormation, you can use the AWS SAM <code class="noloc">CLI</code><code>sam validate --debug</code> command. You may have to set <code>lint</code> to <code>false</code> in your <code class="path">samconfig.toml</code> file before running this command.</p>
</div>
<div class="paragraph">
<p>To convert to an AWS CloudFormation stack, deploy the AWS SAM template using the AWS SAM <code class="noloc">CLI</code>. Then migrate from the deployed stack.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrate-resources">8.8. Migrate from deployed resources</h3>
<div class="paragraph">
<p>To migrate from deployed AWS resources, provide the  <code>--from-scan</code> option. You must also provide the required <code>--stack-name</code> option. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate --from-scan --stack-name "myCloudFormationStack"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CDK  <code class="noloc">CLI</code> will do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Scan your account for resource and property details</strong> – The AWS CDK <code class="noloc">CLI</code> utilizes IaC generator to scan your account and gather details.</p>
</li>
<li>
<p><strong>Generate an AWS CloudFormation template</strong> – After scanning, the AWS CDK <code class="noloc">CLI</code> utilizes IaC generator to create an AWS CloudFormation template.</p>
</li>
<li>
<p><strong>Initialize a new CDK app and migrate your template</strong> – The AWS CDK <code class="noloc">CLI</code> runs  <code>cdk init</code> to initialize a new AWS CDK app and migrates your AWS CloudFormation template into the CDK app as a single stack.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="migrate-resources-filters">8.8.1. Use filters</h4>
<div class="paragraph">
<p>By default, the AWS CDK  <code class="noloc">CLI</code> will scan the entire AWS environment and migrate resources up to the maximum quota limit of IaC generator. You can provide filters with the AWS CDK  <code class="noloc">CLI</code> to specify a criteria for which resources get migrated from your account to the new CDK app. To learn more, see  <code><a href="#ref-cli-cdk-migrate-options-filter">--filter</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrate-resources-scan">8.8.2. Scanning for resources with IaC generator</h4>
<div class="paragraph">
<p>Depending on the number of resources in your account, scanning may take a few minutes. A progress bar will display during the scanning process.</p>
</div>
<div id="migrate-resources-supported" class="dlist">
<dl>
<dt class="hdlist1">Supported resource types</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The AWS CDK <code class="noloc">CLI</code> will migrate resources supported by the IaC generator. For a full list, see  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import-supported-resources.html">Resource type support</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="migrate-resources-writeonly">8.8.3. Resolve write-only properties</h4>
<div class="paragraph">
<p>Some supported resources contain write-only properties. These properties can be written to, to configure the property, but can&#8217;t be read by IaC generator or AWS CloudFormation to obtain the value. For example, a property used to specify a database password may be write-only for security reasons.</p>
</div>
<div class="paragraph">
<p>When scanning resources during migration, IaC generator will detect resources that may contain write-only properties and will categorize them into any of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MUTUALLY_EXCLUSIVE_PROPERTIES</code> – These are write-only properties for a specific resource that are interchangeable and serve a similar purpose. One of the mutually exclusive properties are required to configure your resource. For example, the <code>S3Bucket</code>, <code>ImageUri</code>, and <code>ZipFile</code> properties for an <code>AWS::Lambda::Function</code> resource are mutually exclusive write-only properties. Any one of them can be used to specify your function assets, but you must use one.</p>
</li>
<li>
<p><code>MUTUALLY_EXCLUSIVE_TYPES</code> – These are required write-only properties that accept multiple configuration types. For example, the <code>Body</code> property of an <code>AWS::ApiGateway::RestApi</code> resource accepts an object or string type.</p>
</li>
<li>
<p><code>UNSUPPORTED_PROPERTIES</code> – These are write-only properties that don&#8217;t fall under the other two categories. They are either optional properties or required properties that accept an array of objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on write-only properties and how IaC generator manages them when scanning for deployed resources and creating AWS CloudFormation templates, see  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/generate-IaC-write-only-properties.html">IaC generator and write-only properties</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="paragraph">
<p>After migration, you must specify write-only property values in the new CDK app. The AWS CDK <code class="noloc">CLI</code> will append a  <strong>Warnings</strong> section to the CDK project&#8217;s <code class="path">ReadMe</code> file to document any write-only properties that were identified by IaC generator. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-markdown" data-lang="markdown"># Welcome to your CDK TypeScript project
...
## Warnings
### Write-only properties
Write-only properties are resource property values that can be written to but can't be read by AWS CloudFormation or CDK Migrate. For more information, see [IaC generator and write-only properties](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/generate-IaC-write-only-properties.html).

Write-only properties discovered during migration are organized here by resource ID and categorized by write-only property type. Resolve write-only properties by providing property values in your CDK app. For guidance, see [Resolve write-only properties](https://docs.aws.amazon.com/cdk/v2/guide/migrate.html#migrate-resources-writeonly).
### MyLambdaFunction
- **UNSUPPORTED_PROPERTIES**:
  - SnapStart/ApplyOn: Applying SnapStart setting on function resource type.Possible values: [PublishedVersions, None]
This property can be replaced with other types
  - Code/S3ObjectVersion: For versioned objects, the version of the deployment package object to use.
This property can be replaced with other exclusive properties
- **MUTUALLY_EXCLUSIVE_PROPERTIES**:
  - Code/S3Bucket: An Amazon S3 bucket in the same AWS Region as your function. The bucket can be in a different AWS account.
This property can be replaced with other exclusive properties
  - Code/S3Key: The Amazon S3 key of the deployment package.
This property can be replaced with other exclusive properties</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Warnings are organized under headings that identify the resource&#8217;s logical ID that they are associated with.</p>
</li>
<li>
<p>Warnings are categorized by type. These types come directly from IaC generator.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify write-only properties to resolve from the <strong>Warnings</strong> section of your CDK project&#8217;s <code class="path">ReadMe</code> file. Here, you can take note of the resources in your CDK app that may contain write-only properties and identify the write-only property types that were discovered.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For <code>MUTUALLY_EXCLUSIVE_PROPERTIES</code>, determine which mutually exclusive property to configure in your AWS CDK app.</p>
</li>
<li>
<p>For <code>MUTUALLY_EXCLUSIVE_TYPES</code>, determine which accepted type that you will use to configure the property.</p>
</li>
<li>
<p>For <code>UNSUPPORTED_PROPERTIES</code>, determine if the property is optional or required. Then, configure as necessary.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Use guidance from <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/generate-IaC-write-only-properties.html">IaC generator and write-only properties</a> to reference what the warning types mean.</p>
</li>
<li>
<p>In your CDK app, write-only property values to resolve will also be specified in the <code>Props</code> section of your app. Provide the correct values here. For property descriptions and guidance, you can reference the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">AWS CDK API Reference</a>.</p>
<div class="paragraph">
<p>The following is an example of the <code>Props</code> section within a migrated CDK app with two write-only properties to resolve:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export interface MyTestAppStackProps extends cdk.StackProps {
  /**
   * The Amazon S3 key of the deployment package.
   */
  readonly lambdaFunction00asdfasdfsadf008grk1CodeS3Keym8P82: string;
  /**
   * An Amazon S3 bucket in the same AWS Region as your function. The bucket can be in a different AWS account.
   */
  readonly lambdaFunction00asdfasdfsadf008grk1CodeS3Bucketzidw8: string;
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you resolve all write-only property values, you&#8217;re ready to prepare for deployment.</p>
</div>
</div>
<div class="sect3">
<h4 id="migrate-resources-file">8.8.4. The migrate.json file</h4>
<div class="paragraph">
<p>The AWS CDK  <code class="noloc">CLI</code> creates a  <code class="path">migrate.json</code> file in your AWS CDK project during migration. This file contains reference information on your deployed resources. When you deploy your CDK app for the first time, the AWS CDK  <code class="noloc">CLI</code> uses this file to reference your deployed resources, associates your resources with the new AWS CloudFormation stack, and deletes the file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrate-manage">8.9. Manage and deploy your CDK app</h3>
<div class="paragraph">
<p>When migrating to AWS CDK, the new CDK app may not be deployment-ready immediately. This topic describes action items to consider while managing and deploying your new CDK app.</p>
</div>
<div class="sect3">
<h4 id="migrate-manage-prepare">8.9.1. Prepare for deployment</h4>
<div class="paragraph">
<p>Before deploying, you must prepare your CDK app.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Synthesize your app</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the <code>cdk synth</code> command to synthesize the stack in your CDK app into an AWS CloudFormation template.</p>
<div class="paragraph">
<p>If you migrated from a deployed AWS CloudFormation stack or template, you can compare the synthesized template to the migrated template to verify resource and property values.</p>
</div>
<div class="paragraph">
<p>To learn more about <code>cdk synth</code>, see <a href="#cli-synth">Synthesize stacks</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Perform a diff</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you migrated from a deployed AWS CloudFormation stack, you can use the cdk diff command to compare with the stack in your new CDK app.</p>
<div class="paragraph">
<p>To learn more about cdk diff, see <a href="#cli-diff">Compare stacks</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Bootstrap your environment</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you are deploying from an AWS environment for the first time, use <code>cdk bootstrap</code> to prepare your environment. To learn more, see <a href="#bootstrapping">AWS CDK bootstrapping</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="migrate-manage-deploy">8.9.2. Deploy your CDK app</h4>
<div class="paragraph">
<p>When you deploy a CDK app, the AWS CDK  <code class="noloc">CLI</code> utilizes the AWS CloudFormation service to provision your resources. Resources are bundled into a single stack in the CDK app and are deployed as a single AWS CloudFormation stack.</p>
</div>
<div class="paragraph">
<p>Depending on where you migrated from, you can deploy to create a new AWS CloudFormation stack or update an existing AWS CloudFormation stack.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Deploy to create a new AWS CloudFormation stack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you migrated from deployed resources, the AWS CDK <code class="noloc">CLI</code> will automatically create a new AWS CloudFormation stack at deployment. Your deployed resources will be included in the new AWS CloudFormation stack.</p>
<div class="paragraph">
<p>If you migrated from a local AWS CloudFormation template that was never deployed, the AWS CDK <code class="noloc">CLI</code> will automatically create a new AWS CloudFormation stack at deployment.</p>
</div>
<div class="paragraph">
<p>If you migrated from a deployed AWS CloudFormation stack or local AWS CloudFormation template that was previously deployed, you can deploy to create a new AWS CloudFormation stack. To create a new stack, do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy to a new AWS environment. This consists of using a different AWS account or deploying to a different AWS Region.</p>
</li>
<li>
<p>If you want to deploy a new stack to the same AWS environment of the migrated stack or template, you must modify the stack name in your CDK app to a new value. You must also modify all logical IDs of resources in your CDK app. Then, you can deploy to the same environment to create a new stack and new resources.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Deploy to update an existing AWS CloudFormation stack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you migrated from a deployed AWS CloudFormation stack or local AWS CloudFormation template that was previously deployed, you can deploy to update the existing AWS CloudFormation stack.</p>
<div class="paragraph">
<p>Verify that the stack name in your CDK app matches the stack name of the deployed AWS CloudFormation stack and deploy to the same AWS environment.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="configure-access">9. Configure security credentials for the AWS CDK <code class="noloc">CLI</code></h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>When you use the AWS Cloud Development Kit (AWS CDK) to develop applications in your local environment, you will primarily use the AWS CDK  <code class="noloc">CLI</code> to interact with AWS to deploy and manage your CDK stacks. To use the CDK  <code class="noloc">CLI</code>, you must configure security credentials.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>When you use the AWS Cloud Development Kit (AWS CDK) to develop applications in your local environment, you will primarily use the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>) to interact with AWS. For example, you can use the CDK  <code class="noloc">CLI</code> to deploy your application or to delete your resources from your AWS environment.</p>
</div>
<div class="paragraph">
<p>To use the CDK <code class="noloc">CLI</code> to interact with AWS, you must configure security credentials on your local machine. This lets AWS know who you are and what permissions you have.</p>
</div>
<div class="paragraph">
<p>To learn more about security credentials, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/security-creds.html">AWS security credentials</a> in the <em>IAM User Guide</em>.</p>
</div>
<div class="sect2">
<h3 id="configure-access-prerequisites">9.1. Prerequisites</h3>
<div class="paragraph">
<p>Configuring security credentials is part of the  <em>getting started</em> process. Complete all prerequisites and previous steps at <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure-access-how">9.2. How to configure security credentials</h3>
<div class="paragraph">
<p>How you configure security credentials depends on how you or your organization manages users. Whether you use AWS Identity and Access Management (IAM) or AWS IAM Identity Center, we recommend that you use the AWS Command Line Interface (AWS CLI) to configure and manage security credentials for the CDK  <code class="noloc">CLI</code>. This includes using AWS CLI commands like  <code>aws configure</code> to configure security credentials on your local machine. However, you can use alternative methods such as manually updating your <code class="path">config</code> and  <code class="path">credentials</code> files, or setting environment variables.</p>
</div>
<div class="paragraph">
<p>For guidance on configuring security credentials using the AWS CLI, along with information on configuration and credential precedence when using different methods, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-authentication.html">Authentication and access credentials</a> in the <em>AWS Command Line Interface User Guide</em>. The CDK <code class="noloc">CLI</code> adheres to the same configuration and credential precedence of the AWS CLI. The  <code>--profile</code> command line option takes precedence over environment variables. If you have both the <code>AWS_PROFILE</code> and <code>CDK_DEFAULT_PROFILE</code> environment variables configured, the <code>AWS_PROFILE</code> environment variable takes precedence.</p>
</div>
<div class="paragraph">
<p>If you configure multiple profiles, you can use the CDK <code class="noloc">CLI</code><code><a href="#ref-cli-cmd-options-profile">--profile</a></code> option with any command to specify the profile from your <code class="path">credentials</code> and  <code class="path">config</code> files to use for authentication. If you don&#8217;t provide  <code>--profile</code>, the <code>default</code> profile will be used.</p>
</div>
<div class="paragraph">
<p>If you prefer to quickly configure basic settings, including security credentials, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-quickstart.html">Set up the AWS CLI</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve configured security credentials on your local machine, you can use the CDK <code class="noloc">CLI</code> to interact with AWS.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure-access-sso">9.3. Configure and manage security credentials for IAM Identity Center users</h3>
<div class="paragraph">
<p>IAM Identity Center users can authenticate with IAM Identity Center or manually by using short-term credentials.</p>
</div>
<div class="sect3">
<h4 id="configure-access-sso-auto">9.3.1. Authenticate with IAM Identity Center to generate short-term credentials</h4>
<div class="paragraph">
<p>You can configure the AWS CLI to authenticate with IAM Identity Center. This is the recommended approach of configuring security credentials for IAM Identity Center users. IAM Identity Center users can use the AWS CLI  <code>aws configure sso</code> wizard to configure an IAM Identity Center profile and <code>sso-session</code>, which gets stored in the <code class="path">config</code> file on your local machine. For instructions, see  <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html">Configure the AWS CLI to use AWS IAM Identity Center</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>Next, you can use the AWS CLI <code>aws sso login</code> command to request refreshed credentials. You can also use this command to switch profiles. For instructions, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/sso-using-profile.html">Use an IAM Identity Center named profile</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>Once authenticated, you can use the CDK <code class="noloc">CLI</code> to interact with AWS for the duration of your session. For an example, see  <a href="#configure-access-sso-example-cli">Example: Authenticate with IAM Identity Center automatic token refresh for use with the AWS CDK CLI</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-access-sso-manual">9.3.2. Manually configure short-term credentials</h4>
<div class="paragraph">
<p>As an alternative to using the AWS CLI and authenticating with IAM Identity Center, IAM Identity Center users can obtain short-term credentials from the AWS Management Console and manually configure the  <code class="path">credentials</code> and  <code class="path">config</code> files on their local machine. Once configured, you can use the CDK  <code class="noloc">CLI</code> to interact with AWS until your credentials expire. For instructions, see  <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-authentication-short-term.html">Authenticate with short-term credentials</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-access-iam">9.4. Configure and manage security credentials for IAM users</h3>
<div class="paragraph">
<p>IAM users can use an IAM role or IAM user credentials with the CDK  <code class="noloc">CLI</code>.</p>
</div>
<div class="sect3">
<h4 id="configure-access-iam-role">9.4.1. Use an IAM role to configure short-term credentials</h4>
<div class="paragraph">
<p>IAM users can assume IAM roles to gain additional (or different) permissions. For IAM users, this is the recommended approach since it provides short-term credentials.</p>
</div>
<div class="paragraph">
<p>First, the IAM role and user&#8217;s permission to assume the role must be configured. This is typically performed by an administrator using the AWS Management Console or AWS CLI. Then, the IAM user can use the AWS CLI to assume the role and configure short-term credentials on their local machine. For instructions, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html">Use an IAM role in the AWS CLI</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-access-iam-user">9.4.2. Use IAM user credentials</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid security risks, we don&#8217;t recommend using IAM user credentials since they provide long-term access. If you must use long-term credentials, we recommend that you  <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#rotate-credentials">update access keys</a> as an IAM security best practice.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>IAM users can obtain access keys from the AWS Management Console. You can then use the AWS CLI to configure long-term credentials on your local machine. For instructions, see  <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-authentication-user.html">Authenticate with IAM user credentials</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-access-info">9.5. Additional information</h3>
<div class="paragraph">
<p>To learn about the different ways that you can sign in to AWS, depending on the type of user you are, see  <a href="https://docs.aws.amazon.com/signin/latest/userguide/what-is-sign-in.html">What is AWS Sign-In?</a> in the <em>AWS Sign-In User Guide</em>.</p>
</div>
<div class="paragraph">
<p>For reference information when using AWS <code class="noloc">SDKs</code> and tools, including the AWS CLI, see the  <a href="https://docs.aws.amazon.com/sdkref/latest/guide/overview.html">AWS SDKs and Tools Reference Guide</a>.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="configure-access-sso-example-cli">9.6. Example: Authenticate with IAM Identity Center automatic token refresh for use with the AWS CDK <code class="noloc">CLI</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>In this example, we configure the AWS Command Line Interface to authenticate our user with the AWS IAM Identity Center token provider configuration. The SSO token provider configuration lets the AWS CLI automatically retrieve refreshed authentication tokens to generate short-term credentials that we can use with the AWS Cloud Development Kit (AWS CDK) Command Line Interface (AWS CDK  <code class="noloc">CLI</code>).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In this example, we configure the AWS Command Line Interface (AWS CLI) to authenticate our user with the AWS IAM Identity Center token provider configuration. The SSO token provider configuration lets the AWS CLI automatically retrieve refreshed authentication tokens to generate short-term credentials that we can use with the AWS Cloud Development Kit (AWS CDK) Command Line Interface (AWS CDK  <code class="noloc">CLI</code>).</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="configure-access-sso-example-cli-prerequisites">9.6.1. Prerequisites</h4>
<div class="paragraph">
<p>This example assumes that the following prerequisites have been completed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prerequisites required to get set up with AWS and install our starting <code class="noloc">CLI</code> tools. For more information, see  <a href="#configure-access-prerequisites">Prerequisites</a>.</p>
</li>
<li>
<p>IAM Identity Center has been set up by our organization as the method of managing users.</p>
</li>
<li>
<p>At least one user has been created in IAM Identity Center.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configure-access-sso-example-cli-configure">9.6.2. Step 1: Configure the AWS CLI</h4>
<div class="paragraph">
<p>For detailed instructions on this step, see  <a href="https://docs.aws.amazon.com/cli/latest/userguide/sso-configure-profile-token.html">Configure the AWS CLI to use IAM Identity Center token provider credentials with automatic authentication refresh</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>We sign in to the AWS access portal provided by our organization to gather our IAM Identity Center information. This includes the <strong>SSO start URL</strong> and  <strong>SSO Region</strong>.</p>
</div>
<div class="paragraph">
<p>Next, we use the AWS CLI <code>aws configure sso</code> command to configure an IAM Identity Center profile and <code>sso-session</code> on our local machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ aws configure sso
SSO session name (Recommended): my-sso
SSO start URL [None]: https://my-sso-portal.awsapps.com/start
SSO region [None]: us-east-1
SSO registration scopes [sso:account:access]: &lt;ENTER&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CLI attempts to open our default browser to begin the login process for our IAM Identity Center account. If the AWS CLI is unable to open our browser, instructions are provided to manually start the login process. This process associates the IAM Identity Center session with our current AWS CLI session.</p>
</div>
<div class="paragraph">
<p>After establishing our session, the AWS CLI displays the AWS accounts available to us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>There are 2 AWS accounts available to you.
&gt; DeveloperAccount, developer-account-admin@example.com (123456789011)
  ProductionAccount, production-account-admin@example.com (123456789022)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the arrow keys to select our  <strong>DeveloperAccount</strong>.</p>
</div>
<div class="paragraph">
<p>Next, the AWS CLI displays the IAM roles available to us from our selected account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">Using the account ID 123456789011
There are 2 roles available to you.
&gt; ReadOnly
  FullAccess</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the arrow keys to select  <strong>FullAccess</strong>.</p>
</div>
<div class="paragraph">
<p>Next, the AWS CLI prompts us to complete configuration by specifying a default output format, default AWS Region, and name for our profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">CLI default client Region [None]: us-west-2 &lt;ENTER&gt;&gt;
CLI default output format [None]: json &lt;ENTER&gt;
CLI profile name [123456789011_FullAccess]: my-dev-profile &lt;ENTER&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CLI displays a final message, showing how to use the named profile with the AWS CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">To use this profile, specify the profile name using --profile, as shown:

aws s3 ls --profile my-dev-profile</code></pre>
</div>
</div>
<div class="paragraph">
<p>After completing this step, our  <code class="path">config</code> file will look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[profile`my-dev-profile`]
sso_session =`my-sso`sso_account_id =`123456789011`sso_role_name =`fullAccess`region =`us-west-2`output =`json`[sso-session`my-sso`]
sso_region =`us-east-1`sso_start_url =`https://my-sso-portal.awsapps.com/start`sso_registration_scopes =`sso:account:access`</pre>
</div>
</div>
<div class="paragraph">
<p>We can now use this  <code>sso-session</code> and named profile to request security credentials.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-access-sso-example-cli-credentials">9.6.3. Step 2: Use the AWS CLI to generate security credentials</h4>
<div class="paragraph">
<p>For detailed instructions on this step, see  <a href="https://docs.aws.amazon.com/cli/latest/userguide/sso-using-profile.html">Use an IAM Identity Center named profile</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>We use the AWS CLI <code>aws sso login</code> command to request security credentials for our profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws sso login --profile my-dev-profile</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AWS CLI attempts to open our default browser and verifies our IAM log in. If we are not currently signed into IAM Identity Center, we will be prompted to complete the sign in process. If the AWS CLI is unable to open our browser, instructions are provided to manually start the authorization process.</p>
</div>
<div class="paragraph">
<p>After successfully logging in, the AWS CLI caches our IAM Identity Center session credentials. These credentials include an expiration timestamp. When they expire, the AWS CLI will request that we sign in to IAM Identity Center again.</p>
</div>
<div class="paragraph">
<p>Using valid IAM Identity Center credentials, the AWS CLI securely retrieves AWS credentials for the IAM role specified in our profile. From here, we can use the AWS CDK <code class="noloc">CLI</code> with our credentials.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-access-sso-example-cli-cdk">9.6.4. Step 3: Use the CDK <code class="noloc">CLI</code></h4>
<div class="paragraph">
<p>With any CDK  <code class="noloc">CLI</code> command, we use the  <code><a href="#ref-cli-cmd-options-profile">--profile</a></code> option to specify the named profile that we generated credentials for. If our credentials are valid, the CDK <code class="noloc">CLI</code> will successfully perform the command. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff --profile my-dev-profile
Stack CdkAppStack
Hold on while we create a read-only change set to get a diff with accurate replacement information (use --no-change-set to use a less accurate but faster template-only diff)
Resources
[-] AWS::S3::Bucket amzn-s3-demo-bucket amzn-s3-demo-bucket5AF9C99B destroy

Outputs
[-] Output BucketRegion: {"Value":{"Ref":"AWS::Region"}}


✨  Number of stacks with differences: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>When our credentials expire, an error message like the following will display:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff --profile my-dev-profile
Stack CdkAppStack

Unable to resolve AWS account to use. It must be either configured when you define your CDK Stack, or through the environment</code></pre>
</div>
</div>
<div class="paragraph">
<p>To refresh our credentials, we use the AWS CLI  <code>aws sso login</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws sso login --profile my-dev-profile</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="configure-env">10. Configure environments to use with the AWS CDK</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>You can configure AWS environments in multiple ways to use with the AWS Cloud Development Kit (AWS CDK). The best method of managing AWS environments will vary, based on your specific needs.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You can configure AWS environments in multiple ways to use with the AWS Cloud Development Kit (AWS CDK). The best method of managing AWS environments will vary, based on your specific needs.</p>
</div>
<div class="paragraph">
<p>Each CDK stack in your application must eventually be associated with an environment to determine where the stack gets deployed to.</p>
</div>
<div class="paragraph">
<p>For an introduction to AWS environments, see <a href="#environments">Environments for the AWS CDK</a>.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect2">
<h3 id="configure-env-where">10.1. Where you can specify environments from</h3>
<div class="paragraph">
<p>You can specify environments in credentials and configuration files, or by using the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#env">env</a></code> property of the <code>Stack</code> construct from the AWS Construct Library.</p>
</div>
<div class="sect3">
<h4 id="configure-env-where-files">10.1.1. Credentials and configuration files</h4>
<div class="paragraph">
<p>You can use the AWS Command Line Interface (AWS CLI) to create  <code class="path">credentials</code> and  <code class="path">config</code> files that store, organize, and manage your AWS environment information. To learn more about these files, see  <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html">Configuration and credential file settings</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
</div>
<div class="paragraph">
<p>Values stored in these files are organized by <em>profiles</em>. How you name your profiles and the key-value pairs in these files will vary based on your method of configuring programmatic access. To learn more about the different methods, see <a href="#configure-access">Configure security credentials for the AWS CDK CLI</a>.</p>
</div>
<div class="paragraph">
<p>In general, the AWS CDK resolves AWS account information from your <code class="path">credentials</code> file and AWS Region information from your  <code class="path">config</code> file.</p>
</div>
<div class="paragraph">
<p>Once you have your <code class="path">credentials</code> and  <code class="path">config</code> files configured, you can specify the environment to use with the AWS CDK  <code class="noloc">CLI</code> and through environment variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-env-where-env">10.1.2. env property of the Stack construct</h4>
<div class="paragraph">
<p>You can specify the environment for each stack by using the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#env">env</a></code> property of the <code>Stack</code> construct. This property defines an account and Region to use. You can pass hard-coded values to this property or pass environment variables that are offered by the CDK.</p>
</div>
<div class="paragraph">
<p>To pass environment variables, use the <code>AWS_DEFAULT_ACCOUNT</code> and <code>AWS_DEFAULT_REGION</code> environment variables. These environment variables can pass values from your <code class="path">credentials</code> and  <code class="path">config</code> files. You can also use logic within your CDK code to determine the values of these environment variables.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-env-precedence">10.2. Environment precedence with the AWS CDK</h3>
<div class="paragraph">
<p>If you use multiple methods of specifying environments, the AWS CDK adheres to the following precedence:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hard-coded values specified with the <code>env</code> property of the <code>Stack</code> construct.</p>
</li>
<li>
<p><code>AWS_DEFAULT_ACCOUNT</code> and <code>AWS_DEFAULT_REGION</code> environment variables specified with the <code>env</code> property of the <code>Stack</code> construct.</p>
</li>
<li>
<p>Environment information associated with the profile from your <code class="path">credentials</code> and  <code class="path">config</code> files and passed to the CDK  <code class="noloc">CLI</code> using the  <code>--profile</code> option.</p>
</li>
<li>
<p>The <code>default</code> profile from your <code class="path">credentials</code> and  <code class="path">config</code> files.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configure-env-when">10.3. When to specify environments</h3>
<div class="paragraph">
<p>When you develop with the CDK, you start by defining CDK stacks, which contain constructs that represent AWS resources. Next, you synthesize each CDK stack into an AWS CloudFormation template. You then deploy the CloudFormation template to your environment. How you specify environments determines when your environment information gets applied and can affect CDK behavior and outcomes.</p>
</div>
<div class="sect3">
<h4 id="configure-env-when-synth">10.3.1. Specify environments at template synthesis</h4>
<div class="paragraph">
<p>When you specify environment information using the  <code>env</code> property of the <code>Stack</code> construct, your environment information is applied at template synthesis. Running <code>cdk synth</code> or <code>cdk deploy</code> produces an environment-specific CloudFormation template.</p>
</div>
<div class="paragraph">
<p>If you use environment variables within the <code>env</code> property, you must use the <code>--profile</code> option with CDK <code class="noloc">CLI</code> commands to pass in the profile containing your environment information from your credentials and configuration files. This information will then be applied at template synthesis to produce an environment-specific template.</p>
</div>
<div class="paragraph">
<p>Environment information within the CloudFormation template takes precedence over other methods. For example, if you provide a different environment with <code>cdk deploy --profile [replaceable]</code>profile````, the profile will be ignored.</p>
</div>
<div class="paragraph">
<p>When you provide environment information in this way, you can use environment-dependent code and logic within your CDK app. This also means that the synthesized template could be different, based on the machine, user, or session that it&#8217;s synthesized under. This approach is often acceptable or desirable during development, but is not recommended for production use.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-env-when-deploy">10.3.2. Specify environments at stack deployment</h4>
<div class="paragraph">
<p>If you don&#8217;t specify an environment using the  <code>env</code> property of the <code>Stack</code> construct, the CDK <code class="noloc">CLI</code> will produce an environment-agnostic CloudFormation template at synthesis. You can then specify the environment to deploy to by using  <code>cdk deploy --profile [replaceable]</code>profile````.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify a profile when deploying an environment-agnostic template, the CDK <code class="noloc">CLI</code> will attempt to use environment values from the  <code>default</code> profile of your <code>credentials</code> and <code>config</code> files at deployment.</p>
</div>
<div class="paragraph">
<p>If environment information is not available at deployment, AWS CloudFormation will attempt to resolve environment information at deployment through environment-related attributes such as <code>stack.account</code>, <code>stack.region</code>, and <code>stack.availabilityZones</code>.</p>
</div>
<div class="paragraph">
<p>For environment-agnostic stacks, constructs within the stack cannot use environment information and you cannot use logic that requires environment information. For example, you cannot write code like <code>if (stack.region ==== 'us-east-1')</code> or use construct methods that require environment information such as <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Vpc.html#static-fromwbrlookupscope-id-options">Vpc.fromLookup</a></code>. To use these features, you must specify an environment with the <code>env</code> property.</p>
</div>
<div class="paragraph">
<p>For environment-agnostic stacks, any construct that uses Availability Zones will see two Availability Zones, allowing the stack to be deployed to any Region.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-env-how">10.4. How to specify environments with the AWS CDK</h3>
<div class="sect3">
<h4 id="configure-env-how-hard-coded">10.4.1. Specify hard-coded environments for each stack</h4>
<div class="paragraph">
<p>Use the  <code>env</code> property of the <code>Stack</code> construct to specify AWS environment values for your stack. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const envEU  = { account: '2383838383', region: 'eu-west-1' };
const envUSA = { account: '8373873873', region: 'us-west-2' };

new MyFirstStack(app, 'first-stack-us', { env: envUSA });
new MyFirstStack(app, 'first-stack-eu', { env: envEU });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const envEU  = { account: '2383838383', region: 'eu-west-1' };
const envUSA = { account: '8373873873', region: 'us-west-2' };

new MyFirstStack(app, 'first-stack-us', { env: envUSA });
new MyFirstStack(app, 'first-stack-eu', { env: envEU });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">env_EU = cdk.Environment(account="8373873873", region="eu-west-1")
env_USA = cdk.Environment(account="2383838383", region="us-west-2")

MyFirstStack(app, "first-stack-us", env=env_USA)
MyFirstStack(app, "first-stack-eu", env=env_EU)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyApp {

    // Helper method to build an environment
    static Environment makeEnv(String account, String region) {
        return Environment.builder()
                .account(account)
                .region(region)
                .build();
    }

    public static void main(final String argv[]) {
        App app = new App();

        Environment envEU = makeEnv("8373873873", "eu-west-1");
        Environment envUSA = makeEnv("2383838383", "us-west-2");

        new MyFirstStack(app, "first-stack-us", StackProps.builder()
                .env(envUSA).build());
        new MyFirstStack(app, "first-stack-eu", StackProps.builder()
                .env(envEU).build());

        app.synth();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Amazon.CDK.Environment makeEnv(string account, string region)
{
    return new Amazon.CDK.Environment
    {
        Account = account,
        Region = region
    };
}

var envEU = makeEnv(account: "8373873873", region: "eu-west-1");
var envUSA = makeEnv(account: "2383838383", region: "us-west-2");

new MyFirstStack(app, "first-stack-us", new StackProps { Env=envUSA });
new MyFirstStack(app, "first-stack-eu", new StackProps { Env=envEU });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">env_EU := awscdk.Environment{
	Account: jsii.String("8373873873"),
	Region:  jsii.String("eu-west-1"),
}

env_USA := awscdk.Environment{
	Account: jsii.String("2383838383"),
	Region:  jsii.String("us-west-2"),
}

MyFirstStack(app, "first-stack-us", &amp;awscdk.StackProps{
	Env: &amp;env_USA,
})

MyFirstStack(app, "first-stack-eu", &amp;awscdk.StackProps{
	Env: &amp;env_EU,
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend this approach for production environments. By explicitly specifying the environment in this way, you can ensure that the stack is always deployed to the specific environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-env-how-env">10.4.2. Specify environments using environment variables</h4>
<div class="paragraph">
<p>The AWS CDK provides two environment variables that you can use within your CDK code:  <code>CDK_DEFAULT_ACCOUNT</code> and <code>CDK_DEFAULT_REGION</code>. When you use these environment variables within the <code>env</code> property of your stack instance, you can pass environment information from your credentials and configuration files using the CDK <code class="noloc">CLI</code><code>--profile</code> option.</p>
</div>
<div class="paragraph">
<p>The following is an example of how to specify these environment variables:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Access environment variables via Node&#8217;s <code>process</code> object.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need the <code>DefinitelyTyped</code> module to use <code>process</code> in TypeScript. <code>cdk init</code> installs this module for you. However, you should install this module manually if you are working with a project created before it was added, or if you didn&#8217;t set up your project using <code>cdk init</code>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm install @types/node</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyDevStack(app, 'dev', {
  env: {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION
}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Access environment variables via Node&#8217;s <code>process</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyDevStack(app, 'dev', {
  env: {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION
}});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the <code>os</code> module&#8217;s <code>environ</code> dictionary to access environment variables.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import os
MyDevStack(app, "dev", env=cdk.Environment(
    account=os.environ["CDK_DEFAULT_ACCOUNT"],
    region=os.environ["CDK_DEFAULT_REGION"]))</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use <code>System.getenv()</code> to get the value of an environment variable.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyApp {

    // Helper method to build an environment
    static Environment makeEnv(String account, String region) {
        account = (account == null) ? System.getenv("CDK_DEFAULT_ACCOUNT") : account;
        region = (region == null) ? System.getenv("CDK_DEFAULT_REGION") : region;

        return Environment.builder()
                .account(account)
                .region(region)
                .build();
    }

    public static void main(final String argv[]) {
        App app = new App();

        Environment envEU = makeEnv(null, null);
        Environment envUSA = makeEnv(null, null);

        new MyDevStack(app, "first-stack-us", StackProps.builder()
                .env(envUSA).build());
        new MyDevStack(app, "first-stack-eu", StackProps.builder()
                .env(envEU).build());

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use <code>System.Environment.GetEnvironmentVariable()</code> to get the value of an environment variable.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Amazon.CDK.Environment makeEnv(string account=null, string region=null)
{
    return new Amazon.CDK.Environment
    {
        Account = account ?? System.Environment.GetEnvironmentVariable("CDK_DEFAULT_ACCOUNT"),
        Region = region ?? System.Environment.GetEnvironmentVariable("CDK_DEFAULT_REGION")
    };
}

new MyDevStack(app, "dev", new StackProps { Env = makeEnv() });</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">import "os"

MyDevStack(app, "dev", &amp;awscdk.StackProps{
	Env: &amp;awscdk.Environment{
		Account: jsii.String(os.Getenv("CDK_DEFAULT_ACCOUNT")),
		Region:  jsii.String(os.Getenv("CDK_DEFAULT_REGION")),
    },
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>By specifying environments using environment variables, you can have the same CDK stack synthesize to AWS CloudFormation templates for different environments. This means that you can deploy the same CDK stack to different AWS environments without having to modify your CDK code. You only have to specify the profile to use when running  <code>cdk synth</code>.</p>
</div>
<div class="paragraph">
<p>This approach is great for development environments when deploying the same stack to different environments. However, we do not recommend this approach for production environments since the same CDK code can synthesize different templates, depending on the machine, user, or session that it&#8217;s synthesized under.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-env-how-files">10.4.3. Specify environments from your credentials and configuration files with the CDK <code class="noloc">CLI</code></h4>
<div class="paragraph">
<p>When deploying an environment-agnostic template, use the  <code>--profile</code> option with any CDK <code class="noloc">CLI</code> command to specify the profile to use. The following is an example that deploys a CDK stack named  <code>myStack</code> using the <code>prod</code> profile that is defined in the <code class="path">credentials</code> and  <code class="path">config</code> files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy myStack --profile prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the  <code>--profile</code> option, along with other CDK <code class="noloc">CLI</code> commands and options, see  <a href="#ref-cli-cmd">AWS CDK CLI command reference</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-env-considerations">10.5. Considerations when configuring environments with the AWS CDK</h3>
<div class="paragraph">
<p>Services that you define by using constructs within your stacks must support the Region that you are deploying to. For a list of supported AWS services per region, see  <a href="https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/">AWS Services by Region</a>.</p>
</div>
<div class="paragraph">
<p>You must have valid AWS Identity and Access Management (IAM) credentials to perform stack deployments with the AWS CDK into your specified environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure-env-examples">10.6. Examples</h3>
<div class="sect3">
<h4 id="configure-env-examples-agnostic">10.6.1. Synthesize an environment–agnostic CloudFormation template from a CDK stack</h4>
<div class="paragraph">
<p>In this example, we create an environment-agnostic CloudFormation template from our CDK stack. We can then deploy this template to any environment.</p>
</div>
<div class="paragraph">
<p>The following is our example CDK stack. This stack defines an Amazon S3 bucket and a CloudFormation stack output for the bucket&#8217;s Region. For this example, <code>env</code> is not defined:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export class CdkAppStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Create the S3 bucket
    const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket', {
      removalPolicy: cdk.RemovalPolicy.DESTROY,
    });

    // Create an output for the bucket's Region
    new cdk.CfnOutput(this, 'BucketRegion', {
      value: bucket.env.region,
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class CdkAppStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Create the S3 bucket
    const bucket = new s3.Bucket(this, 'amzn-s3-demo-bucket', {
      removalPolicy: cdk.RemovalPolicy.DESTROY,
    });

    // Create an output for the bucket's Region
    new cdk.CfnOutput(this, 'BucketRegion', {
      value: bucket.env.region,
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class CdkAppStack(cdk.Stack):

    def __init__(self, scope: cdk.Construct, id: str, **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        # Create the S3 bucket
        bucket = s3.Bucket(self, 'amzn-s3-demo-bucket',
            removal_policy=cdk.RemovalPolicy.DESTROY
        )

        # Create an output for the bucket's Region
        cdk.CfnOutput(self, 'BucketRegion',
            value=bucket.env.region
        )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CdkAppStack extends Stack {

    public CdkAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Create the S3 bucket
        Bucket bucket = Bucket.Builder.create(this, "amzn-s3-demo-bucket")
            .removalPolicy(RemovalPolicy.DESTROY)
            .build();

        // Create an output for the bucket's Region
        CfnOutput.Builder.create(this, "BucketRegion")
            .value(this.getRegion())
            .build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">namespace MyCdkApp
{
    public class CdkAppStack : Stack
    {
        public CdkAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Create the S3 bucket
            var bucket = new Bucket(this, "amzn-s3-demo-bucket", new BucketProps
            {
                RemovalPolicy = RemovalPolicy.DESTROY
            });

            // Create an output for the bucket's Region
            new CfnOutput(this, "BucketRegion", new CfnOutputProps
            {
                Value = this.Region
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">func NewCdkAppStack(scope constructs.Construct, id string, props *CdkAppStackProps) awscdk.Stack {
	stack := awscdk.NewStack(scope, &amp;id, &amp;props.StackProps)

	// Create the S3 bucket
	bucket := awss3.NewBucket(stack, jsii.String("amzn-s3-demo-bucket"), &amp;awss3.BucketProps{
		RemovalPolicy: awscdk.RemovalPolicy_DESTROY,
	})

	// Create an output for the bucket's Region
	awscdk.NewCfnOutput(stack, jsii.String("BucketRegion"), &amp;awscdk.CfnOutputProps{
		Value: stack.Region(),
	})

	return stack
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, the CDK <code class="noloc">CLI</code> produces a CloudFormation template with the pseudo parameter  <code>AWS::Region</code> as the output value for the bucket&#8217;s Region. This parameter will be resolved at deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Outputs:
  BucketRegion:
    Value:
      Ref: AWS::Region</code></pre>
</div>
</div>
<div class="paragraph">
<p>To deploy this stack to an environment that is specified in the  <code>dev</code> profile of our credentials and configuration files, we run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy CdkAppStack --profile dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t specify a profile, the CDK  <code class="noloc">CLI</code> will attempt to use environment information from the  <code>default</code> profile in our credentials and configuration files.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-env-example-logic">10.6.2. Use logic to determine environment information at template synthesis</h4>
<div class="paragraph">
<p>In this example, we configure the  <code>env</code> property of our <code>stack</code> instance to use a valid expression. We specify two additional environment variables, <code>CDK_DEPLOY_ACCOUNT</code> and <code>CDK_DEPLOY_REGION</code>. These environment variables can override defaults at synthesis time if they exist:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyDevStack(app, 'dev', {
  env: {
    account: process.env.CDK_DEPLOY_ACCOUNT || process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEPLOY_REGION || process.env.CDK_DEFAULT_REGION
}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyDevStack(app, 'dev', {
  env: {
    account: process.env.CDK_DEPLOY_ACCOUNT || process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEPLOY_REGION || process.env.CDK_DEFAULT_REGION
}});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">MyDevStack(app, "dev", env=cdk.Environment(
    account=os.environ.get("CDK_DEPLOY_ACCOUNT", os.environ["CDK_DEFAULT_ACCOUNT"]),
    region=os.environ.get("CDK_DEPLOY_REGION", os.environ["CDK_DEFAULT_REGION"])</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyApp {

    // Helper method to build an environment
    static Environment makeEnv(String account, String region) {
        account = (account == null) ? System.getenv("CDK_DEPLOY_ACCOUNT") : account;
        region = (region == null) ? System.getenv("CDK_DEPLOY_REGION") : region;
        account = (account == null) ? System.getenv("CDK_DEFAULT_ACCOUNT") : account;
        region = (region == null) ? System.getenv("CDK_DEFAULT_REGION") : region;

        return Environment.builder()
                .account(account)
                .region(region)
                .build();
    }

    public static void main(final String argv[]) {
        App app = new App();

        Environment envEU = makeEnv(null, null);
        Environment envUSA = makeEnv(null, null);

        new MyDevStack(app, "first-stack-us", StackProps.builder()
                .env(envUSA).build());
        new MyDevStack(app, "first-stack-eu", StackProps.builder()
                .env(envEU).build());

        app.synth();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">Amazon.CDK.Environment makeEnv(string account=null, string region=null)
{
    return new Amazon.CDK.Environment
    {
        Account = account ??
            System.Environment.GetEnvironmentVariable("CDK_DEPLOY_ACCOUNT") ??
            System.Environment.GetEnvironmentVariable("CDK_DEFAULT_ACCOUNT"),
        Region = region ??
            System.Environment.GetEnvironmentVariable("CDK_DEPLOY_REGION") ??
            System.Environment.GetEnvironmentVariable("CDK_DEFAULT_REGION")
    };
}

new MyDevStack(app, "dev", new StackProps { Env = makeEnv() });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">var account, region string
var b bool

if account, b = os.LookupEnv("CDK_DEPLOY_ACCOUNT"); !b || len(account) == 0 {
	account = os.Getenv("CDK_DEFAULT_ACCOUNT")
}
if region, b = os.LookupEnv("CDK_DEPLOY_REGION"); !b || len(region) == 0 {
	region = os.Getenv("CDK_DEFAULT_REGION")
}

MyDevStack(app, "dev", &amp;awscdk.StackProps{
	Env: &amp;awscdk.Environment{
		Account: &amp;account,
		Region:  &amp;region,
	},
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>With our stack&#8217;s environment declared this way, we can then write a short script or batch file and set variables from command line arguments, then call  <code>cdk deploy</code>. The following is an example. Any arguments beyond the first two are passed through to <code>cdk deploy</code> to specify command line options or arguments:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash
if [[ $# -ge 2 ]]; then
    export CDK_DEPLOY_ACCOUNT=$1
    export CDK_DEPLOY_REGION=$2
    shift; shift
    npx cdk deploy "$@"
    exit $?
else
    echo 1&gt;&amp;2 "Provide account and region as first two args."
    echo 1&gt;&amp;2 "Additional args are passed through to cdk deploy."
    exit 1
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Save the script as  <code class="path">cdk-deploy-to.sh</code>, then execute  <code>chmod +x cdk-deploy-to.sh</code> to make it executable.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bat" data-lang="bat">@findstr /B /V @ %~dpnx0 &gt; %~dpn0.ps1 &amp;&amp; powershell -ExecutionPolicy Bypass %~dpn0.ps1 %*
@exit /B %ERRORLEVEL%
if ($args.length -ge 2) {
    $env:CDK_DEPLOY_ACCOUNT, $args = $args
    $env:CDK_DEPLOY_REGION,  $args = $args
    npx cdk deploy $args
    exit $lastExitCode
} else {
    [console]::error.writeline("Provide account and region as first two args.")
    [console]::error.writeline("Additional args are passed through to cdk deploy.")
    exit 1
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>The Windows version of the script uses PowerShell to provide the same functionality as the macOS/Linux version. It also contains instructions to allow it to be run as a batch file so it can be easily invoked from a command line. It should be saved as  <code class="path">cdk-deploy-to.bat</code>. The file  <code class="path">cdk-deploy-to.ps1</code> will be created when the batch file is invoked.</p>
</div>
<div class="paragraph">
<p>We can then write additional scripts that use the  <code class="path">cdk-deploy-to</code> script to deploy to specific environments. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash
# cdk-deploy-to-test.sh
./cdk-deploy-to.sh 123457689 us-east-1 "$@"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bat" data-lang="bat">@echo off
rem cdk-deploy-to-test.bat
cdk-deploy-to 135792469 us-east-1 %*</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example that uses the  <code class="path">cdk-deploy-to</code> script to deploy to multiple environments. If the first deployment fails, the process stops:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash
# cdk-deploy-to-prod.sh
./cdk-deploy-to.sh 135792468 us-west-1 "$@" || exit
./cdk-deploy-to.sh 246813579 eu-west-1 "$@"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bat" data-lang="bat">@echo off
rem cdk-deploy-to-prod.bat
cdk-deploy-to 135792469 us-west-1 %* || exit /B
cdk-deploy-to 245813579 eu-west-1 %*</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="bootstrapping-env">11. Bootstrap your environment for use with the AWS CDK</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Bootstrap your AWS environment before using the AWS Cloud Development Kit (AWS CDK) to deploy CDK stacks into your environment.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Bootstrap your AWS environment to prepare it for AWS Cloud Development Kit (AWS CDK) stack deployments.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For an introduction to environments, see <a href="#environments">Environments for the AWS CDK</a>.</p>
</li>
<li>
<p>For an introduction to bootstrapping, see <a href="#bootstrapping">AWS CDK bootstrapping</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="bootstrapping-howto">11.1. How to bootstrap your environment</h3>
<div class="paragraph">
<p>You can use the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>) or your preferred AWS CloudFormation deployment tool to bootstrap your environment.</p>
</div>
<div class="sect3">
<h4 id="bootstrapping-howto-cli">11.1.1. Use the CDK <code class="noloc">CLI</code></h4>
<div class="paragraph">
<p>You can use the CDK  <code class="noloc">CLI</code><code>cdk bootstrap</code> command to bootstrap your environment. This is the method that we recommend if you don&#8217;t require significant modifications to bootstrapping.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Bootstrap from any working directory</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To bootstrap from any working directory, provide the environment to bootstrap as a command line argument. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap aws://123456789012/us-east-1</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you don&#8217;t have your AWS account number, you can get it from the AWS Management Console. You can also use the following AWS CLI command to display your default account information, including your account number:
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ aws sts get-caller-identity</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have named profiles in your AWS <code class="path">config</code> and  <code class="path">credentials</code> files, use the  <code>--profile</code> option to retrieve account information for a specific profile. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ aws sts get-caller-identity --profile prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>To display the default Region, use the <code>aws configure get</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ aws configure get region
$ aws configure get region --profile prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>When providing an argument, the  <code>aws://</code> prefix is optional. The following is valid:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap 123456789012/us-east-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>To bootstrap multiple environments at the same time, provide multiple arguments:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap aws://123456789012/us-east-1 aws://123456789012/us-east-2</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Bootstrap from the parent directory of a CDK project</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>You can run <code>cdk bootstrap</code> from the parent directory of a CDK project containing a <code class="path">cdk.json</code> file. If you don&#8217;t provide an environment as an argument, the CDK  <code class="noloc">CLI</code> will obtain environment information from default sources, such as your  <code class="path">config</code> and  <code class="path">credentials</code> files or any environment information specified for your CDK stack.</p>
<div class="paragraph">
<p>When you bootstrap from the parent directory of a CDK project, environments provided from command line arguments take precedence over other sources.</p>
</div>
<div class="paragraph">
<p>To bootstrap an environment that is specified in your <code class="path">config</code> and  <code class="path">credentials</code> files, use the  <code>--profile</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --profile prod</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For more information on the  <code>cdk bootstrap</code> command and supported options, see <a href="#ref-cli-cmd-bootstrap">cdk bootstrap</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-howto-cfn">11.1.2. Use any AWS CloudFormation tool</h4>
<div class="paragraph">
<p>You can copy the  <a href="https://github.com/aws/aws-cdk-cli/blob/main/packages/aws-cdk/lib/api/bootstrap/bootstrap-template.yaml">bootstrap template</a> from the <em>aws-cdk-cli <code class="noloc">GitHub</code> repository</em> or obtain the template with the <code>cdk bootstrap --show-template</code> command. Then, use any AWS CloudFormation tool to deploy the template into your environment.</p>
</div>
<div class="paragraph">
<p>With this method, you can use AWS CloudFormation StackSets or AWS Control Tower. You can also use the AWS CloudFormation console or the AWS Command Line Interface (AWS CLI). You can make modifications to your template before you deploy it. This method may be more flexible and suitable for large-scale deployments.</p>
</div>
<div class="paragraph">
<p>The following is an example of using the <code>--show-template</code> option to retrieve and save the bootstrap template to your local machine:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --show-template &gt; bootstrap-template.yaml</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>On Windows, PowerShell must be used to preserve the encoding of the template.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">powershell "cdk bootstrap --show-template | Out-File -encoding utf8 bootstrap-template.yaml"</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If CDK notices are appearing in your AWS CloudFormation template output, provide the  <code>--no-notices</code> option with your command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To deploy this template using the CDK  <code class="noloc">CLI</code>, you can run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --template bootstrap-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of using the AWS CLI to deploy the template:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws cloudformation create-stack \
  --stack-name CDKToolkit \
  --template-body file://path/to/bootstrap-template.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region us-west-1</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws cloudformation create-stack ^
  --stack-name CDKToolkit ^
  --template-body file://path/to/bootstrap-template.yaml ^
  --capabilities CAPABILITY_NAMED_IAM ^
  --region us-west-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information on using CloudFormation StackSets to bootstrap multiple environments, see  <a href="https://aws.amazon.com/blogs/mt/bootstrapping-multiple-aws-accounts-for-aws-cdk-using-cloudformation-stacksets/">Bootstrapping multiple AWS accounts for AWS CDK using CloudFormation StackSets</a> in the <em>AWS Cloud Operations &amp; Migrations Blog</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-env-when">11.2. When to bootstrap your environment</h3>
<div class="paragraph">
<p>You must bootstrap each AWS environment before you deploy into the environment. We recommend that you proactively bootstrap each environment that you plan to use. You can do this before you plan on actually deploying CDK apps into the environment. By proactively bootstrapping your environments, you prevent potential future issues such as Amazon S3 bucket name conflicts or deploying CDK apps into environments that haven&#8217;t been bootstrapped.</p>
</div>
<div class="paragraph">
<p>It&#8217;s okay to bootstrap an environment more than once. If an environment has already been bootstrapped, the bootstrap stack will be upgraded if necessary. Otherwise, nothing will happen.</p>
</div>
<div class="paragraph">
<p>If you attempt to deploy a CDK stack into an environment that hasn&#8217;t been bootstrapped, you will see an error like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy

✨  Synthesis time: 2.02s

 ❌ Deployment failed: Error: BootstrapExampleStack: SSM parameter /cdk-bootstrap/hnb659fds/version not found. Has the environment been bootstrapped? Please run 'cdk bootstrap' (see https://docs.aws.amazon.com/cdk/latest/guide/bootstrapping.html)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-env-when-update">11.2.1. Update your bootstrap stack</h4>
<div class="paragraph">
<p>Periodically, the CDK team will update the bootstrap template to a new version. When this happens, we recommend that you update your bootstrap stack. If you haven&#8217;t customized the bootstrapping process, you can update your bootstrap stack by following the same steps that you took to originally bootstrap your environment. For more information, see  <a href="#bootstrap-template-history">Bootstrap template version history</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-env-default">11.3. Default resources created during bootstrapping</h3>
<div class="sect3">
<h4 id="bootstrapping-env-roles">11.3.1. IAM roles created during bootstrapping</h4>
<div class="paragraph">
<p>By default, bootstrapping provisions the following AWS Identity and Access Management (IAM) roles in your environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CloudFormationExecutionRole</code></p>
</li>
<li>
<p><code>DeploymentActionRole</code></p>
</li>
<li>
<p><code>FilePublishingRole</code></p>
</li>
<li>
<p><code>ImagePublishingRole</code></p>
</li>
<li>
<p><code>LookupRole</code></p>
</li>
</ul>
</div>
<div id="bootstrapping-env-roles-cfn" class="dlist">
<dl>
<dt class="hdlist1"><code>CloudFormationExecutionRole</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This IAM role is a CloudFormation service role that grants CloudFormation permission to perform stack deployments on your behalf. This role gives CloudFormation permission to perform AWS API calls in your account, including deploying stacks.</p>
<div class="paragraph">
<p>By using a service role, the permissions provisioned for the service role determine what actions can be performed on your CloudFormation resources. Without this service role, the security credentials you provide with the CDK <code class="noloc">CLI</code> would determine what CloudFormation is allowed to do.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-env-roles-deploy" class="dlist">
<dl>
<dt class="hdlist1"><code>DeploymentActionRole</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This IAM role grants permission to perform deployments into your environment. It is assumed by the CDK <code class="noloc">CLI</code> during deployments.</p>
<div class="paragraph">
<p>By using a role for deployments, you can perform cross-account deployments since the role can be assumed by AWS identities in a different account.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-env-roles-s3" class="dlist">
<dl>
<dt class="hdlist1"><code>FilePublishingRole</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This IAM role grants permission to perform actions against the bootstrapped Amazon Simple Storage Service (Amazon S3) bucket, including uploading and deleting assets. It is assumed by the CDK <code class="noloc">CLI</code> during deployments.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-env-roles-ecr" class="dlist">
<dl>
<dt class="hdlist1"><code>ImagePublishingRole</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This IAM role grants permission to perform actions against the bootstrapped Amazon Elastic Container Registry (Amazon ECR) repository. It is assumed by the CDK <code class="noloc">CLI</code> during deployments.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-env-roles-lookup" class="dlist">
<dl>
<dt class="hdlist1"><code>LookupRole</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This IAM role grants <code>readOnly</code> permission to look up <a href="#context">context values</a> from the AWS environment. It is assumed by the CDK <code class="noloc">CLI</code> when performing tasks such as template synthesis and deployments.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-env-default-id">11.3.2. Resource IDs created during bootstrapping</h4>
<div class="paragraph">
<p>When you deploy the default bootstrap template, physical IDs for bootstrap resources are created using the following structure:  <code>cdk-[replaceable]</code>qualifier<code>-[replaceable]</code>description<code>-[replaceable]</code>account-ID<code>-[replaceable]</code>Region````.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Qualifier</strong> – A nine character unique string value of <code>hnb659fds</code>. The actual value has no significance.</p>
</li>
<li>
<p><strong>Description</strong> – A short description of the resource. For example, <code>container-assets</code>.</p>
</li>
<li>
<p><strong>Account ID</strong> – The AWS account ID of the environment.</p>
</li>
<li>
<p><strong>Region</strong> – The AWS Region of the environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example physical ID of the Amazon S3 staging bucket created during bootstrapping:  <code>cdk-hnb659fds-assets-012345678910-us-west-1</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-env-permissions">11.4. Permissions to use when bootstrapping your environment</h3>
<div class="paragraph">
<p>When bootstrapping an AWS environment, the IAM identity performing the bootstrapping must have at least the following permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cloudformation:*",
                "ecr:*",
                "ssm:*",
                "s3:*",
                "iam:*"
            ],
            "Resource": "*"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Over time, the bootstrap stack, including the resources that are created and permissions they require, may change. With future changes, you may need to modify the permissions required to bootstrap an environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-env-customize">11.5. Customize bootstrapping</h3>
<div class="paragraph">
<p>If the default bootstrap template doesn&#8217;t suit your needs, you can customize the bootstrapping of resources into your environment in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use command line options with the <code>cdk bootstrap</code> command – This method is best for making small, specific changes that are supported through command line options.</p>
</li>
<li>
<p>Modify the default bootstrap template and deploy it – This method is best for making complex changes or if you want complete control over the configuration of resources provisioned during bootstrapping.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on customizing bootstrapping, see  <a href="#bootstrapping-customizing">Customize AWS CDK bootstrapping</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-env-pipelines">11.6. Bootstrapping with CDK Pipelines</h3>
<div class="paragraph">
<p>If you are using CDK Pipelines to deploy into another account&#8217;s environment, and you receive a message like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Policy contains a statement with one or more invalid principals</pre>
</div>
</div>
<div class="paragraph">
<p>This error message means that the appropriate IAM roles do not exist in the other environment. The most likely cause is that the environment has not been bootstrapped. Bootstrap the environment and try again.</p>
</div>
<div class="sect3">
<h4 id="bootstrapping-env-pipelines-protect">11.6.1. Protecting your bootstrap stack from deletion</h4>
<div class="paragraph">
<p>If a bootstrap stack is deleted, the AWS resources that were originally provisioned in the environment to support CDK deployments will also be deleted. This will cause the pipeline to stop working. If this happens, there is no general solution for recovery.</p>
</div>
<div class="paragraph">
<p>After your environment is bootstrapped, do not delete and recreate the environment&#8217;s bootstrap stack. Instead, try to update the bootstrap stack to a new version by running the <code>cdk bootstrap</code> command again.</p>
</div>
<div class="paragraph">
<p>To protect against accidental deletion of your bootstrap stack, we recommend that you provide the <code>--termination-protection</code> option with the <code>cdk bootstrap</code> command to enable termination protection. You can enable termination protection on new or existing bootstrap stacks. For instructions on enabling termination protection, see <a href="#bootstrapping-customizing-cli-protection">Enable termination protection for the bootstrap stack</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrap-template-history">11.7. Bootstrap template version history</h3>
<div class="paragraph">
<p>The bootstrap template is versioned and evolves over time with the AWS CDK itself. If you provide your own bootstrap template, keep it up to date with the canonical default template. You want to make sure that your template continues to work with all CDK features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Earlier versions of the bootstrap template created an AWS KMS key in each bootstrapped environment by default. To avoid charges for the KMS key, re-bootstrap these environments using <code>--no-bootstrap-customer-key</code>. The current default is no KMS key, which helps avoid these charges.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This section contains a list of the changes made in each version.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template version</th>
<th class="tableblock halign-left valign-top">AWS CDK version</th>
<th class="tableblock halign-left valign-top">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.40.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial version of template with Bucket, Key, Repository, and Roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.45.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Split asset publishing role into separate file and image publishing roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.46.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>FileAssetKeyArn</code> export to be able to add decrypt permissions to asset consumers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.61.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS KMS permissions are now implicit via Amazon S3 and no longer require <code>FileAsetKeyArn</code>. Add <code>CdkBootstrapVersion</code> SSM parameter so the bootstrap stack version can be verified without knowing the stack name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.87.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment role can read SSM parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.108.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add lookup role separate from deployment role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.109.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attach <code>aws-cdk:bootstrap-role</code> tag to deployment, file publishing, and image publishing roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.110.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment role can no longer read Buckets in the target account directly. (However, this role is effectively an administrator, and could always use its AWS CloudFormation permissions to make the bucket readable anyway).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.114.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lookup role has full read-only permissions to the target environment, and has a <code>aws-cdk:bootstrap-role</code> tag as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixes Amazon S3 asset uploads from being rejected by commonly referenced encryption SCP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon ECR ScanOnPush is now enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>11</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.18.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds policy allowing Lambda to pull from Amazon ECR repos so it survives re-bootstrapping.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>12</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.20.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds support for experimental <strong class="command">cdk import</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>13</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.25.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makes container images in bootstrap-created Amazon ECR repositories immutable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>14</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.34.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns off Amazon ECR image scanning at the repository level by default to allow bootstrapping Regions that do not support image scanning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>15</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.60.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KMS keys cannot be tagged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>16</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.69.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addresses Security Hub finding <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/kms-controls.html#kms-2">KMS.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>17</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.72.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addresses Security Hub finding <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/ecr-controls.html#ecr-3">ECR.3</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>18</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.80.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reverted changes made for version 16 as they don&#8217;t work in all partitions and are are not recommended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>19</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.106.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reverted changes made to version 18 where AccessControl property was removed from the template. (<a href="https://github.com/aws/aws-cdk/issues/27964">#27964</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>20</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.119.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>ssm:GetParameters</code> action to the AWS CloudFormation deploy IAM role. For more information, see <a href="https://github.com/aws/aws-cdk/pull/28336/files#diff-4fdac38426c4747aa17d515b01af4994d3d2f12c34f7b6655f24328259beb7bf">#28336</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>21</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.149.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add condition to the file publishing role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>22</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.160.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>sts:TagSession</code> permissions to the trust policy of bootstrap IAM roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>23</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.161.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add <code>cloudformation:RollbackStack</code> and <code>cloudformation:ContinueUpdateRollback</code> permissions to the trust policy of the deploy IAM role. This provides permissions for the <code>cdk rollback</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>24</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.165.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change the duration of days that noncurrent objects in the bootstrap bucket will be retained, from 365 to 30 days. Since the new <code>cdk gc</code> command introduces the ability to delete objects in the bootstrap bucket, this new behavior ensures that deleted objects remain in the bootstrap bucket for 30 days instead of 365 days. For more information on this change, see <code>aws-cdk</code> PR <a href="https://github.com/aws/aws-cdk/pull/31949">#31949</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>25</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.165.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add support to the bootstrap bucket for the removal of incomplete multipart uploads. Incomplete multipart uploads will be deleted after 1 day. For more information on this change, see <code>aws-cdk</code> PR <a href="https://github.com/aws/aws-cdk/pull/31956">#31956</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>26</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1002.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add two deletion-related policies (<code>UpdateReplacePolicy</code> and <code>DeletionPolicy</code> to the <code>FileAssetsBucketEncryptionKey</code>) resource. These policies ensure that the old AWS KMS key resource will be properly deleted when the bootstrap stack is updated or deleted. For more information on this change, see <code>aws-cdk-cli</code> PR <a href="https://github.com/aws/aws-cdk-cli/pull/100">#100</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>27</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1003.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add new Amazon ECR resource policy to grant Amazon EMR Serverless specific permissions for retrieving container images. For more information on this change, see <code>aws-cdk-cli</code> PR <a href="https://github.com/aws/aws-cdk-cli/pull/112">#112</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="bootstrapping-template">11.8. Upgrade from legacy to modern bootstrap template</h3>
<div class="paragraph">
<p>The AWS CDK v1 supported two bootstrapping templates, legacy and modern. CDK v2 supports only the modern template. For reference, here are the high-level differences between these two templates.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Legacy (v1 only)</th>
<th class="tableblock halign-left valign-top">Modern (v1 and v2)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cross-account deployments</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not allowed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allowed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AWS CloudFormation Permissions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploys using current user&#8217;s permissions (determined by AWS profile, environment variables, etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploys using the permissions specified when the bootstrap stack was provisioned (for example, by using <code>--trust</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Versioning</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only one version of bootstrap stack is available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootstrap stack is versioned; new resources can be added in future versions, and AWS CDK apps can require a minimum version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resources</strong>*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon S3 bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon S3 bucket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS KMS key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IAM roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon ECR repository</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource naming</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically generated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deterministic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bucket encryption</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS managed key by default. You can customize to use a customer managed key.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><em>We will add additional resources to the bootstrap template as needed.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An environment that was bootstrapped using the legacy template must be upgraded to use the modern template for CDK v2 by re-bootstrapping. Re-deploy all AWS CDK applications in the environment at least once before deleting the legacy bucket.</p>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-securityhub">11.9. Address Security Hub Findings</h3>
<div class="paragraph">
<p>If you are using AWS Security Hub, you may see findings reported on some of the resources created by the AWS CDK bootstrapping process. Security Hub findings help you find resource configurations you should double-check for accuracy and safety. We have reviewed these specific resource configurations with AWS Security and are confident they do not constitute a security problem.</p>
</div>
<div class="sect3">
<h4 id="bootstrapping-securityhub-kms2">11.9.1. [KMS.2] IAM principals should not have IAM inline policies that allow decryption actions on all KMS keys</h4>
<div class="paragraph">
<p>The  <em>deploy role</em> (<code>DeploymentActionRole</code>) grants permission to read encrypted data, which is necessary for cross-account deployments with CDK Pipelines. Policies in this role do not grant permission to all data. It only grants permission to read encrypted data from Amazon S3 and AWS KMS, and only when those resources allow it through their bucket or key policy.</p>
</div>
<div class="paragraph">
<p>The following is a snippet of these two statements in the <em>deploy role</em> from the bootstrap template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">DeploymentActionRole:
    Type: AWS::IAM::Role
    Properties:
      ...
      Policies:
        - PolicyDocument:
            Statement:
              ...
              - Sid: PipelineCrossAccountArtifactsBucket
                Effect: Allow
                Action:
                  - s3:GetObject*
                  - s3:GetBucket*
                  - s3:List*
                  - s3:Abort*
                  - s3:DeleteObject*
                  - s3:PutObject*
                Resource: "*"
                Condition:
                  StringNotEquals:
                    s3:ResourceAccount:
                      Ref: AWS::AccountId
              - Sid: PipelineCrossAccountArtifactsKey
                Effect: Allow
                Action:
                  - kms:Decrypt
                  - kms:DescribeKey
                  - kms:Encrypt
                  - kms:ReEncrypt*
                  - kms:GenerateDataKey*
                Resource: "*"
                Condition:
                  StringEquals:
                    kms:ViaService:
                      Fn::Sub: s3.${AWS::Region}.amazonaws.com
              ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-securityhub-kms2-why">Why does Security Hub flag this?</h5>
<div class="paragraph">
<p>The policies contain a  <code>Resource: <strong></code> combined with a <code>Condition</code> clause. Security Hub flags the <code>\</strong></code> wildcard. This wildcard is used because at the time the account is bootstrapped, the AWS KMS key created by CDK Pipelines for the CodePipeline artifact bucket does not exist yet, and therefore, can&#8217;t be referenced on the bootstrap template by ARN. In addition, Security Hub does not consider the <code>Condition</code> clause when raising this flag. This <code>Condition</code> restricts <code>Resource: *</code> to requests made from the same AWS account of the AWS KMS key. These requests must come from Amazon S3 in the same AWS Region as the AWS KMS key.</p>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-securityhub-kms2-decide">Do I need to fix this finding?</h5>
<div class="paragraph">
<p>As long as you have not modified the AWS KMS key on your bootstrap template to be overly permissive, the  <em>deploy role</em> does not allow more access than it needs. Therefore, it is not necessary to fix this finding.</p>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-securityhub-kms2-fix">What if I want to fix this finding?</h5>
<div class="paragraph">
<p>How you fix this finding depends on whether or not you will be using CDK Pipelines for cross-account deployments.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not done so, deploy the CDK bootstrap stack using the <code>cdk bootstrap</code> command.</p>
</li>
<li>
<p>If you have not done so, create and deploy your CDK <code class="noloc">Pipeline</code>. For instructions, see  <a href="#cdk-pipeline">Continuous integration and delivery (CI/CD) using CDK Pipelines</a>.</p>
</li>
<li>
<p>Obtain the AWS KMS key ARN of the CodePipeline artifact bucket. This resource is created during pipeline creation.</p>
</li>
<li>
<p>Obtain a copy of the CDK bootstrap template to modify it. The following is an example, using the AWS CDK <code class="noloc">CLI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --show-template &gt; bootstrap-template.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Modify the template by replacing <code>Resource: *</code> of the <code>PipelineCrossAccountArtifactsKey</code> statement with your ARN value.</p>
</li>
<li>
<p>Deploy the template to update your bootstrap stack. The following is an example, using the CDK <code class="noloc">CLI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap aws://account-id/region --template bootstrap-template.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Obtain a copy of the CDK bootstrap template to modify it. The following is an example, using the CDK <code class="noloc">CLI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --show-template &gt; bootstrap-template.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the <code>PipelineCrossAccountArtifactsBucket</code> and <code>PipelineCrossAccountArtifactsKey</code> statements from the template.</p>
</li>
<li>
<p>Deploy the template to update your bootstrap stack. The following is an example, using the CDK <code class="noloc">CLI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap aws://account-id/region --template bootstrap-template.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-env-considerations">11.10. Considerations</h3>
<div class="paragraph">
<p>Since bootstrapping provisions resources in your environment, you may incur AWS charges when those resources are used with the AWS CDK.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="bootstrapping-customizing">11.11. Customize AWS CDK bootstrapping</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>You can customize AWS Cloud Development Kit (AWS CDK) bootstrapping by using the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>) or by modifying and deploying the AWS CloudFormation bootstrap template.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You can customize AWS Cloud Development Kit (AWS CDK) bootstrapping by using the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>) or by modifying and deploying the AWS CloudFormation bootstrap template.</p>
</div>
<div class="paragraph">
<p>For an introduction to bootstrapping, see <a href="#bootstrapping">AWS CDK bootstrapping</a>.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="bootstrapping-customizing-cli">11.11.1. Use the CDK <code class="noloc">CLI</code> to customize bootstrapping</h4>
<div class="paragraph">
<p>The following are a few examples of how you can customize bootstrapping by using the CDK  <code class="noloc">CLI</code>. For a list of all  <code>cdk bootstrap</code> options, see <a href="#ref-cli-cmd-bootstrap">cdk bootstrap</a>.</p>
</div>
<div id="bootstrapping-customizing-cli-s3-name" class="dlist">
<dl>
<dt class="hdlist1">Override the name of the Amazon S3 bucket</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the <code>--bootstrap-bucket-name</code> option to override the default Amazon S3 bucket name. This may require that you modify template synthesis. For more information, see <a href="#bootstrapping-custom-synth">Customize CDK stack synthesis</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-keys" class="dlist">
<dl>
<dt class="hdlist1">Modify server-side encryption keys for the Amazon S3 bucket</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, the Amazon S3 bucket in the bootstrap stack is configure to use AWS managed keys for server-side encryption. To use an existing customer managed key, use the <code>--bootstrap-kms-key-id</code> option and provide a value for the AWS Key Management Service (AWS KMS) key to use. If you want more control over the encryption key, provide <code>--bootstrap-customer-key</code> to use a customer managed key.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-cli-deploy-role" class="dlist">
<dl>
<dt class="hdlist1">Attach managed policies to the deployment role assumed by AWS CloudFormation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, stacks are deployed with full administrator permissions using the <code>AdministratorAccess</code> policy. To use your own managed policies, use the <code>--cloudformation-execution-policies</code> option and provide the ARNs of the managed policies to attach to the deployment role.</p>
<div class="paragraph">
<p>To provide multiple policies, pass them a single string, separated by commas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --cloudformation-execution-policies "arn:aws:iam::aws:policy/AWSLambda_FullAccess,arn:aws:iam::aws:policy/AWSCodeDeployFullAccess"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid deployment failures, be sure that the policies you specify are sufficient for any deployments that you will perform into the environment being bootstrapped.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-cli-qualifier" class="dlist">
<dl>
<dt class="hdlist1">Change the qualifier that is added to the names of resources in your bootstrap stack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, the <code>hnb659fds</code> qualifier is added to the physical ID of resources in your bootstrap stack. To change this value, use the <code>--qualifier</code> option.</p>
<div class="paragraph">
<p>This modification is useful when provisioning multiple bootstrap stacks in the same environment to avoid name clashes.</p>
</div>
<div class="paragraph">
<p>Changing the qualifier is intended for name isolation between automated tests of the CDK itself. Unless you can very precisely scope down the IAM permissions given to the CloudFormation execution role, there are no permission isolation benefits to having two different bootstrap stacks in a single account. Therefore, there&#8217;s usually no need to change this value.</p>
</div>
<div class="paragraph">
<p>When you change the qualifier, your CDK app must pass the changed value to the stack synthesizer. For more information, see <a href="#bootstrapping-custom-synth">Customize CDK stack synthesis</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-cli-tags" class="dlist">
<dl>
<dt class="hdlist1">Add tags to the bootstrap stack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the <code>--tags</code> option in the format of <code>KEY=VALUE</code> to add CloudFormation tags to your bootstrap stack.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-cli-accounts-deploy" class="dlist">
<dl>
<dt class="hdlist1">Specify additional AWS accounts that can deploy into the environment being bootstrapped</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the <code>--trust</code> option to provide additional AWS accounts that are allowed to deploy into the environment being bootstrapped. By default, the account performing the bootstrapping will always be trusted.</p>
<div class="paragraph">
<p>This option is useful when you are bootstrapping an environment that a CDK <code class="noloc">Pipeline</code> from another environment will deploy into.</p>
</div>
<div class="paragraph">
<p>When you use this option, you must also provide <code>--cloudformation-execution-policies</code>.</p>
</div>
<div class="paragraph">
<p>To add trusted accounts to an existing bootstrap stack, you must specify all of the accounts to trust, including those that you may have previously provided. If you only provide new accounts to trust, the previously trusted accounts will be removed.</p>
</div>
<div class="paragraph">
<p>The following is an example that trusts two accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap aws://123456789012/us-west-2 --trust 234567890123 --trust 987654321098 --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess
 ⏳  Bootstrapping environment aws://123456789012/us-west-2...
Trusted accounts for deployment: 234567890123, 987654321098
Trusted accounts for lookup: (none)
Execution policies: arn:aws:iam::aws:policy/AdministratorAccess
CDKToolkit: creating CloudFormation changeset...
 ✅  Environment aws://123456789012/us-west-2 bootstrapped.</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-cli-accounts-lookup" class="dlist">
<dl>
<dt class="hdlist1">Specify additional AWS accounts that can look up information in the environment being bootstrapped</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the <code>--trust-for-lookup</code> option to specify AWS accounts that are allowed to look up context information from the environment being bootstrapped. This option is useful to give accounts permission to synthesize stacks that will be deployed into the environment, without actually giving them permission to deploy those stacks directly.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="bootstrapping-customizing-cli-protection" class="dlist">
<dl>
<dt class="hdlist1">Enable termination protection for the bootstrap stack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If a bootstrap stack is deleted, the AWS resources that were originally provisioned in the environment will also be deleted. After your environment is bootstrapped, we recommend that you don&#8217;t delete and recreate the environment&#8217;s bootstrap stack, unless you are intentionally doing so. Instead, try to update the bootstrap stack to a new version by running the <code>cdk bootstrap</code> command again.</p>
<div class="paragraph">
<p>Use the <code>--termination-protection</code> option to manage termination protection settings for the bootstrap stack. By enabling termination protection, you prevent the bootstrap stack and its resources from being accidentally deleted. This is especially important if you use CDK <code class="noloc">Pipelines</code> since there is no general recovery option if you accidentally delete the bootstrap stack.</p>
</div>
<div class="paragraph">
<p>After enabling termination protection, you can use the AWS CLI or AWS CloudFormation console to verify.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Run the following command to enable termination protection on a new or existing bootstrap stack:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --termination-protection</code></pre>
</div>
</div>
</li>
<li>
<p>Use the AWS CLI or CloudFormation console to verify. The following is an example, using the AWS CLI. If you modified your bootstrap stack name, replace <code>CDKToolkit</code> with your stack name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws cloudformation describe-stacks --stack-name CDKToolkit --query "Stacks[0].EnableTerminationProtection"
true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-customizing-template">11.11.2. Modify the default bootstrap template</h4>
<div class="paragraph">
<p>When you need more customization than the CDK  <code class="noloc">CLI</code> can provide, you can modify the bootstrap template as needed. Then, deploy the template to bootstrap your environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain the default bootstrap template using the <code>--show-template</code> option. By default, the CDK <code class="noloc">CLI</code> will output the template in your terminal window. You can modify the CDK  <code class="noloc">CLI</code> command to save the template to your local machine. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --show-template &gt; my-bootstrap-template.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Modify the bootstrap template as needed. Any changes that you make should adhere to the bootstrapping template contract. For more information on the bootstrapping template contract, see <a href="#bootstrapping-contract">Follow the bootstrap contract</a>.</p>
<div class="paragraph">
<p>To ensure that your customizations are not accidentally overwritten later by someone running <code>cdk bootstrap</code> using the default template, change the default value of the <code>BootstrapVariant</code> template parameter. The CDK <code class="noloc">CLI</code> will only allow overwriting the bootstrap stack with templates that have the same  <code>BootstrapVariant</code> and an equal or higher version than the template that is currently deployed.</p>
</div>
</li>
<li>
<p>Deploy your modified template using your preferred AWS CloudFormation deployment method. The following is an example that uses the CDK <code class="noloc">CLI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --template my-bootstrap-template.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="bootstrapping-contract">11.11.3. Follow the bootstrap contract</h4>
<div class="paragraph">
<p>For your CDK apps to properly deploy, the CloudFormation templates produced during synthesis must correctly specify the resources created during bootstrapping. These resources are commonly referred to as  <em>bootstrap resources</em>. Bootstrapping creates resources in your AWS environment that are used by the AWS CDK to perform deployments and manage application assets. Synthesis produces CloudFormation templates from each CDK stack in your application. These templates don&#8217;t just define the AWS resources that will be provisioned from your application. They also specify the bootstrap resources to use during deployment.</p>
</div>
<div class="paragraph">
<p>During synthesis, the CDK <code class="noloc">CLI</code> doesn&#8217;t know specifically how your AWS environment has been bootstrapped. Instead, the CDK  <code class="noloc">CLI</code> produces CloudFormation templates based on the synthesizer that you configure. Therefore, when you customize bootstrapping, you may need to customize synthesis. For instructions on customizing synthesis, see  <a href="#bootstrapping-custom-synth">Customize CDK stack synthesis</a>. The purpose is to ensure that your synthesized CloudFormation templates are compatible with your bootstrapped environment. This compatibility is referred to as the <em>bootstrap contract</em>.</p>
</div>
<div class="paragraph">
<p>The simplest method to customize stack synthesis is by modifying the <code>DefaultStackSynthesizer</code> class in your <code>Stack</code> instance. If you require customization beyond what this class can offer, you can write your own synthesizer as a class that implements <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.IStackSynthesizer.html">IStackSynthesizer</a></code> (perhaps deriving from <code>DefaultStackSynthesizer</code>).</p>
</div>
<div class="paragraph">
<p>When you customize bootstrapping, follow the bootstrap template contract to remain compatible with <code>DefaultStackSynthesizer</code>. If you modify bootstrapping beyond the bootstrap template contract, you will need to write your own synthesizer.</p>
</div>
<div class="sect4">
<h5 id="bootstrapping-contract-versioning">Versioning</h5>
<div class="paragraph">
<p>The bootstrap template should contain a resource to create an Amazon EC2 Systems Manager (SSM) parameter with a well-known name and an output to reflect the template&#8217;s version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  CdkBootstrapVersion:
    Type: AWS::SSM::Parameter
    Properties:
      Type: String
      Name:
        Fn::Sub: '/cdk-bootstrap/${Qualifier}/version'
      Value: 4
Outputs:
  BootstrapVersion:
    Value:
      Fn::GetAtt: [CdkBootstrapVersion, Value]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-contract-roles">Roles</h5>
<div class="paragraph">
<p>The  <code>DefaultStackSynthesizer</code> requires five IAM roles for five different purposes. If you are not using the default roles, you must specify your IAM role ARNs within your <code>DefaultStackSynthesizer</code> object. The roles are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>deployment role</em> is assumed by the CDK <code class="noloc">CLI</code> and by AWS CodePipeline to deploy into an environment. Its  <code>AssumeRolePolicy</code> controls who can deploy into the environment. In the template, you can see the permissions that this role needs.</p>
</li>
<li>
<p>The <em>lookup role</em> is assumed by the CDK <code class="noloc">CLI</code> to perform context lookups in an environment. Its  <code>AssumeRolePolicy</code> controls who can deploy into the environment. The permissions this role needs can be seen in the template.</p>
</li>
<li>
<p>The <em>file publishing role</em> and the <em>image publishing role</em> are assumed by the CDK <code class="noloc">CLI</code> and by AWS CodeBuild projects to publish assets into an environment. They&#8217;re used to write to the Amazon S3 bucket and the Amazon ECR repository, respectively. These roles require write access to these resources.</p>
</li>
<li>
<p><em>The AWS CloudFormation execution role</em> is passed to AWS CloudFormation to perform the actual deployment. Its permissions are the permissions that the deployment will execute under. The permissions are passed to the stack as a parameter that lists managed policy ARNs.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-contract-outputs">Outputs</h5>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> requires that the following CloudFormation outputs exist on the bootstrap stack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BucketName</code> – The name of the file asset bucket.</p>
</li>
<li>
<p><code>BucketDomainName</code> – The file asset bucket in domain name format.</p>
</li>
<li>
<p><code>BootstrapVersion</code> – The current version of the bootstrap stack.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-contract-history">Template history</h5>
<div class="paragraph">
<p>The bootstrap template is versioned and evolves over time with the AWS CDK itself. If you provide your own bootstrap template, keep it up to date with the canonical default template. You want to make sure that your template continues to work with all CDK features. For more information, see  <a href="#bootstrap-template-history">Bootstrap template version history</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="customize-permissions-boundaries">11.12. Create and apply permissions boundaries for the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>A <em>permissions boundary</em> is an AWS Identity and Access Management (IAM) advanced feature that you can use to set the maximum permissions that an IAM entity, such as a user or role, can have. You can use permissions boundaries to restrict the actions that IAM entities can perform when using the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A  <em>permissions boundary</em> is an AWS Identity and Access Management (IAM) advanced feature that you can use to set the maximum permissions that an IAM entity, such as a user or role, can have. You can use permissions boundaries to restrict the actions that IAM entities can perform when using the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="paragraph">
<p>To learn more about permissions boundaries, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html">Permissions boundaries for IAM entities</a> in the <em>IAM User Guide</em>.</p>
</div>
<div class="sect3">
<h4 id="customize-permissions-boundaries-when">11.12.1. When to use permissions boundaries with the AWS CDK</h4>
<div class="paragraph">
<p>Consider applying permissions boundaries when you need to restrict developers in your organization from performing certain actions with the AWS CDK. For example, if there are specific resources in your AWS environment that you don&#8217;t want developers to modify, you can create and apply a permissions boundary.</p>
</div>
</div>
<div class="sect3">
<h4 id="customize-permissions-boundaries-how">11.12.2. How to apply permissions boundaries with the AWS CDK</h4>
<div class="sect4">
<h5 id="customize-permissions-boundaries-how-create">Create the permissions boundary</h5>
<div class="paragraph">
<p>First, you create the permissions boundary, using an AWS managed policy or a customer managed policy to set the boundary for an IAM entity (user or role). This policy limits the maximum permissions for the user or role. For instructions on creating permissions boundaries, see  <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html">Permissions boundaries for IAM entities</a> in the <em>IAM User Guide</em>.</p>
</div>
<div class="paragraph">
<p>Permissions boundaries set the maximum permissions that an IAM entity can have, but don&#8217;t grant permissions on their own. You must use permissions boundaries with IAM policies to effectively limit and grant the proper permissions for your organization. You must also prevent IAM entities from being able to escape the boundaries that you set. For an example, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html#access_policies_boundaries-delegate">Delegating responsibility to others using permissions boundaries</a> in the <em>IAM User Guide</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="customize-permissions-boundaries-how-apply">Apply the permissions boundary during bootstrapping</h5>
<div class="paragraph">
<p>After creating the permissions boundary, you can enforce it for the AWS CDK by applying it during bootstrapping.</p>
</div>
<div class="paragraph">
<p>Use the <code><a href="#ref-cli-cmd-bootstrap-options-custom-permissions-boundary">--custom-permissions-boundary</a></code> option and specify the name of the permissions boundary to apply. The following is an example that applies a permissions boundary named <code>cdk-permissions-boundary</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --custom-permissions-boundary cdk-permissions-boundary</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the CDK uses the  <code>CloudFormationExecutionRole</code> IAM role, defined in the bootstrap template, to receive permissions for performing deployments. By applying the custom permissions boundary during bootstrapping, the permissions boundary gets attached to this role. The permissions boundary will then set the maximum permissions that can be performed by developers in your organization when using the AWS CDK. To learn more about this role, see <a href="#bootstrapping-env-roles">IAM roles created during bootstrapping</a>.</p>
</div>
<div class="paragraph">
<p>When you apply permissions boundaries in this way, they are applied to the specific environment that you bootstrap. To use the same permissions boundary across multiple environments, you must apply the permissions boundary for each environment during bootstrapping. You can also apply different permissions boundaries for different environments.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customize-permissions-boundaries-learn">11.12.3. Learn more</h4>
<div class="paragraph">
<p>For more information on permissions boundaries, see  <a href="https://aws.amazon.com/blogs/security/when-and-where-to-use-iam-permissions-boundaries/">When and where to use IAM permissions boundaries</a> in the <em>AWS Security Blog</em>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="bootstrapping-troubleshoot">11.13. Troubleshoot AWS CDK bootstrapping issues</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Troubleshoot common issues when bootstrapping your environment with the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Troubleshoot common issues when bootstrapping your environment with the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="paragraph">
<p>For an introduction to bootstrapping, see <a href="#bootstrapping">AWS CDK bootstrapping</a>.</p>
</div>
<div class="paragraph">
<p>For instructions on bootstrapping, see <a href="#bootstrapping-env">Bootstrap your environment for use with the AWS CDK</a>.</p>
</div>
<div class="sect3">
<h4 id="bootstrapping-troubleshoot-s3-bucket-name">11.13.1. When bootstrapping using the default template, you get a 'CREATE_FAILED' error for the Amazon S3 bucket</h4>
<div class="paragraph">
<p>When bootstrapping using the AWS CDK Command Line Interface (CDK  <code class="noloc">CLI</code>)  <code>cdk bootstrap</code> command with the default bootstrap template, you receive the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">CREATE_FAILED | AWS::S3::Bucket | BucketName already exists</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before troubleshooting, ensure that you are using the latest version of the CDK  <code class="noloc">CLI</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To check your version, run <code>cdk --version</code>.</p>
</li>
<li>
<p>To install the latest version, run <code>npm install -g aws-cdk</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After installing the latest version, try bootstrapping your environment again. If you still receive the same error, continue with troubleshooting.</p>
</div>
<div class="sect4">
<h5 id="bootstrapping-troubleshoot-s3-bucket-name-causes">Common causes</h5>
<div class="paragraph">
<p>When you bootstrap your environment, the AWS CDK generates physical IDs for your bootstrap resources. For more information, see  <a href="#bootstrapping-env-default-id">Resource IDs created during bootstrapping</a>.</p>
</div>
<div class="paragraph">
<p>Unlike the other bootstrap resources, Amazon S3 bucket names are global. This means that each bucket name must be unique across all AWS accounts in all AWS Regions within a partition. For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingBucket.html">Buckets overview</a> in the <em>Amazon S3 User Guide</em>. Therefore, the most common cause of this error is that the physical ID generated as your bucket name already exists somewhere within the partition. This could be within your account or another account.</p>
</div>
<div class="paragraph">
<p>The following is an example bucket name: <code>cdk-hnb659fds-assets-012345678910-us-west-1</code>. While unlikely, due to the qualifier and account ID being a part of the name, it is possible that this name for an Amazon S3 bucket is used by another AWS account. Since bucket names are globally scoped, it can&#8217;t be used by you if its used by a different account in the same partition. Most likely, a bucket with the same name exists somewhere in your account. This could be in the Region you are attempting to bootstrap, or another Region.</p>
</div>
<div class="paragraph">
<p>Generally, the resolution is to locate this bucket in your account and determine what to do with it, or customize bootstrapping to create bootstrap resources of a different name.</p>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-troubleshoot-s3-bucket-name-resolution">Resolution</h5>
<div class="paragraph">
<p>First, determine if a bucket with the same name exists within your AWS account. Using an AWS identity with valid permissions to lookup Amazon S3 buckets in your account, you can do this in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the AWS Command Line Interface (AWS CLI) <code>aws s3 ls</code> command to view a list of all your buckets.</p>
</li>
<li>
<p>Look up bucket names for each Region in your account using the <a href="https://console.aws.amazon.com/s3">Amazon S3 console</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a bucket with the same name exists, determine if it&#8217;s being used. If it&#8217;s not being used, consider deleting the bucket and attempting to bootstrap your environment again.</p>
</div>
<div class="paragraph">
<p>If a bucket with the same name exists and you don&#8217;t want to delete it, determine if it&#8217;s already associated with a bootstrap stack in your account. You may have to check multiple Regions. The Region in the Amazon S3 bucket name doesn&#8217;t necessarily mean that the bucket is in that Region. To check if it&#8217;s associated with the <code>CDKToolkit</code> bootstrap stack, you can do either of the following for each Region:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the AWS CLI <code>aws cloudformation describe-stack-resources --stack-name <code class="replaceable">CDKToolkit</code> --region <code class="replaceable">Region</code></code> command to view the resources in your bootstrap stack and check if the bucket is listed.</p>
</li>
<li>
<p>In the <a href="https://console.aws.amazon.com/cloudformation">AWS CloudFormation console</a>, locate the <code>CDKToolkit</code> stack. Then, on the <strong>Resources</strong> tab, check if the bucket exists.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the bucket is associated with a bootstrap stack, determine if the bootstrap stack is in the same Region that you are attempting to bootstrap. If it is, your environment is already bootstrapped and you should be able to start using the CDK to deploy applications into your environment. If the Amazon S3 bucket is associated with a bootstrap stack in a different Region, you&#8217;ll need to determine what to do. Possible resolutions include renaming the existing Amazon S3 bucket, deleting the current Amazon S3 bucket if its not being used, or using a new name for the Amazon S3 bucket you are attempting to create.</p>
</div>
<div class="paragraph">
<p>If you are unable to locate an Amazon S3 bucket with the same name in your account, it may exist in a different account. To resolve this, you&#8217;ll need to customize bootstrapping to create new names for all of your bootstrap resources or for just your Amazon S3 bucket. To create new names for all bootstrap resources, you can modify the qualifier. To create a new name for only your Amazon S3 bucket, you can provide a new bucket name.</p>
</div>
<div class="paragraph">
<p>To customize bootstrapping, you can use options with the CDK <code class="noloc">CLI</code><code>cdk bootstrap</code> command or by modifying the bootstrap template. For instructions, see <a href="#bootstrapping-customizing">Customize AWS CDK bootstrapping</a>.</p>
</div>
<div class="paragraph">
<p>If you customize bootstrapping, you will need to apply the same changes to synthesis before you can properly deploy an application. For instructions, see <a href="#bootstrapping-custom-synth">Customize CDK stack synthesis</a>.</p>
</div>
<div class="paragraph">
<p>For example, you can provide a new qualifier with <code>cdk bootstrap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk bootstrap --qualifier abcde0123</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example Amazon S3 bucket name that will be created with this modification:  <code>cdk-abcde0123-assets-012345678910-us-west-1</code>. All bootstrap resources created during bootstrapping will use this qualifier.</p>
</div>
<div class="paragraph">
<p>When developing your CDK app, you must specify your custom qualifier in your synthesizer. This helps the CDK with identifying your bootstrap resources during synthesis and deployment. The following is an example of customizing the default synthesizer for your stack instance:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'MyStack', {
  synthesizer: new DefaultStackSynthesizer({
    qualifier: 'abcde0123',
  }),
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'MyStack', {
  synthesizer: new DefaultStackSynthesizer({
    qualifier: 'abcde0123',
  }),
})</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">MyStack(self, "MyStack",
    synthesizer=DefaultStackSynthesizer(
        qualifier="abcde0123"
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new MyStack(app, "MyStack", StackProps.builder()
  .synthesizer(DefaultStackSynthesizer.Builder.create()
    .qualifier("abcde0123")
    .build())
  .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new MyStack(app, "MyStack", new StackProps
{
    Synthesizer = new DefaultStackSynthesizer(new DefaultStackSynthesizerProps
    {
        Qualifier = "abcde0123"
    })
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">func NewMyStack(scope constructs.Construct, id string, props *MyStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	synth := awscdk.NewDefaultStackSynthesizer(&amp;awscdk.DefaultStackSynthesizerProps{
		Qualifier: jsii.String("abcde0123"),
	})

	stack.SetSynthesizer(synth)

	return stack
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify the new qualifier in the  <code class="path">cdk.json</code> file of your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "...",
  "context": {
    "@aws-cdk/core:bootstrapQualifier": "abcde0123"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To modify only the Amazon S3 bucket name, you can use the  <code><a href="#ref-cli-cmd-bootstrap-options-bootstrap-bucket-name">--bootstrap-bucket-name</a></code> option. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk bootstrap --bootstrap-bucket-name 'my-new-bucket-name'</code></pre>
</div>
</div>
<div class="paragraph">
<p>When developing your CDK app, you must specify your new bucket name in your synthesizer. The following is an example of customizing the default synthesizer for your stack instance:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'MyStack', {
  synthesizer: new DefaultStackSynthesizer({
    fileAssetsBucketName: 'my-new-bucket-name',
  }),
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'MyStack', {
  synthesizer: new DefaultStackSynthesizer({
    fileAssetsBucketName: 'my-new-bucket-name',
  }),
})</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">MyStack(self, "MyStack",
    synthesizer=DefaultStackSynthesizer(
        file_assets_bucket_name='my-new-bucket-name'
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new MyStack(app, "MyStack", StackProps.builder()
  .synthesizer(DefaultStackSynthesizer.Builder.create()
    .fileAssetsBucketName("my-new-bucket-name")
    .build())
  .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new MyStack(app, "MyStack", new StackProps
{
    Synthesizer = new DefaultStackSynthesizer(new DefaultStackSynthesizerProps
    {
        FileAssetsBucketName = "my-new-bucket-name"
    })
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">func NewMyStack(scope constructs.Construct, id string, props *MyStackProps) awscdk.Stack {
	var sprops awscdk.StackProps
	if props != nil {
		sprops = props.StackProps
	}
	stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

	synth := awscdk.NewDefaultStackSynthesizer(&amp;awscdk.DefaultStackSynthesizerProps{
		FileAssetsBucketName: jsii.String("my-new-bucket-name"),
	})

	stack.SetSynthesizer(synth)

	return stack
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bootstrapping-troubleshoot-s3-bucket-name-prevention">Prevention</h5>
<div class="paragraph">
<p>We recommend that you proactively bootstrap each AWS environment that you plan to use. For more information, see  <a href="#bootstrapping-env-when">When to bootstrap your environment</a>. Specifically for the Amazon S3 bucket naming issue, this will create Amazon S3 buckets in each AWS environment and prevent others from using your Amazon S3 bucket name.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="develop">12. Develop AWS CDK applications</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Manage your infrastructure on AWS by developing applications using the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Manage your infrastructure on AWS by developing applications using the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="sect2">
<h3 id="develop-prerequisites">12.1. Prerequisites</h3>
<div class="paragraph">
<p>Before you can start developing applications, complete all set up steps in  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="develop-overview">12.2. Developing AWS CDK applications overview</h3>
<div class="paragraph">
<p>At a high-level, developing CDK applications involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create a CDK project</strong> – A CDK <a href="#projects">project</a> consists of the files and folders that store and organize your CDK code.</p>
</li>
<li>
<p><strong>Create a CDK app</strong> – Within a CDK project, you use the <code>App</code> construct to define a CDK <a href="#apps">application</a>.</p>
</li>
<li>
<p><strong>Create a CDK stack</strong> – Within the scope of your CDK app, you define one or more CDK <a href="#stacks">stacks</a>.</p>
</li>
<li>
<p><strong>Define your infrastructure</strong> – Within the scope of a CDK stack, you use <a href="#constructs">constructs</a> from the AWS Construct Library to define the AWS resources and properties that will become your infrastructure. Using a general-purpose programming <a href="#languages">language</a> of your choice, you can use logic, such as conditional statements and loops, to define your infrastructure based on certain conditions.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="develop-gs">12.3. Get started with developing CDK applications</h3>
<div class="paragraph">
<p>To get started, you can use the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>)  <code>cdk init</code> command. Provide the <code>--language</code> option to specify the programming language to use. This command creates a starting CDK project and imports the main AWS Construct Library and core modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="develop-library">12.4. Import and use the AWS CDK Library</h3>
<div class="paragraph">
<p>After you create a CDK project, import and use constructs from the AWS CDK Library to begin defining your infrastructure. For instructions, see  <a href="#work-with">Work with the AWS CDK library</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="develop-next">12.5. Next steps</h3>
<div class="paragraph">
<p>When ready to deploy your application, use the CDK  <code class="noloc">CLI</code><code>cdk deploy</code> command. For instructions, see <a href="#deploy">Deploy AWS CDK applications</a>.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="usage-data">12.6. Configure AWS CDK usage data reporting</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) collects usage data from your CDK applications to gain insight into how the AWS CDK is being used. The CDK team uses this data to do the following:</p>
</div>
</blockquote>
</div>
<div class="sect3">
<h4 id="usage-data-intro">12.6.1. What is CDK usage data reporting?</h4>
<div class="paragraph">
<p>AWS Cloud Development Kit (AWS CDK) applications are configured to collect and report on usage data to gain insight into how the AWS CDK is being used. The CDK team uses this data to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Communicate with customers</strong> – Identify stacks using a construct with known security or reliability issues and send out communication on customer-impacting topics.</p>
</li>
<li>
<p><strong>Inform CDK development</strong> – Gain insight on CDK usage to better inform CDK development.</p>
</li>
<li>
<p><strong>Investigate CDK issues</strong> – When bugs are reported, usage data provides valuable insight to the CDK team when troubleshooting.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="usage-data-categories">12.6.2. What usage data is collected?</h4>
<div class="paragraph">
<p>There are two categories of usage data collected by the CDK:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>General usage data</p>
</li>
<li>
<p>Additional usage data</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="usage-data-categories-general">General usage data collection</h5>
<div class="paragraph">
<p>The CDK collects the following types of general usage data from your CDK applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Versions of CDK libraries used.</p>
</li>
<li>
<p>Names of constructs used from the following <code>NPM</code> modules:</p>
<div class="ulist">
<ul>
<li>
<p>AWS CDK core modules</p>
</li>
<li>
<p>AWS Construct Library modules</p>
</li>
<li>
<p>AWS Solutions Constructs module</p>
</li>
<li>
<p>AWS Render Farm Deployment Kit module</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before version 1.93.0, the AWS CDK reported the names and versions of the modules loaded during synthesis, instead of the constructs used in the stack.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="usage-data-categories-additional">Additional usage data collection</h5>
<div class="paragraph">
<p>Starting with CDK version 2.178.0, usage data collection expanded to include the following additional usage data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CDK–defined property keys</strong> – When you use a built-in property of an L2 construct, the property key will be collected. This includes built-in property keys nested in dictionary objects.</p>
</li>
<li>
<p><strong>Boolean and enum property values from CDK–defined property keys</strong> – For CDK–defined property keys, property values of only Boolean and enum types will be collected. All other types, such as string values or construct references will be redacted.</p>
</li>
<li>
<p><strong>Method name, keys, and property values of Boolean and enum types</strong> – When you use an L2 construct method, we will collect the method name, property keys, and property values of Boolean and enum types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For property keys and values that you uniquely create, the entire object will be redacted. For example, if you use  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.InlineApiDefinition.html">InlineApiDefinition</a></code> to define an <code class="noloc">OpenAPI</code> specification and pass it into a  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.RestApi.html">RestApi</a></code> construct, the entire <code>InlineApiDefinition</code> object will be redacted.</p>
</div>
<div class="paragraph">
<p>For more information on additional usage data collection, including its benefits and potential concerns, see the <a href="https://github.com/aws/aws-cdk/discussions/33198">CDK Collecting Additional Metadata (under feature flag) #33198</a> discussion in the <em>aws-cdk repository</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage-data-how">12.6.3. How the CDK collects usage data</h4>
<div class="paragraph">
<p>At synthesis, the CDK collects usage data from your application and stores it within the  <code>AWS::CDK::Metadata</code> resource. The following is an example of this on a synthesized AWS CloudFormation template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">CDKMetadata:
  Type: "AWS::CDK::Metadata"
  Properties:
    Analytics: "v2:deflate64:H4sIAND9SGAAAzXKSw5AMBAA0L1b2PdzBYnEAdio3RglglY60zQi7u6TWL/XKmNUlxeQSOKwaPTBqrNhwEWU3hGHiCzK0dWWfAxoL/Fd8mvk+QkS/0X6BdjnCdgmOOQKWz+AqqLDt2Y3YMnLYWwAAAA="</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <code>Analytics</code> property is a gzipped, base64-encoded, prefix-encoded list of the constructs in the stack.</p>
</div>
</div>
<div class="sect3">
<h4 id="usage-data-configure">12.6.4. How to opt out or opt in to usage data reporting</h4>
<div class="paragraph">
<p>Your options to opt out or opt in to general usage data reporting and additional usage data reporting depends on the CDK version you used to originally create your app.</p>
</div>
<div class="paragraph">
<p>By default, CDK applications are configured to automatically opt in to usage data reporting as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>All CDK apps</strong> – Opted in to general usage data reporting.</p>
</li>
<li>
<p><strong>CDK apps created with a version older than v2.178.0</strong> – Not automatically opted in to additional usage data reporting.</p>
</li>
<li>
<p><strong>CDK apps created with v2.178.0 or newer</strong> – Opted in to additional usage data reporting.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you choose to opt out, the CDK will not be able to identify if you&#8217;ve been impacted by security issues and will not send you notifications for them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="usage-data-configure-optout-all">Opt out of all usage data reporting</h5>
<div class="paragraph">
<p>To opt out of all usage data reporting, you can use the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>) or configure your project&#8217;s  <code class="path">cdk.json</code> file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>--no-version-reporting</code> option with any CDK <code class="noloc">CLI</code> command to opt out for a single command. The following is an example of opting out during template synthesis:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk synth --no-version-reporting</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the CDK synthesizes templates automatically when you run  <code>cdk deploy</code>, you should also use <code>--no-version-reporting</code> with the <code>cdk deploy</code> command.</p>
</div>
</li>
<li>
<p>Set <code>versionReporting</code> to <code>false</code> in <code class="path">./cdk.json</code> or  <code class="path">~/.cdk.json</code>. This opts you out by default. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "...",
  "versionReporting": false
}</code></pre>
</div>
</div>
</li>
<li>
<p>After configuring, you can override this behavior and opt in by specifying <code>--version-reporting</code> on an individual command.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="usage-data-configure-optout-additional">Opt out of only the additional usage data reporting</h5>
<div class="paragraph">
<p>If your CDK app was created with a CDK version older than 2.178.0, you are automatically opted out of additional usage data reporting, even if you are opted in to general usage data reporting. You don&#8217;t have to do anything to opt out of additional usage data reporting.</p>
</div>
<div class="paragraph">
<p>If your CDK app was created with CDK version 2.178.0 or newer, you must opt out of all usage data reporting. You can&#8217;t opt out of only the additional usage data reporting.</p>
</div>
</div>
<div class="sect4">
<h5 id="usage-data-configure-optin">Opt in to usage data reporting</h5>
<div class="paragraph">
<p>If your CDK app was created with CDK version 2.178.0 or newer, you can opt in to all usage data reporting by setting  <code>versionReporting</code> to <code>true</code>. This is the default behavior of CDK apps.</p>
</div>
<div class="paragraph">
<p>If your CDK app was created with a CDK version older than 2.178.0, you can opt in to general usage data reporting by setting <code>versionReporting</code> to <code>true</code>. To opt in to additional usage data reporting, you must enable a feature flag.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These steps are for CDK apps originally created with a version older than 2.178.0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that you are now using CDK version 2.178.0 or newer.</p>
</li>
<li>
<p>In your CDK configuration file, specify <code>@aws-cdk/core:enableAdditionalMetadataCollection</code> as <code>true</code>. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "context": {
    "@aws-cdk/core:enableAdditionalMetadataCollection": "true"
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>You can also use the <code>ENABLE_ADDITIONAL_METADATA_COLLECTION</code> value with the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.FeatureFlags.html">FeatureFlags</a></code> class. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { FeatureFlags } from 'aws-cdk-lib';
import * as cx_api from 'aws-cdk-lib/cx-api';
import { Construct } from 'constructs';

export class MyStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Set the feature flag ENABLE_ADDITIONAL_METADATA_COLLECTION to true
    FeatureFlags.of(this).add(cx_api.ENABLE_ADDITIONAL_METADATA_COLLECTION, true);

    // Your stack resources go here
    new cdk.aws_s3.Bucket(this, 'MyBucket');
  }
}

const app = new cdk.App();
new MyStack(app, 'MyStack');</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage-data-examples">12.6.5. Examples</h4>
<div class="sect4">
<h5 id="usage-data-examples-example1">General and additional usage data collected from a CDK application</h5>
<div class="paragraph">
<p>The following is an example of a CDK app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

class MyStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Create an S3 bucket (L2 construct)
    const myBucket = new s3.Bucket(this, 'MyBucket', {
      bucketName: 'my-cdk-example-bucket', // String type
      versioned: true,                    // Boolean type
      removalPolicy: cdk.RemovalPolicy.DESTROY, // ENUM type
      lifecycleRules: [{                  // Array of object type
        expirationDate: new Date('2019-10-01'),
        objectSizeLessThan: 600,
        objectSizeGreaterThan: 500,
      }],
    });

    // Use a method of the L2 construct to define additional properties
    myBucket.addLifecycleRule({
      id: 'ExpireOldObjects',
      enabled: true, // Boolean
      expiration: cdk.Duration.days(90), // Expire objects after 90 days
    });
  }
}

// Define the CDK app and stack
const app = new cdk.App();
new MyStack(app, 'MyStack');
app.synth();</code></pre>
</div>
</div>
<div class="paragraph">
<p>At synthesis, usage data is collected, compressed, and stored in the  <code>AWS::CDK::Metadata</code> resource.</p>
</div>
<div class="paragraph">
<p>The following is an example of general usage data collected with a CDK version older than 2.178.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "fqn": "aws-cdk-lib.aws-s3.Bucket",
    "version": "v2.170.0"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of usage data collected, including the additional usage data introduced in CDK version 2.178.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "fqn": "aws-cdk-lib.aws_s3.Bucket",
    "version": "2.170.0",
    "metadata": [
        {
            "type": "aws:cdk:analytics:construct",
            "data": {
                "bucketName": "*",
                "versioned": true,
                "removalPolicy": "cdk.RemovalPolicy.DESTROY",
                "lifecycleRules": [
                    {
                        "expirationDate": "*",
                        "objectSizeLessThan": "*",
                        "objectSizeGreaterThan": "*"
                    }
                ]
            }
        },
        {
            "type": "aws:cdk:analytics:method",
            "data": {
                "name": "addLifecycleRule",
                "prop": {
                    "id": "*",
                    "enabled": true,
                    "expiration": "*",
                }
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="cfn-layer">12.7. Customize constructs from the AWS Construct Library</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Customize constructs from the AWS Construct Library through escape hatches, raw overrides, and custom resources.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Customize constructs from the AWS Construct Library through escape hatches, raw overrides, and custom resources.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="develop-customize-escape">12.7.1. Use escape hatches</h4>
<div class="paragraph">
<p>The AWS Construct Library provides  <a href="#constructs">constructs</a> of varying levels of abstraction.</p>
</div>
<div class="paragraph">
<p>At the highest level, your AWS CDK application and the stacks in it are themselves abstractions of your entire cloud infrastructure, or significant chunks of it. They can be parameterized to deploy them in different environments or for different needs.</p>
</div>
<div class="paragraph">
<p>Abstractions are powerful tools for designing and implementing cloud applications. The AWS CDK gives you the power not only to build with its abstractions, but also to create new abstractions. Using the existing open-source L2 and L3 constructs as guidance, you can build your own L2 and L3 constructs to reflect your own organization&#8217;s best practices and opinions.</p>
</div>
<div class="paragraph">
<p>No abstraction is perfect, and even good abstractions cannot cover every possible use case. During development, you may find a construct that almost fits your needs, requiring a small or large customization.</p>
</div>
<div class="paragraph">
<p>For this reason, the AWS CDK provides ways to <em>break out</em> of the construct model. This includes moving to a lower-level abstraction or to a different model entirely. Escape hatches let you <em>escape</em> the AWS CDK paradigm and customize it in ways that suit your needs. Then, you can wrap your changes in a new construct to abstract away the underlying complexity and provide a clean API for other developers.</p>
</div>
<div class="paragraph">
<p>The following are examples of situations where you can use escape hatches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An AWS service feature is available through AWS CloudFormation, but there are no L2 constructs for it.</p>
</li>
<li>
<p>An AWS service feature is available through AWS CloudFormation, and there are L2 constructs for the service, but these don&#8217;t yet expose the feature. Because L2 constructs are curated by the CDK team, they may not be immediately available for new features.</p>
</li>
<li>
<p>The feature is not yet available through AWS CloudFormation at all.</p>
<div class="paragraph">
<p>To determine whether a feature is available through AWS CloudFormation, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">AWS Resource and Property Types Reference</a>.</p>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="develop-customize-escape-l1">Develop escape hatches for L1 constructs</h5>
<div class="paragraph">
<p>If L2 constructs are not available for the service, you can use the automatically generated L1 constructs. These resources can be recognized by their name starting with  <code>Cfn</code>, such as <code>CfnBucket</code> or <code>CfnRole</code>. You instantiate them exactly as you would use the equivalent AWS CloudFormation resource.</p>
</div>
<div class="paragraph">
<p>For example, to instantiate a low-level Amazon S3 bucket L1 with analytics enabled, you would write something like the following.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new s3.CfnBucket(this, 'amzn-s3-demo-bucket', {
  analyticsConfigurations: [
    {
      id: 'Config',
      // ...
    }
  ]
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new s3.CfnBucket(this, 'amzn-s3-demo-bucket', {
  analyticsConfigurations: [
    {
      id: 'Config'
      // ...
    }
  ]
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">s3.CfnBucket(self, "amzn-s3-demo-bucket",
    analytics_configurations: [
        dict(id="Config",
             # ...
             )
    ]
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnBucket.Builder.create(this, "amzn-s3-demo-bucket")
    .analyticsConfigurations(Arrays.asList(java.util.Map.of(    // Java 9 or later
        "id", "Config", // ...
    ))).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new CfnBucket(this, 'amzn-s3-demo-bucket', new CfnBucketProps {
    AnalyticsConfigurations = new Dictionary&lt;string, string&gt;
    {
        ["id"] = "Config",
        // ...
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>There might be rare cases where you want to define a resource that doesn&#8217;t have a corresponding  <code>CfnXxx</code> class. This could be a new resource type that hasn&#8217;t yet been published in the AWS CloudFormation resource specification. In cases like this, you can instantiate the <code>cdk.CfnResource</code> directly and specify the resource type and properties. This is shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new cdk.CfnResource(this, 'amzn-s3-demo-bucket', {
  type: 'AWS::S3::Bucket',
  properties: {
    // Note the PascalCase here! These are CloudFormation identifiers.
    AnalyticsConfigurations: [
      {
        Id: 'Config',
        // ...
      }
    ]
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new cdk.CfnResource(this, 'amzn-s3-demo-bucket', {
  type: 'AWS::S3::Bucket',
  properties: {
    // Note the PascalCase here! These are CloudFormation identifiers.
    AnalyticsConfigurations: [
      {
        Id: 'Config'
        // ...
      }
    ]
  }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">cdk.CfnResource(self, 'amzn-s3-demo-bucket',
  type="AWS::S3::Bucket",
  properties=dict(
    # Note the PascalCase here! These are CloudFormation identifiers.
    "AnalyticsConfigurations": [
      {
        "Id": "Config",
        # ...
      }
    ]
  }
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnResource.Builder.create(this, "amzn-s3-demo-bucket")
        .type("AWS::S3::Bucket")
        .properties(java.util.Map.of(    // Map.of requires Java 9 or later
            // Note the PascalCase here! These are CloudFormation identifiers
            "AnalyticsConfigurations", Arrays.asList(
                    java.util.Map.of("Id", "Config", // ...
                    ))))
        .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new CfnResource(this, "amzn-s3-demo-bucket", new CfnResourceProps
{
    Type = "AWS::S3::Bucket",
    Properties = new Dictionary&lt;string, object&gt;
    {   // Note the PascalCase here! These are CloudFormation identifiers
        ["AnalyticsConfigurations"] = new Dictionary&lt;string, string&gt;[]
        {
            new Dictionary&lt;string, string&gt; {
                ["Id"] = "Config"
            }
        }
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="develop-customize-escape-l2">Develop escape hatches for L2 constructs</h5>
<div class="paragraph">
<p>If an L2 construct is missing a feature or you&#8217;re trying to work around an issue, you can modify the L1 construct that&#8217;s encapsulated by the L2 construct.</p>
</div>
<div class="paragraph">
<p>All L2 constructs contain within them the corresponding L1 construct. For example, the high-level <code>Bucket</code> construct wraps the low-level <code>CfnBucket</code> construct. Because the <code>CfnBucket</code> corresponds directly to the AWS CloudFormation resource, it exposes all features that are available through AWS CloudFormation.</p>
</div>
<div class="paragraph">
<p>The basic approach to get access to the L1 construct is to use <code>construct.node.defaultChild</code> (Python: <code>default_child</code>), cast it to the right type (if necessary), and modify its properties. Again, let&#8217;s take the example of a <code>Bucket</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Get the CloudFormation resource
const cfnBucket = bucket.node.defaultChild as s3.CfnBucket;

// Change its properties
cfnBucket.analyticsConfiguration = [
  {
    id: 'Config',
    // ...
  }
];</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Get the CloudFormation resource
const cfnBucket = bucket.node.defaultChild;

// Change its properties
cfnBucket.analyticsConfiguration = [
  {
    id: 'Config'
    // ...
  }
];</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Get the CloudFormation resource
cfn_bucket = bucket.node.default_child

# Change its properties
cfn_bucket.analytics_configuration = [
    {
        "id": "Config",
        # ...
    }
]</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Get the CloudFormation resource
CfnBucket cfnBucket = (CfnBucket)bucket.getNode().getDefaultChild();

cfnBucket.setAnalyticsConfigurations(
        Arrays.asList(java.util.Map.of(    // Java 9 or later
            "Id", "Config", // ...
        ));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Get the CloudFormation resource
var cfnBucket = (CfnBucket)bucket.Node.DefaultChild;

cfnBucket.AnalyticsConfigurations = new List&lt;object&gt; {
    new Dictionary&lt;string, string&gt;
    {
        ["Id"] = "Config",
        // ...
    }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use this object to change AWS CloudFormation options such as  <code>Metadata</code> and <code>UpdatePolicy</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">cfnBucket.cfnOptions.metadata = {
  MetadataKey: 'MetadataValue'
};</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">cfnBucket.cfnOptions.metadata = {
  MetadataKey: 'MetadataValue'
};</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">cfn_bucket.cfn_options.metadata = {
    "MetadataKey": "MetadataValue"
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">cfnBucket.getCfnOptions().setMetadata(java.util.Map.of(    // Java 9+
    "MetadataKey", "Metadatavalue"));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">cfnBucket.CfnOptions.Metadata = new Dictionary&lt;string, object&gt;
{
    ["MetadataKey"] = "Metadatavalue"
};</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="develop-customize-unescape">12.7.2. Use un-escape hatches</h4>
<div class="paragraph">
<p>The AWS CDK also provides the capability to go  <em>up</em> an abstraction level, which we might refer to as an "un-escape" hatch. If you have an L1 construct, such as <code>CfnBucket</code>, you can create a new L2 construct (<code>Bucket</code> in this case) to wrap the L1 construct.</p>
</div>
<div class="paragraph">
<p>This is convenient when you create an L1 resource but want to use it with a construct that requires an L2 resource. It&#8217;s also helpful when you want to use convenience methods like <code>.grantXxxxx()</code> that aren&#8217;t available on the L1 construct.</p>
</div>
<div class="paragraph">
<p>You move to the higher abstraction level using a static method on the L2 class called <code>.fromCfnXxxxx()</code>--for example, <code>Bucket.fromCfnBucket()</code> for Amazon S3 buckets. The L1 resource is the only parameter.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">b1 = new s3.CfnBucket(this, "buck09", { ... });
b2 = s3.Bucket.fromCfnBucket(b1);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">b1 = new s3.CfnBucket(this, "buck09", { ...} );
b2 = s3.Bucket.fromCfnBucket(b1);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">b1 = s3.CfnBucket(self, "buck09", ...)
 b2 = s3.from_cfn_bucket(b1)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnBucket b1 = CfnBucket.Builder.create(this, "buck09")
								// ....
		                        .build();
IBucket b2 = Bucket.fromCfnBucket(b1);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var b1 = new CfnBucket(this, "buck09", new CfnBucketProps { ... });
var v2 = Bucket.FromCfnBucket(b1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>L2 constructs created from L1 constructs are proxy objects that refer to the L1 resource, similar to those created from resource names, ARNs, or lookups. Modifications to these constructs do not affect the final synthesized AWS CloudFormation template (since you have the L1 resource, however, you can modify that instead). For more information on proxy objects, see  <a href="#resources-external">Referencing resources in your AWS account</a>.</p>
</div>
<div class="paragraph">
<p>To avoid confusion, do not create multiple L2 constructs that refer to the same L1 construct. For example, if you extract the <code>CfnBucket</code> from a <code>Bucket</code> using the technique in the <a href="#develop-customize-escape-l2">previous section</a>, you shouldn&#8217;t create a second <code>Bucket</code> instance by calling <code>Bucket.fromCfnBucket()</code> with that <code>CfnBucket</code>. It actually works as you&#8217;d expect (only one <code>AWS::S3::Bucket</code> is synthesized) but it makes your code more difficult to maintain.</p>
</div>
</div>
<div class="sect3">
<h4 id="develop-customize-override">12.7.3. Use raw overrides</h4>
<div class="paragraph">
<p>If there are properties that are missing from the L1 construct, you can bypass all typing using raw overrides. This also makes it possible to delete synthesized properties.</p>
</div>
<div class="paragraph">
<p>Use one of the <code>addOverride</code> methods (Python: <code>add_override</code>) methods, as shown in the following example.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Get the CloudFormation resource
const cfnBucket = bucket.node.defaultChild as s3.CfnBucket;

// Use dot notation to address inside the resource template fragment
cfnBucket.addOverride('Properties.VersioningConfiguration.Status', 'NewStatus');
cfnBucket.addDeletionOverride('Properties.VersioningConfiguration.Status');

// use index (0 here) to address an element of a list
cfnBucket.addOverride('Properties.Tags.0.Value', 'NewValue');
cfnBucket.addDeletionOverride('Properties.Tags.0');

// addPropertyOverride is a convenience function for paths starting with "Properties."
cfnBucket.addPropertyOverride('VersioningConfiguration.Status', 'NewStatus');
cfnBucket.addPropertyDeletionOverride('VersioningConfiguration.Status');
cfnBucket.addPropertyOverride('Tags.0.Value', 'NewValue');
cfnBucket.addPropertyDeletionOverride('Tags.0');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Get the CloudFormation resource
const cfnBucket = bucket.node.defaultChild ;

// Use dot notation to address inside the resource template fragment
cfnBucket.addOverride('Properties.VersioningConfiguration.Status', 'NewStatus');
cfnBucket.addDeletionOverride('Properties.VersioningConfiguration.Status');

// use index (0 here) to address an element of a list
cfnBucket.addOverride('Properties.Tags.0.Value', 'NewValue');
cfnBucket.addDeletionOverride('Properties.Tags.0');

// addPropertyOverride is a convenience function for paths starting with "Properties."
cfnBucket.addPropertyOverride('VersioningConfiguration.Status', 'NewStatus');
cfnBucket.addPropertyDeletionOverride('VersioningConfiguration.Status');
cfnBucket.addPropertyOverride('Tags.0.Value', 'NewValue');
cfnBucket.addPropertyDeletionOverride('Tags.0');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Get the CloudFormation resource
cfn_bucket = bucket.node.default_child

# Use dot notation to address inside the resource template fragment
cfn_bucket.add_override("Properties.VersioningConfiguration.Status", "NewStatus")
cfn_bucket.add_deletion_override("Properties.VersioningConfiguration.Status")

# use index (0 here) to address an element of a list
cfn_bucket.add_override("Properties.Tags.0.Value", "NewValue")
cfn_bucket.add_deletion_override("Properties.Tags.0")

# addPropertyOverride is a convenience function for paths starting with "Properties."
cfn_bucket.add_property_override("VersioningConfiguration.Status", "NewStatus")
cfn_bucket.add_property_deletion_override("VersioningConfiguration.Status")
cfn_bucket.add_property_override("Tags.0.Value", "NewValue")
cfn_bucket.add_property_deletion_override("Tags.0")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Get the CloudFormation resource
CfnBucket cfnBucket = (CfnBucket)bucket.getNode().getDefaultChild();

// Use dot notation to address inside the resource template fragment
cfnBucket.addOverride("Properties.VersioningConfiguration.Status", "NewStatus");
cfnBucket.addDeletionOverride("Properties.VersioningConfiguration.Status");

// use index (0 here) to address an element of a list
cfnBucket.addOverride("Properties.Tags.0.Value", "NewValue");
cfnBucket.addDeletionOverride("Properties.Tags.0");

// addPropertyOverride is a convenience function for paths starting with "Properties."
cfnBucket.addPropertyOverride("VersioningConfiguration.Status", "NewStatus");
cfnBucket.addPropertyDeletionOverride("VersioningConfiguration.Status");
cfnBucket.addPropertyOverride("Tags.0.Value", "NewValue");
cfnBucket.addPropertyDeletionOverride("Tags.0");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// Get the CloudFormation resource
var cfnBucket = (CfnBucket)bucket.node.defaultChild;

// Use dot notation to address inside the resource template fragment
cfnBucket.AddOverride("Properties.VersioningConfiguration.Status", "NewStatus");
cfnBucket.AddDeletionOverride("Properties.VersioningConfiguration.Status");

// use index (0 here) to address an element of a list
cfnBucket.AddOverride("Properties.Tags.0.Value", "NewValue");
cfnBucket.AddDeletionOverride("Properties.Tags.0");

// addPropertyOverride is a convenience function for paths starting with "Properties."
cfnBucket.AddPropertyOverride("VersioningConfiguration.Status", "NewStatus");
cfnBucket.AddPropertyDeletionOverride("VersioningConfiguration.Status");
cfnBucket.AddPropertyOverride("Tags.0.Value", "NewValue");
cfnBucket.AddPropertyDeletionOverride("Tags.0");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="develop-customize-custom">12.7.4. Use custom resources</h4>
<div class="paragraph">
<p>If the feature isn&#8217;t available through AWS CloudFormation, but only through a direct API call, you must write an AWS CloudFormation Custom Resource to make the API call you need. You can use the AWS CDK to write custom resources and wrap them into a regular construct interface. From the perspective of a consumer of your construct, the experience will feel native.</p>
</div>
<div class="paragraph">
<p>Building a custom resource involves writing a Lambda function that responds to a resource&#8217;s <code>CREATE</code>, <code>UPDATE</code>, and <code>DELETE</code> lifecycle events. If your custom resource needs to make only a single API call, consider using the <a href="https://github.com/awslabs/aws-cdk/tree/master/packages/%40aws-cdk/custom-resources">AwsCustomResource</a>. This makes it possible to perform arbitrary SDK calls during an AWS CloudFormation deployment. Otherwise, you should write your own Lambda function to perform the work you need to get done.</p>
</div>
<div class="paragraph">
<p>The subject is too broad to cover completely here, but the following links should get you started:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-custom-resources.html">Custom Resources</a></p>
</li>
<li>
<p><a href="https://github.com/aws-samples/aws-cdk-examples/tree/master/typescript/custom-resource/">Custom-Resource Example</a></p>
</li>
<li>
<p>For a more fully fledged example, see the <a href="https://github.com/awslabs/aws-cdk/blob/master/packages/@aws-cdk/aws-certificatemanager/lib/dns-validated-certificate.ts">DnsValidatedCertificate</a> class in the CDK standard library. This is implemented as a custom resource.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="get-env-var">12.8. Get a value from an environment variable</h3>
<div class="paragraph">
<p>To get the value of an environment variable, use code like the following. This code gets the value of the environment variable  <code>amzn-s3-demo-bucket</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Sets bucket_name to undefined if environment variable not set
var bucket_name = process.env.amzn-s3-demo-bucket;

// Sets bucket_name to a default if env var doesn't exist
var bucket_name = process.env.amzn-s3-demo-bucket || "DefaultName";</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Sets bucket_name to undefined if environment variable not set
var bucket_name = process.env.amzn-s3-demo-bucket;

// Sets bucket_name to a default if env var doesn't exist
var bucket_name = process.env.amzn-s3-demo-bucket || "DefaultName";</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import os

# Raises KeyError if environment variable doesn't exist
bucket_name = os.environ["amzn-s3-demo-bucket"]

# Sets bucket_name to None if environment variable doesn't exist
bucket_name = os.getenv("amzn-s3-demo-bucket")

# Sets bucket_name to a default if env var doesn't exist
bucket_name = os.getenv("amzn-s3-demo-bucket", "DefaultName")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Sets bucketName to null if environment variable doesn't exist
String bucketName = System.getenv("amzn-s3-demo-bucket");

// Sets bucketName to a default if env var doesn't exist
String bucketName = System.getenv("amzn-s3-demo-bucket");
if (bucketName == null) bucketName = "DefaultName";</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using System;

// Sets bucket name to null if environment variable doesn't exist
string bucketName = Environment.GetEnvironmentVariable("amzn-s3-demo-bucket");

// Sets bucket_name to a default if env var doesn't exist
string bucketName = Environment.GetEnvironmentVariable("amzn-s3-demo-bucket") ?? "DefaultName";</code></pre>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="get-cfn-param">12.9. Use CloudFormation parameters to get a CloudFormation value</h3>
<div class="paragraph">
<p>Use AWS CloudFormation parameters within AWS Cloud Development Kit (AWS CDK) applications to input custom values into your synthesized CloudFormation templates at deployment.</p>
</div>
<div class="paragraph">
<p>For an introduction, see <a href="#parameters">Parameters and the AWS CDK</a>.</p>
</div>
<div class="sect3">
<h4 id="parameters-define">12.9.1. Define parameters in your CDK app</h4>
<div class="paragraph">
<p>Use the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.CfnParameter.html">CfnParameter</a> class to define a parameter. You&#8217;ll want to specify at least a type and a description for most parameters, though both are technically optional. The description appears when the user is prompted to enter the parameter&#8217;s value in the AWS CloudFormation console. For more information on the available types, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html#parameters-section-structure-properties-type">Types</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can define parameters in any scope. However, we recommend defining parameters at the stack level so that their logical ID doesn&#8217;t change when you refactor your code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const uploadBucketName = new CfnParameter(this, "uploadBucketName", {
  type: "String",
  description: "The name of the Amazon S3 bucket where uploaded files will be stored."});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const uploadBucketName = new CfnParameter(this, "uploadBucketName", {
  type: "String",
  description: "The name of the Amazon S3 bucket where uploaded files will be stored."});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">upload_bucket_name = CfnParameter(self, "uploadBucketName", type="String",
    description="The name of the Amazon S3 bucket where uploaded files will be stored.")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnParameter uploadBucketName = CfnParameter.Builder.create(this, "uploadBucketName")
        .type("String")
        .description("The name of the Amazon S3 bucket where uploaded files will be stored")
        .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var uploadBucketName = new CfnParameter(this, "uploadBucketName", new CfnParameterProps
{
    Type = "String",
    Description = "The name of the Amazon S3 bucket where uploaded files will be stored"
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-use">12.9.2. Use parameters</h4>
<div class="paragraph">
<p>A  <code>CfnParameter</code> instance exposes its value to your CDK app via a <a href="#tokens">token</a>. Like all tokens, the parameter&#8217;s token is resolved at synthesis time. But it resolves to a reference to the parameter defined in the AWS CloudFormation template (which will be resolved at deploy time), rather than to a concrete value.</p>
</div>
<div class="paragraph">
<p>You can retrieve the token as an instance of the <code>Token</code> class, or in string, string list, or numeric encoding. Your choice depends on the kind of value required by the class or method that you want to use the parameter with.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">kind of value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Token</code> class instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueAsList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueAsNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueAsString</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">kind of value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Token</code> class instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueAsList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueAsNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueAsString</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">kind of value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Token</code> class instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value_as_list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value_as_number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value_as_string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">kind of value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getValue()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Token</code> class instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getValueAsList()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getValueAsNumber()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getValueAsString()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">kind of value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Token</code> class instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValueAsList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValueAsNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValueAsString</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The token represented as a string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, to use a parameter in a  <code>Bucket</code> definition:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new Bucket(this, "amzn-s3-demo-bucket",
  { bucketName: uploadBucketName.valueAsString});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = new Bucket(this, "amzn-s3-demo-bucket",
  { bucketName: uploadBucketName.valueAsString});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = Bucket(self, "amzn-s3-demo-bucket",
    bucket_name=upload_bucket_name.value_as_string)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = Bucket.Builder.create(this, "amzn-s3-demo-bucket")
        .bucketName(uploadBucketName.getValueAsString())
        .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = new Bucket(this, "amzn-s3-demo-bucket")
{
    BucketName = uploadBucketName.ValueAsString
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parameters-deploy">12.9.3. Deploy CDK apps containing parameters</h4>
<div class="paragraph">
<p>When you deploy a generated AWS CloudFormation template through the AWS CloudFormation console, you will be prompted to provide the values for each parameter.</p>
</div>
<div class="paragraph">
<p>You can also provide parameter values using the CDK <code class="noloc">CLI</code><code>cdk deploy</code> command, or by specifying parameter values in your CDK project&#8217;s stack file.</p>
</div>
<div class="sect4">
<h5 id="parameters-deploy-cli">Provide parameter values with <code class="noloc">cdk deploy</code></h5>
<div class="paragraph">
<p>When you deploy using the CDK  <code class="noloc">CLI</code><code>cdk deploy</code> command, you can provide parameter values at deployment with the <code>--parameters</code> option.</p>
</div>
<div class="paragraph">
<p>The following is an example of the <code>cdk deploy</code> command structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy stack-logical-id --parameters stack-name:parameter-name=parameter-value</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your CDK app contains a single stack, you don&#8217;t have to provide the stack logical ID argument or the  <code><code class="replaceable">stack-name</code></code> value in the <code>--parameters</code> option. The CDK <code class="noloc">CLI</code> will automatically find and provide these values. The following is an example that specifies an  <code>uploadbucket</code> value for the <code>uploadBucketName</code> parameter of the single stack in our CDK app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --parameters uploadBucketName=uploadbucket</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="parameters-deploy-cli-multi-stack">Provide parameter values with cdk deploy for multi-stack applications</h5>
<div class="paragraph">
<p>The following is an example CDK application in  <code class="noloc">TypeScript</code> that contains two CDK stacks. Each stack contains an Amazon S3 bucket instance and a parameter to set the Amazon S3 bucket name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

// Define the CDK app
const app = new cdk.App();

// First stack
export class MyFirstStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Set a default parameter name
    const bucketNameParam = new cdk.CfnParameter(this, 'bucketNameParam', {
      type: 'String',
      default: 'myfirststackdefaultbucketname'
    });

    // Define an S3 bucket
    new s3.Bucket(this, 'MyFirstBucket', {
      bucketName: bucketNameParam.valueAsString
    });
  }
}

// Second stack
export class MySecondStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Set a default parameter name
    const bucketNameParam = new cdk.CfnParameter(this, 'bucketNameParam', {
      type: 'String',
      default: 'mysecondstackdefaultbucketname'
    });

    // Define an S3 bucket
    new s3.Bucket(this, 'MySecondBucket', {
      bucketName: bucketNameParam.valueAsString
    });
  }
}

// Instantiate the stacks
new MyFirstStack(app, 'MyFirstStack', {
  stackName: 'MyFirstDeployedStack',
});

new MySecondStack(app, 'MySecondStack', {
  stackName: 'MySecondDeployedStack',
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>For CDK apps that contain multiple stacks, you can do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Deploy one stack with parameters</strong> – To deploy a single stack from a multi-stack application, provide the stack logical ID as an argument.</p>
<div class="paragraph">
<p>The following is an example that deploys <code>MySecondStack</code> with <code>mynewbucketname</code> as the parameter value for <code>bucketNameParam</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy MySecondStack --parameters bucketNameParam='mynewbucketname'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Deploy all stacks and specify parameter values for each stack</strong> – Provide the <code>'*'</code> wildcard or the <code>--all</code> option to deploy all stacks. Provide the <code>--parameters</code> option multiple times in a single command to specify parameter values for each stack. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy '*' --parameters MyFirstDeployedStack:bucketNameParam='mynewfirststackbucketname' --parameters MySecondDeployedStack:bucketNameParam='mynewsecondstackbucketname'</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Deploy all stacks and specify parameter values for a single stack</strong> – Provide the <code>'*'</code> wildcard or the <code>--all</code> option to deploy all stacks. Then, specify the stack to define the parameter for in the <code>--parameters</code> option. The following are examples that deploys all stacks in a CDK app and specifies a parameter value for the <code>MySecondDeployedStack</code> AWS CloudFormation stack. All other stacks will deploy and use the default parameter value:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy '*' --parameters MySecondDeployedStack:bucketNameParam='mynewbucketname'
$ cdk deploy --all --parameters MySecondDeployedStack:bucketNameParam='mynewbucketname'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="parameters-deploy-cli-nested-stack">Provide parameter values with  <code class="noloc">cdk deploy</code> for applications with nested stacks</h5>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> behavior when working with applications containing nested stacks is similar to multi-stack applications. The main difference is, if you want to deploy all nested stacks, use the  <code>'<strong>'</code> wildcard. The <code>'*'</code> wildcard deploys all stacks but will not deploy nested stacks. The <code>'</strong>'</code> wildcard deploys all stacks, including nested stacks.</p>
</div>
<div class="paragraph">
<p>The following is an example that deploys nested stacks while specifying the parameter value for one nested stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy '**' --parameters MultiStackCdkApp/SecondStack:bucketNameParam='mysecondstackbucketname'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on  <code>cdk deploy</code> command options, see <a href="#ref-cli-cmd-deploy">cdk deploy</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="use-cfn-template">12.10. Import an existing AWS CloudFormation template</h3>
<div class="paragraph">
<p>Import resources from an AWS CloudFormation template into your AWS Cloud Development Kit (AWS CDK) applications by using the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include-readme.html">cloudformation-include.CfnInclude</a> construct to convert resources to L1 constructs.</p>
</div>
<div class="paragraph">
<p>After import, you can work with these resources in your app in the same way that you would if they were originally defined in AWS CDK code. You can also use these L1 constructs within higher-level AWS CDK constructs. For example, this can let you use the L2 permission grant methods with the resources they define.</p>
</div>
<div class="paragraph">
<p>The <code>cloudformation-include.CfnInclude</code> construct essentially adds an AWS CDK API wrapper to any resource in your AWS CloudFormation template. Use this capability to import your existing AWS CloudFormation templates to the AWS CDK a piece at a time. By doing this, you can manage your existing resources using AWS CDK constructs to utilize the benefits of higher-level abstractions. You can also use this feature to vend your AWS CloudFormation templates to AWS CDK developers by providing an AWS CDK construct API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>AWS CDK v1 also included <a href="https://docs.aws.amazon.com/cdk/api/latest/docs/aws-cdk-lib.CfnInclude.html">aws-cdk-lib.CfnInclude</a>, which was previously used for the same general purpose. However, it lacks much of the functionality of <code>cloudformation-include.CfnInclude</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="w94aac53c46c19">12.10.1. Import an AWS CloudFormation template</h4>
<div class="paragraph">
<p>The following is a sample AWS CloudFormation template that we will use to provide examples in this topic. Copy and save the template as  <code class="path">my-template.json</code> to follow along. After working through these examples, you can explore further by using any of your existing deployed AWS CloudFormation templates. You can obtain them from the AWS CloudFormation console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "Resources": {
    "amzn-s3-demo-bucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketName": "amzn-s3-demo-bucket",
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can work with either JSON or YAML templates. We recommend JSON if available since YAML parsers can vary slightly in what they accept.</p>
</div>
<div class="paragraph">
<p>The following is an example of how to import the sample template into your AWS CDK app using <code>cloudformation-include</code>. Templates are imported within the context of an CDK stack.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import * as cfninc from 'aws-cdk-lib/cloudformation-include';
import { Construct } from 'constructs';

export class MyStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const template = new cfninc.CfnInclude(this, 'Template', {
      templateFile: 'my-template.json',
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const cfninc = require('aws-cdk-lib/cloudformation-include');

class MyStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const template = new cfninc.CfnInclude(this, 'Template', {
      templateFile: 'my-template.json',
    });
  }
}

module.exports = { MyStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from aws_cdk import cloudformation_include as cfn_inc
from constructs import Construct

class MyStack(cdk.Stack):

    def __init__(self, scope: Construct, id: str, **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        template = cfn_inc.CfnInclude(self, "Template",
            template_file="my-template.json")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.cloudformation.include.CfnInclude;
import software.constructs.Construct;

public class MyStack extends Stack {
    public MyStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        CfnInclude template = CfnInclude.Builder.create(this, "Template")
        	.templateFile("my-template.json")
        	.build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using cfnInc = Amazon.CDK.CloudFormation.Include;

namespace MyApp
{
    public class MyStack : Stack
    {
        internal MyStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            var template = new cfnInc.CfnInclude(this, "Template", new cfnInc.CfnIncludeProps
            {
                TemplateFile = "my-template.json"
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, importing a resource preserves the resource&#8217;s original logical ID from the template. This behavior is suitable for importing an AWS CloudFormation template into the AWS CDK, where logical IDs must be retained. AWS CloudFormation needs this information to recognize these imported resources as the same resources from the AWS CloudFormation template.</p>
</div>
<div class="paragraph">
<p>If you are developing an AWS CDK construct wrapper for the template so that it can be used by other AWS CDK developers, have the AWS CDK generate new resource IDs instead. By doing this, the construct can be used multiple times in a stack without name conflicts. To do this, set the <code>preserveLogicalIds</code> property to <code>false</code> when importing the template. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const template = new cfninc.CfnInclude(this, 'MyConstruct', {
  templateFile: 'my-template.json',
  preserveLogicalIds: false
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const template = new cfninc.CfnInclude(this, 'MyConstruct', {
  templateFile: 'my-template.json',
  preserveLogicalIds: false
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">template = cfn_inc.CfnInclude(self, "Template",
    template_file="my-template.json",
    preserve_logical_ids=False)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnInclude template = CfnInclude.Builder.create(this, "Template")
	.templateFile("my-template.json")
	.preserveLogicalIds(false)
	.build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var template = new cfnInc.CfnInclude(this, "Template", new cfn_inc.CfnIncludeProps
{
    TemplateFile = "my-template.json",
    PreserveLogicalIds = false
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>To put imported resources under the control of your AWS CDK app, add the stack to the  <code>App</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { MyStack } from '../lib/my-stack';

const app = new cdk.App();
new MyStack(app, 'MyStack');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const { MyStack } = require('../lib/my-stack');

const app = new cdk.App();
new MyStack(app, 'MyStack');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from mystack.my_stack import MyStack

app = cdk.App()
MyStack(app, "MyStack")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.App;

public class MyApp {
    public static void main(final String[] args) {
        App app = new App();

        new MyStack(app, "MyStack");
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;

namespace CdkApp
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            var app = new App();
            new MyStack(app, "MyStack");
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify that there won&#8217;t be any unintended changes to the AWS resources in the stack, you can perform a diff. Use the AWS CDK  <code class="noloc">CLI</code><code>cdk diff</code> command and omit any AWS CDK-specific metadata. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk diff --no-version-reporting --no-path-metadata --no-asset-metadata</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you import an AWS CloudFormation template, the AWS CDK app should become the source of truth for your imported resources. To make changes to your resources, modify them in your AWS CDK app and deploy with the AWS CDK  <code class="noloc">CLI</code><strong class="command">cdk deploy</strong> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-cfn-template-cfninclude-access">12.10.2. Access imported resources</h4>
<div class="paragraph">
<p>The name  <code>template</code> in the example code represents the imported AWS CloudFormation template. To access a resource from it, use the object&#8217;s <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrresourcelogicalid">getResource()</a> method. To access the returned resource as a specific kind of resource, cast the result to the desired type. This isn&#8217;t necessary in Python or JavaScript. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cfnBucket = template.getResource('amzn-s3-demo-bucket') as s3.CfnBucket;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cfnBucket = template.getResource('amzn-s3-demo-bucket');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">cfn_bucket = template.get_resource("amzn-s3-demo-bucket")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnBucket cfnBucket = (CfnBucket)template.getResource("amzn-s3-demo-bucket");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var cfnBucket = (CfnBucket)template.GetResource("amzn-s3-demo-bucket");</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this example,  <code>cfnBucket</code> is now an instance of the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">aws-s3.CfnBucket</a> class. This is an L1 construct that represents the corresponding AWS CloudFormation resource. You can treat it like any other resource of its type. For example, you can get its ARN value with the <code>bucket.attrArn</code> property.</p>
</div>
<div class="paragraph">
<p>To wrap the L1 <code>CfnBucket</code> resource in an L2 <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html">aws-s3.Bucket</a> instance instead, use the static methods <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#static-fromwbrbucketwbrarnscope-id-bucketarn">fromBucketArn()</a>, <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#static-fromwbrbucketwbrattributesscope-id-attrs">fromBucketAttributes()</a>, or <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#static-fromwbrbucketwbrnamescope-id-bucketname">fromBucketName()</a>. Usually, the <code>fromBucketName()</code> method is most convenient. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = s3.Bucket.fromBucketName(this, 'Bucket', cfnBucket.ref);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket = s3.Bucket.fromBucketName(this, 'Bucket', cfnBucket.ref);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket = s3.Bucket.from_bucket_name(self, "Bucket", cfn_bucket.ref)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Bucket bucket = (Bucket)Bucket.fromBucketName(this, "Bucket", cfnBucket.getRef());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucket = (Bucket)Bucket.FromBucketName(this, "Bucket", cfnBucket.Ref);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other L2 constructs have similar methods for creating the construct from an existing resource.</p>
</div>
<div class="paragraph">
<p>When you wrap an L1 construct in an L2 construct, it doesn&#8217;t create a new resource. From our example, we are not creating a second S3; bucket. Instead, the new <code>Bucket</code> instance encapsulates the existing <code>CfnBucket</code>.</p>
</div>
<div class="paragraph">
<p>From the example, the <code>bucket</code> is now an L2 <code>Bucket</code> construct that behaves like any other L2 construct. For example, you can grant an AWS Lambda function write access to the bucket by using the bucket&#8217;s convenient <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#grantwbrwriteidentity-objectskeypattern">grantWrite()</a> method. You don&#8217;t have to define the necessary AWS Identity and Access Management (IAM) policy manually. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.grantWrite(lambdaFunc);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">bucket.grantWrite(lambdaFunc);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket.grant_write(lambda_func)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bucket.grantWrite(lambdaFunc);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">bucket.GrantWrite(lambdaFunc);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-cfn-template-cfninclude-params">12.10.3. Replace parameters</h4>
<div class="paragraph">
<p>If your AWS CloudFormation template contains parameters, you can replace them with build time values at import by using the  <code>parameters</code> property. In the following example, we replace the <code>UploadBucket</code> parameter with the ARN of a bucket defined elsewhere in our AWS CDK code.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const template = new cfninc.CfnInclude(this, 'Template', {
  templateFile: 'my-template.json',
  parameters: {
    'UploadBucket': bucket.bucketArn,
  },
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const template = new cfninc.CfnInclude(this, 'Template', {
  templateFile: 'my-template.json',
  parameters: {
    'UploadBucket': bucket.bucketArn,
  },
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">template = cfn_inc.CfnInclude(self, "Template",
    template_file="my-template.json",
    parameters=dict(UploadBucket=bucket.bucket_arn)
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnInclude template = CfnInclude.Builder.create(this, "Template")
	.templateFile("my-template.json")
	.parameters(java.util.Map.of(    // Map.of requires Java 9+
			"UploadBucket", bucket.getBucketArn()))
	.build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var template = new cfnInc.CfnInclude(this, "Template", new cfnInc.CfnIncludeProps
{
    TemplateFile = "my-template.json",
    Parameters = new Dictionary&lt;string, string&gt;
    {
        { "UploadBucket", bucket.BucketArn }
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-cfn-template-cfninclude-other">12.10.4. Import other template elements</h4>
<div class="paragraph">
<p>You can import any AWS CloudFormation template element, not just resources. The imported elements become a part of the AWS CDK stack. To import these elements, use the following methods of the  <code>CfnInclude</code> object:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrconditionconditionname">getCondition()</a> – AWS CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html">conditions</a>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrhookhooklogicalid">getHook()</a> – AWS CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html">hooks</a> for blue/green deployments.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrmappingmappingname">getMapping()</a> – AWS CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/mappings-section-structure.html">mappings</a>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbroutputlogicalid">getOutput()</a> – AWS CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html">outputs</a>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrparameterparametername">getParameter()</a> – AWS CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">parameters</a>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrrulerulename">getRule()</a> – AWS CloudFormation <a href="https://docs.aws.amazon.com/servicecatalog/latest/adminguide/reference-template_constraint_rules.html">rules</a> for AWS Service Catalog templates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these methods return an instance of a class that represents the specific type of AWS CloudFormation element. These objects are mutable. Changes that you make to them will appear in the template that gets generated from the AWS CDK stack. The following is an example that imports a parameter from the template and modifies its default value:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const param = template.getParameter('MyParameter');
param.default = "AWS CDK"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const param = template.getParameter('MyParameter');
param.default = "AWS CDK"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">param = template.get_parameter("MyParameter")
param.default = "AWS CDK"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnParameter param = template.getParameter("MyParameter");
param.setDefaultValue("AWS CDK")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var cfnBucket = (CfnBucket)template.GetResource("amzn-s3-demo-bucket");
var param = template.GetParameter("MyParameter");
param.Default = "AWS CDK";</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="use-cfn-template-cfninclude-nested">12.10.5. Import nested stacks</h4>
<div class="paragraph">
<p>You can import  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-nested-stacks.html">nested stacks</a> by specifying them either when you import their main template, or at some later point. The nested template must be stored in a local file, but referenced as a <code>NestedStack</code> resource in the main template. Also, the resource name used in the AWS CDK code must match the name used for the nested stack in the main template.</p>
</div>
<div class="paragraph">
<p>Given this resource definition in the main template, the following code shows how to import the referenced nested stack both ways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"NestedStack": {
  "Type": "AWS::CloudFormation::Stack",
  "Properties": {
    "TemplateURL": "https://my-s3-template-source.s3.amazonaws.com/nested-stack.json"
  }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// include nested stack when importing main stack
const mainTemplate = new cfninc.CfnInclude(this, 'MainStack', {
  templateFile: 'main-template.json',
  loadNestedStacks: {
    'NestedStack': {
      templateFile: 'nested-template.json',
    },
  },
});

// or add it some time after importing the main stack
const nestedTemplate = mainTemplate.loadNestedStack('NestedTemplate', {
  templateFile: 'nested-template.json',
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// include nested stack when importing main stack
const mainTemplate = new cfninc.CfnInclude(this, 'MainStack', {
  templateFile: 'main-template.json',
  loadNestedStacks: {
    'NestedStack': {
      templateFile: 'nested-template.json',
    },
  },
});

// or add it some time after importing the main stack
const nestedTemplate = mainTemplate.loadNestedStack('NestedStack', {
  templateFile: 'my-nested-template.json',
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># include nested stack when importing main stack
main_template = cfn_inc.CfnInclude(self, "MainStack",
    template_file="main-template.json",
    load_nested_stacks=dict(NestedStack=
        cfn_inc.CfnIncludeProps(template_file="nested-template.json")))

# or add it some time after importing the main stack
nested_template = main_template.load_nested_stack("NestedStack",
    template_file="nested-template.json")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnInclude mainTemplate = CfnInclude.Builder.create(this, "MainStack")
	.templateFile("main-template.json")
	.loadNestedStacks(java.util.Map.of(    // Map.of requires Java 9+
	   "NestedStack", CfnIncludeProps.builder()
				.templateFile("nested-template.json").build()))
	.build();

// or add it some time after importing the main stack
IncludedNestedStack nestedTemplate = mainTemplate.loadNestedStack("NestedTemplate", CfnIncludeProps.builder()
		.templateFile("nested-template.json")
		.build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// include nested stack when importing main stack
var mainTemplate = new cfnInc.CfnInclude(this, "MainStack", new cfnInc.CfnIncludeProps
{
    TemplateFile = "main-template.json",
    LoadNestedStacks = new Dictionary&lt;string, cfnInc.ICfnIncludeProps&gt;
    {
        { "NestedStack", new cfnInc.CfnIncludeProps { TemplateFile = "nested-template.json" } }
    }
});

// or add it some time after importing the main stack
var nestedTemplate = mainTemplate.LoadNestedStack("NestedTemplate", new cfnInc.CfnIncludeProps {
    TemplateFile = 'nested-template.json'
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can import multiple nested stacks with either methods. When importing the main template, you provide a mapping between the resource name of each nested stack and its template file. This mapping can contain any number of entries. To do it after the initial import, call  <code>loadNestedStack()</code> once for each nested stack.</p>
</div>
<div class="paragraph">
<p>After importing a nested stack, you can access it using the main template&#8217;s <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrnestedwbrstacklogicalid">getNestedStack()</a> method.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const nestedStack = mainTemplate.getNestedStack('NestedStack').stack;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const nestedStack = mainTemplate.getNestedStack('NestedStack').stack;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">nested_stack = main_template.get_nested_stack("NestedStack").stack</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">NestedStack nestedStack = mainTemplate.getNestedStack("NestedStack").getStack();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var nestedStack = mainTemplate.GetNestedStack("NestedStack").Stack;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <code>getNestedStack()</code> method returns an <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.cloudformation_include.CfnInclude.html#getwbrnestedwbrstacklogicalid">IncludedNestedStack</a> instance. From this instance, you can access the AWS CDK <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.NestedStack.html">NestedStack</a> instance via the <code>stack</code> property, as shown in the example. You can also access the original AWS CloudFormation template object via <code>includedTemplate</code>, from which you can load resources and other AWS CloudFormation elements.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="get-ssm-value">12.11. Get a value from the Systems Manager Parameter Store</h3>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) can retrieve the value of AWS Systems Manager Parameter Store attributes. During synthesis, the AWS CDK produces a  <a href="#tokens">token</a> that is resolved by AWS CloudFormation during deployment.</p>
</div>
<div class="paragraph">
<p>The AWS CDK supports retrieving both plain and secure values. You may request a specific version of either kind of value. For plain values, you may omit the version from your request to retrieve the latest version. For secure values, you must specify the version when requesting the value of the secure attribute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This topic shows how to read attributes from the AWS Systems Manager Parameter Store. You can also read secrets from the AWS Secrets Manager (see <a href="#get-secrets-manager-value">Get a value from AWS Secrets Manager</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="ssm-read-at-deploy">12.11.1. Read Systems Manager values at deployment time</h4>
<div class="paragraph">
<p>To read values from the Systems Manager Parameter Store, use the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ssm.StringParameter.html#static-valuewbrforwbrstringwbrparameterscope-parametername-version">valueForStringParameter</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ssm.StringParameter.html#static-valuewbrforwbrsecurewbrstringwbrparameterscope-parametername-version">valueForSecureStringParameter</a> methods. Choose a method based on whether the attribute you want is a plain string or a secure string value. These methods return <a href="#tokens">tokens</a>, not the actual value. The value is resolved by AWS CloudFormation during deployment. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as ssm from 'aws-cdk-lib/aws-ssm';

// Get latest version or specified version of plain string attribute
const latestStringToken = ssm.StringParameter.valueForStringParameter(
    this, 'my-plain-parameter-name');      // latest version
const versionOfStringToken = ssm.StringParameter.valueForStringParameter(
    this, 'my-plain-parameter-name', 1);   // version 1

// Get specified version of secure string attribute
const secureStringToken = ssm.StringParameter.valueForSecureStringParameter(
    this, 'my-secure-parameter-name', 1);   // must specify version</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ssm = require('aws-cdk-lib/aws-ssm');

// Get latest version or specified version of plain string attribute
const latestStringToken = ssm.StringParameter.valueForStringParameter(
    this, 'my-plain-parameter-name');      // latest version
const versionOfStringToken = ssm.StringParameter.valueForStringParameter(
    this, 'my-plain-parameter-name', 1);   // version 1

// Get specified version of secure string attribute
const secureStringToken = ssm.StringParameter.valueForSecureStringParameter(
    this, 'my-secure-parameter-name', 1);   // must specify version</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_ssm as ssm

# Get latest version or specified version of plain string attribute
latest_string_token = ssm.StringParameter.value_for_string_parameter(
    self, "my-plain-parameter-name")
latest_string_token = ssm.StringParameter.value_for_string_parameter(
    self, "my-plain-parameter-name", 1)

# Get specified version of secure string attribute
secure_string_token = ssm.StringParameter.value_for_secure_string_parameter(
    self, "my-secure-parameter-name", 1)   # must specify version</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.ssm.StringParameter;

//Get latest version or specified version of plain string attribute
String latestStringToken = StringParameter.valueForStringParameter(
            this, "my-plain-parameter-name");       // latest version
String versionOfStringToken = StringParameter.valueForStringParameter(
            this, "my-plain-parameter-name", 1);    // version 1

//Get specified version of secure string attribute
String secureStringToken = StringParameter.valueForSecureStringParameter(
            this, "my-secure-parameter-name", 1);   // must specify version</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.SSM;

// Get latest version or specified version of plain string attribute
var latestStringToken = StringParameter.ValueForStringParameter(
    this, "my-plain-parameter-name");      // latest version
var versionOfStringToken = StringParameter.ValueForStringParameter(
    this, "my-plain-parameter-name", 1);   // version 1

// Get specified version of secure string attribute
var secureStringToken = StringParameter.ValueForSecureStringParameter(
    this, "my-secure-parameter-name", 1);   // must specify version</code></pre>
</div>
</div>
<div class="paragraph">
<p>A  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html#template-parameters-dynamic-patterns-resources">limited number of AWS services</a> currently support this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssm-read-at-synth">12.11.2. Read Systems Manager values at synthesis time</h4>
<div class="paragraph">
<p>At times, it&#8217;s useful to provide a parameter at synthesis time. By doing this, the AWS CloudFormation template will always use the same value instead of resolving the value during deployment.</p>
</div>
<div class="paragraph">
<p>To read a value from the Systems Manager Parameter Store at synthesis time, use the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ssm.StringParameter.html#static-valuewbrfromwbrlookupscope-parametername">valueFromLookup</a> method (Python: <code>value_from_lookup</code>). This method returns the actual value of the parameter as a <a href="#context">Context values and the AWS CDK</a> value. If the value is not already cached in <code class="path">cdk.json</code> or passed on the command line, it is retrieved from the current AWS account. For this reason, the stack  <em>must</em> be synthesized with explicit AWS environment information.</p>
</div>
<div class="paragraph">
<p>The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as ssm from 'aws-cdk-lib/aws-ssm';

const stringValue = ssm.StringParameter.valueFromLookup(this, 'my-plain-parameter-name');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ssm = require('aws-cdk-lib/aws-ssm');

const stringValue = ssm.StringParameter.valueFromLookup(this, 'my-plain-parameter-name');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_ssm as ssm

string_value = ssm.StringParameter.value_from_lookup(self, "my-plain-parameter-name")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.ssm.StringParameter;

String stringValue = StringParameter.valueFromLookup(this, "my-plain-parameter-name");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.SSM;

var stringValue = StringParameter.ValueFromLookup(this, "my-plain-parameter-name");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only plain Systems Manager strings may be retrieved. Secure strings cannot be retrieved. The latest version will always be returned. Specific versions cannot be requested.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The retrieved value will end up in your synthesized AWS CloudFormation template. This might be a security risk, depending on who has access to your AWS CloudFormation templates and what kind of value it is. Generally, don&#8217;t use this feature for passwords, keys, or other values you want to keep private.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ssm-write">12.11.3. Write values to Systems Manager</h4>
<div class="paragraph">
<p>You can use the AWS CLI, the AWS Management Console, or an AWS SDK to set Systems Manager parameter values. The following examples use the  <a href="https://docs.aws.amazon.com/cli/latest/reference/ssm/put-parameter.html">ssm put-parameter</a> CLI command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws ssm put-parameter --name "parameter-name" --type "String" --value "parameter-value"
aws ssm put-parameter --name "secure-parameter-name" --type "SecureString" --value "secure-parameter-value"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When updating an SSM value that already exists, also include the  <code>--overwrite</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws ssm put-parameter --overwrite --name "parameter-name" --type "String" --value "parameter-value"
aws ssm put-parameter --overwrite --name "secure-parameter-name" --type "SecureString" --value "secure-parameter-value"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="get-secrets-manager-value">12.12. Get a value from AWS Secrets Manager</h3>
<div class="paragraph">
<p>To use values from AWS Secrets Manager in your AWS CDK app, use the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_secretsmanager.Secret.html#static-fromwbrsecretwbrattributesscope-id-attrs">fromSecretAttributes()</a> method. It represents a value that is retrieved from Secrets Manager and used at AWS CloudFormation deployment time. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as sm from "aws-cdk-lib/aws-secretsmanager";

export class SecretsManagerStack extends cdk.Stack {
  constructor(scope: cdk.App, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const secret = sm.Secret.fromSecretAttributes(this, "ImportedSecret", {
      secretCompleteArn:
        "arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id-number&gt;:secret:&lt;secret-name&gt;-&lt;random-6-characters&gt;"
      // If the secret is encrypted using a KMS-hosted CMK, either import or reference that key:
      // encryptionKey: ...
    });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const sm = require("aws-cdk-lib/aws-secretsmanager");

class SecretsManagerStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const secret = sm.Secret.fromSecretAttributes(this, "ImportedSecret", {
      secretCompleteArn:
        "arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id-number&gt;:secret:&lt;secret-name&gt;-&lt;random-6-characters&gt;"
      // If the secret is encrypted using a KMS-hosted CMK, either import or reference that key:
      // encryptionKey: ...
    });
  }
}

module.exports = { SecretsManagerStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk.aws_secretsmanager as sm

class SecretsManagerStack(cdk.Stack):
    def __init__(self, scope: cdk.App, id: str, **kwargs):
      super().__init__(scope, name, **kwargs)

      secret = sm.Secret.from_secret_attributes(self, "ImportedSecret",
          secret_complete_arn="arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id-number&gt;:secret:&lt;secret-name&gt;-&lt;random-6-characters&gt;",
          # If the secret is encrypted using a KMS-hosted CMK, either import or reference that key:
          # encryption_key=....
      )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.secretsmanager.Secret;
import software.amazon.awscdk.services.secretsmanager.SecretAttributes;

public class SecretsManagerStack extends Stack {
    public SecretsManagerStack(App scope, String id) {
        this(scope, id, null);
    }

    public SecretsManagerStack(App scope, String id, StackProps props) {
        super(scope, id, props);

        Secret secret = (Secret)Secret.fromSecretAttributes(this, "ImportedSecret", SecretAttributes.builder()
            .secretCompleteArn("arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id-number&gt;:secret:&lt;secret-name&gt;-&lt;random-6-characters&gt;")
             // If the secret is encrypted using a KMS-hosted CMK, either import or reference that key:
             // .encryptionKey(...)
             .build());
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.SecretsManager;

public class SecretsManagerStack : Stack
{
    public SecretsManagerStack(App scope, string id, StackProps props) : base(scope, id, props) {

        var secret = Secret.FromSecretAttributes(this, "ImportedSecret", new SecretAttributes {
            SecretCompleteArn = "arn:aws:secretsmanager:&lt;region&gt;:&lt;account-id-number&gt;:secret:&lt;secret-name&gt;-&lt;random-6-characters&gt;"
            // If the secret is encrypted using a KMS-hosted CMK, either import or reference that key:
            // encryptionKey = ...,
        });
    }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the AWS CLI  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_secretsmanager.Secret.html">create-secret</a> CLI command to create a secret from the command line, such as when testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws secretsmanager create-secret --name ImportedSecret --secret-string mygroovybucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command returns an ARN that you can use with the preceding example.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have created a  <code>Secret</code> instance, you can get the secret&#8217;s value from the instance&#8217;s <code>secretValue</code> attribute. The value is represented by a <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.SecretValue.html">SecretValue</a></code> instance, a special type of <a href="#tokens">Tokens and the AWS CDK</a>. Because it&#8217;s a token, it has meaning only after resolution. Your CDK app does not need to access its actual value. Instead, the app can pass the <code>SecretValue</code> instance (or its string or numeric representation) to whatever CDK method needs the value.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="how-to-set-cw-alarm">12.13. Set a CloudWatch alarm</h3>
<div class="paragraph">
<p>Use the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudwatch-readme.html">aws-cloudwatch</a> package to set up Amazon CloudWatch alarms on CloudWatch metrics. You can use predefined metrics or create your own.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="how-to-set-cw-alarm-use-metric">12.13.1. Use an existing metric</h4>
<div class="paragraph">
<p>Many AWS Construct Library modules let you set an alarm on an existing metric by passing the metric&#8217;s name to a convenience method on an instance of an object that has metrics. For example, given an Amazon SQS queue, you can get the metric  <strong>ApproximateNumberOfMessagesVisible</strong> from the queue&#8217;s <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html#metricmetricname-props">metric()</a> method:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const metric = queue.metric("ApproximateNumberOfMessagesVisible");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const metric = queue.metric("ApproximateNumberOfMessagesVisible");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">metric = queue.metric("ApproximateNumberOfMessagesVisible")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Metric metric = queue.metric("ApproximateNumberOfMessagesVisible");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var metric = queue.Metric("ApproximateNumberOfMessagesVisible");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-set-cw-alarm-new-metric">12.13.2. Create your own metric</h4>
<div class="paragraph">
<p>Create your own  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudwatch.Metric.html">metric</a> as follows, where the <em>namespace</em> value should be something like <strong>AWS/SQS</strong> for an Amazon SQS queue. You also need to specify your metric&#8217;s name and dimension:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const metric = new cloudwatch.Metric({
  namespace: 'MyNamespace',
  metricName: 'MyMetric',
  dimensionsMap: { MyDimension: 'MyDimensionValue' }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const metric = new cloudwatch.Metric({
  namespace: 'MyNamespace',
  metricName: 'MyMetric',
  dimensionsMap: { MyDimension: 'MyDimensionValue' }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">metric = cloudwatch.Metric(
    namespace="MyNamespace",
    metric_name="MyMetric",
    dimensionsMap=dict(MyDimension="MyDimensionValue")
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Metric metric = Metric.Builder.create()
        .namespace("MyNamespace")
        .metricName("MyMetric")
        .dimensionsMap(java.util.Map.of(    // Java 9 or later
            "MyDimension", "MyDimensionValue"))
        .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var metric = new Metric(this, "Metric", new MetricProps
{
    Namespace = "MyNamespace",
    MetricName = "MyMetric",
    Dimensions = new Dictionary&lt;string, object&gt;
    {
        { "MyDimension", "MyDimensionValue" }
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-set-cw-alarm-create">12.13.3. Create the alarm</h4>
<div class="paragraph">
<p>Once you have a metric, either an existing one or one you defined, you can create an alarm. In this example, the alarm is raised when there are more than 100 of your metric in two of the last three evaluation periods. You can use comparisons such as less-than in your alarms via the  <code>comparisonOperator</code> property. Greater-than-or-equal-to is the AWS CDK default, so we don&#8217;t need to specify it.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const alarm = new cloudwatch.Alarm(this, 'Alarm', {
  metric: metric,
  threshold: 100,
  evaluationPeriods: 3,
  datapointsToAlarm: 2,
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const alarm = new cloudwatch.Alarm(this, 'Alarm', {
  metric: metric,
  threshold: 100,
  evaluationPeriods: 3,
  datapointsToAlarm: 2
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">alarm = cloudwatch.Alarm(self, "Alarm",
    metric=metric,
    threshold=100,
    evaluation_periods=3,
    datapoints_to_alarm=2
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.cloudwatch.Alarm;
import software.amazon.awscdk.services.cloudwatch.Metric;

Alarm alarm = Alarm.Builder.create(this, "Alarm")
        .metric(metric)
        .threshold(100)
        .evaluationPeriods(3)
        .datapointsToAlarm(2).build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var alarm = new Alarm(this, "Alarm", new AlarmProps
{
    Metric = metric,
    Threshold = 100,
    EvaluationPeriods = 3,
    DatapointsToAlarm = 2
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative way to create an alarm is using the metric&#8217;s  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudwatch.Metric.html#createwbralarmscope-id-props">createAlarm()</a> method, which takes essentially the same properties as the <code>Alarm</code> constructor. You don&#8217;t need to pass in the metric, because it&#8217;s already known.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">metric.createAlarm(this, 'Alarm', {
  threshold: 100,
  evaluationPeriods: 3,
  datapointsToAlarm: 2,
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">metric.createAlarm(this, 'Alarm', {
  threshold: 100,
  evaluationPeriods: 3,
  datapointsToAlarm: 2,
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">metric.create_alarm(self, "Alarm",
    threshold=100,
    evaluation_periods=3,
    datapoints_to_alarm=2
)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">metric.createAlarm(this, "Alarm", new CreateAlarmOptions.Builder()
        .threshold(100)
        .evaluationPeriods(3)
        .datapointsToAlarm(2)
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">metric.CreateAlarm(this, "Alarm", new CreateAlarmOptions
{
    Threshold = 100,
    EvaluationPeriods = 3,
    DatapointsToAlarm = 2
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="get-context-var">12.14. Save and retrieve context variable values</h3>
<div class="paragraph">
<p>You can specify context variables with the AWS Cloud Development Kit (AWS CDK)  <code class="noloc">CLI</code> or in the  <code class="path">cdk.json</code> file. Then, use the  <code>TryGetContext</code> method to retrieve values.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="develop-context-specify">12.14.1. Specify context variables</h4>
<div class="paragraph">
<p>You can specify a context variable either as part of an AWS CDK  <code class="noloc">CLI</code> command, or in  <code class="path">cdk.json</code>.</p>
</div>
<div class="paragraph">
<p>To create a command line context variable, use the <strong>--context</strong> (<strong>-c</strong>) option, as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth -c bucket_name=mygroovybucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify the same context variable and value in the  <code>cdk.json</code> file, use the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "context": {
    "bucket_name": "myotherbucket"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you specify a context variable using both the AWS CDK  <code class="noloc">CLI</code> and  <code class="path">cdk.json</code> file, the AWS CDK  <code class="noloc">CLI</code> value takes precedence.</p>
</div>
</div>
<div class="sect3">
<h4 id="develop-context-retrieve">12.14.2. Retrieve context variable values</h4>
<div class="paragraph">
<p>To get the value of a context variable in your app, use the  <code>TryGetContext</code> method in the context of a construct. (That is, when <code>this</code>, or <code>self</code> in Python, is an instance of some construct.)</p>
</div>
<div class="paragraph">
<p>In this example, we retrieve the value of the <code>bucket_name</code> context variable. If the requested value is not defined, <code>TryGetContext</code> returns <code>undefined</code> (<code>None</code> in Python; <code>null</code> in Java and C#; <code>nil</code> in Go) rather than raising an exception.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket_name = this.node.tryGetContext('bucket_name');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const bucket_name = this.node.tryGetContext('bucket_name');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">bucket_name = self.node.try_get_context("bucket_name")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">String bucketName = (String)this.getNode().tryGetContext("bucket_name");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var bucketName = this.Node.TryGetContext("bucket_name");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Outside the context of a construct, you can access the context variable from the app object, like this.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new cdk.App();
const bucket_name = app.node.tryGetContext('bucket_name')</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new cdk.App();
const bucket_name = app.node.tryGetContext('bucket_name');</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">app = cdk.App()
bucket_name = app.node.try_get_context("bucket_name")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">App app = App();
String bucketName = (String)app.getNode().tryGetContext("bucket_name");</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">app = App();
var bucketName = app.Node.TryGetContext("bucket_name");</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on working with context variables, see  <a href="#context">Context values and the AWS CDK</a>.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="use-cfn-public-registry">12.15. Use resources from the AWS CloudFormation Public Registry</h3>
<div class="paragraph">
<p>The AWS CloudFormation Public Registry lets you manage extensions, both public and private, such as resources, modules, and hooks that are available for use in your AWS account. You can use public resource extensions in your AWS Cloud Development Kit (AWS CDK) applications with the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.CfnResource.html">CfnResource</a> construct.</p>
</div>
<div class="paragraph">
<p>To learn more about the AWS CloudFormation Public Registry, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/registry.html">Using the AWS CloudFormation registry</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="paragraph">
<p>All public extensions published by AWS are available to all accounts in all Regions without any action on your part. However, you must activate each third-party extension you want to use, in each account and Region where you want to use it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you use AWS CloudFormation with third-party resource types, you will incur charges. Charges are based on the number of handler operations you run per month and handler operation duration. See <a href="https://aws.amazon.com/cloudformation/pricing/">CloudFormation pricing</a> for complete details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To learn more about public extensions, see  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/registry-public.html">Using public extensions in CloudFormation</a> in the <em>AWS CloudFormation User Guide</em></p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="use-cfn-public-registry-activate">12.15.1. Activate a third-party resource in your account and Region</h4>
<div class="paragraph">
<p>Extensions published by AWS do not require activation. They are always available in every account and Region. You can activate a third-party extension through the AWS Management Console, via the AWS Command Line Interface, or by deploying a special AWS CloudFormation resource.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/activate-cfn-extension.png" alt="activate cfn extension">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sign in to the AWS account in which you want to use the extension, then switch to the Region where you want to use it.</p>
</li>
<li>
<p>Navigate to the CloudFormation console via the <strong>Services</strong> menu.</p>
</li>
<li>
<p>Choose <strong>Public extensions</strong> on the navigation bar, then activate the  <strong>Third party</strong> radio button under  <strong>Publisher</strong>. A list of the available third-party public extensions appears. (You may also choose  <strong>AWS</strong> to see a list of the public extensions published by AWS, though you don&#8217;t need to activate them.)</p>
</li>
<li>
<p>Browse the list and find the extension you want to activate. Alternatively, search for it, then activate the radio button in the upper right corner of the extension&#8217;s card.</p>
</li>
<li>
<p>Choose the <strong>Activate</strong> button at the top of the list to activate the selected extension. The extension&#8217;s  <strong>Activate</strong> page appears.</p>
</li>
<li>
<p>In the <strong>Activate</strong> page, you can override the extension&#8217;s default name and specify an execution role and logging configuration. You can also choose whether to automatically update the extension when a new version is released. When you have set these options as you like, choose  <strong>Activate extension</strong> at the bottom of the page.</p>
</li>
<li>
<p>Use the <code>activate-type</code> command. Substitute the ARN of the custom type you want to use where indicated.</p>
<div class="paragraph">
<p>The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">aws cloudformation activate-type --public-type-arn public_extension_ARN --auto-update-activated</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy a resource of type <code>AWS::CloudFormation::TypeActivation</code> and specify the following properties:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>TypeName</code> - The name of the type, such as <code>AWSQS::EKS::Cluster</code>.</p>
</li>
<li>
<p><code>MajorVersion</code> - The major version number of the extension that you want. Omit if you want the latest version.</p>
</li>
<li>
<p><code>AutoUpdate</code> - Whether to automatically update this extension when a new minor version is released by the publisher. (Major version updates require explicitly changing the <code>MajorVersion</code> property.)</p>
</li>
<li>
<p><code>ExecutionRoleArn</code> - The ARN of the IAM role under which this extension will run.</p>
</li>
<li>
<p><code>LoggingConfig</code> - The logging configuration for the extension.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The  <code>TypeActivation</code> resource can be deployed by the CDK using the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.CfnResource.html">CfnResource</a> construct. This is shown for the actual extensions in the following section.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="use-cfn-public-registry-add">12.15.2. Add a resource from the AWS CloudFormation Public Registry to your CDK app</h4>
<div class="paragraph">
<p>Use the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.CfnResource.html">CfnResource</a> construct to include a resource from the AWS CloudFormation Public Registry in your application. This construct is in the CDK&#8217;s <code>aws-cdk-lib</code> module.</p>
</div>
<div class="paragraph">
<p>For example, suppose that there is a public resource named <code>MY::S5::UltimateBucket</code> that you want to use in your AWS CDK application. This resource takes one property: the bucket name. The corresponding <code>CfnResource</code> instantiation looks like this.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ubucket = new CfnResource(this, 'MyUltimateBucket', {
    type: 'MY::S5::UltimateBucket::MODULE',
    properties: {
           BucketName: 'UltimateBucket'
    }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ubucket = new CfnResource(this, 'MyUltimateBucket', {
    type: 'MY::S5::UltimateBucket::MODULE',
    properties: {
           BucketName: 'UltimateBucket'
    }
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ubucket = CfnResource(self, "MyUltimateBucket",
            type="MY::S5::UltimateBucket::MODULE",
            properties=dict(
                BucketName="UltimateBucket"))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CfnResource.Builder.create(this, "MyUltimateBucket")
	.type("MY::S5::UltimateBucket::MODULE")
	.properties(java.util.Map.of(    // Map.of requires Java 9+
	    "BucketName", "UltimateBucket"))
	.build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new CfnResource(this, "MyUltimateBucket", new CfnResourceProps
{
    Type = "MY::S5::UltimateBucket::MODULE",
    Properties = new Dictionary&lt;string, object&gt;
    {
        ["BucketName"] = "UltimateBucket"
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="define-iam-l2">12.16. Define permissions for L2 constructs with the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Define AWS Identity and Access Management (IAM) roles and policies for L2 constructs when using the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Define AWS Identity and Access Management (IAM) roles and policies for L2 constructs when using the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="sect3">
<h4 id="define-iam-l2-grant">12.16.1. Use grant methods to define permissions</h4>
<div class="paragraph">
<p>When you define your infrastructure using L2 constructs from the AWS Construct Library, you can use the provided  <em>grant methods</em> to specify the permissions your resources will require. The AWS CDK will automatically create the IAM roles needed for all AWS resources that require them.</p>
</div>
<div class="paragraph">
<p>The following is an example that defines permissions between an AWS Lambda function and Amazon Simple Storage Service (Amazon S3) bucket. Here, the <code>grantRead</code> method of the Bucket L2 construct is used to define these permissions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as kms from 'aws-cdk-lib/aws-kms';

export class CdkDemoStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const key = new kms.Key(this, 'BucketKey');
    const bucket = new s3.Bucket(this, 'Bucket', {
      encryptionKey: key,
    });
    const handler = new lambda.Function(this, 'Handler', {
      runtime: lambda.Runtime.NODEJS_20_X,
      handler: 'index.handler',
      code: lambda.Code.fromAsset('lambda'),
    });

    // Define permissions between function and S3 bucket using grantRead method
    bucket.grantRead(handler);

  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');
const lambda = require('aws-cdk-lib/aws-lambda');
const kms = require('aws-cdk-lib/aws-kms');

class CdkDemoStack extends Stack {

  constructor(scope, id, props) {
    super(scope, id, props);

    const key = new kms.Key(this, 'BucketKey');
    const bucket = new s3.Bucket(this, 'Bucket', {
      encryptionKey: key,
    });
    const handler = new lambda.Function(this, 'Handler', {
      runtime: lambda.Runtime.NODEJS_20_X,
      handler: 'index.handler',
      code: lambda.Code.fromAsset('lambda'),
    });

    // Define permissions between function and S3 bucket using grantRead method
    bucket.grantRead(handler);

  }
}

// ...</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Stack,
    aws_s3 as s3,
    aws_lambda as _lambda,
    aws_kms as kms,
)
from constructs import Construct

class CdkDemoStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        key = kms.Key(self, 'BucketKey')
        bucket = s3.Bucket(self, 'Bucket')
        handler = _lambda.Function(
            self,
            'Handler',
            runtime = _lambda.Runtime.NODEJS_20_X,
            handler = 'index.handler',
            code = _lambda.Code.from_asset('lambda'),
        )

        # Define permissions between function and S3 bucket using grantRead method
        bucket.grantRead(handler)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.core.App;
import software.amazon.awscdk.core.Stack;
import software.amazon.awscdk.core.StackProps;
import software.amazon.awscdk.services.kms.Key;
import software.amazon.awscdk.services.kms.KeyProps;
import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.s3.BucketProps;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.FunctionProps;
import software.amazon.awscdk.services.lambda.Runtime;
import software.amazon.awscdk.services.lambda.Code;
import software.constructs.Construct;

public class CdkDemoStack extends Stack {
    public CdkDemoStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkDemoStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Key key = new Key(this, "BucketKey", KeyProps.builder().build());

        Bucket bucket = new Bucket(this, "Bucket", BucketProps.builder()
            .encryptionKey(key)
            .build());

        Function handler = new Function(this, "Handler", FunctionProps.builder()
            .runtime(Runtime.NODEJS_20_X)
            .handler("index.handler")
            .code(Code.fromAsset("lambda"))
            .build());

        // Define permissions between function and S3 bucket using grantRead method
        bucket.grantRead(handler);
    }

    public static void main(final String[] args) {
        App app = new App();

        new CdkDemoStack(app, "CdkDemoStack");

        app.synth();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.KMS;
using Amazon.CDK.AWS.S3;
using Amazon.CDK.AWS.Lambda;

namespace CdkDemo
{
    public class CdkDemoStack : Stack
    {
        internal CdkDemoStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            var key = new Key(this, "BucketKey");

            var bucket = new Bucket(this, "Bucket", new BucketProps
            {
                EncryptionKey = key
            });

            var handler = new Function(this, "Handler", new FunctionProps
            {
                Runtime = Runtime.NODEJS_20_X,
                Handler = "index.handler",
                Code = Code.FromAsset("lambda")
            });

            // Define permissions between function and S3 bucket using grantRead method
            bucket.GrantRead(handler);
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main
import (
    "github.com/aws/aws-cdk-go/awscdk/v2"
    "github.com/aws/aws-cdk-go/awscdk/v2/awskms"
    "github.com/aws/aws-cdk-go/awscdk/v2/awss3"
    "github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
    "github.com/aws/constructs-go/constructs/v10"
    "github.com/aws/jsii-runtime-go"
)
// ...
func NewCdkDemoStack(scope constructs.Construct, id string, props *CdkDemoStackProps) awscdk.Stack {
    stack := awscdk.NewStack(scope, &amp;id, &amp;props.StackProps)
    key := awskms.NewKey(stack, jsii.String("BucketKey"), nil)
    bucket := awss3.NewBucket(stack, jsii.String("Bucket"), &amp;awss3.BucketProps{
        EncryptionKey: key,
    })
    handler := awslambda.NewFunction(stack, jsii.String("Handler"), &amp;awslambda.FunctionProps{
        Runtime: awslambda.Runtime_NODEJS_20_X(),
        Handler: jsii.String("index.handler"),
        Code:    awslambda.Code_FromAsset(jsii.String("lambda"), &amp;awss3assets.AssetOptions{}),
    })
    bucket.GrantRead(handler)
    return stack
}
// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you use grant methods of L2 constructs to define permissions between resources, the AWS CDK will create roles with least privilege policies based on the method you specify. As a security best practice, we recommend that you use the method that applies only the permissions that you require. For example, if you only need to grant permissions for a Lambda function to read from an Amazon S3 bucket, use the  <code>grantRead</code> method instead of <code>grantReadWrite</code>.</p>
</div>
<div class="paragraph">
<p>For each method that you use, the CDK creates a unique IAM role for the specified resources. If necessary, you can also directly modify the policy that will be attached to the role. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { aws_iam as iam } from 'aws-cdk-lib';

handler.addToRolePolicy(new iam.PolicyStatement({
  actions: ['s3:GetObject', 's3:List*'],
  resources: [
    bucket.bucketArn,
    bucket.arnForObjects('*'),
  ]
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const iam = require('aws-cdk-lib/aws-iam');

handler.addToRolePolicy(new iam.PolicyStatement({
  actions: ['s3:GetObject', 's3:List*'],
  resources: [
    bucket.bucketArn,
    bucket.arnForObjects('*'),
  ]
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import aws_iam as iam

handler.add_to_role_policy(iam.PolicyStatement(
    actions=['s3:GetObject', 's3:List*'],
    resources=[
        bucket.bucket_arn,
        bucket.arn_for_objects('*'),
    ]
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.iam.PolicyStatement;
import software.amazon.awscdk.services.iam.PolicyStatementProps;

handler.addToRolePolicy(PolicyStatement.Builder.create()
    .actions(Arrays.asList("s3:GetObject", "s3:List*"))
    .resources(Arrays.asList(
        bucket.getBucketArn(),
        bucket.arnForObjects("*")
    ))
    .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.IAM;
using Amazon.CDK.AWS.S3;
using Amazon.CDK.AWS.Lambda;

handler.AddToRolePolicy(new PolicyStatement(new PolicyStatementProps
{
    Actions = new[] { "s3:GetObject", "s3:List*" },
    Resources = new[] { bucket.BucketArn, bucket.ArnForObjects("*") }
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	// ...
	"github.com/aws/aws-cdk-go/awscdk/v2/awsiam"
	// ...
)

// ...

func NewCdkDemoStack(scope constructs.Construct, id string, props *CdkDemoStackProps) awscdk.Stack {
	// ...

	handler.AddToRolePolicy(awsiam.NewPolicyStatement(&amp;awsiam.PolicyStatementProps{
		Actions:   jsii.Strings("s3:GetObject", "s3:List*"),
		Resources: jsii.Strings(bucket.BucketArn(), bucket.ArnForObjects("*")),
	}))

	// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, we recommend that you use the  <code>grant</code> methods when available.</p>
</div>
</div>
<div class="sect3">
<h4 id="define-iam-l2-manual">12.16.2. Manually create and use IAM roles</h4>
<div class="paragraph">
<p>If you prefer not to use the CDK  <code>grant</code> methods to create and manage permissions, you must manually create and configure them. You can create IAM roles using the AWS Management Console, AWS CLI, or AWS SDKs. Then, you can pass them into your CDK application manually or use the <em>role customization</em> feature.</p>
</div>
<div class="sect4">
<h5 id="define-iam-l2-manual-role">Reference and manage all roles manually</h5>
<div class="paragraph">
<p>Constructs that require a role have an optional  <code>role</code> property that you can use to pass in a role object.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use <code>Role.fromRoleName()</code> to reference your pre-existing role. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const existingRole = Role.fromRoleName(stack, 'Role', 'my-pre-existing-role', {
  mutable: false // Prevent CDK from attempting to add policies to this role
}</code></pre>
</div>
</div>
</li>
<li>
<p>Pass the pre-existing role when defining your resource. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const handler = new lambda.Function(stack, 'Handler', { runtime: lambda.Runtime.NODEJS_20_XZ, handler:
         'index.handler', code: lambda.Code.fromAsset(path.join(__dirname, 'lambda-handler')), // Pass in pre-existing role
         role: existingRole, });</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="define-iam-l2-manual-customization">Use the role customization feature</h5>
<div class="paragraph">
<p>The AWS CDK  <em>role customization</em> feature generates a report of roles and policies in your CDK app. You can use this feature to generate a report. Then you can substitute pre-created roles for them.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>Role.customizeRoles()</code> somewhere towards the top of your CDK application. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const stack = new Stack(app, 'LambdaStack');

// Add this to use the role customization feature
iam.Role.customizeRoles(stack);

// Define your resources using L2 constructs
const key = new kms.Key(stack, 'BucketKey');
const bucket = new s3.Bucket(stack, 'Bucket', {
  encryptionKey: key,
});
const handler = new lambda.Function(stack, 'Handler', {
  runtime: lambda.Runtime.NODEJS_16_X,
  handler: 'index.handler',
  code: lambda.Code.fromAsset(path.join(__dirname, 'lambda-handler')),
});

// The grantRead() is still important. Even though it actually doesn't mutate
// any policies, it indicates the need for them.
bucket.grantRead(handler);</code></pre>
</div>
</div>
</li>
<li>
<p>When you synthesize your application, the CDK will throw an error, indicating that you need to provide the pre-created role name to <code>Role.customizeRoles()</code>. The following is an example of the generated report:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;missing role&gt; (LambdaStack/Handler/ServiceRole)

AssumeRole Policy:
[
  {
    "Action": "sts:AssumeRole",
    "Effect": "Allow",
    "Principal": {
      "Service": "lambda.amazonaws.com"
    }
  }
]

Managed Policy ARNs:
[
  "arn:(PARTITION):iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
]

Managed Policies Statements:
NONE

Identity Policy Statements:
[
  {
    "Action": [
      "s3:GetObject*",
      "s3:GetBucket*",
      "s3:List*"
    ],
    "Effect": "Allow",
    "Resource": [
      "(LambdaStack/Bucket/Resource.Arn)",
      "(LambdaStack/Bucket/Resource.Arn)/*"
    ]
  }
]</pre>
</div>
</div>
</li>
<li>
<p>Once the role is created, you can pass it into your application for the resource that it applies to. For example, if the name of the role created for <code>LambdaStack/Handler/ServiceRole</code> is <code>lambda-service-role</code>, you would update your CDK app as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const stack = new Stack(app, 'LambdaStack');

// Add this to pass in the role
iam.Role.customizeRoles(stack, {
  usePrecreatedRoles: {
    'LambdaStack/Handler/ServiceRole': 'lambda-service-role',
  },
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CDK will now use the pre-created role name anywhere that the role is referenced in the CDK application. It will also continue to generate the report so that any future policy changes can be referenced.</p>
</div>
<div class="paragraph">
<p>You will notice that the reference to the Amazon S3 bucket ARN in the report is rendered as (<code>LambdaStack/Bucket/Resource.Arn</code>) instead of the actual ARN of the bucket. This is because the bucket ARN is a deploy time value that is not known at synthesis (the bucket hasn&#8217;t been created yet). This is another example of why we recommend allowing CDK to manage IAM roles and permissions by using the provided <code>grant</code> methods. In order to create the role with the initial policy, the admin will have to create the policy with broader permissions (for example, <code>arn:aws:s3:::*</code>).</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="configure-synth">13. Configure and perform CDK stack synthesis</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Before you can deploy an AWS Cloud Development Kit (AWS CDK) stack, it must first be synthesized. Stack synthesis is the process of creating an AWS CloudFormation template from a CDK stack. The CloudFormation template is what you then deploy to provision your resources on AWS.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Before you can deploy an AWS Cloud Development Kit (AWS CDK) stack, it must first be synthesized.  <em>Stack synthesis</em> is the process of producing an AWS CloudFormation template and deployment artifacts from a CDK stack. The template and artifacts are known as the <em>cloud assembly</em>. The cloud assembly is what gets deployed to provision your resources on AWS. For more information on how deployments work, see <a href="#deploy-how">How AWS CDK deployments work</a>.</p>
</div>
<div class="sect2">
<h3 id="configure-synth-bootstrap">13.1. How synthesis and bootstrapping work together</h3>
<div class="paragraph">
<p>For your CDK apps to properly deploy, the CloudFormation templates produced during synthesis must correctly specify the resources created during bootstrapping. Therefore, bootstrapping and synthesis must complement one another for a deployment to be successful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bootstrapping is a one-time process of setting up an AWS environment for AWS CDK deployments. It configures specific AWS resources in your environment that are used by the CDK for deployments. These are commonly referred to as <em>bootstrap resources</em>. For instructions on bootstrapping, see <a href="#bootstrapping-env">Bootstrap your environment for use with the AWS CDK</a>.</p>
</li>
<li>
<p>CloudFormation templates produced during synthesis include information on which bootstrap resources to use. During synthesis, the CDK <code class="noloc">CLI</code> doesn&#8217;t know specifically how your AWS environment has been bootstrapped. Instead, the CDK  <code class="noloc">CLI</code> produces CloudFormation templates based on the synthesizer you configure for each CDK stack. For a deployment to be successful, the synthesizer must produce CloudFormation templates that reference the correct bootstrap resources to use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The CDK comes with a default synthesizer and bootstrapping configuration that are designed to work together. If you customize one, you must apply relevant customizations to the other.</p>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-synthesizers">13.2. How to configure CDK stack synthesis</h3>
<div class="paragraph">
<p>You configure CDK stack synthesis using the  <code>synthesizer</code> property of your <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> instance. This property specifies how your CDK stacks will be synthesized. You provide an instance of a class that implements <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.IStackSynthesizer.html">IStackSynthesizer</a></code> or <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.IReusableStackSynthesizer.html">IReusableStackSynthesizer</a></code>. Its methods will be invoked every time an asset is added to the stack or when the stack is synthesized. The following is a basic example of using this property within your stack:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'MyStack', {
  // stack properties
  synthesizer: new DefaultStackSynthesizer({
    // synthesizer properties
  }),
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new MyStack(this, 'MyStack', {
  // stack properties
  synthesizer: new DefaultStackSynthesizer({
    // synthesizer properties
  }),
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">MyStack(self, "MyStack",
    # stack properties
    synthesizer=DefaultStackSynthesizer(
        # synthesizer properties
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">new MyStack(app, "MyStack", StackProps.builder()
  // stack properties
  .synthesizer(DefaultStackSynthesizer.Builder.create()
    // synthesizer properties
    .build())
  .build();</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">new MyStack(app, "MyStack", new StackProps
// stack properties
{
    Synthesizer = new DefaultStackSynthesizer(new DefaultStackSynthesizerProps
    {
        // synthesizer properties
    })
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">func main() {
  app := awscdk.NewApp(nil)

  NewMyStack(app, "MyStack", &amp;MyStackProps{
    StackProps: awscdk.StackProps{
      Synthesizer: awscdk.NewDefaultStackSynthesizer(&amp;awscdk.DefaultStackSynthesizerProps{
        // synthesizer properties
      }),
    },
  })

  app.Synth(nil)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure a synthesizer for all CDK stacks in your CDK app using the  <code>defaultStackSynthesizer</code> property of your <code>App</code> instance:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { App, Stack, DefaultStackSynthesizer } from 'aws-cdk-lib';

const app = new App({
  // Configure for all stacks in this app
  defaultStackSynthesizer: new DefaultStackSynthesizer({
    /* ... */
  }),
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { App, Stack, DefaultStackSynthesizer } = require('aws-cdk-lib');

const app = new App({
  // Configure for all stacks in this app
  defaultStackSynthesizer: new DefaultStackSynthesizer({
    /* ... */
  }),
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import App, Stack, DefaultStackSynthesizer

app = App(
    default_stack_synthesizer=DefaultStackSynthesizer(
        # Configure for all stacks in this app
        # ...
    )
)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.App;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.DefaultStackSynthesizer;

public class Main {
    public static void main(final String[] args) {
        App app = new App(AppProps.builder()
            // Configure for all stacks in this app
            .defaultStackSynthesizer(DefaultStackSynthesizer.Builder.create().build())
            .build()
        );
    }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.Synthesizers;

namespace MyNamespace
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            var app = new App(new AppProps
            {
                // Configure for all stacks in this app
                DefaultStackSynthesizer = new DefaultStackSynthesizer(new DefaultStackSynthesizerProps
                {
                    // ...
                })
            });
        }
    }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
    "github.com/aws/aws-cdk-go/awscdk/v2"
    "github.com/aws/constructs-go/constructs/v10"
    "github.com/aws/jsii-runtime-go"
)

func main() {
    defer jsii.Close()

    app := awscdk.NewApp(&amp;awscdk.AppProps{
        // Configure for all stacks in this app
        DefaultStackSynthesizer: awscdk.NewDefaultStackSynthesizer(&amp;awscdk.DefaultStackSynthesizerProps{
            // ...
        }),
    })
}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default, the AWS CDK uses  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.DefaultStackSynthesizer.html">DefaultStackSynthesizer</a></code>. If you don&#8217;t configure a synthesizer, this synthesizer will be used.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t modify bootstrapping, such as making changes to the bootstrap stack or template, you don&#8217;t have to modify stack synthesis. You don&#8217;t even have to provide a synthesizer. The CDK will use the default <code>DefaultStackSynthesizer</code> class to configure CDK stack synthesis to properly interact with your bootstrap stack.</p>
</div>
</div>
<div class="sect2">
<h3 id="configure-synth-stack">13.3. How to synthesize a CDK stack</h3>
<div class="paragraph">
<p>To synthesize a CDK stack, use the AWS CDK Command Line Interface (AWS CDK  <code class="noloc">CLI</code>)  <code>cdk synth</code> command. For more information about this command, including options that you can use with this command, see <a href="#ref-cli-cmd-synth">cdk synthesize</a>.</p>
</div>
<div class="paragraph">
<p>If your CDK app contains a single stack, or to synthesize all stacks, you don&#8217;t have to provide the CDK stack name as an argument. By default, the CDK <code class="noloc">CLI</code> will synthesize your CDK stacks into AWS CloudFormation templates. A  <code class="path">json</code> formatted template for each stack is saved to the  <code class="path">cdk.out</code> directory. If your app contains a single stack, a  <code class="path">yaml</code> formatted template is printed to  <code>stdout</code>. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth
Resources:
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/unique-identifier
    Metadata:
      aws:cdk:path: CdkAppStack/CDKMetadata/Default
    Condition: CDKMetadataAvailable
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your CDK app contains multiple stacks, you can provide the logical ID of a stack to synthesize a single stack. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth MyStackName</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t synthesize a stack and run  <code>cdk deploy</code>, the CDK <code class="noloc">CLI</code> will automatically synthesize your stack before deployment.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-synth-default">13.4. How synthesis works by default</h3>
<div class="sect3">
<h4 id="how-synth-default-logical-ids">13.4.1. Generated logical IDs in your AWS CloudFormation template</h4>
<div class="paragraph">
<p>When you synthesize a CDK stack to produce a CloudFormation template, logical IDs are generated from the following sources, formatted as  <code class="replaceable">&lt;construct-path&gt;&lt;construct-ID&gt;&lt;unique-hash&gt;</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Construct path</strong> – The entire path to the construct in your CDK app. This path excludes the ID of the L1 construct, which is always <code>Resource</code> or <code>Default</code>, and the ID of the top-level stack that it&#8217;s a part of.</p>
</li>
<li>
<p><strong>Construct ID</strong> – The ID that you provide as the second argument when instantiating your construct.</p>
</li>
<li>
<p><strong>Unique hash</strong> – The AWS CDK generates an 8 character unique hash using a deterministic hashing algorithm. This unique hash helps to ensure that logical ID values in your template are unique from one another. The deterministic behavior of this hash generation ensures that the generated logical ID value for each construct remains the same every time that you perform synthesis. The hash value will only change if you modify specific construct values such as your construct&#8217;s ID or its path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Logical IDs have a maximum length of 255 characters. Therefore, the AWS CDK will truncate the construct path and construct ID if necessary to keep within that limit.</p>
</div>
<div class="paragraph">
<p>The following is an example of a construct that defines an Amazon Simple Storage Service (Amazon S3) bucket. Here, we pass <code>myBucket</code> as the ID for our construct:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct} from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

export class MyCdkAppStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define the S3 bucket
    new s3.Bucket(this, 'myBucket', {
      versioned: true,
      removalPolicy: cdk.RemovalPolicy.DESTROY,
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');

class MyCdkAppStack extends cdk.Stack {

  constructor(scope, id, props) {
    super(scope, id, props);

    new s3.Bucket(this, 'myBucket', {
      versioned: true,
      removalPolicy: cdk.RemovalPolicy.DESTROY,
    });
  }
}

module.exports = { MyCdkAppStack }</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from aws_cdk import Stack
from aws_cdk import aws_s3 as s3

class MyCdkAppStack(Stack):
  def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
    super().__init__(scope, construct_id, **kwargs)

    s3.Bucket(self, 'MyBucket',
      versioned=True,
      removal_policy=cdk.RemovalPolicy.DESTROY
    )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.s3.BucketProps;
import software.amazon.awscdk.RemovalPolicy;

public class MyCdkAppStack extends Stack {
    public MyCdkAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyCdkAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Bucket.Builder.create(this, "myBucket")
            .versioned(true)
            .removalPolicy(RemovalPolicy.DESTROY)
            .build();
    }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.S3;

namespace MyCdkApp
{
    public class MyCdkAppStack : Stack
    {
        public MyCdkAppStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            new Bucket(this, "myBucket", new BucketProps
            {
                Versioned = true,
                RemovalPolicy = RemovalPolicy.DESTROY
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
    "github.com/aws/aws-cdk-go/awscdk/v2"
    "github.com/aws/aws-cdk-go/awscdk/v2/awss3"
    "github.com/aws/constructs-go/constructs/v10"
    "github.com/aws/jsii-runtime-go"
)

type MyCdkAppStackProps struct {
    awscdk.StackProps
}

func NewMyCdkAppStack(scope constructs.Construct, id string, props *MyCdkAppStackProps) awscdk.Stack {
    var sprops awscdk.StackProps
    if props != nil {
        sprops = props.StackProps
    }
    stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

    awss3.NewBucket(stack, jsii.String("myBucket"), &amp;awss3.BucketProps{
      Versioned: jsii.Bool(true),
      RemovalPolicy: awscdk.RemovalPolicy_DESTROY,
    })

    return stack
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, a logical ID in the format of <code>myBucket<code class="replaceable">unique-hash</code></code> gets generated. The following is an example of this resource in the generated AWS CloudFormation template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  myBucket5AF9C99B:
    Type: AWS::S3::Bucket
    Properties:
      VersioningConfiguration:
        Status: Enabled
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: S3BucketAppStack/myBucket/Resource</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of a custom construct named  <code>Bar</code> that defines an Amazon S3 bucket. The <code>Bar</code> construct includes the custom construct <code>Foo</code> in its path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

// Define the Bar construct
export class Bar extends Construct {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Define an S3 bucket inside of Bar
    new s3.Bucket(this, 'Bucket', {
       versioned: true,
       removalPolicy: cdk.RemovalPolicy.DESTROY,
      } );
  }
}

// Define the Foo construct
export class Foo extends Construct {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Create an instance of Bar inside Foo
    new Bar(this, 'Bar');
  }
}

// Define the CDK stack
export class MyCustomAppStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Instantiate Foo construct in the stack
    new Foo(this, 'Foo');
  }
}</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');
const { Construct } = require('constructs');

// Define the Bar construct
class Bar extends Construct {
  constructor(scope, id) {
    super(scope, id);

    // Define an S3 bucket inside of Bar
    new s3.Bucket(this, 'Bucket', {
      versioned: true,
      removalPolicy: cdk.RemovalPolicy.DESTROY,
    });
  }
}

// Define the Foo construct
class Foo extends Construct {
  constructor(scope, id) {
    super(scope, id);

    // Create an instance of Bar inside Foo
    new Bar(this, 'Bar');
  }
}

// Define the CDK stack
class MyCustomAppStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Instantiate Foo construct in the stack
    new Foo(this, 'Foo');
  }
}

module.exports = { MyCustomAppStack }</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from aws_cdk import (
    Stack,
    aws_s3 as s3,
    RemovalPolicy,
)

# Define the Bar construct
class Bar(Construct):
    def __init__(self, scope: Construct, id: str) -&gt; None:
        super().__init__(scope, id)

        # Define an S3 bucket inside of Bar
        s3.Bucket(self, 'Bucket',
            versioned=True,
            removal_policy=RemovalPolicy.DESTROY
        )

# Define the Foo construct
class Foo(Construct):
    def __init__(self, scope: Construct, id: str) -&gt; None:
        super().__init__(scope, id)

        # Create an instance of Bar inside Foo
        Bar(self, 'Bar')

# Define the CDK stack
class MyCustomAppStack(Stack):
    def __init__(self, scope: Construct, id: str, **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        # Instantiate Foo construct in the stack
        Foo(self, 'Foo')</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">my-custom-app/src/main/java/com/myorg/Bar.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.s3.BucketProps;
import software.amazon.awscdk.RemovalPolicy;

public class Bar extends Construct {
    public Bar(final Construct scope, final String id) {
        super(scope, id);

        // Define an S3 bucket inside Bar
        Bucket.Builder.create(this, "Bucket")
            .versioned(true)
            .removalPolicy(RemovalPolicy.DESTROY)
            .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">my-custom-app/src/main/java/com/myorg/Foo.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;

public class Foo extends Construct {
    public Foo(final Construct scope, final String id) {
        super(scope, id);

        // Create an instance of Bar inside Foo
        new Bar(this, "Bar");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">my-custom-app/src/main/java/com/myorg/MyCustomAppStack.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class MyCustomAppStack extends Stack {
    public MyCustomAppStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Instantiate Foo construct in the stack
        new Foo(this, "Foo");
    }

    // Overload constructor in case StackProps is not provided
    public MyCustomAppStack(final Construct scope, final String id) {
        this(scope, id, null);
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.S3;

namespace MyCustomApp
{
    // Define the Bar construct
    public class Bar : Construct
    {
        public Bar(Construct scope, string id) : base(scope, id)
        {
            // Define an S3 bucket inside Bar
            new Bucket(this, "Bucket", new BucketProps
            {
                Versioned = true,
                RemovalPolicy = RemovalPolicy.DESTROY
            });
        }
    }

    // Define the Foo construct
    public class Foo : Construct
    {
        public Foo(Construct scope, string id) : base(scope, id)
        {
            // Create an instance of Bar inside Foo
            new Bar(this, "Bar");
        }
    }

    // Define the CDK Stack
    public class MyCustomAppStack : Stack
    {
        public MyCustomAppStack(Construct scope, string id, StackProps props = null) : base(scope, id, props)
        {
            // Instantiate Foo construct in the stack
            new Foo(this, "Foo");
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"github.com/aws/aws-cdk-go/awscdk/v2"
	"github.com/aws/aws-cdk-go/awscdk/v2/awss3"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
)

// Define the Bar construct
type Bar struct {
	constructs.Construct
}

func NewBar(scope constructs.Construct, id string) constructs.Construct {
	bar := constructs.NewConstruct(scope, &amp;id)

	// Define an S3 bucket inside Bar
	awss3.NewBucket(bar, jsii.String("Bucket"), &amp;awss3.BucketProps{
		Versioned:     jsii.Bool(true),
		RemovalPolicy: awscdk.RemovalPolicy_DESTROY,
	})

	return bar
}

// Define the Foo construct
type Foo struct {
	constructs.Construct
}

func NewFoo(scope constructs.Construct, id string) constructs.Construct {
	foo := constructs.NewConstruct(scope, &amp;id)

	// Create an instance of Bar inside Foo
	NewBar(foo, "Bar")

	return foo
}

// Define the CDK Stack
type MyCustomAppStackProps struct {
	awscdk.StackProps
}

func NewMyCustomAppStack(scope constructs.Construct, id string, props *MyCustomAppStackProps) awscdk.Stack {
	stack := awscdk.NewStack(scope, &amp;id, &amp;props.StackProps)

	// Instantiate Foo construct in the stack
	NewFoo(stack, "Foo")

	return stack
}

// Define the CDK App
func main() {
	app := awscdk.NewApp(nil)

	NewMyCustomAppStack(app, "MyCustomAppStack", &amp;MyCustomAppStackProps{
		StackProps: awscdk.StackProps{},
	})

	app.Synth(nil)
}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When we run  <code>cdk synth</code>, a logical ID in the format of <code>FooBarBucket<code class="replaceable">unique-hash</code></code> gets generated. The following is an example of this resource in the generated AWS CloudFormation template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  FooBarBucketBA3ED1FA:
    Type: AWS::S3::Bucket
    Properties:
      VersioningConfiguration:
        Status: Enabled
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bootstrapping-custom-synth">13.5. Customize CDK stack synthesis</h3>
<div class="paragraph">
<p>If the default CDK synthesis behavior doesn&#8217;t suit your needs, you can customize CDK synthesis. To do this, you modify  <code>DefaultStackSynthesizer</code>, use other available built-in synthesizers, or create your own synthesizer. For instructions, see <a href="#customize-synth">Customize CDK stack synthesis</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="deploy">14. Deploy AWS CDK applications</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>An AWS Cloud Development Kit (AWS CDK) deployment is the process of provisioning your infrastructure on AWS.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>An AWS Cloud Development Kit (AWS CDK) deployment is the process of provisioning your infrastructure on AWS.</p>
</div>
<div class="sect2">
<h3 id="deploy-how">14.1. How AWS CDK deployments work</h3>
<div class="paragraph">
<p>The AWS CDK utilizes the AWS CloudFormation service to perform deployments. Before you deploy, you synthesize your CDK stacks. This creates a CloudFormation template and deployment artifacts for each CDK stack in your app. Deployments are initiated from a local development machine or from a  <em>continuous integration and continuous delivery (CI/CD)</em> environment. During deployment, assets are uploaded to the bootstrapped resources and the CloudFormation template is submitted to CloudFormation to provision your AWS resources.</p>
</div>
<div class="paragraph">
<p>For a deployment to be successful, the following is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>) must be provided with valid permissions.</p>
</li>
<li>
<p>The AWS environment must be bootstrapped.</p>
</li>
<li>
<p>The AWS CDK must know the bootstrapped resources to upload assets into.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deploy-prerequisites">14.2. Prerequisites for CDK deployments</h3>
<div class="paragraph">
<p>Before you can deploy an AWS CDK application, you must complete the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure security credentials for the CDK <code class="noloc">CLI</code>.</p>
</li>
<li>
<p>Bootstrap your AWS environment.</p>
</li>
<li>
<p>Configure an AWS environment for each of your CDK stacks.</p>
</li>
<li>
<p>Develop your CDK app.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="deploy-prerequisites-creds">14.2.1. Configure security credentials</h4>
<div class="paragraph">
<p>To use the CDK  <code class="noloc">CLI</code> to interact with AWS, you must configure security credentials on your local machine. For instructions, see  <a href="#configure-access">Configure security credentials for the AWS CDK CLI</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploy-prerequisites-bootstrap">14.2.2. Bootstrap your AWS environment</h4>
<div class="paragraph">
<p>A deployment is always associated with one or more AWS  <a href="#environments">environments</a>. Before you can deploy, the environment must first be <a href="#bootstrapping">bootstrapped</a>. Bootstrapping provisions resources in your environment that the CDK uses to perform and manage deployments. These resources include an Amazon Simple Storage Service (Amazon S3) bucket and Amazon Elastic Container Registry (Amazon ECR) repository to store and manage <a href="#assets">assets</a>. These resources also include AWS Identity and Access Management (IAM) roles that are used to provide permissions during development and deployment.</p>
</div>
<div class="paragraph">
<p>We recommend that you use the AWS CDK Command Line Interface (AWS CDK <code class="noloc">CLI</code>)  <code>cdk bootstrap</code> command to bootstrap your environment. You can customize bootstrapping or manually create these resources in your environment if necessary. For instructions, see <a href="#bootstrapping-env">Bootstrap your environment for use with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploy-prerequisites-env">14.2.3. Configure AWS environments</h4>
<div class="paragraph">
<p>Each CDK stack must be associated with an environment to determine where the stack is deployed to. For instructions, see  <a href="#configure-env">Configure environments to use with the AWS CDK</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploy-prerequisites-develop">14.2.4. Develop your CDK app</h4>
<div class="paragraph">
<p>Within a CDK  <a href="#projects">project</a>, you create and develop your CDK app. Within your app, you create one or more CDK <a href="#stacks">stacks</a>. Within your stacks, you import and use <a href="#constructs">constructs</a> from the AWS Construct Library to define your infrastructure. Before you can deploy, your CDK app must contain at least one stack.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-how-synth">14.3. CDK app synthesis</h3>
<div class="paragraph">
<p>To perform synthesis, we recommend that you use the CDK  <code class="noloc">CLI</code><code>cdk synth</code> command. The <code>cdk deploy</code> command will also perform synthesis before initiating deployment. However, by using <code>cdk synth</code>, you can validate your CDK app and catch errors before initiating deployment.</p>
</div>
<div class="paragraph">
<p>Synthesis behavior is determined by the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib-readme.html#stack-synthesizers">stack synthesizer</a> that you configure for your CDK stack. If you don&#8217;t configure a synthesizer, <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.DefaultStackSynthesizer.html">DefaultStackSynthesizer</a></code> will be used. You can also configure and customize synthesis to meet your needs. For instructions, see <a href="#configure-synth">Configure and perform CDK stack synthesis</a>.</p>
</div>
<div class="paragraph">
<p>For your synthesized CloudFormation template to deploy successfully into your environment, it must be compatible with how your environment was bootstrapped. For example, your CloudFormation template must specify the correct Amazon S3 bucket to deploy assets into. If you use the default method of bootstrapping your environment, the default stack synthesizer will work. If you customize CDK behavior, such as customizing bootstrapping or synthesis, CDK deployment behavior may vary.</p>
</div>
<div class="sect3">
<h4 id="deploy-how-synth-app">14.3.1. The app lifecycle</h4>
<div class="paragraph">
<p>When you perform synthesis, your CDK app is run through the following phases, known as the  <em>app lifecycle</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Construction (or Initialization)</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Your code instantiates all of the defined constructs and then links them together. In this stage, all of the constructs (app, stacks, and their child constructs) are instantiated and the constructor chain is run. Most of your app code is run in this stage.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Preparation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>All constructs that have implemented the <code>prepare</code> method participate in a final round of modifications, to set up their final state. The preparation phase happens automatically. As a user, you don&#8217;t see any feedback from this phase. It&#8217;s rare to need to use the "prepare" hook, and generally not recommended. Be very careful when mutating the construct tree during this phase, because the order of operations could impact behavior.</p>
<div class="paragraph">
<p>During this phase, once the construct tree has been built, any <a href="#aspects">aspects</a> that you have configured are applied as well.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Validation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>All constructs that have implemented the <code>validate</code> method can validate themselves to ensure that they&#8217;re in a state that will correctly deploy. You will get notified of any validation failures that happen during this phase. Generally, we recommend performing validation as soon as possible (usually as soon as you get some input) and throwing exceptions as early as possible. Performing validation early improves reliability as stack traces will be more accurate, and ensures that your code can continue to execute safely.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Synthesis</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This is the final stage of running your CDK app. It&#8217;s triggered by a call to <code>app.synth()</code>, and it traverses the construct tree and invokes the <code>synthesize</code> method on all constructs. Constructs that implement <code>synthesize</code> can participate in synthesis and produce deployment artifacts to the resulting cloud assembly. These artifacts include CloudFormation templates, AWS Lambda application bundles, file and <code class="noloc">Docker</code> image assets, and other deployment artifacts. In most cases, you won&#8217;t need to implement the  <code>synthesize</code> method.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="deploy-how-synth-run">14.3.2. Running your app</h4>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> needs to know how to run your CDK app. If you created the project from a template using the  <code>cdk init</code> command, your app&#8217;s <code class="path">cdk.json</code> file includes an  <code>app</code> key. This key specifies the necessary command for the language that the app is written in. If your language requires compilation, the command line performs this step before running the app automatically.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "npx ts-node --prefer-ts-exts bin/my-app.ts"
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "node bin/my-app.js"
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "app": "python app.py"
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "mvn -e -q compile exec:java"
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "dotnet run -p src/MyApp/MyApp.csproj"
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "go mod download &amp;&amp; go run my-app.go"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you didn&#8217;t create your project using the CDK  <code class="noloc">CLI</code>, or if you want to override the command line given in  <code class="path">cdk.json</code>, you can provide the  <code><a href="#ref-cli-cmd-options-app">--app</a></code> option when running the <code>cdk</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk --app 'executable' cdk-command ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The  <code class="replaceable">executable</code> part of the command indicates the command that should be run to execute your CDK application. Use quotation marks as shown, since such commands contain spaces. The <code class="replaceable">cdk-command</code> is a subcommand like <code>synth</code> or <code>deploy</code> that tells the CDK <code class="noloc">CLI</code> what you want to do with your app. Follow this with any additional options needed for that subcommand.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> can also interact directly with an already-synthesized cloud assembly. To do that, pass the directory in which the cloud assembly is stored in  <code>--app</code>. The following example lists the stacks defined in the cloud assembly stored under <code class="path">./my-cloud-assembly</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk --app ./my-cloud-assembly ls</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploy-how-synth-assemblies">14.3.3. Cloud assemblies</h4>
<div class="paragraph">
<p>The call to  <code>app.synth()</code> is what tells the AWS CDK to synthesize a cloud assembly from an app. Typically you don&#8217;t interact directly with cloud assemblies. They are files that include everything needed to deploy your app to a cloud environment. For example, it includes an AWS CloudFormation template for each stack in your app. It also includes a copy of any file assets or <code class="noloc">Docker</code> images that you reference in your app.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/aws/aws-cdk/blob/master/design/cloud-assembly.md">cloud assembly specification</a> for details on how cloud assemblies are formatted.</p>
</div>
<div class="paragraph">
<p>To interact with the cloud assembly that your AWS CDK app creates, you typically use the AWS CDK <code class="noloc">CLI</code>. However, any tool that can read the cloud assembly format can be used to deploy your app.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-how-deploy">14.4. Deploy your application</h3>
<div class="paragraph">
<p>To deploy your application, we recommend that you use the CDK  <code class="noloc">CLI</code><code>cdk deploy</code> command to initiate deployments or to configure automated deployments.</p>
</div>
<div class="paragraph">
<p>When you run <code>cdk deploy</code>, the CDK <code class="noloc">CLI</code> initiates  <code>cdk synth</code> to prepare for deployment. The following diagram illustrates the app lifecycle in the context of a deployment:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/app-lifecycle_cdk-flowchart.png" alt="Flowchart of the AWS CDK app lifecycle.">
</div>
</div>
<div class="paragraph">
<p>During deployment, the CDK  <code class="noloc">CLI</code> takes the cloud assembly produced by synthesis and deploys it to an AWS environment. Assets are uploaded to Amazon S3 and Amazon ECR and the CloudFormation template is submitted to AWS CloudFormation for deployment.</p>
</div>
<div class="paragraph">
<p>By the time the AWS CloudFormation deployment phase starts, your CDK app has already finished running and exited. This has the following implications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The CDK app can&#8217;t respond to events that happen during deployment, such as a resource being created or the whole deployment finishing. To run code during the deployment phase, you must inject it into the AWS CloudFormation template as a <a href="#develop-customize-custom">custom resource</a>. For more information about adding a custom resource to your app, see the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudformation-readme.html">AWS CloudFormation module</a>, or the <a href="https://github.com/aws-samples/aws-cdk-examples/tree/master/typescript/custom-resource/">custom-resource</a> example. You can also configure the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.triggers-readme.html">Triggers</a> module to run code during deployments.</p>
</li>
<li>
<p>The CDK app might have to work with values that can&#8217;t be known at the time it runs. For example, if the AWS CDK app defines an Amazon S3 bucket with an automatically generated name, and you retrieve the <code>bucket.bucketName</code> (Python: <code>bucket_name</code>) attribute, that value is not the name of the deployed bucket. Instead, you get a <code>Token</code> value. To determine whether a particular value is available, call <code>cdk.isUnresolved(value)</code> (Python: <code>is_unresolved</code>). See <a href="#tokens">Tokens and the AWS CDK</a> for details.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="deploy-how-deploy-permissions">14.4.1. Deployment permissions</h4>
<div class="paragraph">
<p>Before deployment can be performed, permissions must be established. The following diagram illustrates the permissions that are used during a default deployment, when using the default bootstrapping process and stack synthesizer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/default-deploy-process_cdk_flowchart.png" alt="Flowchart of the default AWS CDK deployment process.">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Actor initiates deployment</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Deployments are initiated by an <em>actor</em>, using the CDK <code class="noloc">CLI</code>. An actor can either be a person, or a service such as AWS CodePipeline.</p>
<div class="paragraph">
<p>If necessary, the CDK <code class="noloc">CLI</code> runs  <code>cdk synth</code> when you run <code>cdk deploy</code>. During synthesis, the AWS identity assumes the <code>LookupRole</code> to perform context lookups in the AWS environment.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Permissions are established</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>First, the actor&#8217;s security credentials are used to authenticate to AWS and obtain the first IAM identity in the process. For human actors, how security credentials are configured and obtained depends on how you or your organization manages users. For more information, see <a href="#configure-access">Configure security credentials for the AWS CDK CLI</a>. For service actors, such as CodePipeline, an IAM execution role is assumed and used.</p>
<div class="paragraph">
<p>Next, the IAM roles created in your AWS environment during bootstrapping are used to establish permissions to perform the actions needed for deployment. For more information about these roles and what they grant permissions for, see <a href="#bootstrapping-env-roles">IAM roles created during bootstrapping</a>. This process includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The AWS identity assumes the <code>DeploymentActionRole</code> role and passes the <code>CloudFormationExecutionRole</code> role to CloudFormation, ensuring that CloudFormation assumes the role when it performs any actions in your AWS environment. <code>DeploymentActionRole</code> grants permission to perform deployments into your environment and <code>CloudFormationExecutionRole</code> determines what actions CloudFormation can perform.</p>
</li>
<li>
<p>The AWS identity assumes the <code>FilePublishingRole</code>, which determines the actions that can be performed on the Amazon S3 bucket created during bootstrapping.</p>
</li>
<li>
<p>The AWS identity assumes the <code>ImagePublishingRole</code>, which determines the actions that can be performed on the Amazon ECR repository created during bootstrapping.</p>
</li>
<li>
<p>If necessary, the AWS identity assumes the <code>LookupRole</code> to perform context lookups in the AWS environment. This action may also be performed during template synthesis.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Deployment is performed</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>During deployment, the CDK <code class="noloc">CLI</code> reads the bootstrap version parameter to confirm the bootstrap version number. AWS CloudFormation also reads this parameter at deployment time to confirm. If permissions across the deployment workflow are valid, deployment is performed. Assets are uploaded to the bootstrapped resources and the CloudFormation template produced at synthesis is deployed using the CloudFormation service as a CloudFormation stack to provision your resources.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="policy-validation-synthesis">14.5. AWS CDK policy validation at synthesis time</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>By using the appropriate policy validation plugin, you can make the AWS CDK application check the generated AWS CloudFormation template against your policies immediately after synthesis.</p>
</div>
</blockquote>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="policy-validation">14.5.1. Policy validation at synthesis time</h4>
<div class="paragraph">
<p>If you or your organization use any policy validation tool, such as  <a href="https://docs.aws.amazon.com/cfn-guard/latest/ug/what-is-guard.html">AWS CloudFormation Guard</a> or <a href="https://www.openpolicyagent.org/">OPA</a>, to define constraints on your AWS CloudFormation template, you can integrate them with the AWS CDK at synthesis time. By using the appropriate policy validation plugin, you can make the AWS CDK application check the generated AWS CloudFormation template against your policies immediately after synthesis. If there are any violations, the synthesis will fail and a report will be printed to the console.</p>
</div>
<div class="paragraph">
<p>The validation performed by the AWS CDK at synthesis time validate controls at one point in the deployment lifecycle, but they can&#8217;t affect actions that occur outside synthesis. Examples include actions taken directly in the console or via service APIs. They aren&#8217;t resistant to alteration of AWS CloudFormation templates after synthesis. Some other mechanism to validate the same rule set more authoritatively should be set up independently, like <a href="https://docs.aws.amazon.com/cloudformation-cli/latest/userguide/hooks.html">AWS CloudFormation hooks</a> or <a href="https://docs.aws.amazon.com/config/latest/developerguide/WhatIsConfig.html">AWS Config</a>. Nevertheless, the ability of the AWS CDK to evaluate the rule set during development is still useful as it will improve detection speed and developer productivity.</p>
</div>
<div class="paragraph">
<p>The goal of AWS CDK policy validation is to minimize the amount of set up needed during development, and make it as easy as possible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is considered experimental, and both the plugin API and the format of the validation report are subject to change in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
</div>
<div class="sect3">
<h4 id="for-application-developers">14.5.2. For application developers</h4>
<div class="paragraph">
<p>To use one or more validation plugins in your application, use the  <code>policyValidationBeta1</code> property of <code>Stage</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { CfnGuardValidator } from '@cdklabs/cdk-validator-cfnguard';
const app = new App({
  policyValidationBeta1: [
    new CfnGuardValidator()
  ],
});
// only apply to a particular stage
const prodStage = new Stage(app, 'ProdStage', {
  policyValidationBeta1: [...],
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Immediately after synthesis, all plugins registered this way will be invoked to validate all the templates generated in the scope you defined. In particular, if you register the templates in the  <code>App</code> object, all templates will be subject to validation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Other than modifying the cloud assembly, plugins can do anything that your AWS CDK application can. They can read data from the filesystem, access the network etc. It&#8217;s your responsibility as the consumer of a plugin to verify that it&#8217;s secure to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="cfnguard-plugin">AWS CloudFormation Guard plugin</h5>
<div class="paragraph">
<p>Using the  <a href="https://github.com/cdklabs/cdk-validator-cfnguard">CfnGuardValidator</a> plugin allows you to use <a href="https://github.com/aws-cloudformation/cloudformation-guard">AWS CloudFormation Guard</a> to perform policy validations. The <code>CfnGuardValidator</code> plugin comes with a select set of <a href="https://docs.aws.amazon.com/controltower/latest/userguide/proactive-controls.html">AWS Control Tower proactive controls</a> built in. The current set of rules can be found in the <a href="https://github.com/cdklabs/cdk-validator-cfnguard/blob/main/README.md">project documentation</a>. As mentioned in <a href="#policy-validation">Policy validation at synthesis time</a>, we recommend that organizations set up a more authoritative method of validation using <a href="https://docs.aws.amazon.com/cloudformation-cli/latest/userguide/hooks.html">AWS CloudFormation hooks</a>.</p>
</div>
<div class="paragraph">
<p>Forhttps://docs.aws.amazon.com/controltower/latest/userguide/what-is-control-tower.html[AWS Control Tower] customers, these same proactive controls can be deployed across your organization. When you enable AWS Control Tower proactive controls in your AWS Control Tower environment, the controls can stop the deployment of non-compliant resources deployed via AWS CloudFormation. For more information about managed proactive controls and how they work, see the <a href="https://docs.aws.amazon.com/controltower/latest/userguide/proactive-controls.html">AWS Control Tower documentation</a>.</p>
</div>
<div class="paragraph">
<p>These AWS CDK bundled controls and managed AWS Control Tower proactive controls are best used together. In this scenario you can configure this validation plugin with the same proactive controls that are active in your AWS Control Tower cloud environment. You can then quickly gain confidence that your AWS CDK application will pass the AWS Control Tower controls by running <code>cdk synth</code> locally.</p>
</div>
</div>
<div class="sect4">
<h5 id="validation-report">Validation Report</h5>
<div class="paragraph">
<p>When you synthesize the AWS CDK app the validator plugins will be called and the results will be printed. An example report is showing below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">Validation Report (CfnGuardValidator)
-------------------------------------
(Summary)
╔═══════════╤════════════════════════╗
║ Status    │ failure                ║
╟───────────┼────────────────────────╢
║ Plugin    │ CfnGuardValidator      ║
╚═══════════╧════════════════════════╝
(Violations)
Ensure S3 Buckets are encrypted with a KMS CMK (1 occurrences)
Severity: medium
  Occurrences:

    - Construct Path: MyStack/MyCustomL3Construct/Bucket
    - Stack Template Path: ./cdk.out/MyStack.template.json
    - Creation Stack:
        └──  MyStack (MyStack)
             │ Library: aws-cdk-lib.Stack
             │ Library Version: 2.50.0
             │ Location: Object.&lt;anonymous&gt; (/home/johndoe/tmp/cdk-tmp-app/src/main.ts:25:20)
             └──  MyCustomL3Construct (MyStack/MyCustomL3Construct)
                  │ Library: N/A - (Local Construct)
                  │ Library Version: N/A
                  │ Location: new MyStack (/home/johndoe/tmp/cdk-tmp-app/src/main.ts:15:20)
                  └──  Bucket (MyStack/MyCustomL3Construct/Bucket)
                       │ Library: aws-cdk-lib/aws-s3.Bucket
                       │ Library Version: 2.50.0
                       │ Location: new MyCustomL3Construct (/home/johndoe/tmp/cdk-tmp-app/src/main.ts:9:20)
    - Resource Name: amzn-s3-demo-bucket
    - Locations:
      &gt; BucketEncryption/ServerSideEncryptionConfiguration/0/ServerSideEncryptionByDefault/SSEAlgorithm
  Recommendation: Missing value for key `SSEAlgorithm` - must specify `aws:kms`
  How to fix:
    &gt; Add to construct properties for `cdk-app/MyStack/Bucket`
      `encryption: BucketEncryption.KMS`

Validation failed. See above reports for details</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the report will be printed in a human readable format. If you want a report in JSON format, enable it usingthe  <code>@aws-cdk/core:validationReportJson</code>via the CLI or passing it directly to the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const app = new App({
  context: { '@aws-cdk/core:validationReportJson': true },
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can set this context key-value pair using the  <code>cdk.json</code> or <code>cdk.context.json</code> files in your project directory (see <a href="#context">Context values and the AWS CDK</a>).</p>
</div>
<div class="paragraph">
<p>If you choose the JSON format, the AWS CDK will print the policy validation report to a file called <code>policy-validation-report.json</code> in the cloud assembly directory. For the default, human-readable format, the report will be printed to the standard output.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="plugin-authors">14.5.3. For plugin authors</h4>
<div class="sect4">
<h5 id="plugins">Plugins</h5>
<div class="paragraph">
<p>The AWS CDK core framework is responsible for registering and invoking plugins and then displaying the formatted validation report. The responsibility of the plugin is to act as the translation layer between the AWS CDK framework and the policy validation tool. A plugin can be created in any language supported by AWS CDK. If you are creating a plugin that might be consumed by multiple languages then it&#8217;s recommended that you create the plugin in  <code>TypeScript</code> so that you can use JSII to publish the plugin in each AWS CDK language.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-plugins">Creating plugins</h5>
<div class="paragraph">
<p>The communication protocol between the AWS CDK core module and your policy tool is defined by the  <code>IPolicyValidationPluginBeta1</code>interface. To create a new plugin you must write a class that implements this interface. There are two things you need to implement: the plugin name (by overriding the <code>name</code> property), and the <code>validate()</code> method.</p>
</div>
<div class="paragraph">
<p>The framework will call <code>validate()</code>, passing an <code>IValidationContextBeta1</code> object. The location of the templates to be validated is given by <code>templatePaths</code>. The plugin should return an instance of <code>ValidationPluginReportBeta1</code>. This object represents the report that the user wil receive at the end of the synthesis.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">validate(context: IPolicyValidationContextBeta1): PolicyValidationReportBeta1 {
  // First read the templates using context.templatePaths...
  // ...then perform the validation, and then compose and return the report.
  // Using hard-coded values here for better clarity:
  return {
    success: false,
    violations: [{
      ruleName: 'CKV_AWS_117',
      description: 'Ensure that AWS Lambda function is configured inside a VPC',
      fix: 'https://docs.bridgecrew.io/docs/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1',
      violatingResources: [{
        resourceName: 'MyFunction3BAA72D1',
        templatePath: '/home/johndoe/myapp/cdk.out/MyService.template.json',
        locations: 'Properties/VpcConfig',
      }],
    }],
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that plugins aren&#8217;t allowed to modify anything in the cloud assembly. Any attempt to do so will result in synthesis failure.</p>
</div>
<div class="paragraph">
<p>If your plugin depends on an external tool, keep in mind that some developers may not have that tool installed in their workstations yet. To minimize friction, we highly recommend that you provide some installation script along with your plugin package, to automate the whole process. Better yet, run that script as part of the installation of your package. With <code>npm</code>, for example, you can add it to the <code>postinstall`https://docs.npmjs.com/cli/v9/using-npm/scripts[script] in the `package.json</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-exemptions">Handling Exemptions</h5>
<div class="paragraph">
<p>If your organization has a mechanism for handling exemptions, it can be implemented as part of the validator plugin.</p>
</div>
<div class="paragraph">
<p>An example scenario to illustrate a possible exemption mechanism:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An organization has a rule that public Amazon S3 buckets aren&#8217;t allowed, <em>except</em> for under certain scenarios.</p>
</li>
<li>
<p>A developer is creating an Amazon S3 bucket that falls under one of those scenarios and requests an exemption (create a ticket for example).</p>
</li>
<li>
<p>Security tooling knows how to read from the internal system that registers exemptions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this scenario the developer would request an exception in the internal system and then will need some way of "registering" that exception. Adding on to the guard plugin example, you could create a plugin that handles exemptions by filtering out the violations that have a matching exemption in an internal ticketing system.</p>
</div>
<div class="paragraph">
<p>See the existing plugins for example implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/cdklabs/cdk-validator-cfnguard">@cdklabs/cdk-validator-cfnguard</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="cdk-pipeline">14.6. Continuous integration and delivery (CI/CD) using CDK Pipelines</h3>
<div class="paragraph">
<p>Use the  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.pipelines-readme.html">CDK Pipelines</a> module from the AWS Construct Library to configure continuous delivery of AWS CDK applications. When you commit your CDK app&#8217;s source code into AWS CodeCommit, <code class="noloc">GitHub</code>, or AWS CodeStar, CDK Pipelines can automatically build, test, and deploy your new version.</p>
</div>
<div class="paragraph">
<p>CDK Pipelines are self-updating. If you add application stages or stacks, the pipeline automatically reconfigures itself to deploy those new stages or stacks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CDK Pipelines supports two APIs. One is the original API that was made available in the CDK Pipelines Developer Preview. The other is a modern API that incorporates feedback from CDK customers received during the preview phase. The examples in this topic use the modern API. For details on the differences between the two supported APIs, see <a href="https://github.com/aws/aws-cdk/blob/master/packages/@aws-cdk/pipelines/ORIGINAL_API.md">CDK Pipelines original API</a> in the <em>aws-cdk <code class="noloc">GitHub</code> repository</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-bootstrap">14.6.1. Bootstrap your AWS environments</h4>
<div class="paragraph">
<p>Before you can use CDK Pipelines, you must bootstrap the AWS  <a href="#environments">environment</a> that you will deploy your stacks to.</p>
</div>
<div class="paragraph">
<p>A CDK Pipeline involves at least two environments. The first environment is where the pipeline is provisioned. The second environment is where you want to deploy the application&#8217;s stacks or stages to (stages are groups of related stacks). These environments can be the same, but a best practice recommendation is to isolate stages from each other in different environments.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="#bootstrapping">AWS CDK bootstrapping</a> for more information on the kinds of resources created by bootstrapping and how to customize the bootstrap stack.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Continuous deployment with CDK Pipelines requires the following to be included in the CDK Toolkit stack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An Amazon Simple Storage Service (Amazon S3) bucket.</p>
</li>
<li>
<p>An Amazon ECR repository.</p>
</li>
<li>
<p>IAM roles to give the various parts of a pipeline the permissions they need.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The CDK Toolkit will upgrade your existing bootstrap stack or creates a new one if necessary.</p>
</div>
<div class="paragraph">
<p>To bootstrap an environment that can provision an AWS CDK pipeline, invoke <code>cdk bootstrap</code> as shown in the following example. Invoking the AWS CDK Toolkit via the <code>npx</code> command temporarily installs it if necessary. It will also use the version of the Toolkit installed in the current project, if one exists.</p>
</div>
<div class="paragraph">
<p><code>--cloudformation-execution-policies</code> specifies the ARN of a policy under which future CDK Pipelines deployments will execute. The default <code>AdministratorAccess</code> policy makes sure that your pipeline can deploy every type of AWS resource. If you use this policy, make sure you trust all the code and dependencies that make up your AWS CDK app.</p>
</div>
<div class="paragraph">
<p>Most organizations mandate stricter controls on what kinds of resources can be deployed by automation. Check with the appropriate department within your organization to determine the policy your pipeline should use.</p>
</div>
<div class="paragraph">
<p>You can omit the <code>--profile</code> option if your default AWS profile contains the necessary authentication configuration and AWS Region.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx cdk bootstrap aws://ACCOUNT-NUMBER/REGION --profile ADMIN-PROFILE \
    --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx cdk bootstrap aws://ACCOUNT-NUMBER/REGION --profile ADMIN-PROFILE ^
    --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess</code></pre>
</div>
</div>
<div class="paragraph">
<p>To bootstrap additional environments into which AWS CDK applications will be deployed by the pipeline, use the following commands instead. The  <code>--trust</code> option indicates which other account should have permissions to deploy AWS CDK applications into this environment. For this option, specify the pipeline&#8217;s AWS account ID.</p>
</div>
<div class="paragraph">
<p>Again, you can omit the <code>--profile</code> option if your default AWS profile contains the necessary authentication configuration and AWS Region.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx cdk bootstrap aws://ACCOUNT-NUMBER/REGION --profile ADMIN-PROFILE \
    --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess \
    --trust PIPELINE-ACCOUNT-NUMBER</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx cdk bootstrap aws://ACCOUNT-NUMBER/REGION --profile ADMIN-PROFILE ^
    --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess ^
    --trust PIPELINE-ACCOUNT-NUMBER</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use administrative credentials only to bootstrap and to provision the initial pipeline. Afterward, use the pipeline itself, not your local machine, to deploy changes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are upgrading a legacy bootstrapped environment, the previous Amazon S3 bucket is orphaned when the new bucket is created. Delete it manually by using the Amazon S3 console.</p>
</div>
<div class="sect4">
<h5 id="cdk-pipeline-protect">Protecting your bootstrap stack from deletion</h5>
<div class="paragraph">
<p>If a bootstrap stack is deleted, the AWS resources that were originally provisioned in the environment to support CDK deployments will also be deleted. This will cause the pipeline to stop working. If this happens, there is no general solution for recovery.</p>
</div>
<div class="paragraph">
<p>After your environment is bootstrapped, do not delete and recreate the environment&#8217;s bootstrap stack. Instead, try to update the bootstrap stack to a new version by running the <code>cdk bootstrap</code> command again.</p>
</div>
<div class="paragraph">
<p>To protect against accidental deletion of your bootstrap stack, we recommend that you provide the <code>--termination-protection</code> option with the <code>cdk bootstrap</code> command to enable termination protection. You can enable termination protection on new or existing bootstrap stacks. To learn more about this option, see <code><a href="#ref-cli-cmd-bootstrap-options-termination-protection">--termination-protection</a></code>.</p>
</div>
<div class="paragraph">
<p>After enabling termination protection, you can use the AWS CLI or CloudFormation console to verify.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following command to enable termination protection on a new or existing bootstrap stack:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --termination-protection</code></pre>
</div>
</div>
</li>
<li>
<p>Use the AWS CLI or CloudFormation console to verify. The following is an example, using the AWS CLI. If you modified your bootstrap stack name, replace <code>CDKToolkit</code> with your stack name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws cloudformation describe-stacks --stack-name CDKToolkit --query "Stacks[0].EnableTerminationProtection"
true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-init">14.6.2. Initialize a project</h4>
<div class="paragraph">
<p>Create a new, empty  <code class="noloc">GitHub</code> project and clone it to your workstation in the  <code class="path">my-pipeline</code> directory. (Our code examples in this topic use GitHub. You can also use AWS CodeStar or AWS CodeCommit.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">git clone GITHUB-CLONE-URL my-pipeline
cd my-pipeline</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a name other than  <code>my-pipeline</code> for your app&#8217;s main directory. However, if you do so, you will have to tweak the file and class names later in this topic. This is because the AWS CDK Toolkit bases some file and class names on the name of the main directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After cloning, initialize the project as usual.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language typescript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language javascript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language python</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>After the app has been created, also enter the following two commands. These activate the app&#8217;s Python virtual environment and install the AWS CDK core dependencies.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ source .venv/bin/activate # On Windows, run `.\venv\Scripts\activate` instead
$ python -m pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language java</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>If you are using an IDE, you can now open or import the project. In Eclipse, for example, choose  <strong>File</strong> &gt;  <strong>Import</strong> &gt;  <strong>Maven</strong> &gt;  <strong>Existing Maven Projects</strong>. Make sure that the project settings are set to use Java 8 (1.8).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>If you are using Visual Studio, open the solution file in the  <code class="path">src</code> directory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk init app --language go</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>After the app has been created, also enter the following command to install the AWS Construct Library modules that the app requires.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ go get</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to commit your  <code class="path">cdk.json</code> and  <code class="path">cdk.context.json</code> files to source control. The context information (such as feature flags and cached values retrieved from your AWS account) are part of your project&#8217;s state. The values may be different in another environment, which can cause unexpected changes in your results. For more information, see  <a href="#context">Context values and the AWS CDK</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-define">14.6.3. Define a pipeline</h4>
<div class="paragraph">
<p>Your CDK Pipelines application will include at least two stacks: one that represents the pipeline itself, and one or more stacks that represent the application deployed through it. Stacks can also be grouped into  <em>stages</em>, which you can use to deploy copies of infrastructure stacks to different environments. For now, we&#8217;ll consider the pipeline, and later delve into the application it will deploy.</p>
</div>
<div class="paragraph">
<p>The construct <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.pipelines.CodePipeline.html">CodePipeline</a> is the construct that represents a CDK Pipeline that uses AWS CodePipeline as its deployment engine. When you instantiate <code>CodePipeline</code> in a stack, you define the source location for the pipeline (such as a GitHub repository). You also define the commands to build the app.</p>
</div>
<div class="paragraph">
<p>For example, the following defines a pipeline whose source is stored in a GitHub repository. It also includes a build step for a TypeScript CDK application. Fill in the information about your GitHub repo where indicated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the pipeline authenticates to GitHub using a personal access token stored in Secrets Manager under the name <code class="path">github-token</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You&#8217;ll also need to update the instantiation of the pipeline stack to specify the AWS account and Region.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">lib/my-pipeline-stack.ts</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { CodePipeline, CodePipelineSource, ShellStep } from 'aws-cdk-lib/pipelines';

export class MyPipelineStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const pipeline = new CodePipeline(this, 'Pipeline', {
      pipelineName: 'MyPipeline',
      synth: new ShellStep('Synth', {
        input: CodePipelineSource.gitHub('OWNER/REPO', 'main'),
        commands: ['npm ci', 'npm run build', 'npx cdk synth']
      })
    });
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">bin/my-pipeline.ts</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import * as cdk from 'aws-cdk-lib';
import { MyPipelineStack } from '../lib/my-pipeline-stack';

const app = new cdk.App();
new MyPipelineStack(app, 'MyPipelineStack', {
  env: {
    account: '111111111111',
    region: 'eu-west-1',
  }
});

app.synth();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">lib/my-pipeline-stack.js</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const { CodePipeline, CodePipelineSource, ShellStep } = require('aws-cdk-lib/pipelines');

 class MyPipelineStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const pipeline = new CodePipeline(this, 'Pipeline', {
      pipelineName: 'MyPipeline',
      synth: new ShellStep('Synth', {
        input: CodePipelineSource.gitHub('OWNER/REPO', 'main'),
        commands: ['npm ci', 'npm run build', 'npx cdk synth']
      })
    });
  }
}

module.exports = { MyPipelineStack }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">bin/my-pipeline.js</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node

const cdk = require('aws-cdk-lib');
const { MyPipelineStack } = require('../lib/my-pipeline-stack');

const app = new cdk.App();
new MyPipelineStack(app, 'MyPipelineStack', {
  env: {
    account: '111111111111',
    region: 'eu-west-1',
  }
});

app.synth();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">my-pipeline/my-pipeline-stack.py</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from aws_cdk.pipelines import CodePipeline, CodePipelineSource, ShellStep

class MyPipelineStack(cdk.Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        pipeline =  CodePipeline(self, "Pipeline",
                        pipeline_name="MyPipeline",
                        synth=ShellStep("Synth",
                            input=CodePipelineSource.git_hub("OWNER/REPO", "main"),
                            commands=["npm install -g aws-cdk",
                                "python -m pip install -r requirements.txt",
                                "cdk synth"]
                        )
                    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">app.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import aws_cdk as cdk
from my_pipeline.my_pipeline_stack import MyPipelineStack

app = cdk.App()
MyPipelineStack(app, "MyPipelineStack",
    env=cdk.Environment(account="111111111111", region="eu-west-1")
)

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">src/main/java/com/myorg/MyPipelineStack.java</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import java.util.Arrays;
import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.pipelines.CodePipeline;
import software.amazon.awscdk.pipelines.CodePipelineSource;
import software.amazon.awscdk.pipelines.ShellStep;

public class MyPipelineStack extends Stack {
    public MyPipelineStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyPipelineStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        CodePipeline pipeline = CodePipeline.Builder.create(this, "pipeline")
             .pipelineName("MyPipeline")
             .synth(ShellStep.Builder.create("Synth")
                .input(CodePipelineSource.gitHub("OWNER/REPO", "main"))
                .commands(Arrays.asList("npm install -g aws-cdk", "cdk synth"))
                .build())
             .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">src/main/java/com/myorg/MyPipelineApp.java</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

public class MyPipelineApp {
    public static void main(final String[] args) {
        App app = new App();

        new MyPipelineStack(app, "PipelineStack", StackProps.builder()
            .env(Environment.builder()
                .account("111111111111")
                .region("eu-west-1")
                .build())
            .build());

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">src/MyPipeline/MyPipelineStack.cs</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.Pipelines;

namespace MyPipeline
{
    public class MyPipelineStack : Stack
    {
        internal MyPipelineStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            var pipeline = new CodePipeline(this, "pipeline", new CodePipelineProps
            {
                PipelineName = "MyPipeline",
                Synth = new ShellStep("Synth", new ShellStepProps
                {
                    Input = CodePipelineSource.GitHub("OWNER/REPO", "main"),
                    Commands = new string[] { "npm install -g aws-cdk", "cdk synth" }
                })
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In  <code class="path">src/MyPipeline/Program.cs</code> (may vary if your project folder isn&#8217;t named  <code class="path">my-pipeline</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;

namespace MyPipeline
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            var app = new App();
            new MyPipelineStack(app, "MyPipelineStack", new StackProps
            {
                Env = new Amazon.CDK.Environment {
                    Account = "111111111111", Region = "eu-west-1" }
            });

            app.Synth();
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
	"github.com/aws/aws-cdk-go/awscdk/v2"
	codebuild "github.com/aws/aws-cdk-go/awscdk/v2/awscodebuild"
	ssm "github.com/aws/aws-cdk-go/awscdk/v2/awsssm"
	pipeline "github.com/aws/aws-cdk-go/awscdk/v2/pipelines"
	"github.com/aws/constructs-go/constructs/v10"
	"github.com/aws/jsii-runtime-go"
	"os"
)

// my CDK Stack with resources
func NewCdkStack(scope constructs.Construct, id *string, props *awscdk.StackProps) awscdk.Stack {
	stack := awscdk.NewStack(scope, id, props)

	// create an example ssm parameter
	_ = ssm.NewStringParameter(stack, jsii.String("ssm-test-param"), &amp;ssm.StringParameterProps{
		ParameterName: jsii.String("/testparam"),
		Description:   jsii.String("ssm parameter for demo"),
		StringValue:   jsii.String("my test param"),
	})

	return stack
}

// my CDK Application
func NewCdkApplication(scope constructs.Construct, id *string, props *awscdk.StageProps) awscdk.Stage {
	stage := awscdk.NewStage(scope, id, props)

	_ = NewCdkStack(stage, jsii.String("cdk-stack"), &amp;awscdk.StackProps{Env: props.Env})

	return stage
}

// my CDK Pipeline
func NewCdkPipeline(scope constructs.Construct, id *string, props *awscdk.StackProps) awscdk.Stack {
	stack := awscdk.NewStack(scope, id, props)

	// GitHub repo with owner and repository name
	githubRepo := pipeline.CodePipelineSource_GitHub(jsii.String("owner/repo"), jsii.String("main"), &amp;pipeline.GitHubSourceOptions{
		Authentication: awscdk.SecretValue_SecretsManager(jsii.String("my-github-token"), nil),
	})

	// self mutating pipeline
	myPipeline := pipeline.NewCodePipeline(stack, jsii.String("cdkPipeline"), &amp;pipeline.CodePipelineProps{
		PipelineName: jsii.String("CdkPipeline"),
		// self mutation true - pipeline changes itself before application deployment
		SelfMutation: jsii.Bool(true),
		CodeBuildDefaults: &amp;pipeline.CodeBuildOptions{
			BuildEnvironment: &amp;codebuild.BuildEnvironment{
				// image version 6.0 recommended for newer go version
				BuildImage: codebuild.LinuxBuildImage_FromCodeBuildImageId(jsii.String("aws/codebuild/standard:6.0")),
			},
		},
		Synth: pipeline.NewCodeBuildStep(jsii.String("Synth"), &amp;pipeline.CodeBuildStepProps{
			Input: githubRepo,
			Commands: &amp;[]*string{
				jsii.String("npm install -g aws-cdk"),
				jsii.String("cdk synth"),
			},
		}),
	})

	// deployment of actual CDK application
	myPipeline.AddStage(NewCdkApplication(stack, jsii.String("MyApplication"), &amp;awscdk.StageProps{
		Env: targetAccountEnv(),
	}), &amp;pipeline.AddStageOpts{
		Post: &amp;[]pipeline.Step{
			pipeline.NewCodeBuildStep(jsii.String("Manual Steps"), &amp;pipeline.CodeBuildStepProps{
				Commands: &amp;[]*string{
					jsii.String("echo \"My CDK App deployed, manual steps go here ... \""),
				},
			}),
		},
	})

	return stack
}

// main app
func main() {
	defer jsii.Close()

	app := awscdk.NewApp(nil)

	// call CDK Pipeline
	NewCdkPipeline(app, jsii.String("CdkPipelineStack"), &amp;awscdk.StackProps{
		Env: pipelineEnv(),
	})

	app.Synth(nil)
}

// env determines the AWS environment (account+region) in which our stack is to
// be deployed. For more information see: https://docs.aws.amazon.com/cdk/latest/guide/environments.html
func pipelineEnv() *awscdk.Environment {
	return &amp;awscdk.Environment{
		Account: jsii.String(os.Getenv("CDK_DEFAULT_ACCOUNT")),
		Region:  jsii.String(os.Getenv("CDK_DEFAULT_REGION")),
	}
}

func targetAccountEnv() *awscdk.Environment {
	return &amp;awscdk.Environment{
		Account: jsii.String(os.Getenv("CDK_DEFAULT_ACCOUNT")),
		Region:  jsii.String(os.Getenv("CDK_DEFAULT_REGION")),
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You must deploy a pipeline manually once. After that, the pipeline keeps itself up to date from the source code repository. So be sure that the code in the repo is the code you want deployed. Check in your changes and push to GitHub, then deploy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">git add --all
git commit -m "initial commit"
git push
cdk deploy</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Now that you&#8217;ve done the initial deployment, your local AWS account no longer needs administrative access. This is because all changes to your app will be deployed via the pipeline. All you need to be able to do is push to GitHub.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-stages">14.6.4. Application stages</h4>
<div class="paragraph">
<p>To define a multi-stack AWS application that can be added to the pipeline all at once, define a subclass of  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stage.html">Stage</a></code>. (This is different from <code>CdkStage</code> in the CDK Pipelines module.)</p>
</div>
<div class="paragraph">
<p>The stage contains the stacks that make up your application. If there are dependencies between the stacks, the stacks are automatically added to the pipeline in the right order. Stacks that don&#8217;t depend on each other are deployed in parallel. You can add a dependency relationship between stacks by calling <code>stack1.addDependency(stack2)</code>.</p>
</div>
<div class="paragraph">
<p>Stages accept a default <code>env</code> argument, which becomes the default environment for the stacks inside it. (Stacks can still have their own environment specified.).</p>
</div>
<div class="paragraph">
<p>An application is added to the pipeline by calling <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.pipelines.CodePipeline.html#addwbrstagestage-optionss">addStage</a>()</code> with instances of <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stage.html">Stage</a>. A stage can be instantiated and added to the pipeline multiple times to define different stages of your DTAP or multi-Region application pipeline.</p>
</div>
<div class="paragraph">
<p>We will create a stack containing a simple Lambda function and place that stack in a stage. Then we will add the stage to the pipeline so it can be deployed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create the new file <code class="path">lib/my-pipeline-lambda-stack.ts</code> to hold our application stack containing a Lambda function.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { Function, InlineCode, Runtime } from 'aws-cdk-lib/aws-lambda';

export class MyLambdaStack extends cdk.Stack {
    constructor(scope: Construct, id: string, props?: cdk.StackProps) {
      super(scope, id, props);

      new Function(this, 'LambdaFunction', {
        runtime: Runtime.NODEJS_18_X,
        handler: 'index.handler',
        code: new InlineCode('exports.handler = _ =&gt; "Hello, CDK";')
      });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the new file  <code class="path">lib/my-pipeline-app-stage.ts</code> to hold our stage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from "constructs";
import { MyLambdaStack } from './my-pipeline-lambda-stack';

export class MyPipelineAppStage extends cdk.Stage {

    constructor(scope: Construct, id: string, props?: cdk.StageProps) {
      super(scope, id, props);

      const lambdaStack = new MyLambdaStack(this, 'LambdaStack');
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit  <code class="path">lib/my-pipeline-stack.ts</code> to add the stage to our pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { CodePipeline, CodePipelineSource, ShellStep } from 'aws-cdk-lib/pipelines';
import { MyPipelineAppStage } from './my-pipeline-app-stage';

export class MyPipelineStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const pipeline = new CodePipeline(this, 'Pipeline', {
      pipelineName: 'MyPipeline',
      synth: new ShellStep('Synth', {
        input: CodePipelineSource.gitHub('OWNER/REPO', 'main'),
        commands: ['npm ci', 'npm run build', 'npx cdk synth']
      })
    });

    pipeline.addStage(new MyPipelineAppStage(this, "test", {
      env: { account: "111111111111", region: "eu-west-1" }
    }));
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create the new file <code class="path">lib/my-pipeline-lambda-stack.js</code> to hold our application stack containing a Lambda function.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const { Function, InlineCode, Runtime } = require('aws-cdk-lib/aws-lambda');

class MyLambdaStack extends cdk.Stack {
    constructor(scope, id, props) {
      super(scope, id, props);

      new Function(this, 'LambdaFunction', {
        runtime: Runtime.NODEJS_18_X,
        handler: 'index.handler',
        code: new InlineCode('exports.handler = _ =&gt; "Hello, CDK";')
      });
    }
}

module.exports = { MyLambdaStack }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the new file  <code class="path">lib/my-pipeline-app-stage.js</code> to hold our stage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const { MyLambdaStack } = require('./my-pipeline-lambda-stack');

class MyPipelineAppStage extends cdk.Stage {

    constructor(scope, id, props) {
      super(scope, id, props);

      const lambdaStack = new MyLambdaStack(this, 'LambdaStack');
    }
}

module.exports = { MyPipelineAppStage };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit  <code class="path">lib/my-pipeline-stack.ts</code> to add the stage to our pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const { CodePipeline, CodePipelineSource, ShellStep } = require('aws-cdk-lib/pipelines');
const { MyPipelineAppStage } = require('./my-pipeline-app-stage');

 class MyPipelineStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const pipeline = new CodePipeline(this, 'Pipeline', {
      pipelineName: 'MyPipeline',
      synth: new ShellStep('Synth', {
        input: CodePipelineSource.gitHub('OWNER/REPO', 'main'),
        commands: ['npm ci', 'npm run build', 'npx cdk synth']
      })
    });

    pipeline.addStage(new MyPipelineAppStage(this, "test", {
      env: { account: "111111111111", region: "eu-west-1" }
    }));

  }
}

module.exports = { MyPipelineStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create the new file <code class="path">my_pipeline/my_pipeline_lambda_stack.py</code> to hold our application stack containing a Lambda function.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from aws_cdk.aws_lambda import Function, InlineCode, Runtime

class MyLambdaStack(cdk.Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        Function(self, "LambdaFunction",
            runtime=Runtime.NODEJS_18_X,
            handler="index.handler",
            code=InlineCode("exports.handler = _ =&gt; 'Hello, CDK';")
        )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the new file  <code class="path">my_pipeline/my_pipeline_app_stage.py</code> to hold our stage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from my_pipeline.my_pipeline_lambda_stack import MyLambdaStack

class MyPipelineAppStage(cdk.Stage):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        lambdaStack = MyLambdaStack(self, "LambdaStack")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit  <code class="path">my_pipeline/my-pipeline-stack.py</code> to add the stage to our pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from aws_cdk.pipelines import CodePipeline, CodePipelineSource, ShellStep
from my_pipeline.my_pipeline_app_stage import MyPipelineAppStage

class MyPipelineStack(cdk.Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        pipeline =  CodePipeline(self, "Pipeline",
                        pipeline_name="MyPipeline",
                        synth=ShellStep("Synth",
                            input=CodePipelineSource.git_hub("OWNER/REPO", "main"),
                            commands=["npm install -g aws-cdk",
                                "python -m pip install -r requirements.txt",
                                "cdk synth"]))

        pipeline.add_stage(MyPipelineAppStage(self, "test",
            env=cdk.Environment(account="111111111111", region="eu-west-1")))</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create the new file <code class="path">src/main/java/com.myorg/MyPipelineLambdaStack.java</code> to hold our application stack containing a Lambda function.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;
import software.amazon.awscdk.services.lambda.InlineCode;

public class MyPipelineLambdaStack extends Stack {
    public MyPipelineLambdaStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyPipelineLambdaStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Function.Builder.create(this, "LambdaFunction")
          .runtime(Runtime.NODEJS_18_X)
          .handler("index.handler")
          .code(new InlineCode("exports.handler = _ =&gt; 'Hello, CDK';"))
          .build();

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the new file  <code class="path">src/main/java/com.myorg/MyPipelineAppStage.java</code> to hold our stage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.Stage;
import software.amazon.awscdk.StageProps;

public class MyPipelineAppStage extends Stage {
    public MyPipelineAppStage(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyPipelineAppStage(final Construct scope, final String id, final StageProps props) {
        super(scope, id, props);

        Stack lambdaStack = new MyPipelineLambdaStack(this, "LambdaStack");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit  <code class="path">src/main/java/com.myorg/MyPipelineStack.java</code> to add the stage to our pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import java.util.Arrays;
import software.constructs.Construct;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.StageProps;
import software.amazon.awscdk.pipelines.CodePipeline;
import software.amazon.awscdk.pipelines.CodePipelineSource;
import software.amazon.awscdk.pipelines.ShellStep;

public class MyPipelineStack extends Stack {
    public MyPipelineStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public MyPipelineStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        final CodePipeline pipeline = CodePipeline.Builder.create(this, "pipeline")
            .pipelineName("MyPipeline")
            .synth(ShellStep.Builder.create("Synth")
                .input(CodePipelineSource.gitHub("OWNER/REPO", "main"))
                .commands(Arrays.asList("npm install -g aws-cdk", "cdk synth"))
                .build())
            .build();

        pipeline.addStage(new MyPipelineAppStage(this, "test", StageProps.builder()
            .env(Environment.builder()
                .account("111111111111")
                .region("eu-west-1")
                .build())
            .build()));
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create the new file <code class="path">src/MyPipeline/MyPipelineLambdaStack.cs</code> to hold our application stack containing a Lambda function.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.AWS.Lambda;

namespace MyPipeline
{
    class MyPipelineLambdaStack : Stack
    {
        public MyPipelineLambdaStack(Construct scope, string id, StackProps props=null) : base(scope, id, props)
        {
            new Function(this, "LambdaFunction", new FunctionProps
            {
                Runtime = Runtime.NODEJS_18_X,
                Handler = "index.handler",
                Code = new InlineCode("exports.handler = _ =&gt; 'Hello, CDK';")
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the new file  <code class="path">src/MyPipeline/MyPipelineAppStage.cs</code> to hold our stage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace MyPipeline
{
    class MyPipelineAppStage : Stage
    {
        public MyPipelineAppStage(Construct scope, string id, StageProps props=null) : base(scope, id, props)
        {
            Stack lambdaStack = new MyPipelineLambdaStack(this, "LambdaStack");
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit  <code class="path">src/MyPipeline/MyPipelineStack.cs</code> to add the stage to our pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;
using Amazon.CDK.Pipelines;

namespace MyPipeline
{
    public class MyPipelineStack : Stack
    {
        internal MyPipelineStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            var pipeline = new CodePipeline(this, "pipeline", new CodePipelineProps
            {
                PipelineName = "MyPipeline",
                Synth = new ShellStep("Synth", new ShellStepProps
                {
                    Input = CodePipelineSource.GitHub("OWNER/REPO", "main"),
                    Commands = new string[] { "npm install -g aws-cdk", "cdk synth" }
                })
            });

            pipeline.AddStage(new MyPipelineAppStage(this, "test", new StageProps
            {
                Env = new Environment
                {
                    Account = "111111111111", Region = "eu-west-1"
                }
            }));
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Every application stage added by  <code>addStage()</code> results in the addition of a corresponding pipeline stage, represented by a <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.pipelines.StageDeployment.html">StageDeployment</a> instance returned by the <code>addStage()</code> call. You can add pre-deployment or post-deployment actions to the stage by calling its <code>addPre()</code> or <code>addPost()</code> method.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// import { ManualApprovalStep } from 'aws-cdk-lib/pipelines';

const testingStage = pipeline.addStage(new MyPipelineAppStage(this, 'testing', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));

    testingStage.addPost(new ManualApprovalStep('approval'));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// const { ManualApprovalStep } = require('aws-cdk-lib/pipelines');

const testingStage = pipeline.addStage(new MyPipelineAppStage(this, 'testing', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));

testingStage.addPost(new ManualApprovalStep('approval'));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># from aws_cdk.pipelines import ManualApprovalStep

testing_stage = pipeline.add_stage(MyPipelineAppStage(self, "testing",
    env=cdk.Environment(account="111111111111", region="eu-west-1")))

testing_stage.add_post(ManualApprovalStep('approval'))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// import software.amazon.awscdk.pipelines.StageDeployment;
// import software.amazon.awscdk.pipelines.ManualApprovalStep;

StageDeployment testingStage =
        pipeline.addStage(new MyPipelineAppStage(this, "test", StageProps.builder()
                .env(Environment.builder()
                        .account("111111111111")
                        .region("eu-west-1")
                        .build())
                .build()));

testingStage.addPost(new ManualApprovalStep("approval"));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var testingStage = pipeline.AddStage(new MyPipelineAppStage(this, "test", new StageProps
{
    Env = new Environment
    {
        Account = "111111111111", Region = "eu-west-1"
    }
}));

testingStage.AddPost(new ManualApprovalStep("approval"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add stages to a  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.pipelines.Wave.html">Wave</a> to deploy them in parallel, for example when deploying a stage to multiple accounts or Regions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const wave = pipeline.addWave('wave');
wave.addStage(new MyApplicationStage(this, 'MyAppEU', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));
wave.addStage(new MyApplicationStage(this, 'MyAppUS', {
  env: { account: '111111111111', region: 'us-west-1' }
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const wave = pipeline.addWave('wave');
wave.addStage(new MyApplicationStage(this, 'MyAppEU', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));
wave.addStage(new MyApplicationStage(this, 'MyAppUS', {
  env: { account: '111111111111', region: 'us-west-1' }
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">wave = pipeline.add_wave("wave")
wave.add_stage(MyApplicationStage(self, "MyAppEU",
    env=cdk.Environment(account="111111111111", region="eu-west-1")))
wave.add_stage(MyApplicationStage(self, "MyAppUS",
    env=cdk.Environment(account="111111111111", region="us-west-1")))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// import software.amazon.awscdk.pipelines.Wave;
final Wave wave = pipeline.addWave("wave");
wave.addStage(new MyPipelineAppStage(this, "MyAppEU", StageProps.builder()
        .env(Environment.builder()
                .account("111111111111")
                .region("eu-west-1")
                .build())
        .build()));
wave.addStage(new MyPipelineAppStage(this, "MyAppUS", StageProps.builder()
        .env(Environment.builder()
                .account("111111111111")
                .region("us-west-1")
                .build())
        .build()));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var wave = pipeline.AddWave("wave");
wave.AddStage(new MyPipelineAppStage(this, "MyAppEU", new StageProps
{
    Env = new Environment
    {
        Account = "111111111111", Region = "eu-west-1"
    }
}));
wave.AddStage(new MyPipelineAppStage(this, "MyAppUS", new StageProps
{
    Env = new Environment
    {
        Account = "111111111111", Region = "us-west-1"
    }
}));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-validation">14.6.5. Testing deployments</h4>
<div class="paragraph">
<p>You can add steps to a CDK Pipeline to validate the deployments that you&#8217;re performing. For example, you can use the CDK Pipeline library&#8217;s  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.pipelines.ShellStep.html">ShellStep</a></code> to perform tasks such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Trying to access a newly deployed Amazon API Gateway backed by a Lambda function</p>
</li>
<li>
<p>Checking a setting of a deployed resource by issuing an AWS CLI command</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In its simplest form, adding validation actions looks like this:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// stage was returned by pipeline.addStage

stage.addPost(new ShellStep("validate", {
  commands: ['../tests/validate.sh'],
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// stage was returned by pipeline.addStage

stage.addPost(new ShellStep("validate", {
  commands: ['../tests/validate.sh'],
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># stage was returned by pipeline.add_stage

stage.add_post(ShellStep("validate",
  commands=[''../tests/validate.sh'']
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// stage was returned by pipeline.addStage

stage.addPost(ShellStep.Builder.create("validate")
        .commands(Arrays.asList("'../tests/validate.sh'"))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// stage was returned by pipeline.addStage

stage.AddPost(new ShellStep("validate", new ShellStepProps
{
    Commands = new string[] { "'../tests/validate.sh'" }
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many AWS CloudFormation deployments result in the generation of resources with unpredictable names. Because of this, CDK Pipelines provide a way to read AWS CloudFormation outputs after a deployment. This makes it possible to pass (for example) the generated URL of a load balancer to a test action.</p>
</div>
<div class="paragraph">
<p>To use outputs, expose the <code>CfnOutput</code> object you&#8217;re interested in. Then, pass it in a step&#8217;s <code>envFromCfnOutputs</code> property to make it available as an environment variable within that step.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// given a stack lbStack that exposes a load balancer construct as loadBalancer
this.loadBalancerAddress = new cdk.CfnOutput(lbStack, 'LbAddress', {
  value: `https://${lbStack.loadBalancer.loadBalancerDnsName}/`
});

// pass the load balancer address to a shell step
stage.addPost(new ShellStep("lbaddr", {
  envFromCfnOutputs: {lb_addr: lbStack.loadBalancerAddress},
  commands: ['echo $lb_addr']
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// given a stack lbStack that exposes a load balancer construct as loadBalancer
this.loadBalancerAddress = new cdk.CfnOutput(lbStack, 'LbAddress', {
  value: `https://${lbStack.loadBalancer.loadBalancerDnsName}/`
});

// pass the load balancer address to a shell step
stage.addPost(new ShellStep("lbaddr", {
  envFromCfnOutputs: {lb_addr: lbStack.loadBalancerAddress},
  commands: ['echo $lb_addr']
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># given a stack lb_stack that exposes a load balancer construct as load_balancer
self.load_balancer_address = cdk.CfnOutput(lb_stack, "LbAddress",
    value=f"https://{lb_stack.load_balancer.load_balancer_dns_name}/")

# pass the load balancer address to a shell step
stage.add_post(ShellStep("lbaddr",
    env_from_cfn_outputs={"lb_addr": lb_stack.load_balancer_address}
    commands=["echo $lb_addr"]))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// given a stack lbStack that exposes a load balancer construct as loadBalancer
loadBalancerAddress = CfnOutput.Builder.create(lbStack, "LbAddress")
                            .value(String.format("https://%s/",
                                    lbStack.loadBalancer.loadBalancerDnsName))
                            .build();

stage.addPost(ShellStep.Builder.create("lbaddr")
    .envFromCfnOutputs(     // Map.of requires Java 9 or later
        java.util.Map.of("lbAddr", loadBalancerAddress))
    .commands(Arrays.asList("echo $lbAddr"))
    .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// given a stack lbStack that exposes a load balancer construct as loadBalancer
loadBalancerAddress = new CfnOutput(lbStack, "LbAddress", new CfnOutputProps
{
    Value = string.Format("https://{0}/", lbStack.loadBalancer.LoadBalancerDnsName)
});

stage.AddPost(new ShellStep("lbaddr", new ShellStepProps
{
    EnvFromCfnOutputs = new Dictionary&lt;string, CfnOutput&gt;
    {
        {  "lbAddr", loadBalancerAddress }
    },
    Commands = new string[] { "echo $lbAddr" }
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write simple validation tests right in the  <code>ShellStep</code>, but this approach becomes unwieldy when the test is more than a few lines. For more complex tests, you can bring additional files (such as complete shell scripts, or programs in other languages) into the <code>ShellStep</code> via the <code>inputs</code> property. The inputs can be any step that has an output, including a source (such as a GitHub repo) or another <code>ShellStep</code>.</p>
</div>
<div class="paragraph">
<p>Bringing in files from the source repository is appropriate if the files are directly usable in the test (for example, if they are themselves executable). In this example, we declare our GitHub repo as <code>source</code> (rather than instantiating it inline as part of the <code>CodePipeline</code>). Then, we pass this fileset to both the pipeline and the validation test.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const source = CodePipelineSource.gitHub('OWNER/REPO', 'main');

const pipeline = new CodePipeline(this, 'Pipeline', {
  pipelineName: 'MyPipeline',
  synth: new ShellStep('Synth', {
    input: source,
    commands: ['npm ci', 'npm run build', 'npx cdk synth']
  })
});

const stage = pipeline.addStage(new MyPipelineAppStage(this, 'test', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));

stage.addPost(new ShellStep('validate', {
  input: source,
  commands: ['sh ../tests/validate.sh']
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const source = CodePipelineSource.gitHub('OWNER/REPO', 'main');

const pipeline = new CodePipeline(this, 'Pipeline', {
  pipelineName: 'MyPipeline',
  synth: new ShellStep('Synth', {
    input: source,
    commands: ['npm ci', 'npm run build', 'npx cdk synth']
  })
});

const stage = pipeline.addStage(new MyPipelineAppStage(this, 'test', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));

stage.addPost(new ShellStep('validate', {
  input: source,
  commands: ['sh ../tests/validate.sh']
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">source   = CodePipelineSource.git_hub("OWNER/REPO", "main")

pipeline =  CodePipeline(self, "Pipeline",
                pipeline_name="MyPipeline",
                synth=ShellStep("Synth",
                    input=source,
                    commands=["npm install -g aws-cdk",
                        "python -m pip install -r requirements.txt",
                        "cdk synth"]))

stage = pipeline.add_stage(MyApplicationStage(self, "test",
            env=cdk.Environment(account="111111111111", region="eu-west-1")))

stage.add_post(ShellStep("validate", input=source,
    commands=["sh ../tests/validate.sh"],
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final CodePipelineSource source = CodePipelineSource.gitHub("OWNER/REPO", "main");

final CodePipeline pipeline = CodePipeline.Builder.create(this, "pipeline")
        .pipelineName("MyPipeline")
        .synth(ShellStep.Builder.create("Synth")
                .input(source)
                .commands(Arrays.asList("npm install -g aws-cdk", "cdk synth"))
                .build())
        .build();

final StageDeployment stage =
        pipeline.addStage(new MyPipelineAppStage(this, "test", StageProps.builder()
                .env(Environment.builder()
                        .account("111111111111")
                        .region("eu-west-1")
                        .build())
                .build()));

stage.addPost(ShellStep.Builder.create("validate")
        .input(source)
        .commands(Arrays.asList("sh ../tests/validate.sh"))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var source = CodePipelineSource.GitHub("OWNER/REPO", "main");

var pipeline = new CodePipeline(this, "pipeline", new CodePipelineProps
{
    PipelineName = "MyPipeline",
    Synth = new ShellStep("Synth", new ShellStepProps
    {
        Input = source,
        Commands = new string[] { "npm install -g aws-cdk", "cdk synth" }
    })
});

var stage = pipeline.AddStage(new MyPipelineAppStage(this, "test", new StageProps
{
    Env = new Environment
    {
        Account = "111111111111", Region = "eu-west-1"
    }
}));

stage.AddPost(new ShellStep("validate", new ShellStepProps
{
    Input = source,
    Commands = new string[] { "sh ../tests/validate.sh" }
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Getting the additional files from the synth step is appropriate if your tests need to be compiled, which is done as part of synthesis.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const synthStep = new ShellStep('Synth', {
  input: CodePipelineSource.gitHub('OWNER/REPO', 'main'),
  commands: ['npm ci', 'npm run build', 'npx cdk synth'],
});

const pipeline = new CodePipeline(this, 'Pipeline', {
  pipelineName: 'MyPipeline',
  synth: synthStep
});

const stage = pipeline.addStage(new MyPipelineAppStage(this, 'test', {
  env: { account: '111111111111', region: 'eu-west-1' }
}));

// run a script that was transpiled from TypeScript during synthesis
stage.addPost(new ShellStep('validate', {
  input: synthStep,
  commands: ['node tests/validate.js']
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const synthStep = new ShellStep('Synth', {
  input: CodePipelineSource.gitHub('OWNER/REPO', 'main'),
  commands: ['npm ci', 'npm run build', 'npx cdk synth'],
});

const pipeline = new CodePipeline(this, 'Pipeline', {
  pipelineName: 'MyPipeline',
  synth: synthStep
});

const stage = pipeline.addStage(new MyPipelineAppStage(this, "test", {
  env: { account: "111111111111", region: "eu-west-1" }
}));

// run a script that was transpiled from TypeScript during synthesis
stage.addPost(new ShellStep('validate', {
  input: synthStep,
  commands: ['node tests/validate.js']
}));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">synth_step = ShellStep("Synth",
                input=CodePipelineSource.git_hub("OWNER/REPO", "main"),
                commands=["npm install -g aws-cdk",
                  "python -m pip install -r requirements.txt",
                  "cdk synth"])

pipeline   = CodePipeline(self, "Pipeline",
                pipeline_name="MyPipeline",
                synth=synth_step)

stage = pipeline.add_stage(MyApplicationStage(self, "test",
            env=cdk.Environment(account="111111111111", region="eu-west-1")))

# run a script that was compiled during synthesis
stage.add_post(ShellStep("validate",
    input=synth_step,
    commands=["node test/validate.js"],
))</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">final ShellStep synth = ShellStep.Builder.create("Synth")
                            .input(CodePipelineSource.gitHub("OWNER/REPO", "main"))
                            .commands(Arrays.asList("npm install -g aws-cdk", "cdk synth"))
                            .build();

final CodePipeline pipeline = CodePipeline.Builder.create(this, "pipeline")
        .pipelineName("MyPipeline")
        .synth(synth)
        .build();

final StageDeployment stage =
        pipeline.addStage(new MyPipelineAppStage(this, "test", StageProps.builder()
                .env(Environment.builder()
                        .account("111111111111")
                        .region("eu-west-1")
                        .build())
                .build()));

stage.addPost(ShellStep.Builder.create("validate")
        .input(synth)
        .commands(Arrays.asList("node ./tests/validate.js"))
        .build());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">var synth = new ShellStep("Synth", new ShellStepProps
{
    Input = CodePipelineSource.GitHub("OWNER/REPO", "main"),
    Commands = new string[] { "npm install -g aws-cdk", "cdk synth" }
});

var pipeline = new CodePipeline(this, "pipeline", new CodePipelineProps
{
    PipelineName = "MyPipeline",
    Synth = synth
});

var stage = pipeline.AddStage(new MyPipelineAppStage(this, "test", new StageProps
{
    Env = new Environment
    {
        Account = "111111111111", Region = "eu-west-1"
    }
}));

stage.AddPost(new ShellStep("validate", new ShellStepProps
{
    Input = synth,
    Commands = new string[] { "node ./tests/validate.js" }
}));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-security">14.6.6. Security notes</h4>
<div class="paragraph">
<p>Any form of continuous delivery has inherent security risks. Under the AWS  <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">Shared Responsibility Model</a>, you are responsible for the security of your information in the AWS Cloud. The CDK Pipelines library gives you a head start by incorporating secure defaults and modeling best practices.</p>
</div>
<div class="paragraph">
<p>However, by its very nature, a library that needs a high level of access to fulfill its intended purpose cannot assure complete security. There are many attack vectors outside of AWS and your organization.</p>
</div>
<div class="paragraph">
<p>In particular, keep in mind the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Be mindful of the software you depend on. Vet all third-party software you run in your pipeline, because it can change the infrastructure that gets deployed.</p>
</li>
<li>
<p>Use dependency locking to prevent accidental upgrades. CDK Pipelines respects <code class="path">package-lock.json</code> and  <code class="path">yarn.lock</code> to make sure that your dependencies are the ones you expect.</p>
</li>
<li>
<p>CDK Pipelines runs on resources created in your own account, and the configuration of those resources is controlled by developers submitting code through the pipeline. Therefore, CDK Pipelines by itself cannot protect against malicious developers trying to bypass compliance checks. If your threat model includes developers writing CDK code, you should have external compliance mechanisms in place like <a href="https://aws.amazon.com/blogs/mt/proactively-keep-resources-secure-and-compliant-with-aws-cloudformation-hooks/">AWS CloudFormation Hooks</a> (preventive) or <a href="https://aws.amazon.com/config/">AWS Config</a> (reactive) that the AWS CloudFormation Execution Role does not have permissions to disable.</p>
</li>
<li>
<p>Credentials for production environments should be short-lived. After bootstrapping and initial provisioning, there is no need for developers to have account credentials at all. Changes can be deployed through the pipeline. Reduce the possibility of credentials leaking by not needing them in the first place.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pipeline-troubleshooting">14.6.7. Troubleshooting</h4>
<div class="paragraph">
<p>The following issues are commonly encountered while getting started with CDK Pipelines.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Pipeline: Internal Failure</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE_FAILED  | AWS::CodePipeline::Pipeline | Pipeline/Pipeline
Internal Failure</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Check your GitHub access token. It might be missing, or might not have the permissions to access the repository.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Key: Policy contains a statement with one or more invalid principals</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE_FAILED | AWS::KMS::Key | Pipeline/Pipeline/ArtifactsBucketEncryptionKey
Policy contains a statement with one or more invalid principals.</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>One of the target environments has not been bootstrapped with the new bootstrap stack. Make sure all your target environments are bootstrapped.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Stack is in ROLLBACK_COMPLETE state and can not be updated.</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>Stack`STACK_NAME`is in ROLLBACK_COMPLETE state and can not be updated. (Service:
AmazonCloudFormation; Status Code: 400; Error Code: ValidationError; Request
ID: ...)</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>The stack failed its previous deployment and is in a non-retryable state. Delete the stack from the AWS CloudFormation console and retry the deployment.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="build-containers">14.7. Build and deploy container image assets in CDK apps</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>When you build container image assets with the AWS Cloud Development Kit (AWS CDK), <code class="noloc">Docker</code> is utilized by default to perform these actions. If you want to use a different container management tool, you can replace  <code class="noloc">Docker</code> through the  <code>CDK_DOCKER</code> environment variable.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>When you build container image assets with the AWS Cloud Development Kit (AWS CDK),  <code class="noloc">Docker</code> is utilized by default to perform these actions. If you want to use a different container management tool, you can replace  <code class="noloc">Docker</code> through the  <code>CDK_DOCKER</code> environment variable.</p>
</div>
<div class="sect3">
<h4 id="build-containers-intro-example">14.7.1. Example: Build and publish a container image asset with the AWS CDK</h4>
<div class="paragraph">
<p>The following is a simple example of an AWS CDK app that builds and publishes a container asset to Amazon Elastic Container Registry (Amazon ECR) using  <code class="noloc">Docker</code> by default:</p>
</div>
<div class="paragraph">
<p><strong>Project structure</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">my-cdk-app/
├── lib/
│   ├── my-stack.ts
│   └── docker/
│       ├── Dockerfile
│       └── app/
│           └── index.js
├── bin/
│   └── my-cdk-app.ts
├── package.json
├── tsconfig.json
└── cdk.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code class="noloc">Dockerfile</code>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-auto" data-lang="auto">FROM public.ecr.aws/lambda/nodejs:16

# Copy application code
COPY app/ /var/task/

# (Optional) Install dependencies
# RUN npm install

# The AWS Lambda Node.js base image looks for index.handler by default</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Application code</strong>:</p>
</div>
<div class="paragraph">
<p>In <code class="path">lib/docker/app/index.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">console.log("Hello from inside the container!");</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CDK stack</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as ecr_assets from 'aws-cdk-lib/aws-ecr-assets';

export class MyStack extends cdk.Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Define a Docker image asset
    const dockerImageAsset = new ecr_assets.DockerImageAsset(this, 'MyDockerImage', {
      directory: 'lib/docker', // Path to the directory containing the Dockerfile
    });

    // Output the ECR URI
    new cdk.CfnOutput(this, 'ECRImageUri', {
      value: dockerImageAsset.imageUri,
    });
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CDK app</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import * as cdk from 'aws-cdk-lib';
import { MyStack } from '../lib/my-stack';

const app = new cdk.App();
new MyStack(app, 'MyStack');</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run  <code>cdk deploy</code>, the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>) does the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Build the <code class="noloc">Docker</code> image</strong> – Run <code>docker build</code> locally based on the <code class="path">Dockerfile</code> in the specified directory (<code class="path">lib/docker</code>).</p>
</li>
<li>
<p><strong>Tag the image</strong> – Run <code>docker tag</code> to tag the built image with a unique hash, based on the image contents.</p>
</li>
<li>
<p><strong>Publish to Amazon ECR</strong> – Run <code>docker push</code> to publish the container image to an Amazon ECR repository. This repository must already exist. It is created during the default bootstrapping process.</p>
</li>
<li>
<p><strong>Output the Image URI</strong> – After a successful deployment, the Amazon ECR URI of the published container image is output in your command prompt. This is the URI of our <code class="noloc">Docker</code> image in Amazon ECR.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="build-container-replace">14.7.2. How to replace  <code class="noloc">Docker</code> with another container management tool</h4>
<div class="paragraph">
<p>Use the  <code>CDK_DOCKER</code> environment variable to specify the path to the binary of your replacement container management tool. The following is an example of replacing <code class="noloc">Docker</code> with  <code class="noloc">Finch</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-auto" data-lang="auto">$ which finch
/usr/local/bin/finch # Locate the path to the binary

$ export CDK_DOCKER='/usr/local/bin/finch' # Set the environment variable

$ cdk deploy # Deploy using the replacement</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aliasing or linking is not supported. To replace  <code class="noloc">Docker</code>, you must use the  <code>CDK_DOCKER</code> environment variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-container-supported">14.7.3. Supported  <code class="noloc">Docker</code> drop-in replacement engines</h4>
<div class="paragraph">
<p><code class="noloc">Finch</code> is supported, although there may be some  <code class="noloc">Docker</code> features that are unavailable or may work differently as the tool evolves. For more information on Finch, see  <a href="https://aws.amazon.com/blogs/opensource/ready-for-flight-announcing-finch-1-0-ga/">Ready for Flight: Announcing Finch 1.0 GA!</a> in the <em>AWS Open Source Blog</em>.</p>
</div>
<div class="paragraph">
<p>Other container management tools may work. The CDK doesn&#8217;t check which <code class="noloc">Docker</code> replacement you are using to determine if it&#8217;s supported. If the tool has equivalent  <code class="noloc">Docker</code> commands and behaves similarly, it should work.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="deploy-troubleshoot">14.8. Troubleshoot AWS CDK deployments</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Troubleshoot common issues when deploying AWS Cloud Development Kit (AWS CDK) applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Troubleshoot common issues when deploying AWS Cloud Development Kit (AWS CDK) applications.</p>
</div>
<div class="sect3">
<h4 id="deploy-troubleshoot-sp">14.8.1. Incorrect service principals are being created at deployment</h4>
<div class="paragraph">
<p>When deploying CDK applications that contain AWS Identity and Access Management (IAM) roles with service principals, you find that incorrect domains for the service principals are being created.</p>
</div>
<div class="paragraph">
<p>The following is a basic example of creating an IAM role that can be assumed by Amazon CloudWatch Logs using its service principal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import * as iam from 'aws-cdk-lib/aws-iam';
import { Construct } from 'constructs';

export class MyCdkProjectStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Create an IAM role for CloudWatch Logs to assume
    const cloudWatchLogsRole = new iam.Role(this, 'CloudWatchLogsRole', {
      assumedBy: new iam.ServicePrincipal('logs.amazonaws.com'), // This is for CloudWatch Logs
      managedPolicies: [
        iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSCloudWatchLogsFullAccess')
      ]
    });

    // You can then use this role in other constructs or configurations where CloudWatch Logs needs to assume a role
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you deploy this stack, a service principal named  <code>logs.amazonaws.com</code> should be created. In most cases, AWS services use the following naming for service principals: <code>[replaceable]</code>service<code>.amazonaws.com</code>.</p>
</div>
<div class="sect4">
<h5 id="deploy-troubleshoot-sp-causes">Common causes</h5>
<div class="paragraph">
<p>If you are using a version of the AWS CDK older than v2.150.0, you may encounter this bug. In older AWS CDK versions, the naming of service principals were not standardized, which could lead to the creation of service principals with incorrect domains.</p>
</div>
<div class="paragraph">
<p>In AWS CDK v2.51.0, a fix was implemented by standardizing all automatically created service principals to use <code><code class="replaceable">service</code>.amazonaws.com</code> when possible. This fix was available by allowing the <code>@aws-cdk/aws-iam:standardizedServicePrincipals</code> feature flag.</p>
</div>
<div class="paragraph">
<p>Starting in AWS CDK v2.150.0, this became default behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="deploy-troubleshoot-sp-resolution">Resolution</h5>
<div class="paragraph">
<p>Upgrade to AWS CDK v2.150.0 or newer.</p>
</div>
<div class="paragraph">
<p>If you are unable to upgrade to AWS CDK v2.150.0 or newer, you must upgrade to at least v2.51.0 or newer. Then, allow the following feature flag in your <code class="path">cdk.json</code> file:  <code>@aws-cdk/aws-iam:standardizedServicePrincipals</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="toolkit-library">15. Perform programmatic actions using the CDK Toolkit Library</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) Toolkit Library enables you to perform AWS CDK actions requiring programmatic access on AWS.</p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>[.banner.info]CDK Toolkit Library is in developer preview and is subject to change.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="toolkit-library-intro">15.1. What is the CDK Toolkit Library Library?</h3>
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) Toolkit Library enables you to perform AWS CDK actions requiring programmatic access on AWS. You can use the CDK Toolkit Library to implement actions such as bootstrapping, synthesizing, and deploying through code rather than CDK  <code class="noloc">CLI</code> commands. With this library, you can create custom tools, build specialized  <code class="noloc">CLI</code> applications, and integrate CDK programmatic access capabilities into your development workflows.</p>
</div>
<div class="paragraph">
<p>The following is an example, that installs the CDK Toolkit Library and uses it to deploy a cloud assembly of your CDK app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Toolkit } from '@aws-cdk/toolkit-lib'; // Install the CDK Toolkit Library

const cdk = new Toolkit(); // Create a CDK Toolkit instance

// ...

// Implement a deployment
await cdk.deploy(cloudAssembly, {
   deploymentMethod: { method: "direct" }, // Configure deployment options
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="toolkit-library-gs">15.2. Get started with the CDK Toolkit Library</h3>
<div class="paragraph">
<p><em>To get started, see the  <code class="path"><a href="https://www.npmjs.com/package/@aws-cdk/toolkit-lib">ReadMe</a></code> in the  @aws-cdk/toolkit-lib</em><code>npm</code> package.</p>
</div>
<div class="paragraph">
<p>For API reference information, see the <a href="https://docs.aws.amazon.com/cdk/api/toolkit-lib/">CDK Toolkit Library API reference</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="testing">16. Test AWS CDK applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the AWS CDK, your infrastructure can be as testable as any other code you write. You can test in the cloud and locally. This topic addresses how to test in the cloud. For guidance on local testing see  <a href="#testing-locally">Locally test and build AWS CDK applications with the AWS SAM CLI</a>. The standard approach to testing AWS CDK apps uses the AWS CDK&#8217;s <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.assertions-readme.html">assertions</a> module and popular test frameworks like <a href="https://jestjs.io/">Jest</a> for TypeScript and JavaScript or <a href="https://docs.pytest.org/en/6.2.x/">Pytest</a> for Python.</p>
</div>
<div class="paragraph">
<p>There are two categories of tests that you can write for AWS CDK apps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fine-grained assertions</strong> test specific aspects of the generated AWS CloudFormation template, such as "this resource has this property with this value." These tests can detect regressions. They&#8217;re also useful when you&#8217;re developing new features using test-driven development. (You can write a test first, then make it pass by writing a correct implementation.) Fine-grained assertions are the most frequently used tests.</p>
</li>
<li>
<p><strong>Snapshot tests</strong> test the synthesized AWS CloudFormation template against a previously stored baseline template. Snapshot tests let you refactor freely, since you can be sure that the refactored code works exactly the same way as the original. If the changes were intentional, you can accept a new baseline for future tests. However, CDK upgrades can also cause synthesized templates to change, so you can&#8217;t rely only on snapshots to make sure that your implementation is correct.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Complete versions of the TypeScript, Python, and Java apps used as examples in this topic are  <a href="https://github.com/cdklabs/aws-cdk-testing-examples/">available on GitHub</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2 topic">
<h3 id="testing-locally">16.1. Locally test and build AWS CDK applications with the AWS SAM <code class="noloc">CLI</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>You can use AWS SAM to build and locally test your AWS CDK applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You can use the AWS SAM <code class="noloc">CLI</code> to locally test and build serverless applications defined using the AWS Cloud Development Kit (AWS CDK). Because the AWS SAM <code class="noloc">CLI</code> works within the AWS CDK project structure, you can still use the  <a href="#cli">AWS CDK CLI reference</a> for creating, modifying, and deploying your AWS CDK applications.</p>
</div>
<div class="paragraph">
<p>For details on using AWS SAM, see <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started.html">Getting started with AWS SAM</a> in the <em>AWS Serverless Application Model Developer Guide</em>.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3 topic">
<h4 id="testing-locally-getting-started">16.1.1. Getting started with locally testing</h4>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Getting Started documentation that provides the prerequisites for using AWS CDK with AWS SAM, and tutorial for building, locally testing, and deploying a simple AWS CDK application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This topic describes what you need to use the AWS SAM <code class="noloc">CLI</code> with AWS CDK applications, and it provides instructions for building and locally testing a simple AWS CDK application.</p>
</div>
<div class="sect4">
<h5 id="testing-locally-getting-started-prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>To test locally, you must install the AWS SAM <code class="noloc">CLI</code>. see  <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/getting_started.html">Install the AWS SAM CLI</a> for installation instructions.</p>
</div>
</div>
<div class="sect4">
<h5 id="testing-locally-getting-started-tutorial">Creating and locally testing an AWS CDK application</h5>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Learn how to use AWS SAM to download, build, and locally test a AWS CDK application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To locally test an AWS CDK application using the AWS SAM <code class="noloc">CLI</code>, you must have an AWS CDK application that contains a Lambda function. Use the following steps to create a basic AWS CDK application with a Lambda function. For more information, see  <a href="https://docs.aws.amazon.com/cdk/latest/guide/serverless_example.html">Creating a serverless application using the AWS CDK</a> in the <em>AWS Cloud Development Kit (AWS CDK) Developer Guide</em>.</p>
</div>
<div class="sect5">
<h6 id="testing-locally-getting-started-tutorial-init.title">Step 1: Create an AWS CDK application</h6>
<div class="paragraph">
<p>For this tutorial, initialize an AWS CDK application that uses TypeScript.</p>
</div>
<div class="paragraph">
<p>Command to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir cdk-sam-example
$ cd cdk-sam-example
$ cdk init app --language typescript</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="testing-locally-getting-started-tutorial-lambda.title">Step 2: Add a Lambda function to your application</h6>
<div class="paragraph">
<p>Replace the code in  <code class="path">lib/cdk-sam-example-stack.ts</code> with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import { Stack, StackProps } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as lambda from 'aws-cdk-lib/aws-lambda';

export class CdkSamExampleStack extends Stack {
  constructor(scope: Construct, id: string, props?: StackProps) {
    super(scope, id, props);

    new lambda.Function(this, 'MyFunction', {
      runtime: lambda.Runtime.PYTHON_3_12,
      handler: 'app.lambda_handler',
      code: lambda.Code.fromAsset('./my_function'),
    });
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="testing-locally-getting-started-tutorial-code.title">Step 3: Add your Lambda function code</h6>
<div class="paragraph">
<p>Create a directory named  <code class="path">my_function</code>. In that directory, create a file named  <code class="path">app.py</code>.</p>
</div>
<div class="paragraph">
<p>Command to run:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OS and Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir my_function
$ cd my_function
$ touch app.py</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir my_function
$ cd my_function
$ type nul &gt; app.py</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PowerShell</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir my_function
$ cd my_function
$ New-Item -Path "app.py”</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following code to  <code class="path">app.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>def lambda_handler(event, context):
    return "Hello from SAM and the CDK!"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="testing-locally-getting-started-tutorial-function.title">Step 4: Test your Lambda function</h6>
<div class="paragraph">
<p>You can use the AWS SAM <code class="noloc">CLI</code> to locally invoke a Lambda function that you define in an AWS CDK application. To do this, you need the function construct identifier and the path to your synthesized AWS CloudFormation template.</p>
</div>
<div class="paragraph">
<p>Run the following command to go back to the <code>lib</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$  cd ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Command to run:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$  cdk synth --no-staging</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$  sam local invoke MyFunction --no-event -t ./cdk.out/CdkSamExampleStack.template.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example output:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>Invoking app.lambda_handler (python3.9)

START RequestId: 5434c093-7182-4012-9b06-635011cac4f2 Version: $LATEST
"Hello from SAM and the CDK!"
END RequestId: 5434c093-7182-4012-9b06-635011cac4f2
REPORT RequestId: 5434c093-7182-4012-9b06-635011cac4f2	Init Duration: 0.32 ms	Duration: 177.47 ms	Billed Duration: 178 ms	Memory Size: 128 MB	Max Memory Used: 128 MB</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3 topic">
<h4 id="testing-locally-with-sam-cli">16.1.2. Local testing AWS CDK applications with AWS SAM</h4>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use the <strong class="command">sam local</strong> command to locally test AWS CDK applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You can use the AWS SAM <code class="noloc">CLI</code> to locally test your AWS CDK applications by running the following commands from the project root directory of your AWS CDK application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-local-invoke.html">sam local invoke</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-local-start-api.html">sam local start-api</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-local-start-lambda.html">sam local start-lambda</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you run any of the  <strong class="command">sam local</strong> commands with a AWS CDK application, you must run <code>cdk synth</code>.</p>
</div>
<div class="paragraph">
<p>When running <strong class="command">sam local invoke</strong> you need the function construct identifier that you want to invoke, and the path to your synthesized AWS CloudFormation template. If your application uses nested stacks, to resolve naming conflicts, you also need the stack name where the function is defined.</p>
</div>
<div class="paragraph">
<p><strong>Usage:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># Invoke the function FUNCTION_IDENTIFIER declared in the stack STACK_NAME
$  sam local invoke [OPTIONS] [STACK_NAME/FUNCTION_IDENTIFIER]

# Start all APIs declared in the AWS CDK application
$  sam local start-api -t ./cdk.out/CdkSamExampleStack.template.json [OPTIONS]

# Start a local endpoint that emulates AWS Lambda
$  sam local start-lambda -t ./cdk.out/CdkSamExampleStack.template.json [OPTIONS]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="testing-cdk-applications-examples">Example</h5>
<div class="paragraph">
<p>Consider stacks and functions that are declared with the following sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>app = new HelloCdkStack(app, "HelloCdkStack",
   ...
)
class HelloCdkStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    ...
    new lambda.Function(this, 'MyFunction', {
        ...
    });

    new HelloCdkNestedStack(this, 'HelloNestedStack' ,{
        ...
    });
}

class HelloCdkNestedStack extends cdk.NestedStack {
  constructor(scope: Construct, id: string, props?: cdk.NestedStackProps) {
    ...
    new lambda.Function(this, 'MyFunction', {
        ...
    });
    new lambda.Function(this, 'MyNestedFunction', {
        ...
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following commands locally invokes the Lambda functions defined in example presented above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># Invoke MyFunction from the HelloCdkStack
$ sam local invoke -t ./cdk.out/HelloCdkStack.template.json MyFunction</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># Invoke MyNestedFunction from the HelloCdkNestedStack
$ sam local invoke -t ./cdk.out/HelloCdkStack.template.json MyNestedFunction</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># Invoke MyFunction from the HelloCdkNestedStack
$ sam local invoke -t ./cdk.out/HelloCdkStack.template.json HelloNestedStack/MyFunction</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3 topic">
<h4 id="testing-locally-build-with-sam-cli">16.1.3. Building AWS CDK applications with AWS SAM</h4>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use the <strong class="command">sam build</strong> command to build AWS CDK applications.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS SAM <code class="noloc">CLI</code> provides support for building Lambda functions and layers defined in your AWS CDK application with  <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-cli-command-reference-sam-build.html">sam build</a>.</p>
</div>
<div class="paragraph">
<p>For Lambda functions that use zip artifacts, run <code>cdk synth</code> before you run <code>sam local</code> commands. <code>sam build</code> isn&#8217;t required.</p>
</div>
<div class="paragraph">
<p>If your AWS CDK application uses functions with the image type, run <code>cdk synth</code> and then run <code>sam build</code> before you run <code>sam local</code> commands. When you run <code>sam build</code>, AWS SAM doesn&#8217;t build Lambda functions or layers that use runtime-specific constructs, for example, <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda_nodejs.NodejsFunction.html">NodejsFunction</a>. <code>sam build</code> doesn&#8217;t support <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.BundlingOptions.html">bundled assets</a>.</p>
</div>
<div class="sect4">
<h5 id="testing-locally-build-with-sam-cli-examples">Example</h5>
<div class="paragraph">
<p>Running the following command from the AWS CDK project root directory builds the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ sam build -t ./cdk.out/CdkSamExampleStack.template.json</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-getting-started">16.2. Getting started</h3>
<div class="paragraph">
<p>To illustrate how to write these tests, we&#8217;ll create a stack that contains an AWS Step Functions state machine and an AWS Lambda function. The Lambda function is subscribed to an Amazon SNS topic and simply forwards the message to the state machine.</p>
</div>
<div class="paragraph">
<p>First, create an empty CDK application project using the CDK Toolkit and installing the libraries we&#8217;ll need. The constructs we&#8217;ll use are all in the main CDK package, which is a default dependency in projects created with the CDK Toolkit. However, you must install your testing framework.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir state-machine &amp;&amp; cd state-machine
cdk init --language=typescript
npm install --save-dev jest @types/jest</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Create a directory for your tests.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir test</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Edit the project&#8217;s  <code class="path">package.json</code> to tell NPM how to run Jest, and to tell Jest what kinds of files to collect. The necessary changes are as follows.</p>
</div>
<div class="paragraph">
<p>+
<strong> Add a new <code>test</code> key to the <code>scripts</code> section
</strong> Add Jest and its types to the <code>devDependencies</code> section
** Add a new <code>jest</code> top-level key with a <code>moduleFileExtensions</code> declaration</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>These changes are shown in the following outline. Place the new text where indicated in  <code class="path">package.json</code>. The "&#8230;&#8203;" placeholders indicate existing parts of the file that should not be changed.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  ...
  "scripts": {
    ...
    "test": "jest"
  },
  "devDependencies": {
    ...
    "@types/jest": "^24.0.18",
    "jest": "^24.9.0"
  },
  "jest": {
    "moduleFileExtensions": ["js"]
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir state-machine &amp;&amp; cd state-machine
$ cdk init --language=javascript
$ npm install --save-dev jest</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Create a directory for your tests.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir test</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Edit the project&#8217;s  <code class="path">package.json</code> to tell NPM how to run Jest, and to tell Jest what kinds of files to collect. The necessary changes are as follows.</p>
</div>
<div class="paragraph">
<p>+
<strong> Add a new <code>test</code> key to the <code>scripts</code> section
</strong> Add Jest to the <code>devDependencies</code> section
** Add a new <code>jest</code> top-level key with a <code>moduleFileExtensions</code> declaration</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>These changes are shown in the following outline. Place the new text where indicated in  <code class="path">package.json</code>. The "&#8230;&#8203;" placeholders indicate existing parts of the file that shouldn&#8217;t be changed.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  ...
  "scripts": {
    ...
    "test": "jest"
  },
  "devDependencies": {
    ...
    "jest": "^24.9.0"
  },
  "jest": {
    "moduleFileExtensions": ["js"]
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir state-machine &amp;&amp; cd state-machine
$ cdk init --language=python
$ source .venv/bin/activate # On Windows, run '.\venv\Scripts\activate' instead
$ python -m pip install -r requirements.txt
$ python -m pip install -r requirements-dev.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir state-machine &amp;&amp; cd-state-machine
$ cdk init --language=java</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Open the project in your preferred Java IDE. (In Eclipse, use  <strong>File</strong> &gt;  <strong>Import</strong> &gt; Existing Maven Projects.)</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mkdir state-machine &amp;&amp; cd-state-machine
$ cdk init --language=csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Open  <code class="path">src\StateMachine.sln</code> in Visual Studio.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Right-click the solution in Solution Explorer and choose <strong>Add</strong> &gt;  <strong>New Project</strong>. Search for MSTest C# and add an  <strong>MSTest Test Project</strong> for C#. (The default name  <code class="path">TestProject1</code>is fine.)</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Right-click <code class="path">TestProject1</code> and choose  <strong>Add</strong> &gt;  <strong>Project Reference</strong>, and add the  <code class="path">StateMachine</code> project as a reference.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing-app">16.3. The example stack</h3>
<div class="paragraph">
<p>Here&#8217;s the stack that will be tested in this topic. As we&#8217;ve previously described, it contains a Lambda function and a Step Functions state machine, and accepts one or more Amazon SNS topics. The Lambda function is subscribed to the Amazon SNS topics and forwards them to the state machine.</p>
</div>
<div class="paragraph">
<p>You don&#8217;t have to do anything special to make the app testable. In fact, this CDK stack is not different in any important way from the other example stacks in this Guide.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Place the following code in <code class="path">lib/state-machine-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from "aws-cdk-lib";
import * as sns from "aws-cdk-lib/aws-sns";
import * as sns_subscriptions from "aws-cdk-lib/aws-sns-subscriptions";
import * as lambda from "aws-cdk-lib/aws-lambda";
import * as sfn from "aws-cdk-lib/aws-stepfunctions";
import { Construct } from "constructs";

export interface StateMachineStackProps extends cdk.StackProps {
  readonly topics: sns.Topic[];
}

export class StateMachineStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props: StateMachineStackProps) {
    super(scope, id, props);

    // In the future this state machine will do some work...
    const stateMachine = new sfn.StateMachine(this, "StateMachine", {
      definition: new sfn.Pass(this, "StartState"),
    });

    // This Lambda function starts the state machine.
    const func = new lambda.Function(this, "LambdaFunction", {
      runtime: lambda.Runtime.NODEJS_18_X,
      handler: "handler",
      code: lambda.Code.fromAsset("./start-state-machine"),
      environment: {
        STATE_MACHINE_ARN: stateMachine.stateMachineArn,
      },
    });
    stateMachine.grantStartExecution(func);

    const subscription = new sns_subscriptions.LambdaSubscription(func);
    for (const topic of props.topics) {
      topic.addSubscription(subscription);
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Place the following code in <code class="path">lib/state-machine-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require("aws-cdk-lib");
const sns = require("aws-cdk-lib/aws-sns");
const sns_subscriptions = require("aws-cdk-lib/aws-sns-subscriptions");
const lambda = require("aws-cdk-lib/aws-lambda");
const sfn = require("aws-cdk-lib/aws-stepfunctions");

class StateMachineStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // In the future this state machine will do some work...
    const stateMachine = new sfn.StateMachine(this, "StateMachine", {
      definition: new sfn.Pass(this, "StartState"),
    });

    // This Lambda function starts the state machine.
    const func = new lambda.Function(this, "LambdaFunction", {
      runtime: lambda.Runtime.NODEJS_18_X,
      handler: "handler",
      code: lambda.Code.fromAsset("./start-state-machine"),
      environment: {
        STATE_MACHINE_ARN: stateMachine.stateMachineArn,
      },
    });
    stateMachine.grantStartExecution(func);

    const subscription = new sns_subscriptions.LambdaSubscription(func);
    for (const topic of props.topics) {
      topic.addSubscription(subscription);
    }
  }
}

module.exports = { StateMachineStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Place the following code in <code class="path">state_machine/state_machine_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from typing import List

import aws_cdk.aws_lambda as lambda_
import aws_cdk.aws_sns as sns
import aws_cdk.aws_sns_subscriptions as sns_subscriptions
import aws_cdk.aws_stepfunctions as sfn
import aws_cdk as cdk

class StateMachineStack(cdk.Stack):
    def __init__(
        self,
        scope: cdk.Construct,
        construct_id: str,
        *,
        topics: List[sns.Topic],
        **kwargs
    ) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # In the future this state machine will do some work...
        state_machine = sfn.StateMachine(
            self, "StateMachine", definition=sfn.Pass(self, "StartState")
        )

        # This Lambda function starts the state machine.
        func = lambda_.Function(
            self,
            "LambdaFunction",
            runtime=lambda_.Runtime.NODEJS_18_X,
            handler="handler",
            code=lambda_.Code.from_asset("./start-state-machine"),
            environment={
                "STATE_MACHINE_ARN": state_machine.state_machine_arn,
            },
        )
        state_machine.grant_start_execution(func)

        subscription = sns_subscriptions.LambdaSubscription(func)
        for topic in topics:
            topic.add_subscription(subscription)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package software.amazon.samples.awscdkassertionssamples;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.amazon.awscdk.services.lambda.Code;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;
import software.amazon.awscdk.services.sns.ITopicSubscription;
import software.amazon.awscdk.services.sns.Topic;
import software.amazon.awscdk.services.sns.subscriptions.LambdaSubscription;
import software.amazon.awscdk.services.stepfunctions.Pass;
import software.amazon.awscdk.services.stepfunctions.StateMachine;

import java.util.Collections;
import java.util.List;

public class StateMachineStack extends Stack {
    public StateMachineStack(final Construct scope, final String id, final List&lt;Topic&gt; topics) {
        this(scope, id, null, topics);
    }

    public StateMachineStack(final Construct scope, final String id, final StackProps props, final List&lt;Topic&gt; topics) {
        super(scope, id, props);

        // In the future this state machine will do some work...
        final StateMachine stateMachine = StateMachine.Builder.create(this, "StateMachine")
                .definition(new Pass(this, "StartState"))
                .build();

        // This Lambda function starts the state machine.
        final Function func = Function.Builder.create(this, "LambdaFunction")
                .runtime(Runtime.NODEJS_18_X)
                .handler("handler")
                .code(Code.fromAsset("./start-state-machine"))
                .environment(Collections.singletonMap("STATE_MACHINE_ARN", stateMachine.getStateMachineArn()))
                .build();
        stateMachine.grantStartExecution(func);

        final ITopicSubscription subscription = new LambdaSubscription(func);
        for (final Topic topic : topics) {
            topic.addSubscription(subscription);
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.Lambda;
using Amazon.CDK.AWS.StepFunctions;
using Amazon.CDK.AWS.SNS;
using Amazon.CDK.AWS.SNS.Subscriptions;
using Constructs;

using System.Collections.Generic;

namespace AwsCdkAssertionSamples
{
    public class StateMachineStackProps : StackProps
    {
        public Topic[] Topics;
    }

    public class StateMachineStack : Stack
    {

        internal StateMachineStack(Construct scope, string id, StateMachineStackProps props = null) : base(scope, id, props)
        {
            // In the future this state machine will do some work...
            var stateMachine = new StateMachine(this, "StateMachine", new StateMachineProps
            {
                Definition = new Pass(this, "StartState")
            });

            // This Lambda function starts the state machine.
            var func = new Function(this, "LambdaFunction", new FunctionProps
            {
                Runtime = Runtime.NODEJS_18_X,
                Handler = "handler",
                Code = Code.FromAsset("./start-state-machine"),
                Environment = new Dictionary&lt;string, string&gt;
                {
                    { "STATE_MACHINE_ARN", stateMachine.StateMachineArn }
                }
            });
            stateMachine.GrantStartExecution(func);

            foreach (Topic topic in props?.Topics ?? new Topic[0])
            {
                var subscription = new LambdaSubscription(func);
            }

        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll modify the app&#8217;s main entry point so that we don&#8217;t actually instantiate our stack. We don&#8217;t want to accidentally deploy it. Our tests will create an app and an instance of the stack for testing. This is a useful tactic when combined with test-driven development: make sure that the stack passes all tests before you enable deployment.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">bin/state-machine.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import * as cdk from "aws-cdk-lib";

const app = new cdk.App();

// Stacks are intentionally not created here -- this application isn't meant to
// be deployed.</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">bin/state-machine.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
const cdk = require("aws-cdk-lib");

const app = new cdk.App();

// Stacks are intentionally not created here -- this application isn't meant to
// be deployed.</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">app.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os

import aws_cdk  as cdk

app = cdk.App()

# Stacks are intentionally not created here -- this application isn't meant to
# be deployed.

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package software.amazon.samples.awscdkassertionssamples;

import software.amazon.awscdk.App;

public class SampleApp {
    public static void main(final String[] args) {
        App app = new App();

        // Stacks are intentionally not created here -- this application isn't meant to be deployed.

        app.synth();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;

namespace AwsCdkAssertionSamples
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            var app = new App();

            // Stacks are intentionally not created here -- this application isn't meant to be deployed.

            app.Synth();
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-lambda">16.4. The Lambda function</h3>
<div class="paragraph">
<p>Our example stack includes a Lambda function that starts our state machine. We must provide the source code for this function so the CDK can bundle and deploy it as part of creating the Lambda function resource.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the folder <code class="path">start-state-machine</code> in the app&#8217;s main directory.</p>
</li>
<li>
<p>In this folder, create at least one file. For example, you can save the following code in <code class="path">start-state-machines/index.js</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.handler = async function (event, context) {
	return 'hello world';
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, any file will work, since we won&#8217;t actually be deploying the stack.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="testing-running-tests">16.5. Running tests</h3>
<div class="paragraph">
<p>For reference, here are the commands you use to run tests in your AWS CDK app. These are the same commands that you&#8217;d use to run the tests in any project using the same testing framework. For languages that require a build step, include that to make sure that your tests have compiled.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">$ tsc &amp;&amp; npm test</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">$ npm test</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ python -m pytest</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ mvn compile &amp;&amp; mvn test</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Build your solution (F6) to discover the tests, then run the tests (<strong>Test</strong> &gt;  <strong>Run All Tests</strong>). To choose which tests to run, open Test Explorer (<strong>Test</strong> &gt;  <strong>Test Explorer</strong>).</p>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ dotnet test src</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="testing-fine-grained">16.6. Fine-grained assertions</h3>
<div class="paragraph">
<p>The first step for testing a stack with fine-grained assertions is to synthesize the stack, because we&#8217;re writing assertions against the generated AWS CloudFormation template.</p>
</div>
<div class="paragraph">
<p>Our <code>StateMachineStackStack</code> requires that we pass it the Amazon SNS topic to be forwarded to the state machine. So in our test, we&#8217;ll create a separate stack to contain the topic.</p>
</div>
<div class="paragraph">
<p>Ordinarily, when writing a CDK app, you can subclass <code>Stack</code> and instantiate the Amazon SNS topic in the stack&#8217;s constructor. In our test, we instantiate <code>Stack</code> directly, then pass this stack as the <code>Topic</code>'s scope, attaching it to the stack. This is functionally equivalent and less verbose. It also helps make stacks that are used only in tests "look different" from the stacks that you intend to deploy.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Capture, Match, Template } from "aws-cdk-lib/assertions";
import * as cdk from "aws-cdk-lib";
import * as sns from "aws-cdk-lib/aws-sns";
import { StateMachineStack } from "../lib/state-machine-stack";

describe("StateMachineStack", () =&gt; {
  test("synthesizes the way we expect", () =&gt; {
    const app = new cdk.App();

    // Since the StateMachineStack consumes resources from a separate stack
    // (cross-stack references), we create a stack for our SNS topics to live
    // in here. These topics can then be passed to the StateMachineStack later,
    // creating a cross-stack reference.
    const topicsStack = new cdk.Stack(app, "TopicsStack");

    // Create the topic the stack we're testing will reference.
    const topics = [new sns.Topic(topicsStack, "Topic1", {})];

    // Create the StateMachineStack.
    const stateMachineStack = new StateMachineStack(app, "StateMachineStack", {
      topics: topics, // Cross-stack reference
    });

    // Prepare the stack for assertions.
    const template = Template.fromStack(stateMachineStack);


}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Capture, Match, Template } = require("aws-cdk-lib/assertions");
const cdk = require("aws-cdk-lib");
const sns = require("aws-cdk-lib/aws-sns");
const { StateMachineStack } = require("../lib/state-machine-stack");

describe("StateMachineStack", () =&gt; {
  test("synthesizes the way we expect", () =&gt; {
    const app = new cdk.App();

    // Since the StateMachineStack consumes resources from a separate stack
    // (cross-stack references), we create a stack for our SNS topics to live
    // in here. These topics can then be passed to the StateMachineStack later,
    // creating a cross-stack reference.
    const topicsStack = new cdk.Stack(app, "TopicsStack");

    // Create the topic the stack we're testing will reference.
    const topics = [new sns.Topic(topicsStack, "Topic1", {})];

    // Create the StateMachineStack.
    const StateMachineStack = new StateMachineStack(app, "StateMachineStack", {
      topics: topics, // Cross-stack reference
    });

    // Prepare the stack for assertions.
    const template = Template.fromStack(stateMachineStack);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import aws_sns as sns
import aws_cdk as cdk
from aws_cdk.assertions import Template

from app.state_machine_stack import StateMachineStack

def test_synthesizes_properly():
    app = cdk.App()

    # Since the StateMachineStack consumes resources from a separate stack
    # (cross-stack references), we create a stack for our SNS topics to live
    # in here. These topics can then be passed to the StateMachineStack later,
    # creating a cross-stack reference.
    topics_stack = cdk.Stack(app, "TopicsStack")

    # Create the topic the stack we're testing will reference.
    topics = [sns.Topic(topics_stack, "Topic1")]

    # Create the StateMachineStack.
    state_machine_stack = StateMachineStack(
        app, "StateMachineStack", topics=topics  # Cross-stack reference
    )

    # Prepare the stack for assertions.
    template = Template.from_stack(state_machine_stack)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package software.amazon.samples.awscdkassertionssamples;

import org.junit.jupiter.api.Test;
import software.amazon.awscdk.assertions.Capture;
import software.amazon.awscdk.assertions.Match;
import software.amazon.awscdk.assertions.Template;
import software.amazon.awscdk.App;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.services.sns.Topic;

import java.util.*;

import static org.assertj.core.api.Assertions.assertThat;

public class StateMachineStackTest {
    @Test
    public void testSynthesizesProperly() {
        final App app = new App();

        // Since the StateMachineStack consumes resources from a separate stack (cross-stack references), we create a stack
        // for our SNS topics to live in here. These topics can then be passed to the StateMachineStack later, creating a
        // cross-stack reference.
        final Stack topicsStack = new Stack(app, "TopicsStack");

        // Create the topic the stack we're testing will reference.
        final List&lt;Topic&gt; topics = Collections.singletonList(Topic.Builder.create(topicsStack, "Topic1").build());

        // Create the StateMachineStack.
        final StateMachineStack stateMachineStack = new StateMachineStack(
                app,
                "StateMachineStack",
                topics // Cross-stack reference
        );

        // Prepare the stack for assertions.
        final Template template = Template.fromStack(stateMachineStack)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Microsoft.VisualStudio.TestTools.UnitTesting;

using Amazon.CDK;
using Amazon.CDK.AWS.SNS;
using Amazon.CDK.Assertions;
using AwsCdkAssertionSamples;

using ObjectDict = System.Collections.Generic.Dictionary&lt;string, object&gt;;
using StringDict = System.Collections.Generic.Dictionary&lt;string, string&gt;;

namespace TestProject1
{
    [TestClass]
    public class StateMachineStackTest
    {
        [TestMethod]
        public void TestMethod1()
        {
            var app = new App();

            // Since the StateMachineStack consumes resources from a separate stack (cross-stack references), we create a stack
            // for our SNS topics to live in here. These topics can then be passed to the StateMachineStack later, creating a
            // cross-stack reference.
            var topicsStack = new Stack(app, "TopicsStack");

            // Create the topic the stack we're testing will reference.
            var topics = new Topic[] { new Topic(topicsStack, "Topic1") };

            // Create the StateMachineStack.
            var StateMachineStack = new StateMachineStack(app, "StateMachineStack", new StateMachineStackProps
            {
                Topics = topics
            });

            // Prepare the stack for assertions.
            var template = Template.FromStack(stateMachineStack);

            // test will go here
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can assert that the Lambda function and the Amazon SNS subscription were created.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Assert it creates the function with the correct properties...
    template.hasResourceProperties("AWS::Lambda::Function", {
      Handler: "handler",
      Runtime: "nodejs14.x",
    });

    // Creates the subscription...
    template.resourceCountIs("AWS::SNS::Subscription", 1);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Assert it creates the function with the correct properties...
    template.hasResourceProperties("AWS::Lambda::Function", {
      Handler: "handler",
      Runtime: "nodejs14.x",
    });

    // Creates the subscription...
    template.resourceCountIs("AWS::SNS::Subscription", 1);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># Assert that we have created the function with the correct properties
    template.has_resource_properties(
        "AWS::Lambda::Function",
        {
            "Handler": "handler",
            "Runtime": "nodejs14.x",
        },
    )

    # Assert that we have created a subscription
    template.resource_count_is("AWS::SNS::Subscription", 1)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        // Assert it creates the function with the correct properties...
        template.hasResourceProperties("AWS::Lambda::Function", Map.of(
                "Handler", "handler",
                "Runtime", "nodejs14.x"
        ));

         // Creates the subscription...
        template.resourceCountIs("AWS::SNS::Subscription", 1);</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">            // Prepare the stack for assertions.
            var template = Template.FromStack(stateMachineStack);

            // Assert it creates the function with the correct properties...
            template.HasResourceProperties("AWS::Lambda::Function", new StringDict {
                { "Handler", "handler"},
                { "Runtime", "nodejs14x" }
            });

            // Creates the subscription...
            template.ResourceCountIs("AWS::SNS::Subscription", 1);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our Lambda function test asserts that two particular properties of the function resource have specific values. By default, the  <code>hasResourceProperties</code> method performs a partial match on the resource&#8217;s properties as given in the synthesized CloudFormation template. This test requires that the provided properties exist and have the specified values, but the resource can also have other properties, which are not tested.</p>
</div>
<div class="paragraph">
<p>Our Amazon SNS assertion asserts that the synthesized template contains a subscription, but nothing about the subscription itself. We included this assertion mainly to illustrate how to assert on resource counts. The <code>Template</code> class offers more specific methods to write assertions against the <code>Resources</code>, <code>Outputs</code>, and <code>Mapping</code> sections of the CloudFormation template.</p>
</div>
<div class="sect3">
<h4 id="testing-fine-grained-matchers">16.6.1. Matchers</h4>
<div class="paragraph">
<p>The default partial matching behavior of  <code>hasResourceProperties</code> can be changed using <em>matchers</em> from the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.assertions.Match.html#methods">Match</a> class.</p>
</div>
<div class="paragraph">
<p>Matchers range from lenient (<code>Match.anyValue</code>) to strict (<code>Match.objectEquals</code>). They can be nested to apply different matching methods to different parts of the resource properties. Using <code>Match.objectEquals</code> and <code>Match.anyValue</code> together, for example, we can test the state machine&#8217;s IAM role more fully, while not requiring specific values for properties that may change.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Fully assert on the state machine's IAM role with matchers.
    template.hasResourceProperties(
      "AWS::IAM::Role",
      Match.objectEquals({
        AssumeRolePolicyDocument: {
          Version: "2012-10-17",
          Statement: [
            {
              Action: "sts:AssumeRole",
              Effect: "Allow",
              Principal: {
                Service: {
                  "Fn::Join": [
                    "",
                    ["states.", Match.anyValue(), ".amazonaws.com"],
                  ],
                },
              },
            },
          ],
        },
      })
    );</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Fully assert on the state machine's IAM role with matchers.
    template.hasResourceProperties(
      "AWS::IAM::Role",
      Match.objectEquals({
        AssumeRolePolicyDocument: {
          Version: "2012-10-17",
          Statement: [
            {
              Action: "sts:AssumeRole",
              Effect: "Allow",
              Principal: {
                Service: {
                  "Fn::Join": [
                    "",
                    ["states.", Match.anyValue(), ".amazonaws.com"],
                  ],
                },
              },
            },
          ],
        },
      })
    );</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk.assertions import Match

    # Fully assert on the state machine's IAM role with matchers.
    template.has_resource_properties(
        "AWS::IAM::Role",
        Match.object_equals(
            {
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "states.",
                                            Match.any_value(),
                                            ".amazonaws.com",
                                        ],
                                    ],
                                },
                            },
                        },
                    ],
                },
            }
        ),
    )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        // Fully assert on the state machine's IAM role with matchers.
        template.hasResourceProperties("AWS::IAM::Role", Match.objectEquals(
                Collections.singletonMap("AssumeRolePolicyDocument", Map.of(
                        "Version", "2012-10-17",
                        "Statement", Collections.singletonList(Map.of(
                                "Action", "sts:AssumeRole",
                                "Effect", "Allow",
                                "Principal", Collections.singletonMap(
                                        "Service", Collections.singletonMap(
                                                "Fn::Join", Arrays.asList(
                                                        "",
                                                        Arrays.asList("states.", Match.anyValue(), ".amazonaws.com")
                                                )
                                        )
                                )
                        ))
                ))
        ));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">            // Fully assert on the state machine's IAM role with matchers.
            template.HasResource("AWS::IAM::Role", Match.ObjectEquals(new ObjectDict
            {
                { "AssumeRolePolicyDocument", new ObjectDict
                    {
                        { "Version", "2012-10-17" },
                        { "Action", "sts:AssumeRole" },
                        { "Principal", new ObjectDict
                            {
                                { "Version", "2012-10-17" },
                                { "Statement", new object[]
                                    {
                                        new ObjectDict {
                                            { "Action", "sts:AssumeRole" },
                                            { "Effect", "Allow" },
                                            { "Principal", new ObjectDict
                                                {
                                                    { "Service", new ObjectDict
                                                        {
                                                            { "", new object[]
                                                                { "states", Match.AnyValue(), ".amazonaws.com" }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many CloudFormation resources include serialized JSON objects represented as strings. The  <code>Match.serializedJson()</code> matcher can be used to match properties inside this JSON.</p>
</div>
<div class="paragraph">
<p>For example, Step Functions state machines are defined using a string in the JSON-based <a href="https://docs.aws.amazon.com/step-functions/latest/dg/concepts-amazon-states-language.html">Amazon States Language</a>. We&#8217;ll use <code>Match.serializedJson()</code> to make sure that our initial state is the only step. Again, we&#8217;ll use nested matchers to apply different kinds of matching to different parts of the object.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Assert on the state machine's definition with the Match.serializedJson()
    // matcher.
    template.hasResourceProperties("AWS::StepFunctions::StateMachine", {
      DefinitionString: Match.serializedJson(
        // Match.objectEquals() is used implicitly, but we use it explicitly
        // here for extra clarity.
        Match.objectEquals({
          StartAt: "StartState",
          States: {
            StartState: {
              Type: "Pass",
              End: true,
              // Make sure this state doesn't provide a next state -- we can't
              // provide both Next and set End to true.
              Next: Match.absent(),
            },
          },
        })
      ),
    });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Assert on the state machine's definition with the Match.serializedJson()
    // matcher.
    template.hasResourceProperties("AWS::StepFunctions::StateMachine", {
      DefinitionString: Match.serializedJson(
        // Match.objectEquals() is used implicitly, but we use it explicitly
        // here for extra clarity.
        Match.objectEquals({
          StartAt: "StartState",
          States: {
            StartState: {
              Type: "Pass",
              End: true,
              // Make sure this state doesn't provide a next state -- we can't
              // provide both Next and set End to true.
              Next: Match.absent(),
            },
          },
        })
      ),
    });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">    # Assert on the state machine's definition with the serialized_json matcher.
    template.has_resource_properties(
        "AWS::StepFunctions::StateMachine",
        {
            "DefinitionString": Match.serialized_json(
                # Match.object_equals() is the default, but specify it here for clarity
                Match.object_equals(
                    {
                        "StartAt": "StartState",
                        "States": {
                            "StartState": {
                                "Type": "Pass",
                                "End": True,
                                # Make sure this state doesn't provide a next state --
                                # we can't provide both Next and set End to true.
                                "Next": Match.absent(),
                            },
                        },
                    }
                )
            ),
        },
    )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        // Assert on the state machine's definition with the Match.serializedJson() matcher.
        template.hasResourceProperties("AWS::StepFunctions::StateMachine", Collections.singletonMap(
                "DefinitionString", Match.serializedJson(
                        // Match.objectEquals() is used implicitly, but we use it explicitly here for extra clarity.
                        Match.objectEquals(Map.of(
                                "StartAt", "StartState",
                                "States", Collections.singletonMap(
                                        "StartState", Map.of(
                                                "Type", "Pass",
                                                "End", true,
                                                // Make sure this state doesn't provide a next state -- we can't provide
                                                // both Next and set End to true.
                                                "Next", Match.absent()
                                        )
                                )
                        ))
                )
        ));</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">            // Assert on the state machine's definition with the Match.serializedJson() matcher
            template.HasResourceProperties("AWS::StepFunctions::StateMachine", new ObjectDict
            {
                { "DefinitionString", Match.SerializedJson(
                    // Match.objectEquals() is used implicitly, but we use it explicitly here for extra clarity.
                    Match.ObjectEquals(new ObjectDict {
                        { "StartAt", "StartState" },
                        { "States", new ObjectDict
                        {
                            { "StartState", new ObjectDict {
                                { "Type", "Pass" },
                                { "End", "True" },
                                // Make sure this state doesn't provide a next state -- we can't provide
                                // both Next and set End to true.
                                { "Next", Match.Absent() }
                            }}
                        }}
                    })
                )}});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="testing-fine-grained-capture">16.6.2. Capturing</h4>
<div class="paragraph">
<p>It&#8217;s often useful to test properties to make sure they follow specific formats, or have the same value as another property, without needing to know their exact values ahead of time. The  <code>assertions</code> module provides this capability in its <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.assertions.Capture.html">Capture</a> class.</p>
</div>
<div class="paragraph">
<p>By specifying a <code>Capture</code> instance in place of a value in <code>hasResourceProperties</code>, that value is retained in the <code>Capture</code> object. The actual captured value can be retrieved using the object&#8217;s <code>as</code> methods, including <code>asNumber()</code>, <code>asString()</code>, and <code>asObject</code>, and subjected to test. Use <code>Capture</code> with a matcher to specify the exact location of the value to be captured within the resource&#8217;s properties, including serialized JSON properties.</p>
</div>
<div class="paragraph">
<p>The following example tests to make sure that the starting state of our state machine has a name beginning with <code>Start</code>. It also tests that this state is present within the list of states in the machine.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Capture some data from the state machine's definition.
    const startAtCapture = new Capture();
    const statesCapture = new Capture();
    template.hasResourceProperties("AWS::StepFunctions::StateMachine", {
      DefinitionString: Match.serializedJson(
        Match.objectLike({
          StartAt: startAtCapture,
          States: statesCapture,
        })
      ),
    });

    // Assert that the start state starts with "Start".
    expect(startAtCapture.asString()).toEqual(expect.stringMatching(/^Start/));

    // Assert that the start state actually exists in the states object of the
    // state machine definition.
    expect(statesCapture.asObject()).toHaveProperty(startAtCapture.asString());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    // Capture some data from the state machine's definition.
    const startAtCapture = new Capture();
    const statesCapture = new Capture();
    template.hasResourceProperties("AWS::StepFunctions::StateMachine", {
      DefinitionString: Match.serializedJson(
        Match.objectLike({
          StartAt: startAtCapture,
          States: statesCapture,
        })
      ),
    });

    // Assert that the start state starts with "Start".
    expect(startAtCapture.asString()).toEqual(expect.stringMatching(/^Start/));

    // Assert that the start state actually exists in the states object of the
    // state machine definition.
    expect(statesCapture.asObject()).toHaveProperty(startAtCapture.asString());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import re

    from aws_cdk.assertions import Capture

    # ...

    # Capture some data from the state machine's definition.
    start_at_capture = Capture()
    states_capture = Capture()
    template.has_resource_properties(
        "AWS::StepFunctions::StateMachine",
        {
            "DefinitionString": Match.serialized_json(
                Match.object_like(
                    {
                        "StartAt": start_at_capture,
                        "States": states_capture,
                    }
                )
            ),
        },
    )

    # Assert that the start state starts with "Start".
    assert re.match("^Start", start_at_capture.as_string())

    # Assert that the start state actually exists in the states object of the
    # state machine definition.
    assert start_at_capture.as_string() in states_capture.as_object()</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        // Capture some data from the state machine's definition.
        final Capture startAtCapture = new Capture();
        final Capture statesCapture = new Capture();
        template.hasResourceProperties("AWS::StepFunctions::StateMachine", Collections.singletonMap(
                "DefinitionString", Match.serializedJson(
                        Match.objectLike(Map.of(
                                "StartAt", startAtCapture,
                                "States", statesCapture
                        ))
                )
        ));

        // Assert that the start state starts with "Start".
        assertThat(startAtCapture.asString()).matches("^Start.+");

        // Assert that the start state actually exists in the states object of the state machine definition.
        assertThat(statesCapture.asObject()).containsKey(startAtCapture.asString());</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">            // Capture some data from the state machine's definition.
            var startAtCapture = new Capture();
            var statesCapture = new Capture();
            template.HasResourceProperties("AWS::StepFunctions::StateMachine", new ObjectDict
            {
                { "DefinitionString", Match.SerializedJson(
                    new ObjectDict
                    {
                        { "StartAt", startAtCapture },
                        { "States", statesCapture }
                    }
                )}
            });

            Assert.IsTrue(startAtCapture.ToString().StartsWith("Start"));
            Assert.IsTrue(statesCapture.AsObject().ContainsKey(startAtCapture.ToString()));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-snapshot">16.7. Snapshot tests</h3>
<div class="paragraph">
<p>In  <em>snapshot testing</em>, you compare the entire synthesized CloudFormation template against a previously stored baseline (often called a "master") template. Unlike fine-grained assertions, snapshot testing isn&#8217;t useful in catching regressions. This is because snapshot testing applies to the entire template, and things besides code changes can cause small (or not-so-small) differences in synthesis results. These changes may not even affect your deployment, but they will still cause a snapshot test to fail.</p>
</div>
<div class="paragraph">
<p>For example, you might update a CDK construct to incorporate a new best practice, which can cause changes to the synthesized resources or how they&#8217;re organized. Alternatively, you might update the CDK Toolkit to a version that reports additional metadata. Changes to context values can also affect the synthesized template.</p>
</div>
<div class="paragraph">
<p>Snapshot tests can be of great help in refactoring, though, as long as you hold constant all other factors that might affect the synthesized template. You will know immediately if a change you made has unintentionally changed the template. If the change is intentional, simply accept the new template as the baseline.</p>
</div>
<div class="paragraph">
<p>For example, if we have this <code>DeadLetterQueue</code> construct:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">export class DeadLetterQueue extends sqs.Queue {
  public readonly messagesInQueueAlarm: cloudwatch.IAlarm;

  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Add the alarm
    this.messagesInQueueAlarm = new cloudwatch.Alarm(this, 'Alarm', {
      alarmDescription: 'There are messages in the Dead Letter Queue',
      evaluationPeriods: 1,
      threshold: 1,
      metric: this.metricApproximateNumberOfMessagesVisible(),
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">class DeadLetterQueue extends sqs.Queue {

  constructor(scope, id) {
    super(scope, id);

    // Add the alarm
    this.messagesInQueueAlarm = new cloudwatch.Alarm(this, 'Alarm', {
      alarmDescription: 'There are messages in the Dead Letter Queue',
      evaluationPeriods: 1,
      threshold: 1,
      metric: this.metricApproximateNumberOfMessagesVisible(),
    });
  }
}

module.exports = { DeadLetterQueue }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">class DeadLetterQueue(sqs.Queue):
    def __init__(self, scope: Construct, id: str):
        super().__init__(scope, id)

        self.messages_in_queue_alarm = cloudwatch.Alarm(
            self,
            "Alarm",
            alarm_description="There are messages in the Dead Letter Queue.",
            evaluation_periods=1,
            threshold=1,
            metric=self.metric_approximate_number_of_messages_visible(),
        )</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DeadLetterQueue extends Queue {
    private final IAlarm messagesInQueueAlarm;

    public DeadLetterQueue(@NotNull Construct scope, @NotNull String id) {
        super(scope, id);

        this.messagesInQueueAlarm = Alarm.Builder.create(this, "Alarm")
                .alarmDescription("There are messages in the Dead Letter Queue.")
                .evaluationPeriods(1)
                .threshold(1)
                .metric(this.metricApproximateNumberOfMessagesVisible())
                .build();
    }

    public IAlarm getMessagesInQueueAlarm() {
        return messagesInQueueAlarm;
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">namespace AwsCdkAssertionSamples
{
    public class DeadLetterQueue : Queue
    {
        public IAlarm messagesInQueueAlarm;

        public DeadLetterQueue(Construct scope, string id) : base(scope, id)
        {
            messagesInQueueAlarm = new Alarm(this, "Alarm", new AlarmProps
            {
                AlarmDescription = "There are messages in the Dead Letter Queue.",
                EvaluationPeriods = 1,
                Threshold = 1,
                Metric = this.MetricApproximateNumberOfMessagesVisible()
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can test it like this:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Match, Template } from "aws-cdk-lib/assertions";
import * as cdk from "aws-cdk-lib";
import { DeadLetterQueue } from "../lib/dead-letter-queue";

describe("DeadLetterQueue", () =&gt; {
  test("matches the snapshot", () =&gt; {
    const stack = new cdk.Stack();
    new DeadLetterQueue(stack, "DeadLetterQueue");

    const template = Template.fromStack(stack);
    expect(template.toJSON()).toMatchSnapshot();
  });
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Match, Template } = require("aws-cdk-lib/assertions");
const cdk = require("aws-cdk-lib");
const { DeadLetterQueue } = require("../lib/dead-letter-queue");

describe("DeadLetterQueue", () =&gt; {
  test("matches the snapshot", () =&gt; {
    const stack = new cdk.Stack();
    new DeadLetterQueue(stack, "DeadLetterQueue");

    const template = Template.fromStack(stack);
    expect(template.toJSON()).toMatchSnapshot();
  });
});</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk_lib as cdk
from aws_cdk_lib.assertions import Match, Template

from app.dead_letter_queue import DeadLetterQueue

def snapshot_test():
    stack = cdk.Stack()
    DeadLetterQueue(stack, "DeadLetterQueue")

    template = Template.from_stack(stack)
    assert template.to_json() == snapshot</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package software.amazon.samples.awscdkassertionssamples;

import org.junit.jupiter.api.Test;
import au.com.origin.snapshots.Expect;
import software.amazon.awscdk.assertions.Match;
import software.amazon.awscdk.assertions.Template;
import software.amazon.awscdk.Stack;

import java.util.Collections;
import java.util.Map;

public class DeadLetterQueueTest {
    @Test
    public void snapshotTest() {
        final Stack stack = new Stack();
        new DeadLetterQueue(stack, "DeadLetterQueue");

        final Template template = Template.fromStack(stack);
        expect.toMatchSnapshot(template.toJSON());
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Microsoft.VisualStudio.TestTools.UnitTesting;

using Amazon.CDK;
using Amazon.CDK.Assertions;
using AwsCdkAssertionSamples;

using ObjectDict = System.Collections.Generic.Dictionary&lt;string, object&gt;;
using StringDict = System.Collections.Generic.Dictionary&lt;string, string&gt;;

namespace TestProject1
{
    [TestClass]
    public class StateMachineStackTest

    [TestClass]
    public class DeadLetterQueueTest
    {
    [TestMethod]
        public void SnapshotTest()
        {
            var stack = new Stack();
            new DeadLetterQueue(stack, "DeadLetterQueue");

            var template = Template.FromStack(stack);

            return Verifier.Verify(template.ToJSON());
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-tips">16.8. Tips for tests</h3>
<div class="paragraph">
<p>Remember, your tests will live just as long as the code they test, and they will be read and modified just as often. Therefore, it pays to take a moment to consider how best to write them.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t copy and paste setup lines or common assertions. Instead, refactor this logic into fixtures or helper functions. Use good names that reflect what each test actually tests.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t try to do too much in one test. Preferably, a test should test one and only one behavior. If you accidentally break that behavior, exactly one test should fail, and the name of the test should tell you what failed. This is more an ideal to be striven for, however; sometimes you will unavoidably (or inadvertently) write tests that test more than one behavior. Snapshot tests are, for reasons we&#8217;ve already described, especially prone to this problem, so use them sparingly.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="cli">17. AWS CDK <code class="noloc">CLI</code> reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The AWS Cloud Development Kit (AWS CDK) Command Line Interface (AWS CDK  <code class="noloc">CLI</code>), also known as the CDK  <code class="noloc">Toolkit</code>, is the primary tool for interacting with your AWS CDK app. It executes your app, interrogates the application model you defined, and produces and deploys the AWS CloudFormation templates generated by the AWS CDK. It also provides other features useful for creating and working with AWS CDK projects. This topic contains information about common use cases of the CDK  <code class="noloc">CLI</code>.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> is installed with the Node Package Manager. In most cases, we recommend installing it globally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm install -g aws-cdk             # install latest version
npm install -g aws-cdk@X.YY.Z      # install specific version</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you regularly work with multiple versions of the AWS CDK, consider installing a matching version of the CDK  <code class="noloc">CLI</code> in individual CDK projects. To do this, omit  <code>-g</code> from the <code>npm install</code> command. Then use <code>npx aws-cdk</code> to invoke it. This runs the local version if one exists, falling back to a global version if not.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="cli-commands">17.1. CDK <code class="noloc">CLI</code> commands</h3>
<div class="paragraph">
<p>All CDK  <code class="noloc">CLI</code> commands start with  <code>cdk</code>, which is followed by a subcommand (<code>list</code>, <code>synthesize</code>, <code>deploy</code>, etc.). Some subcommands have a shorter version (<code>ls</code>, <code>synth</code>, etc.) that is equivalent. Options and arguments follow the subcommand in any order.</p>
</div>
<div class="paragraph">
<p>For a description of all subcommands, options, and arguments, see <a href="#ref-cli-cmd">AWS CDK CLI command reference</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-options">17.2. Specify options and their values</h3>
<div class="paragraph">
<p>Command line options begin with two hyphens (<code>--</code>). Some frequently used options have single-letter synonyms that begin with a single hyphen (for example, <code>--app</code> has a synonym <code>-a</code>). The order of options in an CDK <code class="noloc">CLI</code> command is not important.</p>
</div>
<div class="paragraph">
<p>All options accept a value, which must follow the option name. The value may be separated from the name by white space or by an equals sign <code>=</code>. The following two options are equivalent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">--toolkit-stack-name MyBootstrapStack
--toolkit-stack-name=MyBootstrapStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some options are flags (Booleans). You may specify  <code>true</code> or <code>false</code> as their value. If you do not provide a value, the value is taken to be <code>true</code>. You may also prefix the option name with <code>no-</code> to imply <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># sets staging flag to true
--staging
--staging=true
--staging true

# sets staging flag to false
--no-staging
--staging=false
--staging false</code></pre>
</div>
</div>
<div class="paragraph">
<p>A few options, namely  <code>--context</code>, <code>--parameters</code>, <code>--plugin</code>, <code>--tags</code>, and <code>--trust</code>, may be specified more than once to specify multiple values. These are noted as having <code>[array]</code> type in the CDK <code class="noloc">CLI</code> help. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk bootstrap --tags costCenter=0123 --tags responsibleParty=jdoe</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-help">17.3. Built-in help</h3>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> has integrated help. You can see general help about the utility and a list of the provided subcommands by issuing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk --help</code></pre>
</div>
</div>
<div class="paragraph">
<p>To see help for a particular subcommand, for example  <code>deploy</code>, specify it before the <code>--help</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy --help</code></pre>
</div>
</div>
<div class="paragraph">
<p>Issue  <code>cdk version</code> to display the version of the CDK <code class="noloc">CLI</code>. Provide this information when requesting support.</p>
</div>
</div>
<div class="sect2">
<h3 id="version-reporting">17.4. Version reporting</h3>
<div class="paragraph">
<p>To gain insight into how the AWS CDK is used, the constructs used by AWS CDK applications are collected and reported by using a resource identified as  <code>AWS::CDK::Metadata</code>. To learn more, see <a href="#usage-data">Configure AWS CDK usage data reporting</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-auth">17.5. Authentication with AWS</h3>
<div class="paragraph">
<p>There are different ways in which you can configure programmatic access to AWS resources, depending on the environment and the AWS access available to you.</p>
</div>
<div class="paragraph">
<p>To choose your method of authentication and configure it for the CDK <code class="noloc">CLI</code>, see  <a href="#configure-access">Configure security credentials for the AWS CDK CLI</a>.</p>
</div>
<div class="paragraph">
<p>The recommended approach for new users developing locally, who are not given a method of authentication by their employer, is to set up AWS IAM Identity Center. This method includes installing the AWS CLI for ease of configuration and for regularly signing in to the AWS access portal. If you choose this method, your environment should contain the following elements after you complete the procedure for <a href="https://docs.aws.amazon.com/sdkref/latest/guide/access-sso.html">IAM Identity Center authentication</a> in the <em>AWS SDKs and Tools Reference Guide</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The AWS CLI, which you use to start an AWS access portal session before you run your application.</p>
</li>
<li>
<p>A <a href="https://docs.aws.amazon.com/sdkref/latest/guide/file-format.html">shared AWSconfig file</a> having a <code>[default]</code> profile with a set of configuration values that can be referenced from the AWS CDK. To find the location of this file, see <a href="https://docs.aws.amazon.com/sdkref/latest/guide/file-location.html">Location of the shared files</a> in the <em>AWS SDKs and Tools Reference Guide</em>.</p>
</li>
<li>
<p>The shared <code class="path">config</code> file sets the  <a href="https://docs.aws.amazon.com/sdkref/latest/guide/feature-region.html">region</a> setting. This sets the default AWS Region the AWS CDK and CDK <code class="noloc">CLI</code> use for AWS requests.</p>
</li>
<li>
<p>The CDK <code class="noloc">CLI</code> uses the profile&#8217;s  <a href="https://docs.aws.amazon.com/sdkref/latest/guide/feature-sso-credentials.html#feature-sso-credentials-profile">SSO token provider configuration</a> to acquire credentials before sending requests to AWS. The <code>sso_role_name</code> value, which is an IAM role connected to an IAM Identity Center permission set, should allow access to the AWS services used in your application.</p>
<div class="paragraph">
<p>The following sample <code>config</code> file shows a default profile set up with SSO token provider configuration. The profile&#8217;s <code>sso_session</code> setting refers to the named <a href="https://docs.aws.amazon.com/sdkref/latest/guide/file-format.html#section-session">sso-session section</a>. The <code>sso-session</code> section contains settings to initiate an AWS access portal session.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[default]
sso_session = my-sso
sso_account_id = 111122223333
sso_role_name = SampleRole
region = us-east-1
output = json

[sso-session my-sso]
sso_region = us-east-1
sso_start_url = https://provided-domain.awsapps.com/start
sso_registration_scopes = sso:account:access</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="accessportal">17.5.1. Start an AWS access portal session</h4>
<div class="paragraph">
<p>Before accessing AWS services, you need an active AWS access portal session for the CDK  <code class="noloc">CLI</code> to use IAM Identity Center authentication to resolve credentials. Depending on your configured session lengths, your access will eventually expire and the CDK  <code class="noloc">CLI</code> will encounter an authentication error. Run the following command in the AWS CLI to sign in to the AWS access portal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">aws sso login</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your SSO token provider configuration is using a named profile instead of the default profile, the command is  <code>aws sso login --profile [replaceable]</code>NAME````. Also specify this profile when issuing <strong class="command">cdk</strong> commands using the <strong class="command">--profile</strong> option or the <code>AWS_PROFILE</code> environment variable.</p>
</div>
<div class="paragraph">
<p>To test if you already have an active session, run the following AWS CLI command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">aws sts get-caller-identity</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response to this command should report the IAM Identity Center account and permission set configured in the shared  <code>config</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you already have an active AWS access portal session and run <code>aws sso login</code>, you will not be required to provide credentials.</p>
</div>
<div class="paragraph">
<p>The sign in process may prompt you to allow the AWS CLI access to your data. Since the AWS CLI is built on top of the SDK for Python, permission messages may contain variations of the <code>botocore</code> name.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-environment">17.6. Specify Region and other configuration</h3>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> needs to know the AWS Region that you&#8217;re deploying into and how to authenticate with AWS. This is needed for deployment operations and to retrieve context values during synthesis. Together, your account and Region make up the  <em>environment</em>.</p>
</div>
<div class="paragraph">
<p>Region may be specified using environment variables or in configuration files. These are the same variables and files used by other AWS tools such as the AWS CLI and the various AWS SDKs. The CDK <code class="noloc">CLI</code> looks for this information in the following order.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>AWS_DEFAULT_REGION</code> environment variable.</p>
</li>
<li>
<p>A named profile defined in the standard AWS <code class="path">config</code> file and specified using the  <code>--profile</code> option on <code>cdk</code> commands.</p>
</li>
<li>
<p>The <code>[default]</code> section of the standard AWS <code class="path">config</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Besides specifying AWS authentication and a Region in the  <code>[default]</code> section, you can also add one or more <code><code class="profile [replaceable">NAME</code>]</code> sections, where <code class="replaceable">NAME</code> is the name of the profile. For more information about named profiles, see <a href="https://docs.aws.amazon.com/sdkref/latest/guide/file-format.html">Shared config and credentials files</a> in the <em>AWS SDKs and Tools Reference Guide</em>.</p>
</div>
<div class="paragraph">
<p>The standard AWS <code class="path">config</code> file is located at  <code class="path">~/.aws/config</code> (macOS/Linux) or  <code class="path">%USERPROFILE%\.aws\config</code> (Windows). For details and alternate locations, see  <a href="https://docs.aws.amazon.com/sdkref/latest/guide/file-location.html">Location of the shared config and credentials files</a> in the <em>AWS SDKs and Tools Reference Guide</em></p>
</div>
<div class="paragraph">
<p>The environment that you specify in your AWS CDK app by using the stack&#8217;s <code>env</code> property is used during synthesis. It&#8217;s used to generate an environment-specific AWS CloudFormation template, and during deployment, it overrides the account or Region specified by one of the preceding methods. For more information, see <a href="#environments">Environments for the AWS CDK</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The AWS CDK uses credentials from the same source files as other AWS tools and SDKs, including the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html">AWS Command Line Interface</a>. However, the AWS CDK might behave somewhat differently from these tools. It uses the AWS SDK for JavaScript under the hood. For complete details on setting up credentials for the AWS SDK for JavaScript, see <a href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/setting-credentials.html">Setting credentials</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may optionally use the  <code>--role-arn</code> (or <code>-r</code>) option to specify the ARN of an IAM role that should be used for deployment. This role must be assumable by the AWS account being used.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-app-command">17.7. Specify the app command</h3>
<div class="paragraph">
<p>Many features of the CDK  <code class="noloc">CLI</code> require one or more AWS CloudFormation templates be synthesized, which in turn requires running your application. The AWS CDK supports programs written in a variety of languages. Therefore, it uses a configuration option to specify the exact command necessary to run your app. This option can be specified in two ways.</p>
</div>
<div class="paragraph">
<p>First, and most commonly, it can be specified using the <code>app</code> key inside the file <code class="path">cdk.json</code>. This is in the main directory of your AWS CDK project. The CDK  <code class="noloc">CLI</code> provides an appropriate command when creating a new project with  <code>cdk init</code>. Here is the <code class="path">cdk.json</code> from a fresh TypeScript project, for instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "npx ts-node bin/hello-cdk.ts"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> looks for  <code class="path">cdk.json</code> in the current working directory when attempting to run your app. Because of this, you might keep a shell open in your project&#8217;s main directory for issuing CDK  <code class="noloc">CLI</code> commands.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> also looks for the app key in  <code class="path">~/.cdk.json</code> (that is, in your home directory) if it can&#8217;t find it in  <code>./cdk.json</code>. Adding the app command here can be useful if you usually work with CDK code in the same language.</p>
</div>
<div class="paragraph">
<p>If you are in some other directory, or to run your app using a command other than the one in <code class="path">cdk.json</code>, use the  <code>--app</code> (or <code>-a</code>) option to specify it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk --app "npx ts-node bin/hello-cdk.ts" ls</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying, you may also specify a directory containing synthesized cloud assemblies, such as  <code class="path">cdk.out</code>, as the value of  <strong class="command">--app</strong>. The specified stacks are deployed from this directory; the app is not synthesized.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-stacks">17.8. Specify stacks</h3>
<div class="paragraph">
<p>Many CDK  <code class="noloc">CLI</code> commands (for example,  <code>cdk deploy</code>) work on stacks defined in your app. If your app contains only one stack, the CDK <code class="noloc">CLI</code> assumes you mean that one if you don&#8217;t specify a stack explicitly.</p>
</div>
<div class="paragraph">
<p>Otherwise, you must specify the stack or stacks you want to work with. You can do this by specifying the desired stacks by ID individually on the command line. Recall that the ID is the value specified by the second argument when you instantiate the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth PipelineStack LambdaStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also use wildcards to specify IDs that match a pattern.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>?</code> matches any single character</p>
</li>
<li>
<p><code>*</code> matches any number of characters (<code>\*</code> alone matches all stacks)</p>
</li>
<li>
<p><code>\**</code> matches everything in a hierarchy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may also use the  <strong class="command">--all</strong> option to specify all stacks.</p>
</div>
<div class="paragraph">
<p>If your app uses <a href="#cdk-pipeline">CDK Pipelines</a>, the CDK <code class="noloc">CLI</code> understands your stacks and stages as a hierarchy. Also, the  <strong class="command">--all</strong> option and the <code>*</code> wildcard only match top-level stacks. To match all the stacks, use <code>**</code>. Also use <code>\**</code> to indicate all the stacks under a particular hierarchy.</p>
</div>
<div class="paragraph">
<p>When using wildcards, enclose the pattern in quotes, or escape the wildcards with <code>\</code>. If you don&#8217;t, your shell may try to expand the pattern to the names of files in the current directory. At best, this won&#8217;t do what you expect; at worst, you could deploy stacks you didn&#8217;t intend to. This isn&#8217;t strictly necessary on Windows because <code>cmd.exe</code> does not expand wildcards, but is good practice nonetheless.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth "*Stack"    # PipelineStack, LambdaStack, etc.
cdk synth 'Stack?'    # StackA, StackB, Stack1, etc.
cdk synth \*          # All stacks in the app, or all top-level stacks in a CDK Pipelines app
cdk synth '**'        # All stacks in a CDK Pipelines app
cdk synth 'PipelineStack/Prod/**'   # All stacks in Prod stage in a CDK Pipelines app</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order in which you specify the stacks is not necessarily the order in which they will be processed. The CDK  <code class="noloc">CLI</code> accounts for dependencies between stacks when deciding the order in which to process them. For example, let&#8217;s say that one stack uses a value produced by another (such as the ARN of a resource defined in the second stack). In this case, the second stack is synthesized before the first one because of this dependency. You can add dependencies between stacks manually using the stack&#8217;s  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#addwbrdependencytarget-reason">addDependency()</a> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cli-bootstrap">17.9. Bootstrap your AWS environment</h3>
<div class="paragraph">
<p>Deploying stacks with the CDK requires special dedicated AWS CDK resources to be provisioned. The  <code>cdk bootstrap</code> command creates the necessary resources for you. You only need to bootstrap if you are deploying a stack that requires these dedicated resources. See <a href="#bootstrapping">AWS CDK bootstrapping</a> for details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk bootstrap</code></pre>
</div>
</div>
<div class="paragraph">
<p>If issued with no arguments, as shown here, the  <code>cdk bootstrap</code> command synthesizes the current app and bootstraps the environments its stacks will be deployed to. If the app contains environment-agnostic stacks, which don&#8217;t explicitly specify an environment, the default account and Region are bootstrapped, or the environment specified using <code>--profile</code>.</p>
</div>
<div class="paragraph">
<p>Outside of an app, you must explicitly specify the environment to be bootstrapped. You may also do so to bootstrap an environment that&#8217;s not specified in your app or local AWS profile. Credentials must be configured (e.g. in <code class="path">~/.aws/credentials</code>) for the specified account and Region. You may specify a profile that contains the required credentials.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk bootstrap ACCOUNT-NUMBER/REGION # e.g.
cdk bootstrap 1111111111/us-east-1
cdk bootstrap --profile test 1111111111/us-east-1</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each environment (account/region combination) to which you deploy such a stack must be bootstrapped separately.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may incur AWS charges for what the AWS CDK stores in the bootstrapped resources. Additionally, if you use  <code>-bootstrap-customer-key</code>, an AWS KMS key will be created, which also incurs charges per environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Earlier versions of the bootstrap template created a KMS key by default. To avoid charges, re-bootstrap using <code>--no-bootstrap-customer-key</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CDK  <code class="noloc">CLI</code> v2 does not support the original bootstrap template, dubbed the legacy template, used by default with CDK v1.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The modern bootstrap template effectively grants the permissions implied by the  <code>--cloudformation-execution-policies</code> to any AWS account in the <code>--trust</code> list. By default, this extends permissions to read and write to any resource in the bootstrapped account. Make sure to <a href="#bootstrapping-customizing">configure the bootstrapping stack</a> with policies and trusted accounts that you are comfortable with.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cli-init">17.10. Create a new app</h3>
<div class="paragraph">
<p>To create a new app, create a directory for it, then, inside the directory, issue  <code>cdk init</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir my-cdk-app
cd my-cdk-app
cdk init TEMPLATE --language LANGUAGE</code></pre>
</div>
</div>
<div class="paragraph">
<p>The supported languages (<code class="replaceable">LANGUAGE</code>) are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Language</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>typescript</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TypeScript</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javascript</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>python</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>csharp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C#</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code class="replaceable">TEMPLATE</code> is an optional template. If the desired template is <em>app</em>, the default, you may omit it. The available templates are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>app</code> (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates an empty AWS CDK app.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sample-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates an AWS CDK app with a stack containing an Amazon SQS queue and an Amazon SNS topic.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The templates use the name of the project folder to generate names for files and classes inside your new app.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-list">17.11. List stacks</h3>
<div class="paragraph">
<p>To see a list of the IDs of the stacks in your AWS CDK application, enter one of the following equivalent commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk list
cdk ls</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your application contains  <a href="#cdk-pipeline">CDK Pipelines</a> stacks, the CDK <code class="noloc">CLI</code> displays stack names as paths according to their location in the pipeline hierarchy. (For example,  <code class="path">PipelineStack</code>,  <code class="path">PipelineStack/Prod</code>, and  <code class="path">PipelineStack/Prod/MyService</code>.)</p>
</div>
<div class="paragraph">
<p>If your app contains many stacks, you can specify full or partial stack IDs of the stacks to be listed. For more information, see <a href="#cli-stacks">Specify stacks</a>.</p>
</div>
<div class="paragraph">
<p>Add the <code>--long</code> flag to see more information about the stacks, including the stack names and their environments (AWS account and Region).</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-synth">17.12. Synthesize stacks</h3>
<div class="paragraph">
<p>The  <code>cdk synthesize</code> command (almost always abbreviated <code>synth</code>) synthesizes a stack defined in your app into a CloudFormation template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth         # if app contains only one stack
cdk synth MyStack
cdk synth Stack1 Stack2
cdk synth "*"     # all stacks in app</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> actually runs your app and synthesizes fresh templates before most operations (such as when deploying or comparing stacks). These templates are stored by default in the  <code class="path">cdk.out</code> directory. The  <code>cdk synth</code> command simply prints the generated templates for one or more specified stacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See  <code>cdk synth --help</code> for all available options. A few of the most frequently used options are covered in the following section.</p>
</div>
<div class="sect3">
<h4 id="w94aac73c33c11">17.12.1. Specify context values</h4>
<div class="paragraph">
<p>Use the  <code>--context</code> or <code>-c</code> option to pass <a href="#context">runtime context</a> values to your CDK app.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># specify a single context value
cdk synth --context key=value MyStack

# specify multiple context values (any number)
cdk synth --context key1=value1 --context key2=value2 MyStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying multiple stacks, the specified context values are normally passed to all of them. If you want, you can specify different values for each stack by prefixing the stack name to the context value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none"># different context values for each stack
cdk synth --context Stack1:key=value Stack2:key=value Stack1 Stack2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="w94aac73c33c13">17.12.2. Specify display format</h4>
<div class="paragraph">
<p>By default, the synthesized template is displayed in YAML format. Add the  <code>--json</code> flag to display it in JSON format instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth --json MyStack</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="w94aac73c33c15">17.12.3. Specify the output directory</h4>
<div class="paragraph">
<p>Add the  <code>--output</code> (<code>-o</code>) option to write the synthesized templates to a directory other than <code class="path">cdk.out</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth --output=~/templates</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-deploy">17.13. Deploy stacks</h3>
<div class="paragraph">
<p>The  <code>cdk deploy</code> subcommand deploys one or more specified stacks to your AWS account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy        # if app contains only one stack
cdk deploy MyStack
cdk deploy Stack1 Stack2
cdk deploy "*"    # all stacks in app</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> runs your app and synthesizes fresh AWS CloudFormation templates before deploying anything. Therefore, most command line options you can use with  <code>cdk synth</code> (for example, <code>--context</code>) can also be used with <code>cdk deploy</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See  <code>cdk deploy --help</code> for all available options. A few of the most useful options are covered in the following section.</p>
</div>
<div class="sect3">
<h4 id="cli-deploy-nosynth">17.13.1. Skip synthesis</h4>
<div class="paragraph">
<p>The  <strong class="command">cdk deploy</strong> command normally synthesizes your app&#8217;s stacks before deploying to make sure that the deployment reflects the latest version of your app. If you know that you haven&#8217;t changed your code since your last <strong class="command">cdk synth</strong>, you can suppress the redundant synthesis step when deploying. To do so, specify your project&#8217;s <code class="path">cdk.out</code> directory in the  <strong class="command">--app</strong> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cdk deploy --app cdk.out StackOne StackTwo</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cli-deploy-norollback">17.13.2. Disable rollback</h4>
<div class="paragraph">
<p>AWS CloudFormation has the ability to roll back changes so that deployments are atomic. This means that they either succeed or fail as a whole. The AWS CDK inherits this capability because it synthesizes and deploys AWS CloudFormation templates.</p>
</div>
<div class="paragraph">
<p>Rollback makes sure that your resources are in a consistent state at all times, which is vital for production stacks. However, while you&#8217;re still developing your infrastructure, some failures are inevitable, and rolling back failed deployments can slow you down.</p>
</div>
<div class="paragraph">
<p>For this reason, the CDK <code class="noloc">CLI</code> lets you disable rollback by adding  <code>--no-rollback</code> to your <code>cdk deploy</code> command. With this flag, failed deployments are not rolled back. Instead, resources deployed before the failed resource remain in place, and the next deployment starts with the failed resource. You&#8217;ll spend a lot less time waiting for deployments and a lot more time developing your infrastructure.</p>
</div>
</div>
<div class="sect3">
<h4 id="cli-deploy-hotswap">17.13.3. Hot swapping</h4>
<div class="paragraph">
<p>Use the  <code>--hotswap</code> flag with <code>cdk deploy</code> to attempt to update your AWS resources directly instead of generating an AWS CloudFormation change set and deploying it. Deployment falls back to AWS CloudFormation deployment if hot swapping is not possible.</p>
</div>
<div class="paragraph">
<p>Currently hot swapping supports Lambda functions, Step Functions state machines, and Amazon ECS container images. The <code>--hotswap</code> flag also disables rollback (i.e., implies <code>--no-rollback</code>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hot-swapping is not recommended for production deployments.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cli-deploy-watch">17.13.4. Watch mode</h4>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code>'s watch mode (  <strong class="command">cdk deploy --watch</strong>, or <strong class="command">cdk watch</strong> for short) continuously monitors your CDK app&#8217;s source files and assets for changes. It immediately performs a deployment of the specified stacks when a change is detected.</p>
</div>
<div class="paragraph">
<p>By default, these deployments use the <code>--hotswap</code> flag, which fast-tracks deployment of changes to Lambda functions. It also falls back to deploying through AWS CloudFormation if you have changed infrastructure configuration. To have <code>cdk watch</code> always perform full AWS CloudFormation deployments, add the <code>--no-hotswap</code> flag to <code>cdk watch</code>.</p>
</div>
<div class="paragraph">
<p>Any changes made while <code>cdk watch</code> is already performing a deployment are combined into a single deployment, which begins as soon as the in-progress deployment is complete.</p>
</div>
<div class="paragraph">
<p>Watch mode uses the <code>"watch"</code> key in the project&#8217;s <code class="path">cdk.json</code> to determine which files to monitor. By default, these files are your application files and assets, but this can be changed by modifying the  <code>"include"</code> and <code>"exclude"</code> entries in the <code>"watch"</code> key. The following <code class="path">cdk.json</code> file shows an example of these entries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "mvn -e -q compile exec:java",
  "watch": {
    "include": "src/main/**",
    "exclude": "target/*"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cdk watch</code> executes the <code>"build"</code> command from <code class="path">cdk.json</code> to build your app before synthesis. If your deployment requires any commands to build or package your Lambda code (or anything else that&#8217;s not in your CDK app), add it here.</p>
</div>
<div class="paragraph">
<p>Git-style wildcards, both <code>*</code> and <code>**</code>, can be used in the <code>"watch"</code> and <code>"build"</code> keys. Each path is interpreted relative to the parent directory of <code class="path">cdk.json</code>. The default value of  <code>include</code> is <code>**/*</code>, meaning all files and directories in the project root directory. <code>exclude</code> is optional.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Watch mode is not recommended for production deployments.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="w94aac73c35c19">17.13.5. Specify AWS CloudFormation parameters</h4>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> supports specifying AWS CloudFormation  <a href="#parameters">parameters</a> at deployment. You may provide these on the command line following the <code>--parameters</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy MyStack --parameters uploadBucketName=UploadBucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>To define multiple parameters, use multiple  <code>--parameters</code> flags.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy MyStack --parameters uploadBucketName=UpBucket --parameters downloadBucketName=DownBucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are deploying multiple stacks, you can specify a different value of each parameter for each stack. To do so, prefix the name of the parameter with the stack name and a colon. Otherwise, the same value is passed to all stacks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy MyStack YourStack --parameters MyStack:uploadBucketName=UploadBucket --parameters YourStack:uploadBucketName=UpBucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the AWS CDK retains values of parameters from previous deployments and uses them in later deployments if they are not specified explicitly. Use the  <code>--no-previous-parameters</code> flag to require all parameters to be specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="w94aac73c35c21">17.13.6. Specify outputs file</h4>
<div class="paragraph">
<p>If your stack declares AWS CloudFormation outputs, these are normally displayed on the screen at the conclusion of deployment. To write them to a file in JSON format, use the  <code>--outputs-file</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy --outputs-file outputs.json MyStack</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cli-security">17.13.7. Approve security-related changes</h4>
<div class="paragraph">
<p>To protect you against unintended changes that affect your security posture, the CDK  <code class="noloc">CLI</code> prompts you to approve security-related changes before deploying them. You can specify the level of change that requires approval:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy --require-approval LEVEL</code></pre>
</div>
</div>
<div class="paragraph">
<p><code class="replaceable">LEVEL</code> can be one of the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>never</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Approval is never required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>any-change</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires approval on any IAM or security-group-related change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>broadening</code> (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires approval when IAM statements or traffic rules are added; removals don&#8217;t require approval</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The setting can also be configured in the  <code class="path">cdk.json</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "...",
  "requireApproval": "never"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-diff">17.14. Compare stacks</h3>
<div class="paragraph">
<p>The  <code>cdk diff</code> command compares the current version of a stack (and its dependencies) defined in your app with the already-deployed versions, or with a saved AWS CloudFormation template, and displays a list of changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Stack HelloCdkStack
IAM Statement Changes
┌───┬──────────────────────────────┬────────┬──────────────────────────────┬──────────────────────────────┬───────────┐
│   │ Resource                     │ Effect │ Action                       │ Principal                    │ Condition │
├───┼──────────────────────────────┼────────┼──────────────────────────────┼──────────────────────────────┼───────────┤
│ + │ ${Custom::S3AutoDeleteObject │ Allow  │ sts:AssumeRole               │ Service:lambda.amazonaws.com │           │
│   │ sCustomResourceProvider/Role │        │                              │                              │           │
│   │ .Arn}                        │        │                              │                              │           │
├───┼──────────────────────────────┼────────┼──────────────────────────────┼──────────────────────────────┼───────────┤
│ + │ ${MyFirstBucket.Arn}         │ Allow  │ s3:DeleteObject*             │ AWS:${Custom::S3AutoDeleteOb │           │
│   │ ${MyFirstBucket.Arn}/*       │        │ s3:GetBucket*                │ jectsCustomResourceProvider/ │           │
│   │                              │        │ s3:GetObject*                │ Role.Arn}                    │           │
│   │                              │        │ s3:List*                     │                              │           │
└───┴──────────────────────────────┴────────┴──────────────────────────────┴──────────────────────────────┴───────────┘
IAM Policy Changes
┌───┬────────────────────────────────────────────────────────┬────────────────────────────────────────────────────────┐
│   │ Resource                                               │ Managed Policy ARN                                     │
├───┼────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────┤
│ + │ ${Custom::S3AutoDeleteObjectsCustomResourceProvider/Ro │ {"Fn::Sub":"arn:${AWS::Partition}:iam::aws:policy/serv │
│   │ le}                                                    │ ice-role/AWSLambdaBasicExecutionRole"}                 │
└───┴────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────┘
(NOTE: There may be security-related changes not in this list. See https://github.com/aws/aws-cdk/issues/1299)

Parameters
[+] Parameter AssetParameters/4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392/S3Bucket AssetParameters4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392S3BucketBF7A7F3F: {"Type":"String","Description":"S3 bucket for asset \"4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392\""}
[+] Parameter AssetParameters/4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392/S3VersionKey AssetParameters4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392S3VersionKeyFAF93626: {"Type":"String","Description":"S3 key for asset version \"4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392\""}
[+] Parameter AssetParameters/4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392/ArtifactHash AssetParameters4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392ArtifactHashE56CD69A: {"Type":"String","Description":"Artifact hash for asset \"4cd61014b71160e8c66fe167e43710d5ba068b80b134e9bd84508cf9238b2392\""}

Resources
[+] AWS::S3::BucketPolicy MyFirstBucket/Policy MyFirstBucketPolicy3243DEFD
[+] Custom::S3AutoDeleteObjects MyFirstBucket/AutoDeleteObjectsCustomResource MyFirstBucketAutoDeleteObjectsCustomResourceC52FCF6E
[+] AWS::IAM::Role Custom::S3AutoDeleteObjectsCustomResourceProvider/Role CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092
[+] AWS::Lambda::Function Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F
[~] AWS::S3::Bucket MyFirstBucket MyFirstBucketB8884501
 ├─ [~] DeletionPolicy
 │   ├─ [-] Retain
 │   └─ [+] Delete
 └─ [~] UpdateReplacePolicy
     ├─ [-] Retain
     └─ [+] Delete</pre>
</div>
</div>
<div class="paragraph">
<p>To compare your app&#8217;s stacks with the existing deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk diff MyStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>To compare your app&#8217;s stacks with a saved CloudFormation template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk diff --template ~/stacks/MyStack.old MyStack</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli-import">17.15. Import existing resources into a stack</h3>
<div class="paragraph">
<p>You can use the  <code>cdk import</code> command to bring resources under the management of CloudFormation for a particular AWS CDK stack. This is useful if you are migrating to AWS CDK, or are moving resources between stacks or changing their logical id. <code>cdk import</code> uses <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import.html">CloudFormation resource imports</a>. See the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import-supported-resources.html">list of resources that can be imported here</a>.</p>
</div>
<div class="paragraph">
<p>To import an existing resource into a AWS CDK stack, follow the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the resource is not currently being managed by any other CloudFormation stack. If it is, first set the removal policy to <code>RemovalPolicy.RETAIN</code> in the stack the resource is currently in and perform a deployment. Then, remove the resource from the stack and perform another deployment. This process will make sure that the resource is no longer managed by CloudFormation but does not delete it.</p>
</li>
<li>
<p>Run a <code>cdk diff</code> to make sure there are no pending changes to the AWS CDK stack you want to import resources into. The only changes allowed in an "import" operation are the addition of new resources which you want to import.</p>
</li>
<li>
<p>Add constructs for the resources you want to import to your stack. For example, if you want to import an Amazon S3 bucket, add something like <code>new s3.Bucket(this, 'ImportedS3Bucket', {});</code>. Do not make any modifications to any other resource.</p>
<div class="paragraph">
<p>You must also make sure to exactly model the state that the resource currently has into the definition. For the example of the bucket, be sure to include AWS KMS keys, life cycle policies, and anything else that&#8217;s relevant about the bucket. If you do not, subsequent update operations may not do what you expect.</p>
</div>
<div class="paragraph">
<p>You can choose whether or not to include the physical bucket name. We usually recommend to not include resource names into your AWS CDK resource definitions so that it becomes easier to deploy your resources multiple times.</p>
</div>
</li>
<li>
<p>Run <code>cdk import [replaceable]</code>STACKNAME````.</p>
</li>
<li>
<p>If the resource names are not in your model, the CLI will prompt you to pass in the actual names of the resources you are importing. After this, the import starts.</p>
</li>
<li>
<p>When <code>cdk import</code> reports success, the resource is now managed by AWS CDK and CloudFormation. Any subsequent changes you make to the resource properties in your AWS CDK app the construct configuration will be applied on the next deployment.</p>
</li>
<li>
<p>To confirm that the resource definition in your AWS CDK app matches the current state of the resource, you can start an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-stack-drift.html">CloudFormation drift detection operation</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This feature currently does not support importing resources into nested stacks.</p>
</div>
</div>
<div class="sect2">
<h3 id="cli-config">17.16. Configuration (<code class="path">cdk.json</code>)</h3>
<div class="paragraph">
<p>Default values for many CDK  <code class="noloc">CLI</code> command line flags can be stored in a project&#8217;s  <code class="path">cdk.json</code> file or in the  <code class="path">.cdk.json</code> file in your user directory. Following is an alphabetical reference to the supported configuration settings.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Notes</th>
<th class="tableblock halign-left valign-top">CDK CLI option</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command that executes the CDK application.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--app</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assetMetadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, CDK does not add metadata to resources that use assets.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-asset-metadata</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bootstrapKmsKeyId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the ID of the AWS KMS key used to encrypt the Amazon S3 deployment bucket.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--bootstrap-kms-key-id</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command that compiles or builds the CDK application before synthesis. Not permitted in <code class="path">~/.cdk.json</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--build</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>browser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command for launching a Web browser for the <code class="path">cdk docs</code> subcommand.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--browser</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>context</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#context">Context values and the AWS CDK</a>. Context values in a configuration file will not be erased by <strong class="command">cdk context --clear</strong>. (The CDK <code class="noloc">CLI</code> places cached context values in  <code class="path">cdk.context.json</code>.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--context</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, CDK <code class="noloc">CLI</code> emits more detailed information useful for debugging.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--debug</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language to be used for initializing new projects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--language</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lookups</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, no context lookups are permitted. Synthesis will fail if any context lookups need to be performed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-lookups</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notices</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, suppresses the display of messages about security vulnerabilities, regressions, and unsupported versions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-notices</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the directory into which the synthesized cloud assembly will be emitted (default <code>"cdk.out"</code>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--output</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>outputsFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file to which AWS CloudFormation outputs from deployed stacks will be written (in JSON format).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--outputs-file</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pathMetadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, CDK path metadata is not added to synthesized templates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-path-metadata</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON array specifying the package names or local paths of packages that extend the CDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--plugin</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the default AWS profile used for specifying Region and account credentials.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--profile</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>progress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>"events"</code>, the CDK <code class="noloc">CLI</code> displays all AWS CloudFormation events during deployment, rather than a progress bar.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--progress</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requireApproval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default approval level for security changes. See <a href="#cli-security">Approve security-related changes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--require-approval</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rollback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, failed deployments are not rolled back.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-rollback</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>staging</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, assets are not copied to the output directory (use for local debugging of the source files with AWS SAM).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-staging</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tags</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object containing tags (key-value pairs) for the stack.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--tags</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>toolkitBucketName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the Amazon S3 bucket used for deploying assets such as Lambda functions and container images (see <a href="#cli-bootstrap">Bootstrap your AWS environment</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--toolkit-bucket-name</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>toolkitStackName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the bootstrap stack (see <a href="#cli-bootstrap">Bootstrap your AWS environment</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--toolkit-stack-name</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>versionReporting</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, opts out of version reporting.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--no-version-reporting</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>watch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object containing <code>"include"</code> and <code>"exclude"</code> keys that indicate which files should (or should not) trigger a rebuild of the project when changed. See <a href="#cli-deploy-watch">Watch mode</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong class="command">--watch</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="ref-cli-cmd">18. AWS CDK <code class="noloc">CLI</code> command reference</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This section contains command reference information for the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>). The CDK  <code class="noloc">CLI</code> is also referred to as the CDK Toolkit.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This section contains command reference information for the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>). The CDK  <code class="noloc">CLI</code> is also referred to as the CDK Toolkit.</p>
</div>
<div class="sect2">
<h3 id="ref-cli-cmd-usage">18.1. Usage</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk &lt;command&gt; &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref-cli-cmd-commands">18.2. Commands</h3>
<div id="ref-cli-cmd-commands-acknowledge" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-ack">acknowledge ack</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Acknowledge a notice by issue number and hide it from displaying again.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-bootstrap" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-bootstrap">bootstrap</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Prepare an AWS environment for CDK deployments by deploying the CDK bootstrap stack, named <code class="path">CDKToolkit</code>, into the AWS environment.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-context" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-context">context</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Manage cached context values for your CDK application.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-deploy" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-deploy">deploy</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Deploy one or more CDK stacks into your AWS environment.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-destroy" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-destroy">destroy</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Delete one or more CDK stacks from your AWS environment.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-diff" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-diff">diff</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Perform a diff to see infrastructure changes between CDK stacks.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-docs" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-docs">docs doc</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Open CDK documentation in your browser.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-doctor" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-doctor">doctor</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Inspect and display useful information about your local CDK project and development environment.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-import" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-import">import</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use AWS CloudFormation resource imports to import existing AWS resources into a CDK stack.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-init" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-init">init</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create a new CDK project from a template.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-list" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-list">list ls</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>List all CDK stacks and their dependencies from a CDK app.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-metadata" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-metadata">metadata</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Display metadata associated with a CDK stack.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-migrate" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cdk-migrate">migrate</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Migrate AWS resources, AWS CloudFormation stacks, and AWS CloudFormation templates into a new CDK project.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-notices" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-notices">notices</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Display notices for your CDK application.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-synthesize" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-synth">synthesize synth</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Synthesize a CDK app to produce a cloud assembly, including an AWS CloudFormation template for each stack.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-commands-watch" class="dlist">
<dl>
<dt class="hdlist1"><code><a href="#ref-cli-cmd-watch">watch</a></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Continuously watch a local CDK project for changes to perform deployments and hotswaps.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="ref-cli-cmd-options">18.3. Global options</h3>
<div class="paragraph">
<p>The following options are compatible with all CDK  <code class="noloc">CLI</code> commands.</p>
</div>
<div id="ref-cli-cmd-options-app" class="dlist">
<dl>
<dt class="hdlist1"><code>--app, -a <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Provide the command for running your app or cloud assembly directory.</p>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-asset-metadata" class="dlist">
<dl>
<dt class="hdlist1"><code>--asset-metadata <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Include <code>aws:asset:*</code> AWS CloudFormation metadata for resources that use assets.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-build" class="dlist">
<dl>
<dt class="hdlist1"><code>--build <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Command for running a pre-synthesis build.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-ca-bundle-path" class="dlist">
<dl>
<dt class="hdlist1"><code>--ca-bundle-path <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Path to a CA certificate to use when validating HTTPS requests.</p>
<div class="paragraph">
<p>If this option is not provided, the CDK <code class="noloc">CLI</code> will read from the  <code>AWS_CA_BUNDLE</code> environment variable.</p>
</div>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-ci" class="dlist">
<dl>
<dt class="hdlist1"><code>--ci <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Indicate that CDK <code class="noloc">CLI</code> commands are being run in a continuous integration (CI) environment.</p>
<div class="paragraph">
<p>This option modifies the behavior of the CDK <code class="noloc">CLI</code> to better suit automated operations that are typical in CI pipelines.</p>
</div>
<div class="paragraph">
<p>When you provide this option, logs are sent to <code>stdout</code> instead of <code>stderr</code>.</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-context" class="dlist">
<dl>
<dt class="hdlist1"><code>--context, -c <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Add contextual string parameters as key-value pairs.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-debug" class="dlist">
<dl>
<dt class="hdlist1"><code>--debug <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Enable detailed debugging information. This option produces a verbose output that includes a lot more detail about what the CDK <code class="noloc">CLI</code> is doing behind the scenes.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-ec2creds" class="dlist">
<dl>
<dt class="hdlist1"><code>--ec2creds, -i <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Force the CDK <code class="noloc">CLI</code> to try and fetch Amazon EC2 instance credentials.</p>
<div class="paragraph">
<p>By default, the CDK <code class="noloc">CLI</code> guesses the Amazon EC2 instance status.</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the CDK <code class="noloc">CLI</code>.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-ignore-errors" class="dlist">
<dl>
<dt class="hdlist1"><code>--ignore-errors <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Ignore synthesis errors, which will likely produce an output that is not valid.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-json" class="dlist">
<dl>
<dt class="hdlist1"><code>--json, -j <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use JSON instead of YAML for AWS CloudFormation templates that are printed to standard output (<code>stdout</code>).</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-lookups" class="dlist">
<dl>
<dt class="hdlist1"><code>--lookups <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Perform context lookups.</p>
<div class="paragraph">
<p>Synthesis will fail if this value is <code>false</code> and context lookups need to be performed.</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-no-color" class="dlist">
<dl>
<dt class="hdlist1"><code>--no-color <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Remove color and other styling from the console output.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-notices" class="dlist">
<dl>
<dt class="hdlist1"><code>--notices <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show relevant notices.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-output" class="dlist">
<dl>
<dt class="hdlist1"><code>--output, -o <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify the directory to output the synthesized cloud assembly to.</p>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code class="path">cdk.out</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-path-metadata" class="dlist">
<dl>
<dt class="hdlist1"><code>--path-metadata <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Include <code>aws::cdk::path</code> AWS CloudFormation metadata for each resource.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-plugin" class="dlist">
<dl>
<dt class="hdlist1"><code>--plugin, -p <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Name or path of a <code class="noloc">node</code> package that extends CDK features. This option can be provided multiple times in a single command.</p>
<div class="paragraph">
<p>You can configure this option in the project&#8217;s <code class="path">cdk.json</code> file or at  <code class="path">~/.cdk.json</code> on your local development machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   // ...
   "plugin": [
      "module_1",
      "module_2"
   ],
   // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-profile" class="dlist">
<dl>
<dt class="hdlist1"><code>--profile <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify the name of the AWS profile, containing your AWS environment information, to use with the CDK <code class="noloc">CLI</code>.</p>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-proxy" class="dlist">
<dl>
<dt class="hdlist1"><code>--proxy <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the indicated proxy.</p>
<div class="paragraph">
<p>If this option is not provided, the CDK <code class="noloc">CLI</code> will read from the  <code>HTTPS_PROXY</code> environment variable.</p>
</div>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Read from <code>HTTPS_PROXY</code> environment variable.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-role-arn" class="dlist">
<dl>
<dt class="hdlist1"><code>--role-arn, -r <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The ARN of the IAM role that the CDK <code class="noloc">CLI</code> will assume when interacting with AWS CloudFormation.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-staging" class="dlist">
<dl>
<dt class="hdlist1"><code>--staging <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Copy assets to the output directory.</p>
<div class="paragraph">
<p>Specify <code>false</code> to prevent the copying of assets to the output directory. This allows the AWS SAM <code class="noloc">CLI</code> to reference the original source files when performing local debugging.</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-strict" class="dlist">
<dl>
<dt class="hdlist1"><code>--strict <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Do not construct stacks that contain warnings.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-trace" class="dlist">
<dl>
<dt class="hdlist1"><code>--trace <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Print trace for stack warnings.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-verbose" class="dlist">
<dl>
<dt class="hdlist1"><code>--verbose, -v <code class="replaceable">COUNT</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show debug logs. You can specify this option multiple times to increase verbosity.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-version" class="dlist">
<dl>
<dt class="hdlist1"><code>--version <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show the CDK <code class="noloc">CLI</code> version number.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-options-version-reporting" class="dlist">
<dl>
<dt class="hdlist1"><code>--version-reporting <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Include the <code>AWS::CDK::Metadata</code> resource in synthesized AWS CloudFormation templates.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="ref-cli-cmd-configure">18.4. Providing and configuring options</h3>
<div class="paragraph">
<p>You can pass options through command-line arguments. For most options, you can configure them in a  <code class="path">cdk.json</code> configuration file. When you use multiple configuration sources, the CDK  <code class="noloc">CLI</code> adheres to the following precedence:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Command-line values</strong> – Any option provided at the command-line overrides options configured in <code class="path">cdk.json</code> files.</p>
</li>
<li>
<p><strong>Project configuration file</strong> – The <code class="path">cdk.json</code> file in your CDK project&#8217;s directory.</p>
</li>
<li>
<p><strong>User configuration file</strong> – The <code class="path">cdk.json</code> file located at  <code class="path">~/.cdk.json</code> on your local machine.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-cli-cmd-pass">18.5. Passing options at the command line</h3>
<div class="sect3">
<h4 id="ref-cli-cmd-pass-bool">18.5.1. Passing boolean values</h4>
<div class="paragraph">
<p>For options that accept a boolean value, you can specify them in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>true</code> and <code>false</code> values – Provide the boolean value with the command. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --watch=true
$ cdk deploy --watch=false</code></pre>
</div>
</div>
</li>
<li>
<p>Provide the option&#8217;s counterpart – Modify the option name by adding <code>no</code> to specify a <code>false</code> value. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --watch
$ cdk deploy --no-watch</code></pre>
</div>
</div>
</li>
<li>
<p>For options that default to <code>true</code> or <code>false</code>, you don&#8217;t have to provide the option unless you want to change from the default.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-ack">18.6. <code class="noloc">cdk acknowledge</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Acknowledge a notice by issue number and hide it from displaying again.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Acknowledge a notice by issue number and hide it from displaying again.</p>
</div>
<div class="paragraph">
<p>This is useful to hide notices that have been addressed or do not apply to you.</p>
</div>
<div class="paragraph">
<p>Acknowledgements are saved at a CDK project level. If you acknowledge a notice in one CDK project, it will still display in other projects until acknowledged there.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-ack-usage">18.6.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk acknowledge &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-ack-args">18.6.2. Arguments</h4>
<div id="ref-cli-cmd-ack-args-notice-id" class="dlist">
<dl>
<dt class="hdlist1">Notice ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The ID of the notice.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-ack-options">18.6.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-ack-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk acknowledge</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-ack-examples">18.6.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-ack-examples-1">Acknowledge and hide a notice that displays when running another CDK <code class="noloc">CLI</code> command</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy
... # Normal output of the command

NOTICES

16603   Toggling off auto_delete_objects for Bucket empties the bucket

        Overview: If a stack is deployed with an S3 bucket with
                  auto_delete_objects=True, and then re-deployed with
                  auto_delete_objects=False, all the objects in the bucket
                  will be deleted.

        Affected versions: &lt;1.126.0.

        More information at: https://github.com/aws/aws-cdk/issues/16603


17061   Error when building EKS cluster with monocdk import

        Overview: When using monocdk/aws-eks to build a stack containing
                  an EKS cluster, error is thrown about missing
                  lambda-layer-node-proxy-agent/layer/package.json.

        Affected versions: &gt;=1.126.0 &lt;=1.130.0.

        More information at: https://github.com/aws/aws-cdk/issues/17061

$ cdk acknowledge 16603</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-bootstrap">18.7. <code class="noloc">cdk bootstrap</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Prepare an AWS environment for CDK deployments by deploying the CDK bootstrap stack, named  <code class="path">CDKToolkit</code>, into the AWS environment.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Prepare an AWS environment for CDK deployments by deploying the CDK bootstrap stack, named  <code class="path">CDKToolkit</code>, into the AWS environment.</p>
</div>
<div class="paragraph">
<p>The bootstrap stack is a CloudFormation stack that provisions an Amazon S3 bucket and Amazon ECR repository in the AWS environment. The AWS CDK <code class="noloc">CLI</code> uses these resources to store synthesized templates and related assets during deployment.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-bootstrap-usage">18.7.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-bootstrap-args">18.7.2. Arguments</h4>
<div id="ref-cli-cmd-bootstrap-args-env" class="dlist">
<dl>
<dt class="hdlist1">AWS environment</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The target AWS environment to deploy the bootstrap stack to in the following format: <code>aws://&lt;account-id&gt;/&lt;region&gt;</code>.</p>
<div class="paragraph">
<p>Example: <code>aws://123456789012/us-east-1</code></p>
</div>
<div class="paragraph">
<p>This argument can be provided multiple times in a single command to deploy the bootstrap stack to multiple environments.</p>
</div>
<div class="paragraph">
<p>By default, the CDK <code class="noloc">CLI</code> will bootstrap all environments referenced in the CDK app or will determine an environment from default sources. This could be an environment specified using the  <code>--profile</code> option, from environment variables, or default AWS CLI sources.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-bootstrap-options">18.7.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-bootstrap-options-bootstrap-bucket-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--bootstrap-bucket-name, --toolkit-bucket-name, -b <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the Amazon S3 bucket that will be used by the CDK <code class="noloc">CLI</code>. This bucket will be created and must not currently exist.</p>
<div class="paragraph">
<p>Provide this option to override the default name of the Amazon S3 bucket.</p>
</div>
<div class="paragraph">
<p>When you use this option, you may have to customize synthesis. To learn more, see <a href="#bootstrapping-custom-synth">Customize CDK stack synthesis</a>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Undefined</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-bootstrap-customer-key" class="dlist">
<dl>
<dt class="hdlist1"><code>--bootstrap-customer-key <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Create a Customer Master Key (CMK) for the bootstrap bucket (you will be charged but can customize permissions, modern bootstrapping only).</p>
<div class="paragraph">
<p>This option is not compatible with <code>--bootstrap-kms-key-id</code>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Undefined</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-bootstrap-kms-key-id" class="dlist">
<dl>
<dt class="hdlist1"><code>--bootstrap-kms-key-id <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The AWS KMS master key ID to use for the <code class="noloc">SSE-KMS</code> encryption.</p>
<div class="paragraph">
<p>Provide this option to override the default AWS KMS key used to encrypt the Amazon S3 bucket.</p>
</div>
<div class="paragraph">
<p>This option is not compatible with <code>--bootstrap-customer-key</code>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Undefined</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-cloudformation-execution-policies" class="dlist">
<dl>
<dt class="hdlist1"><code>--cloudformation-execution-policies <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The managed IAM policy ARNs that should be attached to the deployment role assumed by AWS CloudFormation during deployment of your stacks.</p>
<div class="paragraph">
<p>By default, stacks are deployed with full administrator permissions using the <code>AdministratorAccess</code> policy.</p>
</div>
<div class="paragraph">
<p>You can provide this option multiple times in a single command. You can also provide multiple ARNs as a single string, with the individual ARNs separated by commas. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --cloudformation-execution-policies "arn:aws:iam::aws:policy/AWSLambda_FullAccess,arn:aws:iam::aws:policy/AWSCodeDeployFullAccess"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid deployment failures, be sure that the policies you specify are sufficient for any deployments that you will perform into the environment being bootstrapped.</p>
</div>
<div class="paragraph">
<p>This option applies to modern bootstrapping only.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The modern bootstrap template effectively grants the permissions implied by the <code>--cloudformation-execution-policies</code> to any AWS account in the <code>--trust</code> list. By default, this extends permissions to read and write to any resource in the bootstrapped account. Make sure to <a href="#bootstrapping-customizing">configure the bootstrapping stack</a> with policies and trusted accounts that you are comfortable with.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>[]</code></p>
</div>
<div id="ref-cli-cmd-bootstrap-options-custom-permissions-boundary" class="dlist">
<dl>
<dt class="hdlist1"><code>--custom-permissions-boundary, -cpb <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify the name of a permissions boundary to use.</p>
<div class="paragraph">
<p>This option is not compatible with <code>--example-permissions-boundary</code>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Undefined</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-example-permissions-boundary" class="dlist">
<dl>
<dt class="hdlist1"><code>--example-permissions-boundary, -epb <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the example permissions boundary, supplied by the AWS CDK.</p>
<div class="paragraph">
<p>This option is not compatible with <code>--custom-permissions-boundary</code>.</p>
</div>
<div class="paragraph">
<p>The CDK supplied permissions boundary policy should be regarded as an example. Edit the content and reference the example policy if you are testing out the feature. Convert it into a new policy for actual deployments, if one does not already exist. The concern is to avoid drift. Most likely, a permissions boundary is maintained and has dedicated conventions, naming included.</p>
</div>
<div class="paragraph">
<p>For more information on configuring permissions, including using permissions boundaries, see the <a href="https://github.com/aws/aws-cdk/wiki/Security-And-Safety-Dev-Guide">Security and Safety Dev Guide</a>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Undefined</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-execute" class="dlist">
<dl>
<dt class="hdlist1"><code>--execute <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configure whether to execute the change set.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Always bootstrap, even if it would downgrade the bootstrap template version.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk bootstrap</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-previous-parameters" class="dlist">
<dl>
<dt class="hdlist1"><code>--previous-parameters <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use previous values for existing parameters.</p>
<div class="paragraph">
<p>Once a bootstrap template is deployed with a set of parameters, you must set this option to <code>false</code> to change any parameters on future deployments. When <code>false</code>, you must re-supply all previously supplied parameters.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-public-access-block-configuration" class="dlist">
<dl>
<dt class="hdlist1"><code>--public-access-block-configuration <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Block public access configuration on the Amazon S3 bucket that is created and used by the CDK <code class="noloc">CLI</code>.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-qualifier" class="dlist">
<dl>
<dt class="hdlist1"><code>--qualifier <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Nine-digit string value that is unique for each bootstrap stack. This value is added to the physical ID of resources in the bootstrap stack.</p>
<div class="paragraph">
<p>By providing a qualifier, you avoid resource name clashes when provisioning multiple bootstrap stacks in the same environment.</p>
</div>
<div class="paragraph">
<p>When you change the qualifier, your CDK app must pass the changed value to the stack synthesizer. For more information, see <a href="#bootstrapping-custom-synth">Customize CDK stack synthesis</a>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>hnb659fds</code>. This value has no significance.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-show-template" class="dlist">
<dl>
<dt class="hdlist1"><code>--show-template <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Instead of bootstrapping, print the current bootstrap template to the standard output (<code>stdout</code>). You can then copy and customize the template as necessary.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-tags" class="dlist">
<dl>
<dt class="hdlist1"><code>--tags, -t <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Tags to add to the bootstrap stack in the format of <code>KEY=VALUE</code>.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>[]</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-template" class="dlist">
<dl>
<dt class="hdlist1"><code>--template <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use the template from the given file instead of the built-in one.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-termination-protection" class="dlist">
<dl>
<dt class="hdlist1"><code>--termination-protection <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Toggle AWS CloudFormation termination protection on the bootstrap stack.</p>
<div class="paragraph">
<p>When <code>true</code>, termination protection is enabled. This prevents the bootstrap stack from being accidentally deleted.</p>
</div>
<div class="paragraph">
<p>To learn more about termination protection, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-protect-stacks.html">Protecting a stack from being deleted</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: Undefined</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-toolkit-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--toolkit-stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the bootstrap stack to create.</p>
<div class="paragraph">
<p>By default, <code>cdk bootstrap</code> deploys a stack named <code class="path">CDKToolkit</code> into the specified AWS environment. Use this option to provide a different name for your bootstrap stack.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> uses this value to verify your bootstrap stack version.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>CDKToolkit</code></p>
</div>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-bootstrap-options-trust" class="dlist">
<dl>
<dt class="hdlist1"><code>--trust <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The AWS account IDs that should be trusted to perform deployments into this environment.</p>
<div class="paragraph">
<p>The account performing the bootstrapping will always be trusted.</p>
</div>
<div class="paragraph">
<p>This option requires that you also provide <code>--cloudformation-execution-policies</code>.</p>
</div>
<div class="paragraph">
<p>You can provide this option multiple times in a single command.</p>
</div>
<div class="paragraph">
<p>This option applies to modern bootstrapping only.</p>
</div>
<div class="paragraph">
<p>To add trusted accounts to an existing bootstrap stack, you must specify all of the accounts to trust, including those that you may have previously provided. If you only provide new accounts to trust, the previously trusted accounts will be removed.</p>
</div>
<div class="paragraph">
<p>The following is an example that trusts two accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap aws://123456789012/us-west-2 --trust 234567890123 --trust 987654321098 --cloudformation-execution-policies arn:aws:iam::aws:policy/AdministratorAccess
 ⏳  Bootstrapping environment aws://123456789012/us-west-2...
Trusted accounts for deployment: 234567890123, 987654321098
Trusted accounts for lookup: (none)
Execution policies: arn:aws:iam::aws:policy/AdministratorAccess
CDKToolkit: creating CloudFormation changeset...
 ✅  Environment aws://123456789012/us-west-2 bootstrapped.</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The modern bootstrap template effectively grants the permissions implied by the <code>--cloudformation-execution-policies</code> to any AWS account in the <code>--trust</code> list. By default, this extends permissions to read and write to any resource in the bootstrapped account. Make sure to <a href="#bootstrapping-customizing">configure the bootstrapping stack</a> with policies and trusted accounts that you are comfortable with.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>[]</code></p>
</div>
<div id="ref-cli-cmd-bootstrap-options-trust-for-lookup" class="dlist">
<dl>
<dt class="hdlist1"><code>--trust-for-lookup <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The AWS account IDs that should be trusted to look up values in this environment.</p>
<div class="paragraph">
<p>Use this option to give accounts permission to synthesize stacks that will be deployed into the environment, without actually giving them permission to deploy those stacks directly.</p>
</div>
<div class="paragraph">
<p>You can provide this option multiple times in a single command.</p>
</div>
<div class="paragraph">
<p>This option applies to modern bootstrapping only.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>[]</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-bootstrap-examples">18.7.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-bootstrap-examples-1">Bootstrap the AWS environment specified in the prod profile</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --profile prod</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-bootstrap-examples-2">Deploy the bootstrap stack to environments foo and bar</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --app='node bin/main.js' foo bar</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-bootstrap-examples-3">Export the bootstrap template to customize it</h5>
<div class="paragraph">
<p>If you have specific requirements that are not met by the bootstrap template, you can customize it to fit your needs.</p>
</div>
<div class="paragraph">
<p>You can export the bootstrap template, modify it, and deploy it using AWS CloudFormation. The following is an example of exporting the existing template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --show-template &gt; bootstrap-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also tell the CDK  <code class="noloc">CLI</code> to use a custom template. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --template my-bootstrap-template.yaml</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-bootstrap-examples-4">Bootstrap with a permissions boundary. Then, remove that permissions boundary</h5>
<div class="paragraph">
<p>To bootstrap with a custom permissions boundary, we run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --custom-permissions-boundary my-permissions-boundary</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove the permissions boundary, we run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --no-previous-parameters</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-bootstrap-examples-5">Use a qualifier to distinguish resources that are created for a development environment</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk bootstrap --qualifier dev2024</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-context">18.8. <code class="noloc">cdk context</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Manage cached context values for your AWS CDK application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Manage cached context values for your AWS CDK application.</p>
</div>
<div class="paragraph">
<p><em>Context</em> represents the configuration and environment information that can influence how your stacks are synthesized and deployed. Use <code>cdk context</code> to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View your configured context values.</p>
</li>
<li>
<p>Set and manage context values.</p>
</li>
<li>
<p>Remove context values.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-context-usage">18.8.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk context &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-context-options">18.8.2. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-context-options-clear" class="dlist">
<dl>
<dt class="hdlist1"><code>--clear <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Clear all context.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-context-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Ignore missing key error.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-context-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk context</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-context-options-reset" class="dlist">
<dl>
<dt class="hdlist1"><code>--reset, -e <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The context key, or its index, to reset.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-deploy">18.9. <code class="noloc">cdk deploy</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Deploy one or more AWS CDK stacks into your AWS environment.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Deploy one or more AWS CDK stacks into your AWS environment.</p>
</div>
<div class="paragraph">
<p>During deployment, the CDK <code class="noloc">CLI</code> will output progress indicators, similar to what can be observed from the AWS CloudFormation console.</p>
</div>
<div class="paragraph">
<p>If the AWS environment is not bootstrapped, only stacks without assets and with synthesized templates under 51,200 bytes will successfully deploy.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-deploy-usage">18.9.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-deploy-args">18.9.2. Arguments</h4>
<div id="ref-cli-cmd-deploy-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to deploy.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-deploy-options">18.9.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-deploy-options-all" class="dlist">
<dl>
<dt class="hdlist1"><code>--all <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Deploy all stacks in your CDK app.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-asset-parallelism" class="dlist">
<dl>
<dt class="hdlist1"><code>--asset-parallelism <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether to build and publish assets in parallel.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-asset-prebuild" class="dlist">
<dl>
<dt class="hdlist1"><code>--asset-prebuild <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether to build all assets before deploying the first stack. This option is useful for failing <code class="noloc">Docker</code> builds.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-build-exclude" class="dlist">
<dl>
<dt class="hdlist1"><code>--build-exclude, -E <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Do not rebuild asset with the given ID.</p>
<div class="paragraph">
<p>This option can be specified multiple times in a single command.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>[]</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-change-set-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--change-set-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the AWS CloudFormation change set to create.</p>
<div class="paragraph">
<p>This option is not compatible with <code>--method='direct'</code>.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-concurrency" class="dlist">
<dl>
<dt class="hdlist1"><code>--concurrency <code class="replaceable">NUMBER</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Deploy multiple stacks in parallel while accounting for inter-stack dependencies. Use this option to speed up deployments. You must still factor in AWS CloudFormation and other AWS account rate limiting.</p>
<div class="paragraph">
<p>Provide a number to specify the maximum number of simultaneous deployments (dependency permitting) to perform.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>1</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-exclusively" class="dlist">
<dl>
<dt class="hdlist1"><code>--exclusively, -e <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Only deploy requested stacks and don&#8217;t include dependencies.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When you deploy to update an existing stack, the CDK <code class="noloc">CLI</code> will compare the template and tags of the deployed stack to the stack about to be deployed. If no changes are detected, the CDK  <code class="noloc">CLI</code> will skip deployment.</p>
<div class="paragraph">
<p>To override this behavior and always deploy stacks, even if no changes are detected, use this option.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk deploy</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-hotswap" class="dlist">
<dl>
<dt class="hdlist1"><code>--hotswap <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Hotswap deployments for faster development. This option attempts to perform a faster, hotswap deployment if possible. For example, if you modify the code of a Lambda function in your CDK app, the CDK <code class="noloc">CLI</code> will update the resource directly through service APIs instead of performing a CloudFormation deployment.</p>
<div class="paragraph">
<p>If the CDK <code class="noloc">CLI</code> detects changes that don&#8217;t support hotswapping, those changes will be ignored and a message will display. If you prefer to perform a full CloudFormation deployment as a fall back, use  <code>--hotswap-fallback</code> instead.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> uses your current AWS credentials to perform the API calls. It does not assume the roles from your bootstrap stack, even if the  <code>@aws-cdk/core:newStyleStackSynthesis</code> feature flag is set to <code>true</code>. Those roles do not have the necessary permissions to update AWS resources directly, without using CloudFormation. For that reason, make sure that your credentials are for the same AWS account of the stacks that you are performing hotswap deployments against and that they have the necessary IAM permissions to update the resources.</p>
</div>
<div class="paragraph">
<p>Hotswapping is currently supported for the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code assets (including <code class="noloc">Docker</code> images and inline code), tag changes, and configuration changes (only description and environment variables are supported) of Lambda functions.</p>
</li>
<li>
<p>Lambda versions and alias changes.</p>
</li>
<li>
<p>Definition changes of AWS Step Functions state machines.</p>
</li>
<li>
<p>Container asset changes of Amazon ECS services.</p>
</li>
<li>
<p>Website asset changes of Amazon S3 bucket deployments.</p>
</li>
<li>
<p>Source and environment changes of AWS CodeBuild projects.</p>
</li>
<li>
<p>VTL mapping template changes for AWS AppSync resolvers and functions.</p>
</li>
<li>
<p>Schema changes for AWS AppSync <code class="noloc">GraphQL</code> APIs.</p>
<div class="paragraph">
<p>Usage of certain CloudFormation intrinsic functions are supported as part of a hotswapped deployment. These include:</p>
</div>
</li>
<li>
<p><code>Ref</code></p>
</li>
<li>
<p><code>Fn::GetAtt</code> – Only partially supported. Refer to <a href="https://github.com/aws/aws-cdk/blob/main/packages/aws-cdk/lib/api/evaluate-cloudformation-template.ts#L477-L492">this implementation</a> for supported resources and attributes.</p>
</li>
<li>
<p><code>Fn::ImportValue</code></p>
</li>
<li>
<p><code>Fn::Join</code></p>
</li>
<li>
<p><code>Fn::Select</code></p>
</li>
<li>
<p><code>Fn::Split</code></p>
</li>
<li>
<p><code>Fn::Sub</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This option is also compatible with nested stacks.</p>
</div>
<div class="paragraph">
<p>+
NOTE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This option deliberately introduces drift in CloudFormation stacks in order to speed up deployments. For this reason, only use it for development purposes. Do not use this option for your production deployments.</p>
</li>
<li>
<p>This option is considered experimental and may have breaking changes in the future.</p>
</li>
<li>
<p>Defaults for certain parameters may be different with the hotswap parameter. For example, an Amazon ECS service&#8217;s minimum healthy percentage will currently be set at <code>0</code>. Review the source accordingly if this occurs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
<div id="ref-cli-cmd-deploy-options-hotswap-fallback" class="dlist">
<dl>
<dt class="hdlist1"><code>--hotswap-fallback <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>This option is is similar to <code>--hotswap</code>. The difference being that <code>--hotswap-fallback</code> will fall back to perform a full CloudFormation deployment if a change is detected that requires it.</p>
<div class="paragraph">
<p>For more information about this option, see <code>--hotswap</code>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-ignore-no-stacks" class="dlist">
<dl>
<dt class="hdlist1"><code>--ignore-no-stacks <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Perform a deployment even if your CDK app doesn&#8217;t contain any stacks.</p>
<div class="paragraph">
<p>This option is helpful in the following scenario: You may have an app with multiple environments, such as <code>dev</code> and <code>prod</code>. When starting development, your prod app may not have any resources, or the resources may be commented out. This will result in a deployment error with a message stating that the app has no stacks. Use <code>--ignore-no-stacks</code> to bypass this error.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-import-existing-resources" class="dlist">
<dl>
<dt class="hdlist1"><code>--import-existing-resources <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Import existing, unmanaged AWS CloudFormation resources from your AWS account.</p>
<div class="paragraph">
<p>When you use this option, resources from your synthesized AWS CloudFormation template with the same custom name as existing unmanaged resources in the same account will be imported into your stack.</p>
</div>
<div class="paragraph">
<p>You can use this option to import existing resources into new or existing stacks.</p>
</div>
<div class="paragraph">
<p>You can import existing resources and deploy new resources in the same <code>cdk deploy</code> command.</p>
</div>
<div class="paragraph">
<p>To learn more about custom names, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-name.html">Name type</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="paragraph">
<p>To learn more about the <code>ImportExistingResources</code> CloudFormation parameter, see <a href="https://aws.amazon.com/about-aws/whats-new/2023/11/aws-cloudformation-import-parameter-changesets/">AWS CloudFormation simplifies resource import with a new parameter for ChangeSets</a>.</p>
</div>
<div class="paragraph">
<p>For more information on using this option, see <a href="https://github.com/aws/aws-cdk-cli/tree/main/packages/aws-cdk#import-existing-resources">Import existing resources</a> in the <em>aws-cdk-cli <code class="noloc">GitHub</code> repository</em>.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-logs" class="dlist">
<dl>
<dt class="hdlist1"><code>--logs <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show Amazon CloudWatch log in the standard output (<code>stdout</code>) for all events from all resources in the selected stacks.</p>
<div class="paragraph">
<p>This option is only compatible with <code>--watch</code>.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-method" class="dlist">
<dl>
<dt class="hdlist1"><code>--method, -m <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configure the method to perform a deployment.</p>
<div class="ulist">
<ul>
<li>
<p><code>change-set</code> – Default method. The CDK <code class="noloc">CLI</code> creates a CloudFormation change set with the changes that will be deployed, then performs deployment.</p>
</li>
<li>
<p><code>direct</code> – Do not create a change set. Instead, apply the change immediately. This is typically faster than creating a change set, but you lose progress information.</p>
</li>
<li>
<p><code>prepare-change-set</code> – Create change set but don&#8217;t perform deployment. This is useful if you have external tools that will inspect the change set or if you have an approval process for change sets.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Valid values</em>: <code>change-set</code>, <code>direct</code>, <code>prepare-change-set</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>change-set</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-notification-arns" class="dlist">
<dl>
<dt class="hdlist1"><code>--notification-arns <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The ARNs of Amazon SNS topics that CloudFormation will notify for stack related events.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-outputs-file" class="dlist">
<dl>
<dt class="hdlist1"><code>--outputs-file, -O <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The path to where stack outputs from deployments are written to.</p>
<div class="paragraph">
<p>After deployment, stack outputs will be written to the specified output file in JSON format.</p>
</div>
<div class="paragraph">
<p>You can configure this option in the project&#8217;s <code class="path">cdk.json</code> file or at  <code class="path">~/.cdk.json</code> on your local development machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "app": "npx ts-node bin/myproject.ts",
   // ...
   "outputsFile": "outputs.json"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If multiple stacks are deployed, outputs are written to the same output file, organized by keys representing the stack name.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-parameters" class="dlist">
<dl>
<dt class="hdlist1"><code>--parameters <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Pass additional parameters to CloudFormation during deployment.</p>
<div class="paragraph">
<p>This option accepts an array in the following format: <code>STACK:KEY=VALUE</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>STACK</code> – The name of the stack to associate the parameter with.</p>
</li>
<li>
<p><code>KEY</code> – The name of the parameter from your stack.</p>
</li>
<li>
<p><code>VALUE</code> – The value to pass at deployment.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a stack name is not provided, or if  <code>\*</code> is provided as the stack name, parameters will be applied to all stacks being deployed. If a stack does not make use of the parameter, deployment will fail.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Parameters do not propagate to nested stacks. To pass parameters to nested stacks, use the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.NestedStack.html">NestedStack</a></code> construct.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>{}</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-previous-parameters" class="dlist">
<dl>
<dt class="hdlist1"><code>--previous-parameters <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use previous values for existing parameters.</p>
<div class="paragraph">
<p>When this option is set to <code>false</code>, you must specify all parameters on every deployment.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-progress" class="dlist">
<dl>
<dt class="hdlist1"><code>--progress <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configure how the CDK <code class="noloc">CLI</code> displays deployment progress.</p>
<div class="ulist">
<ul>
<li>
<p><code>bar</code> – Display stack deployment events as a progress bar, with the events for the resource currently being deployed.</p>
</li>
<li>
<p><code>events</code> – Provide a complete history, including all CloudFormation events.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also configure this option in the project&#8217;s  <code class="path">cdk.json</code> file or at  <code class="path">~/.cdk.json</code> on your local development machine:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "progress": "events"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Valid values</em>: <code>bar</code>, <code>events</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>bar</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-require-approval" class="dlist">
<dl>
<dt class="hdlist1"><code>--require-approval <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify what security-sensitive changes require manual approval.</p>
<div class="ulist">
<ul>
<li>
<p>`any-change ` – Manual approval required for any change to the stack.</p>
</li>
<li>
<p><code>broadening</code> – Manual approval required if changes involve a broadening of permissions or security group rules.</p>
</li>
<li>
<p><code>never</code> – Approval is not required.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Valid values</em>: <code>any-change</code>, <code>broadening</code>, <code>never</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>broadening</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-rollback" class="dlist">
<dl>
<dt class="hdlist1"><code>--rollback</code> | <code>--no-rollback</code>, <code>-R</code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>During deployment, if a resource fails to be created or updated, the deployment will roll back to the latest stable state before the CDK <code class="noloc">CLI</code> returns. All changes made up to that point will be undone. Resources that were created will be deleted and updates that were made will be rolled back.</p>
<div class="paragraph">
<p>Specify <code>--no-rollback</code> to turn off this behavior. If a resource fails to be created or updated, the CDK <code class="noloc">CLI</code> will leave changes made up to that point in place and return. This will leave your deployment in a failed, paused state. From here, you can update your code and try the deployment again. This may be helpful in development environments where you are iterating quickly.</p>
</div>
<div class="paragraph">
<p>If a deployment performed with <code>--no-rollback</code> fails, and you decide that you want to rollback the deployment, you can use the <code>cdk rollback</code> command. For more information, see <a href="#ref-cli-cmd-rollback">cdk rollback</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With <code>--no-rollback</code>, deployments that cause resource replacements will always fail. You can only use this option value for deployments that update or create new resources.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>--rollback</code></p>
</div>
<div id="ref-cli-cmd-deploy-options-toolkit-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--toolkit-stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the existing CDK Toolkit stack.</p>
<div class="paragraph">
<p>By default, <code>cdk bootstrap</code> deploys a stack named <code class="path">CDKToolkit</code> into the specified AWS environment. Use this option to provide a different name for your bootstrap stack.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> uses this value to verify your bootstrap stack version.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-deploy-options-watch" class="dlist">
<dl>
<dt class="hdlist1"><code>--watch <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Continuously observe CDK project files, and deploy the specified stacks automatically when changes are detected.</p>
<div class="paragraph">
<p>This option implies <code>--hotswap</code> by default.</p>
</div>
<div class="paragraph">
<p>This option has an equivalent CDK <code class="noloc">CLI</code> command. For more information, see  <a href="#ref-cli-cmd-watch">cdk watch</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-deploy-examples">18.9.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-deploy-examples-1">Deploy the stack named MyStackName</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy MyStackName --app='node bin/main.js'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-deploy-examples-2">Deploy multiple stacks in an app</h5>
<div class="paragraph">
<p>Use  <code>cdk list</code> to list your stacks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk list
CdkHelloWorldStack
CdkStack2
CdkStack3</code></pre>
</div>
</div>
<div class="paragraph">
<p>To deploy all stacks, use the  <code>--all</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --all</code></pre>
</div>
</div>
<div class="paragraph">
<p>To choose which stacks to deploy, provide stack names as arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy CdkHelloWorldStack CdkStack3</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-deploy-examples-3">Deploy pipeline stacks</h5>
<div class="paragraph">
<p>Use  <code>cdk list</code> to show stack names as paths, showing where they are in the pipeline hierarchy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk list
PipelineStack
PiplelineStack/Prod
PipelineStack/Prod/MyService</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the  <code>--all</code> option or the wildcard <code>*</code> to deploy all stacks. If you have a hierarchy of stacks as described above, <code>--all</code> and <code>\*</code> will only match stacks on the top level. To match all stacks in the hierarchy, use <code>\**</code>.</p>
</div>
<div class="paragraph">
<p>You can combine these patterns. The following deploys all stacks in the <code>Prod</code> stage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy PipelineStack/Prod/**</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-deploy-examples-4">Pass parameters at deployment</h5>
<div class="paragraph">
<p>Define parameters in your CDK stack. The following is an example that creates a parameter named  <code>TopicNameParam</code> for an Amazon SNS topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new sns.Topic(this, 'TopicParameter', {
    topicName: new cdk.CfnParameter(this, 'TopicNameParam').value.toString()
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>To provide a parameter value of  <code>parameterized</code>, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --parameters "MyStackName:TopicNameParam=parameterized"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override parameter values by using the  <code>--force</code> option. The following is an example of overriding the topic name from a previous deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --parameters "MyStackName:TopicNameParam=parameterName" --force</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-deploy-examples-5">Write stack outputs to a file after deployment</h5>
<div class="paragraph">
<p>Define outputs in your CDK stack file. The following is an example that creates an output for a function ARN:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const fn = new lambda.Function(this, "fn", {
  handler: "index.handler",
  code: lambda.Code.fromInline(`exports.handler = \${handler.toString()}`),
  runtime: lambda.Runtime.NODEJS_LATEST
});

new cdk.CfnOutput(this, 'FunctionArn', {
  value: fn.functionArn,
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploy the stack and write outputs to  <code class="path">outputs.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --outputs-file outputs.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of  <code class="path">outputs.json</code> after deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "MyStack": {
    "FunctionArn": "arn:aws:lambda:us-east-1:123456789012:function:MyStack-fn5FF616E3-G632ITHSP5HK"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this example, the key  <code>FunctionArn</code> corresponds to the logical ID of the <code>CfnOutput</code> instance.</p>
</div>
<div class="paragraph">
<p>The following is an example of <code class="path">outputs.json</code> after deployment when multiple stacks are deployed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "MyStack": {
    "FunctionArn": "arn:aws:lambda:us-east-1:123456789012:function:MyStack-fn5FF616E3-G632ITHSP5HK"
  },
  "AnotherStack": {
    "VPCId": "vpc-z0mg270fee16693f"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-deploy-examples-6">Modify the deployment method</h5>
<div class="paragraph">
<p>To deploy faster, without using change sets, use  <code>--method='direct'</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --method='direct'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a change set but don&#8217;t deploy, use  <code>--method='prepare-change-set'</code>. By default, a change set named <code>cdk-deploy-change-set</code> will be created. If a previous change set with this name exists, it will be overwritten. If no changes are detected, an empty change set is still created.</p>
</div>
<div class="paragraph">
<p>You can also name your change set. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --method='prepare-change-set' --change-set-name='MyChangeSetName'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-destroy">18.10. <code class="noloc">cdk destroy</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Delete one or more AWS CDK stacks from your AWS environment.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Delete one or more AWS CDK stacks from your AWS environment.</p>
</div>
<div class="paragraph">
<p>When you delete a stack, resources in the stack will be destroyed, unless they were configured with a <code>DeletionPolicy</code> of <code>Retain</code>.</p>
</div>
<div class="paragraph">
<p>During stack deletion, this command will output progress information similar to <code>cdk deploy</code> behavior.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-destroy-usage">18.10.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk destroy &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-destroy-args">18.10.2. Arguments</h4>
<div id="ref-cli-cmd-destroy-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to delete.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-destroy-options">18.10.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-destroy-options-all" class="dlist">
<dl>
<dt class="hdlist1"><code>--all <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Destroy all available stacks.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-destroy-options-exclusively" class="dlist">
<dl>
<dt class="hdlist1"><code>--exclusively, -e <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Only destroy requested stacks and don&#8217;t include dependencies.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-destroy-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Do not ask for confirmation before destroying the stacks.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-destroy-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk destroy</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-destroy-examples">18.10.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-destroy-examples-1">Delete a stack named MyStackName</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk destroy --app='node bin/main.js' MyStackName</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-diff">18.11. <code class="noloc">cdk diff</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Perform a diff to see infrastructure changes between AWS CDK stacks.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Perform a diff to see infrastructure changes between AWS CDK stacks.</p>
</div>
<div class="paragraph">
<p>This command is typically used to compare differences between the current state of stacks in your local CDK app against deployed stacks. However, you can also compare a deployed stack with any local AWS CloudFormation template.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-diff-usage">18.11.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-diff-args">18.11.2. Arguments</h4>
<div id="ref-cli-cmd-diff-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to perform a diff.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-diff-options">18.11.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-diff-options-change-set" class="dlist">
<dl>
<dt class="hdlist1"><code>--change-set <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether to create a change set to analyze resource replacements.</p>
<div class="paragraph">
<p>When <code>true</code>, the CDK <code class="noloc">CLI</code> will create an AWS CloudFormation change set to display the exact changes that will be made to your stack. This output includes whether resources will be updated or replaced. The CDK  <code class="noloc">CLI</code> uses the deploy role instead of the lookup role to perform this action.</p>
</div>
<div class="paragraph">
<p>When <code>false</code>, a quicker, but less-accurate diff is performed by comparing CloudFormation templates. Any change detected to properties that require resource replacement will be displayed as a resource replacement, even if the change is purely cosmetic, like replacing a resource reference with a hard-coded ARN.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-context-lines" class="dlist">
<dl>
<dt class="hdlist1"><code>--context-lines <code class="replaceable">NUMBER</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Number of context lines to include in arbitrary JSON diff rendering.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>3</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-exclusively" class="dlist">
<dl>
<dt class="hdlist1"><code>--exclusively, -e <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Only diff requested stacks and don&#8217;t include dependencies.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-fail" class="dlist">
<dl>
<dt class="hdlist1"><code>--fail <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Fail and exit with a code of <code>1</code> if differences are detected.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk diff</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-processed" class="dlist">
<dl>
<dt class="hdlist1"><code>--processed <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether to compare against the template with CloudFormation transforms already processed.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-quiet" class="dlist">
<dl>
<dt class="hdlist1"><code>--quiet, -q <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Do not print the CDK stack name and default <code>cdk diff</code> message to <code>stdout</code> when no changes are detected.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-security-only" class="dlist">
<dl>
<dt class="hdlist1"><code>--security-only <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Only diff for broadened security changes.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-strict" class="dlist">
<dl>
<dt class="hdlist1"><code>--strict <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Modify <code>cdk diff</code> behavior to be more precise or stringent. When true, the CDK <code class="noloc">CLI</code> will not filter out  <code>AWS::CDK::Metadata</code> resources or unreadable non-ASCII characters.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-diff-options-template" class="dlist">
<dl>
<dt class="hdlist1"><code>--template <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The path to the CloudFormation template to compare a CDK stack with.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-diff-examples">18.11.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-diff-examples-1">Diff against the currently deployed stack named MyStackName</h5>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> uses the following symbols in the diff output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[+]</code> – Identifies code or resources that will be added if you deploy your changes.</p>
</li>
<li>
<p><code>[-]</code> – Identifies code or resources that will be removed if you deploy your changes.</p>
</li>
<li>
<p><code>[~]</code> – Identifies a resource or property that will be modified if you deploy your changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example that shows a diff of local changes to a Lambda function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff MyStackName
start: Building asset-hash:account-Region
success: Built asset-hash:account-Region
start: Publishing asset-hash:account-Region
success: Published asset-hash:account-Region
Hold on while we create a read-only change set to get a diff with accurate replacement information (use --no-change-set to use a less accurate but faster template-only diff)
Stack MyStackName
Resources
[~] AWS::Lambda::Function HelloWorldFunction resource-logical-ID
 └─ [~] Code
     └─ [~] .ZipFile:
         ├─ [-]
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello World!'),
          };
        };

         └─ [+]
        exports.handler = async function(event) {
          return {
            statusCode: 200,
            body: JSON.stringify('Hello from CDK!'),
          };
        };



✨  Number of stacks with differences: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>A  <code>[~]</code> indicator for resources that will be modified does not always mean a full resource replacement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some resource properties, like <code>Code</code>, will update the resource.</p>
</li>
<li>
<p>Some resource properties, like <code>FunctionName</code>, may cause a full resource replacement.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-diff-examples-2">Diff against a specific CloudFormation template</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff MyStackName --app='node bin/main.js' --template-path='./MyStackNameTemplate.yaml'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-diff-examples-3">Diff a local stack with its deployed stack. Don&#8217;t print to stdout if no changes are detected</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk diff MyStackName --app='node bin/main.js' --quiet</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-docs">18.12. <code class="noloc">cdk docs</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Open AWS CDK documentation in your browser.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Open AWS CDK documentation in your browser.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-docs-usage">18.12.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk docs &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-docs-options">18.12.2. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-docs-options-browser" class="dlist">
<dl>
<dt class="hdlist1"><code>--browser, -b <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The command to use to open the browser, using <code>%u</code> as a placeholder for the path of the file to open.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>open %u</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-docs-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk docs</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-docs-examples">18.12.3. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-docs-examples-1">Open AWS CDK documentation in  <code class="noloc">Google Chrome</code></h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk docs --browser='chrome %u'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-doctor">18.13. <code class="noloc">cdk doctor</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Inspect and display useful information about your local AWS CDK project and development environment.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Inspect and display useful information about your local AWS CDK project and development environment.</p>
</div>
<div class="paragraph">
<p>This information can help with troubleshooting CDK issues and should be provided when submitting bug reports.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-doctor-usage">18.13.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk doctor &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-doctor-options">18.13.2. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-doctor-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk doctor</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-doctor-examples">18.13.3. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-doctor-examples-1">Simple example of the  <code>cdk doctor</code> command</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk doctor
ℹ️ CDK Version: 1.0.0 (build e64993a)
ℹ️ AWS environment variables:
  - AWS_EC2_METADATA_DISABLED = 1
  - AWS_SDK_LOAD_CONFIG = 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-gc">18.14. <code class="noloc">cdk gc</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use the AWS Cloud Development Kit (AWS CDK) command line interface (<code class="noloc">CLI</code>)  <code>cdk gc</code> command to perform garbage collection on unused assets stored in the resources of your bootstrap stack. Use this command to view, manage, and delete assets that you no longer need.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Use the AWS Cloud Development Kit (AWS CDK) command line interface (<code class="noloc">CLI</code>)  <code>cdk gc</code> command to perform garbage collection on unused assets stored in the resources of your bootstrap stack. Use this command to view, manage, and delete assets that you no longer need.</p>
</div>
<div class="paragraph">
<p>For Amazon Simple Storage Service (Amazon S3) assets, the CDK <code class="noloc">CLI</code> will check existing AWS CloudFormation templates in the same environment to see if they are referenced. If not referenced, they will be considered unused and eligible for garbage collection actions.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>cdk gc</code> command is in development for the AWS CDK. The current features of this command are considered production ready and safe to use. However, the scope of this command and its features are subject to change. Therefore, you must opt in by providing the <code>unstable=gc</code> option to use this command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-gc-usage">18.14.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk gc &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-gc-args">18.14.2. Arguments</h4>
<div id="ref-cli-cmd-gc-args-env" class="dlist">
<dl>
<dt class="hdlist1">AWS environment</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The target AWS environment to perform garbage collection actions on.</p>
<div class="paragraph">
<p>When providing an environment, use the following format: <code>aws://[replaceable]</code>&lt;account-id&gt;<code>/[replaceable]</code>&lt;region&gt;<code><code>`. For example, </code>aws://<code class="replaceable">123456789012</code>/<code class="replaceable">us-east-1</code>`</code>.</p>
</div>
<div class="paragraph">
<p>This argument can be provided multiple times in a single command to perform garbage collection actions on multiple environments.</p>
</div>
<div class="paragraph">
<p>By default, the CDK <code class="noloc">CLI</code> will perform garbage collection actions on all environments that you reference in your CDK app or provide as arguments. If you don&#8217;t provide an environment, the CDK  <code class="noloc">CLI</code> will determine the environment from default sources. These sources include environments that you specify using the  <code>--profile</code> option, environment variables, or default AWS CLI sources.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-gc-options">18.14.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-gc-options-action" class="dlist">
<dl>
<dt class="hdlist1"><code>--action <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The action that <code>cdk gc</code> performs on your assets during a garbage collection.</p>
<div class="ulist">
<ul>
<li>
<p><code>delete-tagged</code> – Deletes assets that have been tagged with a date within the range of buffer days that you provide, but does not tag newly identified unused assets.</p>
</li>
<li>
<p><code>full</code> – Perform all garbage collection actions. This includes deleting assets within the range of buffer days that you provide and tagging newly identified unused assets.</p>
</li>
<li>
<p><code>print</code> – Outputs the number of unused assets at the command prompt but doesn&#8217;t make any actual changes within your AWS environment.</p>
</li>
<li>
<p><code>tag</code> – Tags any newly identified unused assets, but doesn&#8217;t delete any assets within the range of buffer days that you provide.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Accepted values</em>: <code>delete-tagged</code>, <code>full</code>, <code>print</code>, <code>tag</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>full</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-bootstrap-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--bootstrap-stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the CDK bootstrap stack in your AWS environment. Provide this option if you customized your bootstrap stack name. If you are using the default <code>CDKToolkit</code> stack name, you don&#8217;t have to provide this option.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>CDKToolkit</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-confirm" class="dlist">
<dl>
<dt class="hdlist1"><code>--confirm <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether the CDK <code class="noloc">CLI</code> will request manual confirmation from you before deleting any assets.</p>
<div class="paragraph">
<p>Specify <code>false</code> to automatically delete assets without prompting you for manual confirmation.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-created-buffer-days" class="dlist">
<dl>
<dt class="hdlist1"><code>--created-buffer-days <code class="replaceable">NUMBER</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The number of days an asset must exist before it is eligible for garbage collection actions.</p>
<div class="paragraph">
<p>When you provide a number, assets that have not existed beyond your specified number of days are filtered out from garbage collection actions.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>1</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk gc</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-rollback-buffer-days" class="dlist">
<dl>
<dt class="hdlist1"><code>--rollback-buffer-days <code class="replaceable">NUMBER</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The number of days an asset must be tagged as isolated before it is eligible for garbage collection actions.</p>
<div class="paragraph">
<p>When you provide a number, the CDK <code class="noloc">CLI</code> will tag unused assets with the current date instead of deleting them. The CDK  <code class="noloc">CLI</code> will also check if any assets have been tagged during previous runs of the  <code>cdk gc</code> command. Previously tagged assets that fall within the range of buffer days you provide will be deleted.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>0</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-type" class="dlist">
<dl>
<dt class="hdlist1"><code>--type <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The bootstrap resource type within your bootstrap stack to perform garbage collection actions on.</p>
<div class="ulist">
<ul>
<li>
<p><code>all</code> – Perform garbage collection actions on all bootstrapped resources.</p>
</li>
<li>
<p><code>ecr</code> – Perform garbage collection actions on assets in the Amazon Elastic Container Registry (Amazon ECR) repository of your bootstrap stack.</p>
</li>
<li>
<p><code>s3</code> – Perform garbage collection actions on assets in the Amazon S3 bucket of your bootstrap stack.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Accepted values</em>: <code>all</code>, <code>ecr</code>, <code>s3</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>all</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-gc-options-unstable" class="dlist">
<dl>
<dt class="hdlist1"><code>--unstable <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Allow the usage of CDK <code class="noloc">CLI</code> commands that are still in development.</p>
<div class="paragraph">
<p>This option is required to use any CDK <code class="noloc">CLI</code> command that is still in development and subject to change.</p>
</div>
<div class="paragraph">
<p>This option can be provided multiple times in a single command.</p>
</div>
<div class="paragraph">
<p>To use <code>cdk gc</code>, provide <code>--unstable=gc</code>.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-gc-examples">18.14.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-gc-examples-basic">Basic examples</h5>
<div class="paragraph">
<p>The following example prompts you for manual confirmation to perform default garbage collection actions on assets in the Amazon S3 bucket of your bootstrap stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk gc --unstable=gc --type=s3

 ⏳  Garbage Collecting environment aws://&lt;account-id&gt;/&lt;region&gt;...
Found 99 assets to delete based off of the following criteria:
- assets have been isolated for &gt; 0 days
- assets were created &gt; 1 days ago

Delete this batch (yes/no/delete-all)?</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example performs garbage collection actions on a range of assets in the Amazon S3 bucket of your bootstrap stack. This range includes assets that have been previously tagged by  <code>cdk gc</code> for over 30 days and have been created 10 days or older. This command will prompt for manual confirmation before deleting any assets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk gc --unstable=gc --type=s3 --rollback-buffer-days=30 --created-buffer-days=10</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example performs the action of deleting previously tagged assets in the Amazon S3 bucket of your bootstrap stack that have been unused for longer than 30 days:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk gc --unstable=gc --type=s3 --action=delete-tagged --rollback-buffer-days=30</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-import">18.15. <code class="noloc">cdk import</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import.html">AWS CloudFormation resource imports</a> to import existing AWS resources into a CDK stack.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Use  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import.html">AWS CloudFormation resource imports</a> to import existing AWS resources into a CDK stack.</p>
</div>
<div class="paragraph">
<p>With this command, you can take existing resources that were created using other methods and start managing them using the AWS CDK.</p>
</div>
<div class="paragraph">
<p>When considering moving resources into CDK management, sometimes creating new resources is acceptable, such as with IAM roles, Lambda functions, and event rules. For other resources, such as stateful resources like Amazon S3 buckets and DynamoDB tables, creating new resources can cause impacts to your service. You can use <code>cdk import</code> to import existing resources with minimal disruption to your services. For a list of supported AWS resources, see <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/resource-import-supported-resources.html">Resource type support</a> in the <em>AWS CloudFormation User Guide</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run a <code>cdk diff</code> to make sure your CDK stack has no pending changes. When performing a <code>cdk import</code>, the only changes allowed in an import operation are the addition of new resources being imported.</p>
</li>
<li>
<p>Add constructs for the resources you want to import to your stack. For example, add the following for an Amazon S3 bucket:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new s3.Bucket(this, 'ImportedS3Bucket', {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do not add any other changes. You must also make sure to exactly model the state that the resource currently has. For the bucket example, be sure to include AWS KMS keys, lifecycle policies, and anything else that is relevant about the bucket. Otherwise, subsequent update operations may not do what you expect.</p>
</div>
</li>
<li>
<p>Run <code>cdk import</code>. If there are multiple stacks in the CDK app, pass a specific stack name as an argument.</p>
</li>
<li>
<p>The CDK <code class="noloc">CLI</code> will prompt you to pass in the actual names of the resources you are importing. After you provide this information, import will begin.</p>
</li>
<li>
<p>When <code>cdk import</code> reports success, the resource will be managed by the CDK. Any subsequent changes in the construct configuration will be reflected on the resource.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This feature currently has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Importing resources into nested stacks isn&#8217;t possible.</p>
</li>
<li>
<p>There is no check on whether the properties you specify are correct and complete for the imported resource. Try starting a drift detection operation after importing.</p>
</li>
<li>
<p>Resources that depend on other resources must all be imported together, or individually, in the right order. Otherwise, the CloudFormation deployment will fail with unresolved references.</p>
</li>
<li>
<p>This command uses the deploy role credentials, which is necessary to read the encrypted staging bucket. This requires version 12 of the bootstrap template, which includes the necessary IAM permissions for the deploy role.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-import-usage">18.15.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk import &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-import-args">18.15.2. Arguments</h4>
<div id="ref-cli-cmd-import-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to import resources to. This argument can be provided multiple times in a single command.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-import-options">18.15.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-import-options-change-set-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--change-set-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the CloudFormation change set to create.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-execute" class="dlist">
<dl>
<dt class="hdlist1"><code>--execute <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether to execute change set.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, the CDK <code class="noloc">CLI</code> exits the process if the template diff includes updates or deletions. Specify  <code>true</code> to override this behavior and always continue with importing.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk import</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-record-resource-mapping" class="dlist">
<dl>
<dt class="hdlist1"><code>--record-resource-mapping, -r <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use this option to generate a mapping of existing physical resources to the CDK resources that will be imported. The mapping will be written to the file path that you provide. No actual import operations will be performed.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-resource-mapping" class="dlist">
<dl>
<dt class="hdlist1"><code>--resource-mapping, -m <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use this option to specify a file that defines your resource mapping. The CDK <code class="noloc">CLI</code> will use this file to map physical resources to resources for import instead of interactively asking you.</p>
<div class="paragraph">
<p>This option can be run from scripts.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-rollback" class="dlist">
<dl>
<dt class="hdlist1"><code>--rollback <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Roll back the stack to stable state on failure.</p>
<div class="paragraph">
<p>To specify <code>false</code>, you can use <code>--no-rollback</code> or <code>-R</code>.</p>
</div>
<div class="paragraph">
<p>Specify <code>false</code> to iterate more rapidly. Deployments containing resource replacements will always fail.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-import-options-toolkit-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--toolkit-stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the CDK Toolkit stack to create.</p>
<div class="paragraph">
<p>By default, <code>cdk bootstrap</code> deploys a stack named <code class="path">CDKToolkit</code> into the specified AWS environment. Use this option to provide a different name for your bootstrap stack.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> uses this value to verify your bootstrap stack version.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-init">18.16. <code class="noloc">cdk init</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Create a new AWS CDK project from a template.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Create a new AWS CDK project from a template.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-init-usage">18.16.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-init-args">18.16.2. Arguments</h4>
<div id="ref-cli-cmd-init-args-template-type" class="dlist">
<dl>
<dt class="hdlist1">Template type</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The CDK template type to initialize a new CDK project from.</p>
<div class="ulist">
<ul>
<li>
<p><code>app</code> – Template for a CDK application.</p>
</li>
<li>
<p><code>lib</code> – Template for an AWS Construct Library.</p>
</li>
<li>
<p><code>sample-app</code> – Example CDK application that includes some constructs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Valid values</em>: <code>app</code>, <code>lib</code>, <code>sample-app</code></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-init-options">18.16.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-init-options-generate-only" class="dlist">
<dl>
<dt class="hdlist1"><code>--generate-only <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify this option to generate project files without initiating additional operations such as setting up a git repository, installing dependencies, or compiling the project.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-init-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk init command</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-init-options-language" class="dlist">
<dl>
<dt class="hdlist1"><code>--language, -l <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The language to be used for the new project. This option can be configured in the project&#8217;s <code class="path">cdk.json</code> configuration file or at  <code class="path">~/.cdk.json</code> on your local development machine.</p>
<div class="paragraph">
<p><em>Valid values</em>: <code>csharp</code>, <code>fsharp</code>, <code>go</code>, <code>java</code>, <code>javascript</code>, <code>python</code>, <code>typescript</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-init-options-list" class="dlist">
<dl>
<dt class="hdlist1"><code>--list <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>List the available template types and languages.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-init-examples">18.16.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-init-examples-1">List the available template types and languages</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init --list
Available templates:
* app: Template for a CDK Application
   └─ cdk init app --language=[csharp|fsharp|go|java|javascript|python|typescript]
* lib: Template for a CDK Construct Library
   └─ cdk init lib --language=typescript
* sample-app: Example CDK Application with some constructs
   └─ cdk init sample-app --language=[csharp|fsharp|go|java|javascript|python|typescript]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-init-examples-2">Create a new CDK app in TypeScript from the library template</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init lib --language=typescript</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-list">18.17. <code class="noloc">cdk list</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>List all AWS CDK stacks and their dependencies from a CDK app.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>List all AWS CDK stacks and their dependencies from a CDK app.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-list-usage">18.17.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk list &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-list-args">18.17.2. Arguments</h4>
<div id="ref-cli-cmd-list-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to perform this command against.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-list-options">18.17.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-list-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk list</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-list-options-long" class="dlist">
<dl>
<dt class="hdlist1"><code>--long, -l <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Display AWS environment information for each stack.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-list-options-show-dependencies" class="dlist">
<dl>
<dt class="hdlist1"><code>--show-dependencies, -d <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Display stack dependency information for each stack.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-list-examples">18.17.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-list-examples-1">List all stacks in the CDK app &#8216;node bin/main.js&#8217;</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk list --app='node bin/main.js'
Foo
Bar
Baz</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-list-examples-">List all stacks, including AWS environment details for each stack</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk list --app='node bin/main.js' --long
-
    name: Foo
    environment:
        name: 000000000000/bermuda-triangle-1
        account: '000000000000'
        region: bermuda-triangle-1
-
    name: Bar
    environment:
        name: 111111111111/bermuda-triangle-2
        account: '111111111111'
        region: bermuda-triangle-2
-
    name: Baz
    environment:
        name: 333333333333/bermuda-triangle-3
        account: '333333333333'
        region: bermuda-triangle-3</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-metadata">18.18. <code class="noloc">cdk metadata</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Display metadata associated with a CDK stack.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Display metadata associated with a CDK stack.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-metadata-usage">18.18.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk metadata &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-metadata-args">18.18.2. Arguments</h4>
<div id="ref-cli-cmd-metadata-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to display metadata for.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-metadata-options">18.18.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-metadata-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk metadata</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cdk-migrate">18.19. <code class="noloc">cdk migrate</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Migrate deployed AWS resources, AWS CloudFormation stacks, and CloudFormation templates into a new AWS CDK project.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Migrate deployed AWS resources, AWS CloudFormation stacks, and CloudFormation templates into a new AWS CDK project.</p>
</div>
<div class="paragraph">
<p>This command creates a new CDK app that includes a single stack that is named with the value you provide using <code>--stack-name</code>. You can configure the migration source using <code>--from-scan</code>, <code>--from-stack</code>, or <code>--from-path</code>.</p>
</div>
<div class="paragraph">
<p>For more information on using <code>cdk migrate</code>, see <a href="#migrate">Migrate existing resources and AWS CloudFormation templates to the AWS CDK</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>cdk migrate</code> command is experimental and may have breaking changes in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ref-cli-cdk-migrate-usage">18.19.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cdk-migrate-options">18.19.2. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div class="sect4">
<h5 id="ref-cli-cdk-migrate-options-required">Required options</h5>
<div id="ref-cli-cdk-migrate-options-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the AWS CloudFormation stack that will be created within the CDK app after migrating.</p>
<div class="paragraph">
<p><em>Required</em>: Yes</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cdk-migrate-options-conditional">Conditional options</h5>
<div id="ref-cli-cdk-migrate-options-from-path" class="dlist">
<dl>
<dt class="hdlist1"><code>--from-path <code class="replaceable">PATH</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The path to the AWS CloudFormation template to migrate. Provide this option to specify a local template.</p>
<div class="paragraph">
<p><em>Required</em>: Conditional. Required if migrating from a local AWS CloudFormation template.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-from-scan" class="dlist">
<dl>
<dt class="hdlist1"><code>--from-scan <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When migrating deployed resources from an AWS environment, use this option to specify whether a new scan should be started or if the AWS CDK <code class="noloc">CLI</code> should use the last successful scan.</p>
<div class="paragraph">
<p><em>Required</em>: Conditional. Required when migrating from deployed AWS resources.</p>
</div>
<div class="paragraph">
<p><em>Accepted values</em>: <code>most-recent</code>, <code>new</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-from-stack" class="dlist">
<dl>
<dt class="hdlist1"><code>--from-stack <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Provide this option to migrate from a deployed AWS CloudFormation stack. Use <code>--stack-name</code> to specify the name of the deployed AWS CloudFormation stack.</p>
<div class="paragraph">
<p><em>Required</em>: Conditional. Required if migrating from a deployed AWS CloudFormation stack.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cdk-migrate-options-optional">Optional options</h5>
<div id="ref-cli-cdk-migrate-options-account" class="dlist">
<dl>
<dt class="hdlist1"><code>--account <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The account to retrieve the AWS CloudFormation stack template from.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default</em>: The AWS CDK <code class="noloc">CLI</code> obtains account information from default sources.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-compress" class="dlist">
<dl>
<dt class="hdlist1"><code>--compress <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Provide this option to compress the generated CDK project into a <code class="noloc">ZIP</code> file.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-filter" class="dlist">
<dl>
<dt class="hdlist1"><code>--filter <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Use when migrating deployed resources from an AWS account and AWS Region. This option specifies a filter to determine which deployed resources to migrate.</p>
<div class="paragraph">
<p>This option accepts an array of key-value pairs, where <strong>key</strong> represents the filter type and <strong>value</strong> represents the value to filter.</p>
</div>
<div class="paragraph">
<p>The following are accepted keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resource-identifier</code> – An identifier for the resource. Value can be the resource logical or physical ID. For example, <code>resource-identifier="ClusterName"</code>.</p>
</li>
<li>
<p><code>resource-type-prefix</code> – The AWS CloudFormation resource type prefix. For example, specify <code>resource-type-prefix="AWS::DynamoDB::"</code> to filter all Amazon DynamoDB resources.</p>
</li>
<li>
<p><code>tag-key</code> – The key of a resource tag. For example, <code>tag-key="myTagKey"</code>.</p>
</li>
<li>
<p><code>tag-value</code> – The value of a resource tag. For example, <code>tag-value="myTagValue"</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Provide multiple key-value pairs for  <code>AND</code> conditional logic. The following example filters for any DynamoDB resource that is tagged with <code>myTagKey</code> as the tag key: <code>--filter resource-type-prefix="AWS::DynamoDB::", tag-key="myTagKey"</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Provide the <code>--filter</code> option multiple times in a single command for <code>OR</code> conditional logic. The following example filters for any resource that is a DynamoDB resource or is tagged with <code>myTagKey</code> as the tag key: <code>--filter resource-type-prefix="AWS::DynamoDB::" --filter tag-key="myTagKey"</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk migrate</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-language" class="dlist">
<dl>
<dt class="hdlist1"><code>--language <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The programming language to use for the CDK project created during migration.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Valid values</em>: <code>typescript</code>, <code>python</code>, <code>java</code>, <code>csharp</code>, <code>go</code>.</p>
</div>
<div class="paragraph">
<p><em>Default</em>: <code>typescript</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-output-path" class="dlist">
<dl>
<dt class="hdlist1"><code>--output-path <code class="replaceable">PATH</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The output path for the migrated CDK project.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default</em>: By default, the AWS CDK <code class="noloc">CLI</code> will use your current working directory.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cdk-migrate-options-region" class="dlist">
<dl>
<dt class="hdlist1"><code>--region <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The AWS Region to retrieve the AWS CloudFormation stack template from.</p>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
<div class="paragraph">
<p><em>Default</em>: The AWS CDK <code class="noloc">CLI</code> obtains AWS Region information from default sources.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cdk-migrate-examples">18.19.3. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cdk-migrate-examples-1">Simple example of migrating from a CloudFormation stack</h5>
<div class="paragraph">
<p>Migrate from a deployed CloudFormation stack in a specific AWS environment using  <code>--from-stack</code>. Provide <code>--stack-name</code> to name your new CDK stack. The following is an example that migrates <code>myCloudFormationStack</code> to a new CDK app that is using <code class="noloc">TypeScript</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate --language typescript --from-stack --stack-name 'myCloudFormationStack'</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cdk-migrate-examples-2">Simple example of migrating from a local CloudFormation template</h5>
<div class="paragraph">
<p>Migrate from a local JSON or YAML CloudFormation template using  <code>--from-path</code>. Provide <code>--stack-name</code> to name your new CDK stack. The following is an example that creates a new CDK app in <code class="noloc">TypeScript</code> that includes a  <code>myCloudFormationStack</code> stack from a local <code class="path">template.json</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate --stack-name "myCloudFormationStack" --language typescript --from-path "./template.json"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cdk-migrate-examples-3">Simple example of migrating from deployed AWS resources</h5>
<div class="paragraph">
<p>Migrate deployed AWS resources from a specific AWS environment that are not associated with a CloudFormation stack using  <code>--from-scan</code>. The CDK <code class="noloc">CLI</code> utilizes the  <code class="noloc">IaC generator</code> service to scan for resources and generate a template. Then, the CDK  <code class="noloc">CLI</code> references the template to create the new CDK app. The following is an example that creates a new CDK app in  <code class="noloc">TypeScript</code> with a new  <code>myCloudFormationStack</code> stack containing migrated AWS resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk migrate --language typescript --from-scan --stack-name "myCloudFormationStack"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-notices">18.20. <code class="noloc">cdk notices</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Display notices for your CDK application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Display notices for your CDK application.</p>
</div>
<div class="paragraph">
<p>Notices can include important messages regarding security vulnerabilities, regressions, and usage of unsupported versions.</p>
</div>
<div class="paragraph">
<p>This command displays relevant notices, regardless of whether they have been acknowledged or not. Relevant notices may also appear after every command by default.</p>
</div>
<div class="paragraph">
<p>You can suppress notices in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Through command options. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy --no-notices</code></pre>
</div>
</div>
</li>
<li>
<p>Suppress all notices indefinitely through context in the project&#8217;s <code class="path">cdk.json</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "notices": false,
  "context": {
    // ...
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Acknowledge each notice with the <code>cdk acknowledge</code> command.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-notices-usage">18.20.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk notices &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-notices-options">18.20.2. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-notices-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk notices</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-notices-examples">18.20.3. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-notices-examples-1">Example of a default notice that displays after running the cdk deploy command</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy

... # Normal output of the command

NOTICES

16603   Toggling off auto_delete_objects for Bucket empties the bucket

        Overview: If a stack is deployed with an S3 bucket with
                  auto_delete_objects=True, and then re-deployed with
                  auto_delete_objects=False, all the objects in the bucket
                  will be deleted.

        Affected versions: &lt;1.126.0.

        More information at: https://github.com/aws/aws-cdk/issues/16603


17061   Error when building EKS cluster with monocdk import

        Overview: When using monocdk/aws-eks to build a stack containing
                  an EKS cluster, error is thrown about missing
                  lambda-layer-node-proxy-agent/layer/package.json.

        Affected versions: &gt;=1.126.0 &lt;=1.130.0.

        More information at: https://github.com/aws/aws-cdk/issues/17061


If you don’t want to see an notice anymore, use "cdk acknowledge ID". For example, "cdk acknowledge 16603"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-notices-examples-2">Simple example of running the cdk notices command</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk notices

NOTICES

16603   Toggling off auto_delete_objects for Bucket empties the bucket

        Overview: if a stack is deployed with an S3 bucket with
                  auto_delete_objects=True, and then re-deployed with
                  auto_delete_objects=False, all the objects in the bucket
                  will be deleted.

        Affected versions: framework: &lt;=2.15.0 &gt;=2.10.0

        More information at: https://github.com/aws/aws-cdk/issues/16603


If you don’t want to see a notice anymore, use "cdk acknowledge &lt;id&gt;". For example, "cdk acknowledge 16603"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-rollback">18.21. <code class="noloc">cdk rollback</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Use the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>)  <code>cdk rollback</code> command to rollback a failed or paused stack from an AWS CloudFormation deployment to its last stable state.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Use the AWS Cloud Development Kit (AWS CDK) Command Line Interface (<code class="noloc">CLI</code>)  <code>cdk rollback</code> command to rollback a failed or paused stack from an AWS CloudFormation deployment to its last stable state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use this command, you must have v23 of the bootstrap template deployed to your environment. For more information, see <a href="#bootstrap-template-history">Bootstrap template version history</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you deploy using  <code>cdk deploy</code>, the CDK <code class="noloc">CLI</code> will rollback a failed deployment by default. If you specify  <code>--no-rollback</code> with <code>cdk deploy</code>, you can then use the <code>cdk rollback</code> command to manually rollback a failed deployment. This will initiate a rollback to the last stable state of your stack.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-rollback-usage">18.21.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk rollback &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-rollback-args">18.21.2. Arguments</h4>
<div id="ref-cli-cmd-rollback-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to rollback.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-rollback-options">18.21.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-rollback-options-all" class="dlist">
<dl>
<dt class="hdlist1"><code>--all <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Rollback all stacks in your CDK app.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-rollback-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When you use <code>cdk rollback</code>, some resources may fail to rollback. Provide this option to force the rollback of all resources. This is the same behavior as providing the <code>--orphan</code> option for each resource in your stack.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-rollback-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk rollback</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-rollback-options-orphan" class="dlist">
<dl>
<dt class="hdlist1"><code>--orphan <code class="replaceable">LogicalId</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When you use <code>cdk rollback</code>, some resources may fail to rollback. When this happens, you can try to force the rollback of a resource by using this option and providing the logical ID of the resource that failed to rollback.</p>
<div class="paragraph">
<p>This option can be provided multiple times in a single command The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk rollback MyStack --orphan MyLambdaFunction --orphan MyLambdaFunction2</code></pre>
</div>
</div>
<div class="paragraph">
<p>To force the rollback of all resources, use the  <code>--force</code> option instead.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-rollback-options-toolkit-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--toolkit-stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the existing CDK Toolkit stack that the environment is bootstrapped with.</p>
<div class="paragraph">
<p>By default, <code>cdk bootstrap</code> deploys a stack named <code class="path">CDKToolkit</code> into the specified AWS environment. Use this option to provide a different name for your bootstrap stack.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> uses this value to verify your bootstrap stack version.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-rollback-options-validate-bootstrap-version" class="dlist">
<dl>
<dt class="hdlist1"><code>--validate-bootstrap-version <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Specify whether to validate the bootstrap stack version. Provide <code>--validate-bootstrap-version=false</code> or <code>--no-validate-bootsrap-version</code> to turn off this behavior.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-synth">18.22. <code class="noloc">cdk synthesize</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Synthesize a CDK app to produce a cloud assembly, including an AWS CloudFormation template for each stack.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Synthesize a CDK app to produce a cloud assembly, including an AWS CloudFormation template for each stack.</p>
</div>
<div class="paragraph">
<p>Cloud assemblies are files that include everything needed to deploy your app to your AWS environment. For example, it includes a CloudFormation template for each stack in your app, and a copy of the file assets or <code class="noloc">Docker</code> images that you reference in your app.</p>
</div>
<div class="paragraph">
<p>If your app contains a single stack or if a single stack is provided as an argument, the CloudFormation template will also be displayed in the standard output (<code>stdout</code>) in YAML format.</p>
</div>
<div class="paragraph">
<p>If your app contains multiple stacks, <code>cdk synth</code> will synthesize the cloud assembly to <code class="path">cdk.out</code>.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-synth-usage">18.22.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synthesize &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-synth-args">18.22.2. Arguments</h4>
<div id="ref-cli-cmd-synth-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to synthesize.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-synth-options">18.22.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-synth-options-exclusively" class="dlist">
<dl>
<dt class="hdlist1"><code>--exclusively, -e <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Only synthesize requested stacks, don&#8217;t include dependencies.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-synth-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk synthesize</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-synth-options-quiet" class="dlist">
<dl>
<dt class="hdlist1"><code>--quiet, -q <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Do not output the CloudFormation template to <code>stdout</code>.</p>
<div class="paragraph">
<p>This option can be configured in the CDK project&#8217;s <code class="path">cdk.json</code> file. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "quiet": true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-synth-options-validation" class="dlist">
<dl>
<dt class="hdlist1"><code>--validation <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Validate the generated CloudFormation templates after synthesis by performing additional checks.</p>
<div class="paragraph">
<p>You can also configure this option through the <code>validateOnSynth</code> attribute or <code>CDK_VALIDATION</code> environment variable.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-synth-examples">18.22.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-synth-examples-1">Synthesize the cloud assembly for a CDK stack with logial ID MyStackName and output the CloudFormation template to stdout</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth MyStackName</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-synth-examples-2">Synthesize the cloud assembly for all stacks in a CDK app and save them into cdk.out</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-synth-examples-3">Synthesize the cloud assembly for MyStackName, but don&#8217;t include dependencies</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth MyStackName --exclusively</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-synth-examples-4">Synthesize the cloud assembly for MyStackName, but don&#8217;t output the CloudFormation template to stdout</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth MyStackName --quiet</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ref-cli-cmd-watch">18.23. <code class="noloc">cdk watch</code></h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Continuously watch a local AWS CDK project for changes to perform deployments and hotswaps.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Continuously watch a local AWS CDK project for changes to perform deployments and hotswaps.</p>
</div>
<div class="paragraph">
<p>This command is similar to <code>cdk deploy</code>, except that it can perform continuous deployments and hotswaps through a single command.</p>
</div>
<div class="paragraph">
<p>This command is a shortcut for <code>cdk deploy --watch</code>.</p>
</div>
<div class="paragraph">
<p>To end a <code>cdk watch</code> session, interrupt the process by pressing <code>Ctrl+C</code>.</p>
</div>
<div class="paragraph">
<p>The files that are observed is determined by the <code>"watch"</code> setting in your <code class="path">cdk.json</code> file. It has two sub-keys,  <code>"include"</code> and <code>"exclude"</code>, that accepts a single string or an array of strings. Each entry is interpreted as a path relative to the location of the <code class="path">cdk.json</code> file. Both  <code>*</code> and <code>\**</code> are accepted.</p>
</div>
<div class="paragraph">
<p>If you create a project using the <code>cdk init</code> command, the following default behavior is configured for <code>cdk watch</code> in your project&#8217;s <code class="path">cdk.json</code> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"include"</code> is set to <code>"<strong>*/</strong>"</code>, which includes all files and directories in the root of the project.</p>
</li>
<li>
<p><code>"exclude"</code> is optional, except for files and folders already ignored by default. This consists of files and directories starting with <code>.</code>, the CDK output directory, and the <code class="path">node_modules</code> directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The minimal setting to configure  <code>watch</code> is <code>"watch": {}</code>.</p>
</div>
<div class="paragraph">
<p>If either your CDK code or application code requires a build step before deployment, <code>cdk watch</code> works with the <code>"build"</code> key in the <code class="path">cdk.json</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This command is considered experimental and may have breaking changes in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same limitations of  <code>cdk deploy --hotswap</code> applies to <code>cdk watch</code>. For more information, see <code><a href="#ref-cli-cmd-deploy-options-hotswap">cdk deploy --hotswap</a></code>.</p>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-watch-usage">18.23.1. Usage</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk watch &lt;arguments&gt; &lt;options&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-watch-args">18.23.2. Arguments</h4>
<div id="ref-cli-cmd-watch-args-stack-name" class="dlist">
<dl>
<dt class="hdlist1">CDK stack ID</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The construct ID of the CDK stack from your app to watch.</p>
<div class="paragraph">
<p><em>Type</em>: String</p>
</div>
<div class="paragraph">
<p><em>Required</em>: No</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-watch-options">18.23.3. Options</h4>
<div class="paragraph">
<p>For a list of global options that work with all CDK  <code class="noloc">CLI</code> commands, see  <a href="#ref-cli-cmd-options">Global options</a>.</p>
</div>
<div id="ref-cli-cmd-watch-options-build-exclude" class="dlist">
<dl>
<dt class="hdlist1"><code>--build-exclude, -E <code class="replaceable">ARRAY</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Do not rebuild asset with the given ID.</p>
<div class="paragraph">
<p>This option can be specified multiple times in a single command.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>[]</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-change-set-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--change-set-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the CloudFormation change set to create.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-concurrency" class="dlist">
<dl>
<dt class="hdlist1"><code>--concurrency <code class="replaceable">NUMBER</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Deploy and hotswap multiple stacks in parallel while accounting for inter-stack dependencies. Use this option to speed up deployments. You must still factor in CloudFormation and other AWS account rate limiting.</p>
<div class="paragraph">
<p>Provide a number to specify the maximum number of simultaneous deployments (dependency permitting) to perform.</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>1</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-exclusively" class="dlist">
<dl>
<dt class="hdlist1"><code>--exclusively, -e <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Only deploy requested stacks and don&#8217;t include dependencies.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-force" class="dlist">
<dl>
<dt class="hdlist1"><code>--force, -f <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Always deploy stacks, even if templates are identical.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>false</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-help" class="dlist">
<dl>
<dt class="hdlist1"><code>--help, -h <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Show command reference information for the <code>cdk watch</code> command.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-hotswap" class="dlist">
<dl>
<dt class="hdlist1"><code>--hotswap <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, <code>cdk watch</code> uses hotswap deployments when possible to update your resources. The CDK <code class="noloc">CLI</code> will attempt to perform a hotswap deployment and will not fall back to a full CloudFormation deployment if unsuccessful. Any changes detected that cannot be updated through a hotswap are ignored.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-hotswap-fallback" class="dlist">
<dl>
<dt class="hdlist1"><code>--hotswap-fallback <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, <code>cdk watch</code> attempts to perform hotswap deployments and ignores changes that require CloudFormation deployments. Provide <code>--hotswap-fallback</code> to fall back and perform a full CloudFormation deployment if the hotswap deployment is unsuccessful.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-logs" class="dlist">
<dl>
<dt class="hdlist1"><code>--logs <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>By default, <code>cdk watch</code> monitors all CloudWatch log groups in your application and streams the log events locally to <code>stdout</code>.</p>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-progress" class="dlist">
<dl>
<dt class="hdlist1"><code>--progress <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Configure how the CDK <code class="noloc">CLI</code> displays deployment progress.</p>
<div class="ulist">
<ul>
<li>
<p><code>bar</code> – Display stack deployment events as a progress bar, with the events for the resource currently being deployed.</p>
</li>
<li>
<p><code>events</code> – Provide a complete history, including all CloudFormation events.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also configure this option in the project&#8217;s  <code class="path">cdk.json</code> file or at  <code class="path">~/.cdk.json</code> on your local development machine:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "progress": "events"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Valid values</em>: <code>bar</code>, <code>events</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>bar</code></p>
</div>
</dd>
</dl>
</div>
<div id="ref-cli-cmd-watch-options-rollback" class="dlist">
<dl>
<dt class="hdlist1"><code>--rollback <code class="replaceable">BOOLEAN</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>During deployment, if a resource fails to be created or updated, the deployment will roll back to the latest stable state before the CDK <code class="noloc">CLI</code> returns. All changes made up to that point will be undone. Resources that were created will be deleted and updates that were made will be rolled back.</p>
<div class="paragraph">
<p>Use <code>--no-rollback</code> or <code>-R</code> to deactivate this behavior. If a resource fails to be created or updated, the CDK <code class="noloc">CLI</code> will leave changes made up to that point in place and return. This may be helpful in development environments where you are iterating quickly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When <code>false</code>, deployments that cause resource replacements will always fail. You can only use this value for deployments that update or create new resources.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Default value</em>: <code>true</code></p>
</div>
<div id="ref-cli-cmd-watch-options-toolkit-stack-name" class="dlist">
<dl>
<dt class="hdlist1"><code>--toolkit-stack-name <code class="replaceable">STRING</code></code></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The name of the existing CDK Toolkit stack.</p>
<div class="paragraph">
<p>By default, <code>cdk bootstrap</code> deploys a stack named <code class="path">CDKToolkit</code> into the specified AWS environment. Use this option to provide a different name for your bootstrap stack.</p>
</div>
<div class="paragraph">
<p>The CDK <code class="noloc">CLI</code> uses this value to verify your bootstrap stack version.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-cli-cmd-watch-examples">18.23.4. Examples</h4>
<div class="sect4">
<h5 id="ref-cli-cmd-watch-examples-1">Watch a CDK stack with logical ID DevelopmentStack for changes</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk watch DevelopmentStack
Detected change to 'lambda-code/index.js' (type: change). Triggering 'cdk deploy'
DevelopmentStack: deploying...

 ✅  DevelopmentStack</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-watch-examples-2">Configure a cdk.json file for what to include and exclude from being watched for changes</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "app": "mvn -e -q compile exec:java",
   "watch": {
    "include": "src/main/**",
    "exclude": "target/*"
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-cli-cmd-watch-examples-3">Build a CDK project using  <code class="noloc">Java</code> before deployment by configuring the cdk.json file</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "mvn -e -q exec:java",
  "build": "mvn package",
  "watch": {
    "include": "src/main/**",
    "exclude": "target/*"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">19. AWS CDK reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains reference information for the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect2">
<h3 id="reference-api">19.1. API reference</h3>
<div class="paragraph">
<p>The  <a href="https://docs.aws.amazon.com/cdk/api/v2">API Reference</a> contains information about the AWS Construct Library and other APIs provided by the AWS Cloud Development Kit (AWS CDK). Most of the AWS Construct Library is contained in a single package called by its <code class="noloc">TypeScript</code> name:  <code>aws-cdk-lib</code>. The actual package name varies by language. Separate versions of the API reference are provided for each supported programming language.</p>
</div>
<div class="paragraph">
<p>The CDK API reference is organized into sub-modules. There are one or more sub-modules for each AWS service.</p>
</div>
<div class="paragraph">
<p>Each sub-module has an overview that includes information about how to use its APIs. For example, the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3-readme.html">S3</a> overview demonstrates how to set default encryption on an Amazon Simple Storage Service (Amazon S3) bucket.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="versioning">19.2. AWS CDK versioning</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This topic provides reference information on how the AWS Cloud Development Kit (AWS CDK) handles versioning.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This topic provides reference information on how the AWS Cloud Development Kit (AWS CDK) handles versioning.</p>
</div>
<div class="paragraph">
<p>Version numbers consist of three numeric version parts: <em>major</em>.<em>minor</em>.<em>patch</em>, and strictly adhere to the <a href="https://semver.org">semantic versioning</a> model. This means that breaking changes to stable APIs are limited to major releases.</p>
</div>
<div class="paragraph">
<p>Minor and patch releases are backward compatible. The code written in a previous version with the same major version can be upgraded to a newer version within the same major version. It will also continue to build and run, producing the same output.</p>
</div>
<div class="paragraph topiclist">
<p>[[Topic List]]</p>
</div>
<div class="sect3">
<h4 id="cdk-toolkit-versioning">19.2.1. AWS CDK <code class="noloc">CLI</code> compatibility</h4>
<div class="paragraph">
<p>Each version of the main AWS CDK library (<code>aws-cdk-lib</code>) is compatible with the AWS CDK <code class="noloc">CLI</code> (<code>aws-cdk-cli</code>) version that was current at the time of the CDK library&#8217;s release. It is also compatible with any newer version of the CDK <code class="noloc">CLI</code>. Each version of the CDK library maintains this compatibility until the library&#8217;s  <em>End of Life</em> date. Therefore, as long as you&#8217;re using a supported CDK library version, it is always safe to upgrade your CDK <code class="noloc">CLI</code> version.</p>
</div>
<div class="paragraph">
<p>Each version of the CDK library may also work with CDK <code class="noloc">CLI</code> versions older than the version that was current at the time of the CDK library&#8217;s release. However, this is not guaranteed. Compatibility depends on the CDK library&#8217;s cloud assembly schema version. The AWS CDK generates a cloud assembly during synthesis and the CDK  <code class="noloc">CLI</code> consumes it for deployment. The schema that defines the format of the cloud assembly is strictly specified and versioned. Therefore, an older version of the CDK  <code class="noloc">CLI</code> would need to support the cloud assembly schema version of the CDK library for them to be compatible.</p>
</div>
<div class="paragraph">
<p>When the cloud assembly version required by the CDK library is not compatible with the version supported by the CDK <code class="noloc">CLI</code>, you receive an error message like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cloud assembly schema version mismatch: Maximum schema version supported is 3.0.0, but found 4.0.0.
    Please upgrade your CLI in order to interact with this app.</pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this error, update the CDK  <code class="noloc">CLI</code> to a version compatible with the required cloud assembly version, or to the latest available version. The alternative (downgrading the construct library modules your app uses) is generally not recommended.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on the exact combinations of versions that work together, see the <a href="https://github.com/aws/aws-cdk-cli/blob/main/COMPATIBILITY.md">compatibility table</a> in the <em>aws-cdk-cli <code class="noloc">GitHub</code> repository</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="aws-construct-lib-stability">19.2.2. AWS Construct Library versioning</h4>
<div class="paragraph">
<p>The modules in the AWS Construct Library move through various stages as they are developed from concept to mature API. Different stages offer varying degrees of API stability in subsequent versions of the AWS CDK.</p>
</div>
<div class="paragraph">
<p>APIs in the main AWS CDK library, <code>aws-cdk-lib</code>, are stable, and the library is fully semantically versioned. This package includes AWS CloudFormation (L1) constructs for all AWS services and all stable higher-level (L2 and L3) modules. (It also includes the core CDK classes like <code>App</code> and <code>Stack</code>). APIs will not be removed from this package (though they may be deprecated) until the next major release of the CDK. No individual API will ever have breaking changes. When a breaking change is required, an entirely new API will be added.</p>
</div>
<div class="paragraph">
<p>New APIs under development for a service already incorporated in <code>aws-cdk-lib</code> are identified using a <code>Beta<code class="replaceable">N</code></code> suffix, where <code>N</code> starts at 1 and is incremented with each breaking change to the new API. <code>Beta<code class="replaceable">N</code></code> APIs are never removed, only deprecated, so your existing app continues to work with newer versions of <code>aws-cdk-lib</code>. When the API is deemed stable, a new API without the <code>Beta<code class="replaceable">N</code></code> suffix is added.</p>
</div>
<div class="paragraph">
<p>When higher-level (L2 or L3) APIs begin to be developed for an AWS service that previously had only L1 APIs, those APIs are initially distributed in a separate package. The name of such a package has an "Alpha" suffix, and its version matches the first version of <code>aws-cdk-lib</code> it is compatible with, with an <code>alpha</code> sub-version. When the module supports the intended use cases, its APIs are added to <code>aws-cdk-lib</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="aws-construct-lib-versioning-binding">19.2.3. Language binding stability</h4>
<div class="paragraph">
<p>Over time, we might add support to the AWS CDK for additional programming languages. Although the API described in all the languages is the same, the way that API is expressed varies by language and might change as the language support evolves. For this reason, language bindings are deemed experimental for a time until they are considered ready for production use.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Language</th>
<th class="tableblock halign-left valign-top">Stability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TypeScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C#/.NET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Go</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stable</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2 topic">
<h3 id="videos">19.3. AWS CDK video resources</h3>
<div class="paragraph">
<p>Enjoy these videos presented by members of the AWS CDK team.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the AWS CDK is always evolving, some of the code presented in these videos may not work quite the same way it did when the video was recorded. This is especially true for modules that were under active development at the time. It&#8217;s also possible that we&#8217;ve since added a better way to achieve the same result. Consult this Developer Guide and the <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html">AWS CDK API Reference</a> for up-to-date information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="videos-infrastructure-is-code">19.3.1. Infrastructure  <em>is</em> Code with the AWS CDK</h4>
<div class="videoblock">
<div class="content">
<iframe width="800" height="450" src="https://www.youtube.com/embed/ZWCvNFUN-sU?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect3">
<h4 id="videos-deep-dive">19.3.2. Deep dive into AWS Cloud Development Kit (AWS CDK)</h4>
<div class="videoblock">
<div class="content">
<iframe width="800" height="450" src="https://www.youtube.com/embed/9As_ZIjUGmY?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect3">
<h4 id="videos-contributing">19.3.3. Contributing to the AWS Construct Library</h4>
<div class="videoblock">
<div class="content">
<iframe width="800" height="450" src="https://www.youtube.com/embed/LsYlf7ggyrY?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect3">
<h4 id="videos-pipeliens">19.3.4. Faster deployments with CDK Pipelines</h4>
<div class="videoblock">
<div class="content">
<iframe width="800" height="450" src="https://www.youtube.com/embed/1ps0Wh19MHQ?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect3">
<h4 id="videos-gitpod">19.3.5. How to contribute to the AWS CDK using GitPod</h4>
<div class="videoblock">
<div class="content">
<iframe width="800" height="450" src="https://www.youtube.com/embed/u6XcIgs-Nok?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="how-tos">20. AWS CDK tutorials and examples</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This section contains tutorials and examples for the AWS Cloud Development Kit (AWS CDK).</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This section contains tutorials and examples for the AWS Cloud Development Kit (AWS CDK).</p>
</div>
<div id="tutorials" class="dlist">
<dl>
<dt class="hdlist1">Tutorials</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Tutorials provide you with step-by-step instructions that you can follow to implement a task using the AWS CDK.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="examples" class="dlist">
<dl>
<dt class="hdlist1">Examples</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Examples show and explain how specific tasks can be implemented using the AWS CDK. They do not provide direct step-by-step instructions for you to follow.</p>
<div class="paragraph">
<p>For more examples of AWS CDK stacks and apps in your favorite supported programming language, see the <a href="https://github.com/aws-samples/aws-cdk-examples">AWS CDK Examples</a> repository on GitHub.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect2 topic">
<h3 id="serverless-example">20.1. Tutorial: Create a serverless Hello World application</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>In this tutorial, you use the AWS CDK to create a simple serverless <code class="noloc">Hello World</code> application that implements a basic API backend.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In this tutorial, you use the AWS Cloud Development Kit (AWS CDK) to create a simple serverless  <code class="noloc">Hello World</code> application that implements a basic API backend consisting of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Amazon API Gateway <code class="noloc">REST API</code></strong> – Provides an HTTP endpoint that is used to invoke your function through an <code class="noloc">HTTP GET</code> request.</p>
</li>
<li>
<p><strong>AWS Lambda function</strong> – Function that returns a <code>Hello World!</code> message when invoked with the <code class="noloc">HTTP</code> endpoint.</p>
</li>
<li>
<p><strong>Integrations and permissions</strong> – Configuration details and permissions for your resources to interact with one another and perform actions, such as writing logs to Amazon CloudWatch.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following diagram shows the components of this application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-example-01.png" alt="Diagram of a Lambda function that is invoked when you send a GET request to the API Gateway endpoint.">
</div>
</div>
<div class="paragraph">
<p>For this tutorial, you will create and interact with your application in the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an AWS CDK project.</p>
</li>
<li>
<p>Define a Lambda function and API Gateway REST API using L2 constructs from the AWS Construct Library.</p>
</li>
<li>
<p>Deploy your application to the AWS Cloud.</p>
</li>
<li>
<p>Interact with your application in the AWS Cloud.</p>
</li>
<li>
<p>Delete the sample application from the AWS Cloud.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="serverless-example-pre">Prerequisites</h4>
<div class="paragraph">
<p>Before starting this tutorial, complete the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an AWS account and have the AWS Command Line Interface (AWS CLI) installed and configured.</p>
</li>
<li>
<p>Install <code class="noloc">Node.js</code> and  <code class="noloc">npm</code>.</p>
</li>
<li>
<p>Install the CDK Toolkit globally, using <code>npm install -g aws-cdk</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see  <a href="#getting-started">Getting started with the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>We also recommend a basic understanding of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#home">What is the AWS CDK?</a> for a basic introduction to the AWS CDK.</p>
</li>
<li>
<p><a href="#core-concepts">Learn AWS CDK core concepts</a> for an overview of core concepts of the AWS CDK.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-project">20.1.1. Step 1: Create a CDK project</h4>
<div class="paragraph">
<p>In this step, you create a new CDK project using the AWS CDK  <code class="noloc">CLI</code><code>cdk init</code> command.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a starting directory of your choice, create and navigate to a project directory named <code class="path">cdk-hello-world</code> on your machine:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir cdk-hello-world &amp;&amp; cd cdk-hello-world</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>cdk init</code> command to create a new project in your preferred programming language:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cdk init --language typescript</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Install AWS CDK libraries:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ npm install aws-cdk-lib constructs</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init --language javascript</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Install AWS CDK libraries:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ npm install aws-cdk-lib constructs</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init --language python</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Activate the virtual environment:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ source .venv/bin/activate # On Windows, run '.\venv\Scripts\activate' instead</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Install AWS CDK libraries and project dependencies:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(.venv)$ python3 -m pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init --language java</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Install AWS CDK libraries and project dependencies:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mvn package</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init --language csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Install AWS CDK libraries and project dependencies:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ dotnet restore src</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk init --language go</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>Install project dependencies:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ go get github.com/aws/aws-cdk-go/awscdk/v2
$ go get github.com/aws/aws-cdk-go/awscdk/v2/awslambda
$ go get github.com/aws/aws-cdk-go/awscdk/v2/awsapigateway
$ go mod tidy</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> creates a project with the following structure:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
├── .git
├── .gitignore
├── .npmignore
├── README.md
├── bin
│   └── cdk-hello-world.ts
├── cdk.json
├── jest.config.js
├── lib
│   └── cdk-hello-world-stack.ts
├── node_modules
├── package-lock.json
├── package.json
├── test
│   └── cdk-hello-world.test.ts
└── tsconfig.json</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
├── .git
├── .gitignore
├── .npmignore
├── README.md
├── bin
│   └── cdk-hello-world.js
├── cdk.json
├── jest.config.js
├── lib
│   └── cdk-hello-world-stack.js
├── node_modules
├── package-lock.json
├── package.json
└── test
    └── cdk-hello-world.test.js</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
├── .git
├── .gitignore
├── .venv
├── README.md
├── app.py
├── cdk.json
├── cdk_hello_world
│   ├── __init__.py
│   └── cdk_hello_world_stack.py
├── requirements-dev.txt
├── requirements.txt
├── source.bat
└── tests</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
├── .git
├── .gitignore
├── README.md
├── cdk.json
├── pom.xml
├── src
│   ├── main
│   │   └── java
│   │       └── com
│   │           └── myorg
│   │               ├── CdkHelloWorldApp.java
│   │               └── CdkHelloWorldStack.java
└── target</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
├── .git
├── .gitignore
├── README.md
├── cdk.json
└── src
    ├── CdkHelloWorld
    │   ├── CdkHelloWorld.csproj
    │   ├── CdkHelloWorldStack.cs
    │   ├── GlobalSuppressions.cs
    │   └── Program.cs
    └── CdkHelloWorld.sln</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>**</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
├── .git
├── .gitignore
├── README.md
├── cdk-hello-world.go
├── cdk-hello-world_test.go
├── cdk.json
├── go.mod
└── go.sum</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CDK  <code class="noloc">CLI</code> automatically creates a CDK app that contains a single stack. The CDK app instance is created from the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.App.html">App</a></code> class. The following is a portion of your CDK application file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">bin/cdk-hello-world.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { CdkHelloWorldStack } from '../lib/cdk-hello-world-stack';

const app = new cdk.App();
new CdkHelloWorldStack(app, 'CdkHelloWorldStack', {
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">bin/cdk-hello-world.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
const cdk = require('aws-cdk-lib');
const { CdkHelloWorldStack } = require('../lib/cdk-hello-world-stack');
const app = new cdk.App();
new CdkHelloWorldStack(app, 'CdkHelloWorldStack', {
});</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">app.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3
import os
import aws_cdk as cdk
from cdk_hello_world.cdk_hello_world_stack import CdkHelloWorldStack

app = cdk.App()
CdkHelloWorldStack(app, "CdkHelloWorldStack",)
app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/CdkHelloWorldApp.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

import java.util.Arrays;

public class JavaApp {
    public static void main(final String[] args) {
        App app = new App();

        new JavaStack(app, "JavaStack", StackProps.builder()
                .build());

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/CdkHelloWorld/Program.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using System;
using System.Collections.Generic;
using System.Linq;

namespace CdkHelloWorld
{
    sealed class Program
    {
        public static void Main(string[] args)
        {
            var app = new App();
            new CdkHelloWorldStack(app, "CdkHelloWorldStack", new StackProps
            {

            });
            app.Synth();
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">cdk-hello-world.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main
import (
    "github.com/aws/aws-cdk-go/awscdk/v2"
    "github.com/aws/constructs-go/constructs/v10"
    "github.com/aws/jsii-runtime-go"
)

// ...

func main() {
    defer jsii.Close()
    app := awscdk.NewApp(nil)
    NewCdkHelloWorldStack(app, "CdkHelloWorldStack", &amp;CdkHelloWorldStackProps{
        awscdk.StackProps{
            Env: env(),
        },
    })
    app.Synth(nil)
}

func env() *awscdk.Environment {
    return nil
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-function">20.1.2. Step 2: Create your Lambda function</h4>
<div class="paragraph">
<p>Within your CDK project, create a  <code class="path">lambda</code> directory that includes a new  <code class="path">hello.js</code> file. The following is an example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir lambda &amp;&amp; cd lambda
$ touch hello.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should now be added to your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
└── lambda
    └── hello.js</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir lambda &amp;&amp; cd lambda
$ touch hello.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should now be added to your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
└── lambda
    └── hello.js</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir lambda &amp;&amp; cd lambda
$ touch hello.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should now be added to your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
└── lambda
    └── hello.js</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir -p src/main/resources/lambda
$ cd src/main/resources/lambda
$ touch hello.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should now be added to your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
└── src
    └── main
        └──resources
            └──lambda
                └──hello.js</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir lambda &amp;&amp; cd lambda
$ touch hello.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should now be added to your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
└── lambda
    └── hello.js</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mkdir lambda &amp;&amp; cd lambda
$ touch hello.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should now be added to your CDK project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk-hello-world
└── lambda
    └── hello.js</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To keep this tutorial simple, we use a  <code class="noloc">JavaScript</code> Lambda function for all CDK programming languages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Define your Lambda function by adding the following to the newly created file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">exports.handler = async (event) =&gt; {
    return {
        statusCode: 200,
        headers: { "Content-Type": "text/plain" },
        body: JSON.stringify({ message: "Hello, World!" }),
    };
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-constructs">20.1.3. Step 3: Define your constructs</h4>
<div class="paragraph">
<p>In this step, you will define your Lambda and API Gateway resources using AWS CDK L2 constructs.</p>
</div>
<div class="paragraph">
<p>Open the project file that defines your CDK stack. You will modify this file to define your constructs. The following is an example of your starting stack file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/cdk-hello-world-stack.ts</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

export class CdkHelloWorldStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Your constructs will go here

  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">lib/cdk-hello-world-stack.js</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');
const lambda = require('aws-cdk-lib/aws-lambda');
const apigateway = require('aws-cdk-lib/aws-apigateway');

class CdkHelloWorldStack extends Stack {

  constructor(scope, id, props) {
    super(scope, id, props);

    // Your constructs will go here

  }
}

module.exports = { CdkHelloWorldStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">cdk_hello_world/cdk_hello_world_stack.py</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import Stack
from constructs import Construct

class CdkHelloWorldStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

          // Your constructs will go here</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/main/java/&#8230;&#8203;/CdkHelloWorldStack.java</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.constructs.Construct;
import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;

public class CdkHelloWorldStack extends Stack {
    public CdkHelloWorldStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkHelloWorldStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Your constructs will go here
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located in <code class="path">src/CdkHelloWorld/CdkHelloWorldStack.cs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Constructs;

namespace CdkHelloWorld
{
    public class CdkHelloWorldStack : Stack
    {
        internal CdkHelloWorldStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Your constructs will go here
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Located at <code class="path">cdk-hello-world.go</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
    "github.com/aws/aws-cdk-go/awscdk/v2"
    "github.com/aws/constructs-go/constructs/v10"
    "github.com/aws/jsii-runtime-go"
)

type CdkHelloWorldStackProps struct {
    awscdk.StackProps
}

func NewCdkHelloWorldStack(scope constructs.Construct, id string, props *CdkHelloWorldStackProps) awscdk.Stack {
    var sprops awscdk.StackProps
    if props != nil {
        sprops = props.StackProps
    }
    stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

    // Your constructs will go here

    return stack
}

func main() {

    // ...

}

func env() *awscdk.Environment {

    return nil

}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In this file, the AWS CDK is doing the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your CDK stack instance is instantiated from the <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html">Stack</a></code> class.</p>
</li>
<li>
<p>The <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/constructs-readme.html">Constructs</a></code> base class is imported and provided as the scope or parent of your stack instance.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="serverless-example-constructs-lambda">Define your Lambda function resource</h5>
<div class="paragraph">
<p>To define your Lambda function resource, you import and use the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_lambda-readme.html">aws-lambda</a></code> L2 construct from the AWS Construct Library.</p>
</div>
<div class="paragraph">
<p>Modify your stack file as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
// Import Lambda L2 construct
import * as lambda from 'aws-cdk-lib/aws-lambda';

export class CdkHelloWorldStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // Define the Lambda function resource
    const helloWorldFunction = new lambda.Function(this, 'HelloWorldFunction', {
      runtime: lambda.Runtime.NODEJS_20_X, // Choose any supported Node.js runtime
      code: lambda.Code.fromAsset('lambda'), // Points to the lambda directory
      handler: 'hello.handler', // Points to the 'hello' file in the lambda directory
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const { Stack, Duration } = require('aws-cdk-lib');
// Import Lambda L2 construct
const lambda = require('aws-cdk-lib/aws-lambda');


class CdkHelloWorldStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define the Lambda function resource
    const helloWorldFunction = new lambda.Function(this, 'HelloWorldFunction', {
      runtime: lambda.Runtime.NODEJS_20_X, // Choose any supported Node.js runtime
      code: lambda.Code.fromAsset('lambda'), // Points to the lambda directory
      handler: 'hello.handler', // Points to the 'hello' file in the lambda directory
    });
  }
}

module.exports = { CdkHelloWorldStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    Stack,
    # Import Lambda L2 construct
    aws_lambda as _lambda,
)
# ...

class CdkHelloWorldStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # Define the Lambda function resource
        hello_world_function = _lambda.Function(
            self,
            "HelloWorldFunction",
            runtime = _lambda.Runtime.NODEJS_20_X, # Choose any supported Node.js runtime
            code = _lambda.Code.from_asset("lambda"), # Points to the lambda directory
            handler = "hello.handler", # Points to the 'hello' file in the lambda directory
        )</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
NOTE: We import the <code>aws_lambda</code> module as <code>\_lambda</code> because <code>lambda</code> is a build-in identifier in <code class="noloc">Python</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// ...
// Import Lambda L2 construct
import software.amazon.awscdk.services.lambda.Code;
import software.amazon.awscdk.services.lambda.Function;
import software.amazon.awscdk.services.lambda.Runtime;

public class CdkHelloWorldStack extends Stack {
    public CdkHelloWorldStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkHelloWorldStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // Define the Lambda function resource
        Function helloWorldFunction = Function.Builder.create(this, "HelloWorldFunction")
                .runtime(Runtime.NODEJS_20_X)  // Choose any supported Node.js runtime
                .code(Code.fromAsset("src/main/resources/lambda")) // Points to the lambda directory
                .handler("hello.handler")  // Points to the 'hello' file in the lambda directory
                .build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// ...
// Import Lambda L2 construct
using Amazon.CDK.AWS.Lambda;

namespace CdkHelloWorld
{
    public class CdkHelloWorldStack : Stack
    {
        internal CdkHelloWorldStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
            // Define the Lambda function resource
            var helloWorldFunction = new Function(this, "HelloWorldFunction", new FunctionProps
            {
                Runtime = Runtime.NODEJS_20_X, // Choose any supported Node.js runtime
                Code = Code.FromAsset("lambda"), // Points to the lambda directory
                Handler = "hello.handler" // Points to the 'hello' file in the lambda directory
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">package main

import (
    // ...
    // Import Lambda L2 construct
    "github.com/aws/aws-cdk-go/awscdk/v2/awslambda"
    // Import S3 assets construct
    "github.com/aws/aws-cdk-go/awscdk/v2/awss3assets"
    // ...
)

// ...

func NewCdkHelloWorldStack(scope constructs.Construct, id string, props *CdkHelloWorldStackProps) awscdk.Stack {
    var sprops awscdk.StackProps
    if props != nil {
        sprops = props.StackProps
    }
    stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

    // Define the Lambda function resource
    helloWorldFunction := awslambda.NewFunction(stack, jsii.String("HelloWorldFunction"), &amp;awslambda.FunctionProps{
        Runtime: awslambda.Runtime_NODEJS_20_X(), // Choose any supported Node.js runtime
        Code:    awslambda.Code_FromAsset(jsii.String("lambda"), &amp;awss3assets.AssetOptions{}), // Points to the lambda directory
        Handler: jsii.String("hello.handler"), // Points to the 'hello' file in the lambda directory
    })

    return stack
}

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you create a Lambda function resource and define the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>runtime</code> – The environment the function runs in. Here, we use <code class="noloc">Node.js</code> version  <code class="noloc">20.x</code>.</p>
</li>
<li>
<p><code>code</code> – The path to the function code on your local machine.</p>
</li>
<li>
<p><code>handler</code> – The name of the specific file that contains your function code.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="serverless-example-constructs-api">Define your API Gateway  <code class="noloc">REST API</code> resource</h5>
<div class="paragraph">
<p>To define your API Gateway  <code class="noloc">REST API</code> resource, you import and use the  <code><a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway-readme.html">aws-apigateway</a></code> L2 construct from the AWS Construct Library.</p>
</div>
<div class="paragraph">
<p>Modify your stack file as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// ...
//Import API Gateway L2 construct
import * as apigateway from 'aws-cdk-lib/aws-apigateway';


export class CdkHelloWorldStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // ...

    // Define the API Gateway resource
    const api = new apigateway.LambdaRestApi(this, 'HelloWorldApi', {
      handler: helloWorldFunction,
      proxy: false,
    });

    // Define the '/hello' resource with a GET method
    const helloResource = api.root.addResource('hello');
    helloResource.addMethod('GET');
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// ...
// Import API Gateway L2 construct
const apigateway = require('aws-cdk-lib/aws-apigateway');


class CdkHelloWorldStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // ...

    // Define the API Gateway resource
    const api = new apigateway.LambdaRestApi(this, 'HelloWorldApi', {
      handler: helloWorldFunction,
      proxy: false,
    });

    // Define the '/hello' resource with a GET method
    const helloResource = api.root.addResource('hello');
    helloResource.addMethod('GET');
  };
};

// ...</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (
    # ...
    # Import API Gateway L2 construct
    aws_apigateway as apigateway,
)
from constructs import Construct

class CdkHelloWorldStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        # ...

        # Define the API Gateway resource
        api = apigateway.LambdaRestApi(
            self,
            "HelloWorldApi",
            handler = hello_world_function,
            proxy = False,
        )

        # Define the '/hello' resource with a GET method
        hello_resource = api.root.add_resource("hello")
        hello_resource.add_method("GET")</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// ...
// Import API Gateway L2 construct
import software.amazon.awscdk.services.apigateway.LambdaRestApi;
import software.amazon.awscdk.services.apigateway.Resource;

public class CdkHelloWorldStack extends Stack {
    public CdkHelloWorldStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkHelloWorldStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        // ...

        // Define the API Gateway resource
        LambdaRestApi api = LambdaRestApi.Builder.create(this, "HelloWorldApi")
                .handler(helloWorldFunction)
                .proxy(false) // Turn off default proxy integration
                .build();

        // Define the '/hello' resource and its GET method
        Resource helloResource = api.getRoot().addResource("hello");
        helloResource.addMethod("GET");
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">// ...
// Import API Gateway L2 construct
using Amazon.CDK.AWS.APIGateway;

namespace CdkHelloWorld
{
    public class CdkHelloWorldStack : Stack
    {
        internal CdkHelloWorldStack(Construct scope, string id, IStackProps props = null) : base(scope, id, props)
        {
           // ...

            // Define the API Gateway resource
            var api = new LambdaRestApi(this, "HelloWorldApi", new LambdaRestApiProps
            {
                Handler = helloWorldFunction,
                Proxy = false
            });

            // Add a '/hello' resource with a GET method
            var helloResource = api.Root.AddResource("hello");
            helloResource.AddMethod("GET");
        }
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Go</dt>
<dd>
<p>*</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">// ...

import (
    // ...
    // Import Api Gateway L2 construct
    "github.com/aws/aws-cdk-go/awscdk/v2/awsapigateway"
    // ...
)

// ...

func NewCdkHelloWorldStack(scope constructs.Construct, id string, props *CdkHelloWorldStackProps) awscdk.Stack {
    var sprops awscdk.StackProps
    if props != nil {
        sprops = props.StackProps
    }
    stack := awscdk.NewStack(scope, &amp;id, &amp;sprops)

    // Define the Lambda function resource
    // ...

    // Define the API Gateway resource
    api := awsapigateway.NewLambdaRestApi(stack, jsii.String("HelloWorldApi"), &amp;awsapigateway.LambdaRestApiProps{
        Handler: helloWorldFunction,
        Proxy: jsii.Bool(false),
    })

    // Add a '/hello' resource with a GET method
    helloResource := api.Root().AddResource(jsii.String("hello"), &amp;awsapigateway.ResourceOptions{})
    helloResource.AddMethod(jsii.String("GET"), awsapigateway.NewLambdaIntegration(helloWorldFunction, &amp;awsapigateway.LambdaIntegrationOptions{}), &amp;awsapigateway.MethodOptions{})

    return stack
}

// ...</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here, you create an API Gateway  <code class="noloc">REST API</code> resource, along with the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An integration between the <code class="noloc">REST API</code> and your Lambda function, allowing the API to invoke your function. This includes the creation of a Lambda permission resource.</p>
</li>
<li>
<p>A new resource or path named <code>hello</code> that is added to the root of the API endpoint. This creates a new endpoint that adds <code>/hello</code> to your base <code class="noloc">URL</code>.</p>
</li>
<li>
<p>A GET method for the <code>hello</code> resource. When a GET request is sent to the <code>/hello</code> endpoint, the Lambda function is invoked and its response is returned.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-deploy-prepare">20.1.4. Step 4: Prepare your application for deployment</h4>
<div class="paragraph">
<p>In this step you prepare your application for deployment by building, if necessary, and performing basic validation with the AWS CDK  <code class="noloc">CLI</code><code>cdk synth</code> command.</p>
</div>
<div class="paragraph">
<p>If necessary, build your application:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ npm run build</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Building is not required.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Building is not required.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ mvn package</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From the root of your project, run the following:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ dotnet build src</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Go</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Building is not required.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run  <code>cdk synth</code> to synthesize an AWS CloudFormation template from your CDK code. By using L2 constructs, many of the configuration details required by AWS CloudFormation to facilitate the interaction between your Lambda function and <code class="noloc">REST API</code> are provisioned for you by the AWS CDK.</p>
</div>
<div class="paragraph">
<p>From the root of your project, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk synth</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you receive an error like the following, verify that you are in the  <code class="path">cdk-hello-world</code> directory and try again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--app is required either in command-line, in cdk.json or in ~/.cdk.json</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If successful, the AWS CDK  <code class="noloc">CLI</code> will output the AWS CloudFormation template in  <code class="noloc">YAML</code> format at the command prompt. A  <code class="noloc">JSON</code> formatted template is also saved in the  <code class="path">cdk.out</code> directory.</p>
</div>
<div class="paragraph">
<p>The following is an example output of the AWS CloudFormation template:</p>
</div>
<details id="serverless-example-deploy-cfn">
<summary class="title">AWS CloudFormation template</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">Resources:
  HelloWorldFunctionServiceRoleunique-identifier:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldFunction/ServiceRole/Resource
  HelloWorldFunctionunique-identifier:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Fn::Sub: cdk-unique-identifier-assets-${AWS::AccountId}-${AWS::Region}
        S3Key: unique-identifier.zip
      Handler: hello.handler
      Role:
        Fn::GetAtt:
          - HelloWorldFunctionServiceRoleunique-identifier
          - Arn
      Runtime: nodejs20.x
    DependsOn:
      - HelloWorldFunctionServiceRoleunique-identifier
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldFunction/Resource
      aws:asset:path: asset.unique-identifier
      aws:asset:is-bundled: false
      aws:asset:property: Code
  HelloWorldApiunique-identifier:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Name: HelloWorldApi
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/Resource
  HelloWorldApiDeploymentunique-identifier:
    Type: AWS::ApiGateway::Deployment
    Properties:
      Description: Automatically created by the RestApi construct
      RestApiId:
        Ref: HelloWorldApiunique-identifier
    DependsOn:
      - HelloWorldApihelloGETunique-identifier
      - HelloWorldApihellounique-identifier
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/Deployment/Resource
  HelloWorldApiDeploymentStageprod012345ABC:
    Type: AWS::ApiGateway::Stage
    Properties:
      DeploymentId:
        Ref: HelloWorldApiDeploymentunique-identifier
      RestApiId:
        Ref: HelloWorldApiunique-identifier
      StageName: prod
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/DeploymentStage.prod/Resource
  HelloWorldApihellounique-identifier:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
          - HelloWorldApiunique-identifier
          - RootResourceId
      PathPart: hello
      RestApiId:
        Ref: HelloWorldApiunique-identifier
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/Default/hello/Resource
  HelloWorldApihelloGETApiPermissionCdkHelloWorldStackHelloWorldApiunique-identifier:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - HelloWorldFunctionunique-identifier
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: HelloWorldApi9E278160
            - /
            - Ref: HelloWorldApiDeploymentStageprodunique-identifier
            - /GET/hello
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/Default/hello/GET/ApiPermission.CdkHelloWorldStackHelloWorldApiunique-identifier.GET..hello
  HelloWorldApihelloGETApiPermissionTestCdkHelloWorldStackHelloWorldApiunique-identifier:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - HelloWorldFunctionunique-identifier
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: HelloWorldApiunique-identifier
            - /test-invoke-stage/GET/hello
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/Default/hello/GET/ApiPermission.Test.CdkHelloWorldStackHelloWorldApiunique-identifier.GET..hello
  HelloWorldApihelloGETunique-identifier:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: NONE
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - HelloWorldFunctionunique-identifier
                  - Arn
              - /invocations
      ResourceId:
        Ref: HelloWorldApihellounique-identifier
      RestApiId:
        Ref: HelloWorldApiunique-identifier
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/HelloWorldApi/Default/hello/GET/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:unique-identifier
    Metadata:
      aws:cdk:path: CdkHelloWorldStack/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Outputs:
  HelloWorldApiEndpointunique-identifier:
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: HelloWorldApiunique-identifier
          - .execute-api.
          - Ref: AWS::Region
          - "."
          - Ref: AWS::URLSuffix
          - /
          - Ref: HelloWorldApiDeploymentStageprodunique-identifier
          - /
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - af-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - il-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - me-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-2
Parameters:
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value&lt;String&gt;
    Default: /cdk-bootstrap/hnb659fds/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]
Rules:
  CheckBootstrapVersion:
    Assertions:
      - Assert:
          Fn::Not:
            - Fn::Contains:
                - - "1"
                  - "2"
                  - "3"
                  - "4"
                  - "5"
                - Ref: BootstrapVersion
        AssertDescription: CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>By using L2 constructs, you define a few properties to configure your resources and use helper methods to integrate them together. The AWS CDK configures the majority of your AWS CloudFormation resources and properties required to provision your application.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-deploy">20.1.5. Step 5: Deploy your application</h4>
<div class="paragraph">
<p>In this step, you use the AWS CDK  <code class="noloc">CLI</code><code>cdk deploy</code> command to deploy your application. The AWS CDK works with the AWS CloudFormation service to provision your resources.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must perform a one-time bootstrapping of your AWS environment before deployment. For instructions, see <a href="#bootstrapping-env">Bootstrap your environment for use with the AWS CDK</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>From the root of your project, run the following. Confirm changes if prompted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy

✨  Synthesis time: 2.44s

...

Do you wish to deploy these changes (y/n)? y</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deployment completes, the AWS CDK  <code class="noloc">CLI</code> will output your endpoint URL. Copy this URL for the next step. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>...
✅  HelloWorldStack

✨  Deployment time: 45.37s

Outputs:
HelloWorldStack.HelloWorldApiEndpointunique-identifier = https://&lt;api-id&gt;.execute-api.&lt;region&gt;.amazonaws.com/prod/
Stack ARN:
arn:aws:cloudformation:region:account-id:stack/HelloWorldStack/unique-identifier
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-interact">20.1.6. Step 6: Interact with your application</h4>
<div class="paragraph">
<p>In this step, you initiate a GET request to your API endpoint and receive your Lambda function response.</p>
</div>
<div class="paragraph">
<p>Locate your endpoint URL from the previous step and add the <code>/hello</code> path. Then, using your browser or command prompt, send a GET request to your endpoint. The following is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ curl https://&lt;api-id&gt;.execute-api.&lt;region&gt;.amazonaws.com/prod/hello
{"message":"Hello World!"}%</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations, you have successfully created, deployed, and interacted with your application using the AWS CDK!</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-delete">20.1.7. Step 7: Delete your application</h4>
<div class="paragraph">
<p>In this step, you use the AWS CDK  <code class="noloc">CLI</code> to delete your application from the AWS Cloud.</p>
</div>
<div class="paragraph">
<p>To delete your application, run <code>cdk destroy</code>. When prompted, confirm your request to delete the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk destroy
Are you sure you want to delete: CdkHelloWorldStack (y/n)? y
CdkHelloWorldStack: destroying... [1/1]
...
 ✅  CdkHelloWorldStack: destroyed</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-example-troubleshooting">20.1.8. Troubleshooting</h4>
<div class="sect4">
<h5 id="w94aac85c11c55b5">Error: {&#8220;message&#8221;: &#8220;Internal server error&#8221;}%</h5>
<div class="paragraph">
<p>When invoking the deployed Lambda function, you receive this error. This error could occur for multiple reasons.</p>
</div>
<div class="paragraph">
<p>Use the AWS CLI to invoke your Lambda function.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify your stack file to capture the output value of your deployed Lambda function name. The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">...

class CdkHelloWorldStack extends Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Define the Lambda function resource
    // ...

    new CfnOutput(this, 'HelloWorldFunctionName', {
      value: helloWorldFunction.functionName,
      description: 'JavaScript Lambda function'
    });

    // Define the API Gateway resource
    // ...</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy your application again. The AWS CDK <code class="noloc">CLI</code> will output the value of your deployed Lambda function name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cdk deploy

✨  Synthesis time: 0.29s
...
 ✅  CdkHelloWorldStack

✨  Deployment time: 20.36s

Outputs:
...
CdkHelloWorldStack.HelloWorldFunctionName = CdkHelloWorldStack-HelloWorldFunctionunique-identifier
...</code></pre>
</div>
</div>
</li>
<li>
<p>Use the AWS CLI to invoke your Lambda function in the AWS Cloud and output the response to a text file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ aws lambda invoke --function-name CdkHelloWorldStack-HelloWorldFunctionunique-identifier output.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Check <code class="path">output.txt</code> to see your results.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Possible cause: API Gateway resource is defined incorrectly in your stack file.</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If <code class="path">output.txt</code> shows a successful Lambda function response, the issue could be with how you defined your API Gateway REST API. The AWS CLI invokes your Lambda directly, not through your endpoint. Check your code to ensure it matches this tutorial. Then, deploy again.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Possible cause: Lambda resource is defined incorrectly in your stack file.</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If <code class="path">output.txt</code> returns an error, the issue could be with how you defined your Lambda function. Check your code to ensure it matches this tutorial. Then deploy again.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="stack-how-to-create-multiple-stacks">20.2. Example: Create a CDK app with multiple stacks</h3>
<div class="paragraph">
<p>You can create an AWS Cloud Development Kit (AWS CDK) application containing multiple  <a href="#stacks">stacks</a>. When you deploy the AWS CDK app, each stack becomes its own AWS CloudFormation template. You can also synthesize and deploy each stack individually using the AWS CDK <code class="noloc">CLI</code><code>cdk deploy</code> command.</p>
</div>
<div class="paragraph">
<p>In this example, we cover the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to extend the <code>Stack</code> class to accept new properties or arguments.</p>
</li>
<li>
<p>How to use properties to determine which resources the stack contains and their configuration.</p>
</li>
<li>
<p>How to instantiate multiple stacks from this class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example in this topic uses a Boolean property, named  <code>encryptBucket</code> (Python: <code>encrypt_bucket</code>). It indicates whether an Amazon S3 bucket should be encrypted. If so, the stack enables encryption using a key managed by AWS Key Management Service (AWS KMS). The app creates two instances of this stack, one with encryption and one without.</p>
</div>
<div class="sect3">
<h4 id="cdk-how-to-create-multiple-stacks-prereqs">20.2.1. Prerequisites</h4>
<div class="paragraph">
<p>This example assumes that all  <a href="#getting-started">getting started</a> steps have been completed.</p>
</div>
</div>
<div class="sect3">
<h4 id="cdk-how-to-create-multiple-stacks-create">20.2.2. Create a CDK project</h4>
<div class="paragraph">
<p>First, we create a CDK project using the CDK  <code class="noloc">CLI</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir multistack
cd multistack
cdk init --language=typescript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir multistack
cd multistack
cdk init --language=javascript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir multistack
cd multistack
cdk init --language=python
source .venv/bin/activate # On Windows, run '.\venv\Scripts\activate' instead
pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir multistack
cd multistack
cdk init --language=java</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>You can import the resulting Maven project into your Java IDE.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir multistack
cd multistack
cdk init --language=csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>You can open the file  <code class="path">src/Pipeline.sln</code> in Visual Studio.</p>
</div>
</div>
<div class="sect3">
<h4 id="cdk-how-to-create-multiple-stacks-extend-stackprops">20.2.3. Add an optional parameter</h4>
<div class="paragraph">
<p>The  <code>props</code> argument of the <code>Stack</code> constructor fulfills the interface <code>StackProps</code>. In this example, we want the stack to accept an additional property to tell us whether to encrypt the Amazon S3 bucket. To do this, we create an interface or class that includes the property. This allows the compiler to make sure that the property has a Boolean value and enables auto-completion for it in your IDE.</p>
</div>
<div class="paragraph">
<p>We open our <em>stack file</em> in our IDE or editor and add the new interface, class, or argument. New lines are highlighted in bold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">lib/multistack-stack.ts</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';

interface MultiStackProps extends cdk.StackProps {
  encryptBucket?: boolean;
}

export class MultistackStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: MultiStackProps) {
    super(scope, id, props);

    // The code that defines our stack goes here
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">lib/multistack-stack.js</code></p>
<div class="paragraph">
<p>JavaScript doesn&#8217;t have an interface feature; we don&#8217;t need to add any code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-stack');

class MultistackStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // The code that defines our stack goes here
  }
}

module.exports = { MultistackStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">multistack/multistack_stack.py</code></p>
<div class="paragraph">
<p>Python does not have an interface feature, so we&#8217;ll extend our stack to accept the new property by adding a keyword argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct

class MultistackStack(cdk.Stack):

    # The Stack class doesn't know about our encrypt_bucket parameter,
    # so accept it separately and pass along any other keyword arguments.
    def __init__(self, scope: Construct, id: str, *, encrypt_bucket=False,
                 **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        # The code that defines our stack goes here</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/main/java/com/myorg/MultistackStack.java</code></p>
<div class="paragraph">
<p>It&#8217;s more complicated than we really want to get into to extend a props type in Java. Instead, write the stack&#8217;s constructor to accept an optional Boolean parameter. Because <code>props</code> is an optional argument, we&#8217;ll write an additional constructor that lets you skip it. It will default to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.constructs.Construct;

import software.amazon.awscdk.services.s3.Bucket;

public class MultistackStack extends Stack {
    // additional constructors to allow props and/or encryptBucket to be omitted
    public MultistackStack(final Construct scope, final String id, boolean encryptBucket) {
        this(scope, id, null, encryptBucket);
    }

    public MultistackStack(final Construct scope, final String id) {
        this(scope, id, null, false);
    }

    public MultistackStack(final Construct scope, final String id, final StackProps props,
            final boolean encryptBucket) {
        super(scope, id, props);

        // The code that defines our stack goes here
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/Multistack/MultistackStack.cs</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using constructs;

namespace Multistack
{


    public class MultiStackProps : StackProps
    {
        public bool? EncryptBucket { get; set; }
    }


    public class MultistackStack : Stack
    {
        public MultistackStack(Construct scope, string id, MultiStackProps props) : base(scope, id, props)
        {
            // The code that defines our stack goes here
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The new property is optional. If  <code>encryptBucket</code> (Python: <code>encrypt_bucket</code>) is not present, its value is <code>undefined</code>, or the local equivalent. The bucket will be unencrypted by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="cdk-how-to-create-multiple-stacks-define-stack">20.2.4. Define the stack class</h4>
<div class="paragraph">
<p>Next, we define our stack class, using our new property. New code is highlighted in bold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">lib/multistack-stack.ts</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from constructs;
import * as s3 from 'aws-cdk-lib/aws-s3';

interface MultistackProps extends cdk.StackProps {
  encryptBucket?: boolean;
}

export class MultistackStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: MultistackProps) {
    super(scope, id, props);

    // Add a Boolean property "encryptBucket" to the stack constructor.
    // If true, creates an encrypted bucket. Otherwise, the bucket is unencrypted.
    // Encrypted bucket uses KMS-managed keys (SSE-KMS).
    if (props &amp;&amp; props.encryptBucket) {
      new s3.Bucket(this, "MyGroovyBucket", {
        encryption: s3.BucketEncryption.KMS_MANAGED,
        removalPolicy: cdk.RemovalPolicy.DESTROY
      });
    } else {
      new s3.Bucket(this, "MyGroovyBucket", {
        removalPolicy: cdk.RemovalPolicy.DESTROY});
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">lib/multistack-stack.js</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');

class MultistackStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    // Add a Boolean property "encryptBucket" to the stack constructor.
    // If true, creates an encrypted bucket. Otherwise, the bucket is unencrypted.
    // Encrypted bucket uses KMS-managed keys (SSE-KMS).
    if ( props &amp;&amp; props.encryptBucket) {
      new s3.Bucket(this, "MyGroovyBucket", {
        encryption: s3.BucketEncryption.KMS_MANAGED,
        removalPolicy: cdk.RemovalPolicy.DESTROY
      });
    } else {
      new s3.Bucket(this, "MyGroovyBucket", {
        removalPolicy: cdk.RemovalPolicy.DESTROY});
    }
  }
}

module.exports = { MultistackStack }</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">multistack/multistack_stack.py</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
from aws_cdk import aws_s3 as s3

class MultistackStack(cdk.Stack):

    # The Stack class doesn't know about our encrypt_bucket parameter,
    # so accept it separately and pass along any other keyword arguments.
    def __init__(self, scope: Construct, id: str, *, encrypt_bucket=False,
                 **kwargs) -&gt; None:
        super().__init__(scope, id, **kwargs)

        # Add a Boolean property "encryptBucket" to the stack constructor.
        # If true, creates an encrypted bucket. Otherwise, the bucket is unencrypted.
        # Encrypted bucket uses KMS-managed keys (SSE-KMS).
        if encrypt_bucket:
            s3.Bucket(self, "MyGroovyBucket",
                      encryption=s3.BucketEncryption.KMS_MANAGED,
                      removal_policy=cdk.RemovalPolicy.DESTROY)
        else:
            s3.Bucket(self, "MyGroovyBucket",
                     removal_policy=cdk.RemovalPolicy.DESTROY)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/main/java/com/myorg/MultistackStack.java</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.Stack;
import software.amazon.awscdk.StackProps;
import software.constructs.Construct;
import software.amazon.awscdk.RemovalPolicy;

import software.amazon.awscdk.services.s3.Bucket;
import software.amazon.awscdk.services.s3.BucketEncryption;

public class MultistackStack extends Stack {
    // additional constructors to allow props and/or encryptBucket to be omitted
    public MultistackStack(final Construct scope, final String id,
            boolean encryptBucket) {
        this(scope, id, null, encryptBucket);
    }

    public MultistackStack(final Construct scope, final String id) {
        this(scope, id, null, false);
    }

    // main constructor
    public MultistackStack(final Construct scope, final String id,
            final StackProps props, final boolean encryptBucket) {
        super(scope, id, props);

        // Add a Boolean property "encryptBucket" to the stack constructor.
        // If true, creates an encrypted bucket. Otherwise, the bucket is
        // unencrypted. Encrypted bucket uses KMS-managed keys (SSE-KMS).
        if (encryptBucket) {
            Bucket.Builder.create(this, "MyGroovyBucket")
                    .encryption(BucketEncryption.KMS_MANAGED)
                    .removalPolicy(RemovalPolicy.DESTROY).build();
        } else {
            Bucket.Builder.create(this, "MyGroovyBucket")
                    .removalPolicy(RemovalPolicy.DESTROY).build();
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/Multistack/MultistackStack.cs</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.S3;

namespace Multistack
{

    public class MultiStackProps : StackProps
    {
        public bool? EncryptBucket { get; set; }
    }

    public class MultistackStack : Stack
    {
        public MultistackStack(Construct scope, string id, IMultiStackProps props = null) : base(scope, id, props)
        {
            // Add a Boolean property "EncryptBucket" to the stack constructor.
            // If true, creates an encrypted bucket. Otherwise, the bucket is unencrypted.
            // Encrypted bucket uses KMS-managed keys (SSE-KMS).
            if (props?.EncryptBucket ?? false)
            {
                new Bucket(this, "MyGroovyBucket", new BucketProps
                {
                    Encryption = BucketEncryption.KMS_MANAGED,
                    RemovalPolicy = RemovalPolicy.DESTROY
                });
            }
            else
            {
                new Bucket(this, "MyGroovyBucket", new BucketProps
                {
                    RemovalPolicy = RemovalPolicy.DESTROY
                });
            }
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="stack-how-to-create-multiple-stacks-create-stacks">20.2.5. Create two stack instances</h4>
<div class="paragraph">
<p>In our  <em>application file</em>, we add the code to instantiate two separate stacks. We delete the existing <code>MultistackStack</code> definition and define our two stacks. New code is highlight in bold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">bin/multistack.ts</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
import 'source-map-support/register';
import * as cdk from 'aws-cdk-lib';
import { MultistackStack } from '../lib/multistack-stack';

const app = new cdk.App();

new MultistackStack(app, "MyWestCdkStack", {
    env: {region: "us-west-1"},
    encryptBucket: false
});

new MultistackStack(app, "MyEastCdkStack", {
    env: {region: "us-east-1"},
    encryptBucket: true
});

app.synth();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">bin/multistack.js</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">#!/usr/bin/env node
const cdk = require('aws-cdk-lib');
const { MultistackStack } = require('../lib/multistack-stack');

const app = new cdk.App();

new MultistackStack(app, "MyWestCdkStack", {
    env: {region: "us-west-1"},
    encryptBucket: false
});

new MultistackStack(app, "MyEastCdkStack", {
    env: {region: "us-east-1"},
    encryptBucket: true
});

app.synth();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">./app.py</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python3

import aws_cdk as cdk

from multistack.multistack_stack import MultistackStack

app = cdk.App()
MultistackStack(app, "MyWestCdkStack",
                env=cdk.Environment(region="us-west-1"),
                encrypt_bucket=False)

MultistackStack(app, "MyEastCdkStack",
                env=cdk.Environment(region="us-east-1"),
                encrypt_bucket=True)

app.synth()</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/main/java/com/myorg/MultistackApp.java</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.myorg;

import software.amazon.awscdk.App;
import software.amazon.awscdk.Environment;
import software.amazon.awscdk.StackProps;

public class MultistackApp {
    public static void main(final String argv[]) {
        App app = new App();

        new MultistackStack(app, "MyWestCdkStack", StackProps.builder()
                .env(Environment.builder()
                        .region("us-west-1")
                        .build())
                .build(), false);

        new MultistackStack(app, "MyEastCdkStack", StackProps.builder()
                .env(Environment.builder()
                        .region("us-east-1")
                        .build())
                .build(), true);

        app.synth();
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: src/Multistack/Program.cs</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;

namespace Multistack
{
    class Program
    {
        static void Main(string[] args)
        {
            var app = new App();

            new MultistackStack(app, "MyWestCdkStack", new MultiStackProps
            {
                Env = new Environment { Region = "us-west-1" },
                EncryptBucket = false
            });

            new MultistackStack(app, "MyEastCdkStack", new MultiStackProps
            {
                Env = new Environment { Region = "us-east-1" },
                EncryptBucket = true
            });

            app.Synth();
        }
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This code uses the new  <code>encryptBucket</code> (Python: <code>encrypt_bucket</code>) property on the <code>MultistackStack</code> class to instantiate the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One stack with an encrypted Amazon S3 bucket in the <code>us-east-1</code> AWS Region.</p>
</li>
<li>
<p>One stack with an unencrypted Amazon S3 bucket in the <code>us-west-1</code> AWS Region.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cdk-how-to-create-multiple-stacks-synth-deploy">20.2.6. Synthesize and deploy the stack</h4>
<div class="paragraph">
<p>Next, we can deploy stacks from the app. First, we synthesize an AWS CloudFormation template for  <code>MyEastCdkStack</code>. This is the stack in <code>us-east-1</code> with the encrypted Amazon S3 bucket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk synth MyEastCdkStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>To deploy this stack to our AWS environment, we can issue one of the following commands. The first command uses our default AWS profile to obtain the credentials to deploy the stack. The second uses a profile that we specify. For  <code class="replaceable">PROFILE_NAME</code>, we can substitute the name of an AWS CLI profile that contains appropriate credentials for deploying to the <code>us-east-1</code> AWS Region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk deploy MyEastCdkStack</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">$ cdk deploy MyEastCdkStack --profile=PROFILE_NAME</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cdk-how-to-create-multiple-stacks-destroy-stack">20.2.7. Clean up</h4>
<div class="paragraph">
<p>To avoid charges for resources that we deployed, we destroy the stack using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk destroy MyEastCdkStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>The destroy operation fails if there is anything stored in the stack&#8217;s bucket. There shouldn&#8217;t be, since we only created the bucket. If we did put something in the bucket, we must delete the bucket contents before destroying the stack. We can use the AWS Management Console or the AWS CLI to delete the bucket contents.</p>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="ecs-example">20.3. Example: Create an AWS Fargate service using the AWS CDK</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Learn how to create an AWS Fargate service.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In this example, we show you how to create an AWS Fargate service running on an Amazon Elastic Container Service (Amazon ECS) cluster that&#8217;s fronted by an internet-facing Application Load Balancer from an image on Amazon ECR.</p>
</div>
<div class="paragraph">
<p>Amazon ECS is a highly scalable, fast, container management service that makes it easy to run, stop, and manage <code class="noloc">Docker</code> containers on a cluster. You can host your cluster on serverless infrastructure that&#8217;s managed by Amazon ECS by launching your services or tasks using the Fargate launch type. For more control, you can host your tasks on a cluster of Amazon Elastic Compute Cloud (Amazon EC2) instances that you manage by using the Amazon EC2 launch type.</p>
</div>
<div class="paragraph">
<p>In this example, we launch some services using the Fargate launch type. If you&#8217;ve used the AWS Management Console to create a Fargate service, you know that there are many steps to follow to accomplish that task. AWS has several tutorials and documentation topics that walk you through creating a Fargate service, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/getting-started/tutorials/deploy-docker-containers">How to Deploy Docker Containers - AWS</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/get-set-up-for-amazon-ecs.html">Setting Up with Amazon ECS</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_GetStarted.html">Getting Started with Amazon ECS Using Fargate</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example creates a similar Fargate service using the AWS CDK.</p>
</div>
<div class="paragraph">
<p>The Amazon ECS construct used in this example helps you use AWS services by providing the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatically configures a load balancer.</p>
</li>
<li>
<p>Automatically opens a security group for load balancers. This enables load balancers to communicate with instances without having to explicitly create a security group.</p>
</li>
<li>
<p>Automatically orders dependency between the service and the load balancer attaching to a target group, where the AWS CDK enforces the correct order of creating the listener before an instance is created.</p>
</li>
<li>
<p>Automatically configures user data on automatically scaling groups. This creates the correct configuration to associate a cluster to AMIs.</p>
</li>
<li>
<p>Validates parameter combinations early. This exposes AWS CloudFormation issues earlier, thus saving deployment time. For example, depending on the task, it&#8217;s easy to improperly configure the memory settings. Previously, we would not encounter an error until we deployed our app. But now the AWS CDK can detect a misconfiguration and emit an error when we synthesize our app.</p>
</li>
<li>
<p>Automatically adds permissions for Amazon Elastic Container Registry (Amazon ECR) if we use an image from Amazon ECR.</p>
</li>
<li>
<p>Automatically scales. The AWS CDK supplies a method so we can auto scale instances when we use an Amazon EC2 cluster. This happens automatically when we use an instance in a Fargate cluster.</p>
<div class="paragraph">
<p>In addition, the AWS CDK prevents an instance from being deleted when automatic scaling tries to stop an instance, but either a task is running or is scheduled on that instance.</p>
</div>
<div class="paragraph">
<p>Previously, we had to create a Lambda function to have this functionality.</p>
</div>
</li>
<li>
<p>Provides asset support, so that we can deploy a source from our machine to Amazon ECS in one step. Previously, to use an application source, we had to perform several manual steps, such as uploading to Amazon ECR and creating a <code class="noloc">Docker</code> image.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The  <code>ApplicationLoadBalancedFargateService</code> constructs we&#8217;ll be using includes numerous AWS components, some of which have non-trivial costs if left provisioned in our AWS account, even if we don&#8217;t use them. Be sure to clean up (<strong class="command">cdk destroy</strong>) if you follow along with this example.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ecs-example-initialize">20.3.1. Create a CDK project</h4>
<div class="paragraph">
<p>We start by creating a CDK project. This is a directory that stores our AWS CDK code, including our CDK app.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir MyEcsConstruct
cd MyEcsConstruct
cdk init --language typescript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir MyEcsConstruct
cd MyEcsConstruct
cdk init --language javascript</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir MyEcsConstruct
cd MyEcsConstruct
cdk init --language python
source .venv/bin/activate # On Windows, run '.\venv\Scripts\activate' instead
pip install -r requirements.txt</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">mkdir MyEcsConstruct
cd MyEcsConstruct
cdk init --language java</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>We may now import the Maven project into our IDE.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">mkdir MyEcsConstruct
cd MyEcsConstruct
cdk init --language csharp</code></pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>We may now open  <code class="path">src/MyEcsConstruct.sln</code> in Visual Studio.</p>
</div>
<div class="paragraph">
<p>Next, we run the app and confirm that it creates an empty stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ecs-example-create-fargate-service">20.3.2. Create a Fargate service</h4>
<div class="paragraph">
<p>There are two different ways that we can run our container tasks with Amazon ECS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>Fargate</code> launch type, where Amazon ECS manages the physical machines that oour containers are running on for us.</p>
</li>
<li>
<p>Use the <code>EC2</code> launch type, where we do the managing, such as specifying automatic scaling.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this example, we&#8217;ll create a Fargate service running on an Amazon ECS cluster, fronted by an internet-facing Application Load Balancer.</p>
</div>
<div class="paragraph">
<p>We add the following AWS Construct Library module imports to our <em>stack file</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">lib/my_ecs_construct-stack.ts</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as ec2 from "aws-cdk-lib/aws-ec2";
import * as ecs from "aws-cdk-lib/aws-ecs";
import * as ecs_patterns from "aws-cdk-lib/aws-ecs-patterns";</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">JavaScript</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">lib/my_ecs_construct-stack.js</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const ec2 = require("aws-cdk-lib/aws-ec2");
const ecs = require("aws-cdk-lib/aws-ecs");
const ecs_patterns = require("aws-cdk-lib/aws-ecs-patterns");</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Python</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">my_ecs_construct/my_ecs_construct_stack.py</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from aws_cdk import (aws_ec2 as ec2, aws_ecs as ecs,
                     aws_ecs_patterns as ecs_patterns)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Java</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/main/java/com/myorg/MyEcsConstructStack.java</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import software.amazon.awscdk.services.ec2.*;
import software.amazon.awscdk.services.ecs.*;
import software.amazon.awscdk.services.ecs.patterns.*;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">C#</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>File: <code class="path">src/MyEcsConstruct/MyEcsConstructStack.cs</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK.AWS.EC2;
using Amazon.CDK.AWS.ECS;
using Amazon.CDK.AWS.ECS.Patterns;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Within our stack, we add the following code:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    const vpc = new ec2.Vpc(this, "MyVpc", {
      maxAzs: 3 // Default is all AZs in region
    });

    const cluster = new ecs.Cluster(this, "MyCluster", {
      vpc: vpc
    });

    // Create a load-balanced Fargate service and make it public
    new ecs_patterns.ApplicationLoadBalancedFargateService(this, "MyFargateService", {
      cluster: cluster, // Required
      cpu: 512, // Default is 256
      desiredCount: 6, // Default is 1
      taskImageOptions: { image: ecs.ContainerImage.fromRegistry("amazon/amazon-ecs-sample") },
      memoryLimitMiB: 2048, // Default is 512
      publicLoadBalancer: true // Default is true
    });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">    const vpc = new ec2.Vpc(this, "MyVpc", {
      maxAzs: 3 // Default is all AZs in region
    });

    const cluster = new ecs.Cluster(this, "MyCluster", {
      vpc: vpc
    });

    // Create a load-balanced Fargate service and make it public
    new ecs_patterns.ApplicationLoadBalancedFargateService(this, "MyFargateService", {
      cluster: cluster, // Required
      cpu: 512, // Default is 256
      desiredCount: 6, // Default is 1
      taskImageOptions: { image: ecs.ContainerImage.fromRegistry("amazon/amazon-ecs-sample") },
      memoryLimitMiB: 2048, // Default is 512
      publicLoadBalancer: true // Default is true
    });</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">        vpc = ec2.Vpc(self, "MyVpc", max_azs=3)     # default is all AZs in region

        cluster = ecs.Cluster(self, "MyCluster", vpc=vpc)

        ecs_patterns.ApplicationLoadBalancedFargateService(self, "MyFargateService",
            cluster=cluster,            # Required
            cpu=512,                    # Default is 256
            desired_count=6,            # Default is 1
            task_image_options=ecs_patterns.ApplicationLoadBalancedTaskImageOptions(
                image=ecs.ContainerImage.from_registry("amazon/amazon-ecs-sample")),
            memory_limit_mib=2048,      # Default is 512
            public_load_balancer=True)  # Default is True</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Vpc vpc = Vpc.Builder.create(this, "MyVpc")
                            .maxAzs(3)  // Default is all AZs in region
                            .build();

        Cluster cluster = Cluster.Builder.create(this, "MyCluster")
                            .vpc(vpc).build();

        // Create a load-balanced Fargate service and make it public
        ApplicationLoadBalancedFargateService.Builder.create(this, "MyFargateService")
                    .cluster(cluster)           // Required
                    .cpu(512)                   // Default is 256
                     .desiredCount(6)            // Default is 1
                     .taskImageOptions(
                             ApplicationLoadBalancedTaskImageOptions.builder()
                                     .image(ContainerImage.fromRegistry("amazon/amazon-ecs-sample"))
                                     .build())
                     .memoryLimitMiB(2048)       // Default is 512
                     .publicLoadBalancer(true)   // Default is true
                     .build();</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">            var vpc = new Vpc(this, "MyVpc", new VpcProps
            {
                MaxAzs = 3 // Default is all AZs in region
            });

            var cluster = new Cluster(this, "MyCluster", new ClusterProps
            {
                Vpc = vpc
            });

            // Create a load-balanced Fargate service and make it public
            new ApplicationLoadBalancedFargateService(this, "MyFargateService",
                new ApplicationLoadBalancedFargateServiceProps
                {
                    Cluster = cluster,          // Required
                    DesiredCount = 6,           // Default is 1
                    TaskImageOptions = new ApplicationLoadBalancedTaskImageOptions
                    {
                        Image = ContainerImage.FromRegistry("amazon/amazon-ecs-sample")
                    },
                    MemoryLimitMiB = 2048,      // Default is 256
                    PublicLoadBalancer = true   // Default is true
                }
            );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we validate our code by running the following to synthesize our stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth</code></pre>
</div>
</div>
<div class="paragraph">
<p>The stack is hundreds of lines, so we won&#8217;t show it here. The stack should contain one default instance, a private subnet and a public subnet for the three Availability Zones, and a security group.</p>
</div>
<div class="paragraph">
<p>To deploy the stack, we run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>AWS CloudFormation displays information about the dozens of steps that it takes as it deploys our app.</p>
</div>
<div class="paragraph">
<p>Once deployment completes, we have successfully created a Fargate powered Amazon ECS service to run a <code class="noloc">Docker</code> image.</p>
</div>
</div>
<div class="sect3">
<h4 id="ecs-example-destroy">20.3.3. Clean up</h4>
<div class="paragraph">
<p>As a general maintenance best practice, and to minimize unnecessary costs, we delete our stack when complete:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cdk destroy</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="tools">21. Use other tools with the AWS CDK</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Tools for the AWS CDK</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You can use other tools with the AWS CDK to improve your development workflows.</p>
</div>
<div class="sect2">
<h3 id="vscode">21.1. AWS Toolkit for Visual Studio Code</h3>
<div class="paragraph">
<p>The  <a href="https://aws.amazon.com/visualstudiocode/">AWS Toolkit for Visual Studio Code</a> is an open source plugin for Visual Studio Code that makes it easier to create, debug, and deploy applications on AWS. The toolkit provides an integrated experience for developing AWS CDK applications. It includes the AWS CDK Explorer feature to list your AWS CDK projects and browse the various components of the CDK application. <a href="https://docs.aws.amazon.com/toolkit-for-vscode/latest/userguide/setup-toolkit.html">Install the AWS Toolkit</a> and learn more about <a href="https://docs.aws.amazon.com/toolkit-for-vscode/latest/userguide/cdk-explorer.html">using the AWS CDK Explorer</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sam">21.2. AWS SAM integration</h3>
<div class="paragraph">
<p>Use the AWS CDK and the AWS Serverless Application Model (AWS SAM) together to locally build and test serverless applications defined in the CDK. For complete information, see  <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-cdk.html">AWS Cloud Development Kit (AWS CDK)</a> in the <em>AWS Serverless Application Model Developer Guide</em>. To install the AWS SAM <code class="noloc">CLI</code>, see  <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">Install the AWS SAM CLI</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="security">22. Security for the AWS Cloud Development Kit (AWS CDK)</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Provides security-related information for the AWS CDK.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Cloud security at Amazon Web Services (AWS) is the highest priority. As an AWS customer, you benefit from a data center and network architecture that is built to meet the requirements of the most security-sensitive organizations. Security is a shared responsibility between AWS and you. The  <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">Shared Responsibility Model</a> describes this as Security of the Cloud and Security in the Cloud.</p>
</div>
<div class="paragraph">
<p><strong>Security of the Cloud</strong> – AWS is responsible for protecting the infrastructure that runs all of the services offered in the AWS Cloud and providing you with services that you can use securely. Our security responsibility is the highest priority at AWS, and the effectiveness of our security is regularly tested and verified by third-party auditors as part of the <a href="https://aws.amazon.com/compliance/programs/">AWS Compliance Programs</a>.</p>
</div>
<div class="paragraph">
<p><strong>Security in the Cloud</strong> – Your responsibility is determined by the AWS service you are using, and other factors including the sensitivity of your data, your organization&#8217;s requirements, and applicable laws and regulations.</p>
</div>
<div class="paragraph">
<p>The AWS CDK follows the <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">shared responsibility model</a> through the specific Amazon Web Services (AWS) services it supports. For AWS service security information, see the <a href="https://docs.aws.amazon.com/security/?id=docs_gateway#aws-security">AWS service security documentation page</a> and <a href="https://aws.amazon.com/compliance/services-in-scope/">AWS services that are in scope of AWS compliance efforts by compliance program</a>.</p>
</div>
<div class="paragraph topiclist-abbrev">
<p>[[Topic List]]</p>
</div>
<div class="sect2 topic">
<h3 id="security-iam">22.1. Identity and access management for the AWS Cloud Development Kit (AWS CDK)</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Provides information about identity and access management for the AWS CDK.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>AWS Identity and Access Management (IAM) is an AWS service that helps an administrator securely control access to AWS resources. IAM administrators control who can be  <em>authenticated</em> (signed in) and <em>authorized</em> (have permissions) to use AWS resources. IAM is an AWS service that you can use with no additional charge.</p>
</div>
<div class="sect3">
<h4 id="security-iam-audience">22.1.1. Audience</h4>
<div class="paragraph">
<p>How you use AWS Identity and Access Management (IAM) differs, depending on the work that you do in AWS.</p>
</div>
<div class="paragraph">
<p><strong>Service user</strong> – If you use AWS services to do your job, then your administrator provides you with the credentials and permissions that you need. As you use more AWS features to do your work, you might need additional permissions. Understanding how access is managed can help you request the right permissions from your administrator.</p>
</div>
<div class="paragraph">
<p><strong>Service administrator</strong> – If you&#8217;re in charge of AWS resources at your company, you probably have full access to AWS resources. It&#8217;s your job to determine which AWS services and resources your service users should access. You must then submit requests to your IAM administrator to change the permissions of your service users. Review the information on this page to understand the basic concepts of IAM.</p>
</div>
<div class="paragraph">
<p><strong>IAM administrator</strong> – If you&#8217;re an IAM administrator, you might want to learn details about how you can write policies to manage access to AWS services.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-iam-authentication">22.1.2. Authenticating with identities</h4>
<div class="paragraph">
<p>Authentication is how you sign in to AWS using your identity credentials. You must be  <em>authenticated</em> (signed in to AWS) as the AWS account root user, as an IAM user, or by assuming an IAM role.</p>
</div>
<div class="paragraph">
<p>You can sign in to AWS as a federated identity by using credentials provided through an identity source. AWS IAM Identity Center (IAM Identity Center) users, your company&#8217;s single sign-on authentication, and your Google or Facebook credentials are examples of federated identities. When you sign in as a federated identity, your administrator previously set up identity federation using IAM roles. When you access AWS by using federation, you are indirectly assuming a role.</p>
</div>
<div class="paragraph">
<p>Depending on the type of user you are, you can sign in to the AWS Management Console or the AWS access portal. For more information about signing in to AWS, see <a href="https://docs.aws.amazon.com/signin/latest/userguide/how-to-sign-in.html">How to sign in to your AWS account</a> in the <em>AWS Sign-In User Guide</em>.</p>
</div>
<div class="paragraph">
<p>To access AWS programmatically, AWS provides the AWS CDK, software development kits (SDKs), and a command line interface (CLI) to cryptographically sign your requests using your credentials. If you don&#8217;t use AWS tools, you must sign requests yourself. For more information about using the recommended method to sign requests yourself, see <a href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">Signature Version 4 signing process</a> in the <em>AWS General Reference</em>.</p>
</div>
<div class="paragraph">
<p>Regardless of the authentication method that you use, you might be required to provide additional security information. For example, AWS recommends that you use multi-factor authentication (MFA) to increase the security of your account. To learn more, see <a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/enable-mfa.html">Multi-factor authentication</a> in the <em>AWS IAM Identity Center User Guide</em> and <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html">Using multi-factor authentication (MFA) in AWS</a> in the <em>IAM User Guide</em>.</p>
</div>
<div class="sect4">
<h5 id="security-iam-authentication-rootuser">AWS account root user</h5>
<div class="paragraph">
<p>When you create an AWS account, you begin with one sign-in identity that has complete access to all AWS services and resources in the account. This identity is called the AWS account  <em>root user</em> and is accessed by signing in with the email address and password that you used to create the account. We strongly recommend that you don&#8217;t use the root user for your everyday tasks. Safeguard your root user credentials and use them to perform the tasks that only the root user can perform. For the complete list of tasks that require you to sign in as the root user, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html#root-user-tasks">Tasks that require root user credentials</a> in the <em>IAM User Guide</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="security-iam-authentication-federated">Federated identity</h5>
<div class="paragraph">
<p>As a best practice, require human users, including users that require administrator access, to use federation with an identity provider to access AWS services by using temporary credentials.</p>
</div>
<div class="paragraph">
<p>A <em>federated identity</em> is a user from your enterprise user directory, a web identity provider, the AWS Directory Service, the Identity Center directory, or any user that accesses AWS services by using credentials provided through an identity source. When federated identities access AWS accounts, they assume roles, and the roles provide temporary credentials.</p>
</div>
<div class="paragraph">
<p>For centralized access management, we recommend that you use AWS IAM Identity Center. You can create users and groups in IAM Identity Center, or you can connect and synchronize to a set of users and groups in your own identity source for use across all your AWS accounts and applications. For information about IAM Identity Center, see <a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html">What is IAM Identity Center?</a> in the <em>AWS IAM Identity Center User Guide</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="security-iam-authentication-iamuser">IAM users and groups</h5>
<div class="paragraph">
<p>An  <em><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html">IAM user</a></em> is an identity within your AWS account that has specific permissions for a single person or application. Where possible, we recommend relying on temporary credentials instead of creating IAM users who have long-term credentials such as passwords and access keys. However, if you have specific use cases that require long-term credentials with IAM users, we recommend that you rotate access keys. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#rotate-credentials">Rotate access keys regularly for use cases that require long-term credentials</a> in the <em>IAM User Guide</em>.</p>
</div>
<div class="paragraph">
<p>An <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html">IAM group</a> is an identity that specifies a collection of IAM users. You can&#8217;t sign in as a group. You can use groups to specify permissions for multiple users at a time. Groups make permissions easier to manage for large sets of users. For example, you could have a group named <em>IAMAdmins</em> and give that group permissions to administer IAM resources.</p>
</div>
<div class="paragraph">
<p>Users are different from roles. A user is uniquely associated with one person or application, but a role is intended to be assumable by anyone who needs it. Users have permanent long-term credentials, but roles provide temporary credentials. To learn more, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/gs-identities-iam-users.html">Use cases for IAM users</a> in the <em>IAM User Guide</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="security-iam-authentication-iamrole">IAM roles</h5>
<div class="paragraph">
<p>An  <em><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">IAM role</a></em> is an identity within your AWS account that has specific permissions. It&#8217;s similar to an IAM user, but isn&#8217;t associated with a specific person. You can temporarily assume an IAM role in the AWS Management Console by <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html">switching roles</a>. You can assume a role by calling an AWS CLI or AWS API operation or by using a custom URL. For more information about methods for using roles, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use.html">Using IAM roles</a> in the <em>IAM User Guide</em>.</p>
</div>
<div class="paragraph">
<p>IAM roles with temporary credentials are useful in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Federated user access</strong> – To assign permissions to a federated identity, you create a role and define permissions for the role. When a federated identity authenticates, the identity is associated with the role and is granted the permissions that are defined by the role. For information about roles for federation, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-idp.html">Create a role for a third-party identity provider (federation)</a> in the <em>IAM User Guide</em>. If you use IAM Identity Center, you configure a permission set. To control what your identities can access after they authenticate, IAM Identity Center correlates the permission set to a role in IAM. For information about permissions sets, see <a href="https://docs.aws.amazon.com/singlesignon/latest/userguide/permissionsetsconcept.html">Permission sets</a> in the <em>AWS IAM Identity Center User Guide</em>.</p>
</li>
<li>
<p><strong>Temporary IAM user permissions</strong> – An IAM user or role can assume an IAM role to temporarily take on different permissions for a specific task.</p>
</li>
<li>
<p><strong>Cross-account access</strong> – You can use an IAM role to allow someone (a trusted principal) in a different account to access resources in your account. Roles are the primary way to grant cross-account access. However, with some AWS services, you can attach a policy directly to a resource (instead of using a role as a proxy). To learn the difference between roles and resource-based policies for cross-account access, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_compare-resource-policies.html">How IAM roles differ from resource-based policies</a> in the <em>IAM User Guide</em>.</p>
</li>
<li>
<p><strong>Cross-service access</strong> – Some AWS services use features in other AWS services. For example, when you make a call in a service, it&#8217;s common for that service to run applications in Amazon EC2 or store objects in Amazon S3. A service might do this using the calling principal&#8217;s permissions, using a service role, or using a service-linked role.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Service role</strong> – A service role is an <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">IAM role</a> that a service assumes to perform actions on your behalf. An IAM administrator can create, modify, and delete a service role from within IAM. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html">Create a role to delegate permissions to an AWS service</a> in the <em>IAM User Guide</em>.</p>
</li>
<li>
<p><strong>Service-linked role</strong> – A service-linked role is a type of service role that is linked to an AWS service. The service can assume the role to perform an action on your behalf. Service-linked roles appear in your AWS account and are owned by the service. An IAM administrator can view, but not edit the permissions for service-linked roles.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Applications running on Amazon EC2</strong> – You can use an IAM role to manage temporary credentials for applications that are running on an EC2 instance and making AWS CLI or AWS API requests. This is preferable to storing access keys within the EC2 instance. To assign an AWS role to an EC2 instance and make it available to all of its applications, you create an instance profile that is attached to the instance. An instance profile contains the role and enables programs that are running on the EC2 instance to get temporary credentials. For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html">Use an IAM role to grant permissions to applications running on Amazon EC2 instances</a> in the <em>IAM User Guide</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To learn whether to use IAM roles or IAM users, see  <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html#id_which-to-choose_role">When to create an IAM role (instead of a user)</a> in the <em>IAM User Guide</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2 topic">
<h3 id="compliance-validation">22.2. Compliance validation for the AWS Cloud Development Kit (AWS CDK)</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Provides information about compliance validation for the AWS CDK.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS CDK follows the  <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">shared responsibility model</a> through the specific Amazon Web Services (AWS) services it supports. For AWS service security information, see the <a href="https://docs.aws.amazon.com/security/?id=docs_gateway#aws-security">AWS service security documentation page</a> and <a href="https://aws.amazon.com/compliance/services-in-scope/">AWS services that are in scope of AWS compliance efforts by compliance program</a>.</p>
</div>
<div class="paragraph">
<p>The security and compliance of AWS services is assessed by third-party auditors as part of multiple AWS compliance programs. These include SOC, PCI, FedRAMP, HIPAA, and others. AWS provides a frequently updated list of AWS services in scope of specific compliance programs at <a href="https://aws.amazon.com/compliance/services-in-scope/">AWS Services in Scope by Compliance Program</a>.</p>
</div>
<div class="paragraph">
<p>Third-party audit reports are available for you to download using AWS Artifact. For more information, see <a href="https://docs.aws.amazon.com/artifact/latest/ug/downloading-documents.html">Downloading Reports in AWS Artifact</a>.</p>
</div>
<div class="paragraph">
<p>For more information about AWS compliance programs, see <a href="https://aws.amazon.com/compliance/programs/">AWS Compliance Programs</a>.</p>
</div>
<div class="paragraph">
<p>Your compliance responsibility when using the AWS CDK to access an AWS service is determined by the sensitivity of your data, your organization&#8217;s compliance objectives, and applicable laws and regulations. If your use of an AWS service is subject to compliance with standards such as HIPAA, PCI, or FedRAMP, AWS provides resources to help:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/quickstart/?quickstart-all.sort-by=item.additionalFields.updateDate&amp;quickstart-all.sort-order=desc&amp;awsf.quickstart-homepage-filter=categories%23security-identity-compliance">Security and Compliance Quick Start Guides</a> – Deployment guides that discuss architectural considerations and provide steps for deploying security-focused and compliance-focused baseline environments on AWS.</p>
</li>
<li>
<p><a href="https://aws.amazon.com/compliance/resources/">AWS Compliance Resources</a> – A collection of workbooks and guides that might apply to your industry and location.</p>
</li>
<li>
<p><a href="https://aws.amazon.com/config/">AWS Config</a> – A service that assesses how well your resource configurations comply with internal practices, industry guidelines, and regulations.</p>
</li>
<li>
<p><a href="https://aws.amazon.com/security-hub/">AWS Security Hub</a> – A comprehensive view of your security state within AWS that helps you check your compliance with security industry standards and best practices.</p>
</li>
</ul>
</div>
</div>
<div class="sect2 topic">
<h3 id="disaster-recovery-resiliency">22.3. Resilience for the AWS Cloud Development Kit (AWS CDK)</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Provides information about resilience for the AWS CDK.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The Amazon Web Services (AWS) global infrastructure is built around AWS Regions and Availability Zones.</p>
</div>
<div class="paragraph">
<p>AWS Regions provide multiple physically separated and isolated Availability Zones, which are connected with low-latency, high-throughput, and highly redundant networking.</p>
</div>
<div class="paragraph">
<p>With Availability Zones, you can design and operate applications and databases that automatically fail over between Availability Zones without interruption. Availability Zones are more highly available, fault tolerant, and scalable than traditional single or multiple data center infrastructures.</p>
</div>
<div class="paragraph">
<p>For more information about AWS Regions and Availability Zones, see <a href="https://aws.amazon.com/about-aws/global-infrastructure/">AWS Global Infrastructure</a>.</p>
</div>
<div class="paragraph">
<p>The AWS CDK follows the <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">shared responsibility model</a> through the specific Amazon Web Services (AWS) services it supports. For AWS service security information, see the <a href="https://docs.aws.amazon.com/security/?id=docs_gateway#aws-security">AWS service security documentation page</a> and <a href="https://aws.amazon.com/compliance/services-in-scope/">AWS services that are in scope of AWS compliance efforts by compliance program</a>.</p>
</div>
</div>
<div class="sect2 topic">
<h3 id="infrastructure-security">22.4. Infrastructure security for the AWS Cloud Development Kit (AWS CDK)</h3>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Provides information about infrastructure security for the AWS CDK.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The AWS CDK follows the  <a href="https://aws.amazon.com/compliance/shared-responsibility-model/">shared responsibility model</a> through the specific Amazon Web Services (AWS) services it supports. For AWS service security information, see the <a href="https://docs.aws.amazon.com/security/?id=docs_gateway#aws-security">AWS service security documentation page</a> and <a href="https://aws.amazon.com/compliance/services-in-scope/">AWS services that are in scope of AWS compliance efforts by compliance program</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="troubleshooting">23. Troubleshooting common AWS CDK issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This topic describes how to troubleshoot the following issues with the AWS CDK.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#troubleshooting-toolkit">After updating the AWS CDK the AWS CDK Toolkit (CLI) reports a mismatch with the AWS Construct Library</a></p>
</li>
<li>
<p><a href="#troubleshooting-nobucket">When deploying my AWS CDK stack I receive a NoSuchBucket error</a></p>
</li>
<li>
<p><a href="#troubleshooting-forbidden-null">When deploying my AWS CDK stack I receive a forbidden: null message</a></p>
</li>
<li>
<p><a href="#troubleshooting-app-required">When synthesizing an AWS CDK stack I get the message --app is required either in command-line in cdk.json or in ~/.cdk.json</a></p>
</li>
<li>
<p><a href="#troubleshooting-resource-count">When synthesizing an AWS CDK stack I receive an error because the AWS CloudFormation template contains too many resources</a></p>
</li>
<li>
<p><a href="#troubleshooting-availability-zones">I specified three (or more) Availability Zones for my Auto Scaling group or VPC but it was only deployed in two</a></p>
</li>
<li>
<p><a href="#troubleshooting-resource-not-deleted">My S3 bucket DynamoDB table or other resource is not deleted when I issue cdk destroy</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">After updating the AWS CDK, the AWS CDK Toolkit (CLI) reports a mismatch with the AWS Construct Library</div>
<p>The version of the AWS CDK Toolkit (which provides the <code>cdk</code> command) must be at least equal to the version of the main AWS Construct Library module, <code>aws-cdk-lib</code>. The Toolkit is intended to be backward compatible. The latest 2.x version of the toolkit can be used with any 1.x or 2.x release of the library. For this reason, we recommend you install this component globally and keep it up to date.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm update -g aws-cdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to work with multiple versions of the AWS CDK Toolkit, install a specific version of the toolkit locally in your project folder.</p>
</div>
<div class="paragraph">
<p>If you are using TypeScript or JavaScript, your project directory already contains a versioned local copy of the CDK Toolkit.</p>
</div>
<div class="paragraph">
<p>If you are using another language, use <code>npm</code> to install the AWS CDK Toolkit, omitting the <code>-g</code> flag and specifying the desired version. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npm install aws-cdk@2.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a locally installed AWS CDK Toolkit, use the command  <code>npx aws-cdk</code> instead of only <code>cdk</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">npx aws-cdk deploy MyStack</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>npx aws-cdk</code> runs the local version of the AWS CDK Toolkit if one exists. It falls back to the global version when a project doesn&#8217;t have a local installation. You may find it convenient to set up a shell alias to make sure <code>cdk</code> is always invoked this way.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">macOS/Linux</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">alias cdk="npx aws-cdk"</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">doskey cdk=npx aws-cdk $*</code></pre>
</div>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)<a id="troubleshooting-nobucket"></a></p>
</div>
<div class="paragraph">
<div class="title">When deploying my AWS CDK stack, I receive a  <code>NoSuchBucket</code> error</div>
<p>Your AWS environment has not been bootstrapped, and so does not have an Amazon S3 bucket to hold resources during deployment. You can create the staging bucket and other required resources with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk bootstrap aws://ACCOUNT-NUMBER/REGION</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid generating unexpected AWS charges, the AWS CDK does not automatically bootstrap any environment. You must explicitly bootstrap each environment into which you will deploy.</p>
</div>
<div class="paragraph">
<p>By default, the bootstrap resources are created in the Region or Regions that are used by stacks in the current AWS CDK application. Alternatively, they are created in the Region specified in your local AWS profile (set by <code>aws configure</code>), using that profile&#8217;s account. You can specify a different account and Region on the command line as follows. (You must specify the account and Region if you are not in an app&#8217;s directory.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk bootstrap aws://ACCOUNT-NUMBER/REGION</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see  <a href="#bootstrapping">AWS CDK bootstrapping</a>.</p>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)<a id="troubleshooting-forbidden-null"></a></p>
</div>
<div class="paragraph">
<div class="title">When deploying my AWS CDK stack, I receive a  <code>forbidden: null</code> message</div>
<p>You are deploying a stack that requires bootstrap resources, but are using an IAM role or account that lacks permission to write to it. (The staging bucket is used when deploying stacks that contain assets or that synthesize an AWS CloudFormation template larger than 50K.) Use an account or role that has permission to perform the action <code>s3:*</code> against the bucket mentioned in the error message.</p>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)<a id="troubleshooting-app-required"></a></p>
</div>
<div class="paragraph">
<div class="title">When synthesizing an AWS CDK stack, I get the message  <code>--app is required either in command-line, in cdk.json or in ~/.cdk.json</code></div>
<p>This message usually means that you aren&#8217;t in the main directory of your AWS CDK project when you issue <code>cdk synth</code>. The file <code>cdk.json</code> in this directory, created by the <code>cdk init</code> command, contains the command line needed to run (and thereby synthesize) your AWS CDK app. For a TypeScript app, for example, the default <code>cdk.json</code> looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "app": "npx ts-node bin/my-cdk-app.ts"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend issuing  <code>cdk</code> commands only in your project&#8217;s main directory, so the AWS CDK toolkit can find <code class="path">cdk.json</code> there and successfully run your app.</p>
</div>
<div class="paragraph">
<p>If this isn&#8217;t practical for some reason, the AWS CDK Toolkit looks for the app&#8217;s command line in two other locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In <code class="path">cdk.json</code> in your home directory</p>
</li>
<li>
<p>On the <code>cdk synth</code> command itself using the <code>-a</code> option</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, you might synthesize a stack from a TypeScript app as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">cdk synth --app "npx ts-node my-cdk-app.ts" MyStack</code></pre>
</div>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)<a id="troubleshooting-resource-count"></a></p>
</div>
<div class="paragraph">
<div class="title">When synthesizing an AWS CDK stack, I receive an error because the AWS CloudFormation template contains too many resources</div>
<p>The AWS CDK generates and deploys AWS CloudFormation templates. AWS CloudFormation has a hard limit on the number of resources a stack can contain. With the AWS CDK, you can run up against this limit more quickly than you might expect.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The AWS CloudFormation resource limit is 500 at this writing. See  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cloudformation-limits.html">AWS CloudFormation quotas</a> for the current resource limit.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The AWS Construct Library&#8217;s higher-level, intent-based constructs automatically provision any auxiliary resources that are needed for logging, key management, authorization, and other purposes. For example, granting one resource access to another generates any IAM objects needed for the relevant services to communicate.</p>
</div>
<div class="paragraph">
<p>In our experience, real-world use of intent-based constructs results in 1–5 AWS CloudFormation resources per construct, though this can vary. For serverless applications, 5–8 AWS resources per API endpoint is typical.</p>
</div>
<div class="paragraph">
<p>Patterns, which represent a higher level of abstraction, let you define even more AWS resources with even less code. The AWS CDK code in <a href="#ecs-example">Example: Create an AWS Fargate service using the AWS CDK</a>, for example, generates more than 50 AWS CloudFormation resources while defining only three constructs!</p>
</div>
<div class="paragraph">
<p>Exceeding the AWS CloudFormation resource limit is an error during AWS CloudFormation synthesis. The AWS CDK issues a warning if your stack exceeds 80% of the limit. You can use a different limit by setting the <code>maxResources</code> property on your stack, or disable validation by setting <code>maxResources</code> to 0.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can get an exact count of the resources in your synthesized output using the following utility script. (Since every AWS CDK developer needs Node.js, the script is written in JavaScript.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// rescount.js - count the resources defined in a stack
// invoke with: node rescount.js &lt;path-to-stack-json&gt;
// e.g. node rescount.js cdk.out/MyStack.template.json

import * as fs from 'fs';
const path = process.argv[2];

if (path) fs.readFile(path, 'utf8', function(err, contents) {
  console.log(err ? `${err}` :
  `${Object.keys(JSON.parse(contents).Resources).length} resources defined in ${path}`);
}); else console.log("Please specify the path to the stack's output .json file");</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As your stack&#8217;s resource count approaches the limit, consider re-architecting to reduce the number of resources your stack contains: for example, by combining some Lambda functions, or by breaking your stack into multiple stacks. The CDK supports  <a href="#resource-stack">references between stacks</a>, so you can separate your app&#8217;s functionality into different stacks in whatever way makes the most sense to you.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>AWS CloudFormation experts often suggest the use of nested stacks as a solution to the resource limit. The AWS CDK supports this approach via the <a href="#stack-nesting">NestedStack</a> construct.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)<a id="troubleshooting-availability-zones"></a></p>
</div>
<div class="paragraph">
<div class="title">I specified three (or more) Availability Zones for my Auto Scaling group or VPC, but it was only deployed in two</div>
<p>To get the number of Availability Zones that you request, specify the account and Region in the stack&#8217;s <code>env</code> property. If you do not specify both, the AWS CDK, by default, synthesizes the stack as environment-agnostic. You can then deploy the stack to a specific Region using AWS CloudFormation. Because some Regions have only two Availability Zones, an environment-agnostic template doesn&#8217;t use more than two.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the past, Regions have occasionally launched with only one Availability Zone. Environment-agnostic AWS CDK stacks cannot be deployed to such Regions. At this writing, however, all AWS Regions have at least two AZs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can change this behavior by overriding your stack&#8217;s  <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.Stack.html#availabilityzones">availablilityZones</a> (Python: <code>availability_zones</code>) property to explicitly specify the zones that you want to use.</p>
</div>
<div class="paragraph">
<p>For more information about specifying a stack&#8217;s account and region at synthesis time, while retaining the flexibility to deploy to any region, see <a href="#environments">Environments for the AWS CDK</a>.</p>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)<a id="troubleshooting-resource-not-deleted"></a></p>
</div>
<div class="paragraph">
<div class="title">My S3 bucket, DynamoDB table, or other resource is not deleted when I issue  <code>cdk destroy</code></div>
<p>By default, resources that can contain user data have a <code>removalPolicy</code> (Python: <code>removal_policy</code>) property of <code>RETAIN</code>, and the resource is not deleted when the stack is destroyed. Instead, the resource is orphaned from the stack. You must then delete the resource manually after the stack is destroyed. Until you do, redeploying the stack fails. This is because the name of the new resource being created during deployment conflicts with the name of the orphaned resource.</p>
</div>
<div class="paragraph">
<p>If you set a resource&#8217;s removal policy to  <code>DESTROY</code>, that resource will be deleted when the stack is destroyed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TypeScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';

export class CdkTestStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const bucket = new s3.Bucket(this, 'Bucket', {
      removalPolicy: cdk.RemovalPolicy.DESTROY,
    });
  }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">JavaScript</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const cdk = require('aws-cdk-lib');
const s3 = require('aws-cdk-lib/aws-s3');

class CdkTestStack extends cdk.Stack {
  constructor(scope, id, props) {
    super(scope, id, props);

    const bucket = new s3.Bucket(this, 'Bucket', {
      removalPolicy: cdk.RemovalPolicy.DESTROY
    });
  }
}

module.exports = { CdkTestStack }</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Python</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import aws_cdk as cdk
from constructs import Construct
import aws_cdk.aws_s3 as s3

class CdkTestStack(cdk.stack):
    def __init__(self, scope: Construct, id: str, **kwargs):
        super().__init__(scope, id, **kwargs)

        bucket = s3.Bucket(self, "Bucket",
            removal_policy=cdk.RemovalPolicy.DESTROY)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">software.amazon.awscdk.*;
import software.amazon.awscdk.services.s3.*;
import software.constructs;

public class CdkTestStack extends Stack {
    public CdkTestStack(final Construct scope, final String id) {
        this(scope, id, null);
    }

    public CdkTestStack(final Construct scope, final String id, final StackProps props) {
        super(scope, id, props);

        Bucket.Builder.create(this, "Bucket")
                .removalPolicy(RemovalPolicy.DESTROY).build();
    }
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">C#</dt>
<dd>
<p>*</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-csharp" data-lang="csharp">using Amazon.CDK;
using Amazon.CDK.AWS.S3;

public CdkTestStack(Construct scope, string id, IStackProps props) : base(scope, id, props)
{
    new Bucket(this, "Bucket", new BucketProps {
        RemovalPolicy = RemovalPolicy.DESTROY
    });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>AWS CloudFormation cannot delete a non-empty Amazon S3 bucket. If you set an Amazon S3 bucket&#8217;s removal policy to  <code>DESTROY</code>, and it contains data, attempting to destroy the stack will fail because the bucket cannot be deleted. You can have the AWS CDK delete the objects in the bucket before attempting to destroy it by setting the bucket&#8217;s <code>autoDeleteObjects</code> prop to <code>true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>(<a href="#troubleshooting-top">back to list</a>)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pgp-keys">24. OpenPGP keys for the AWS CDK and jsii</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Current and historical OpenPGP keys for the AWS CDK and jsii.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This topic contains current and historical OpenPGP keys for the AWS CDK and jsii.</p>
</div>
<div class="sect2">
<h3 id="pgp-keys-current">24.1. Current keys</h3>
<div class="paragraph">
<p>These keys should be used to validate current releases of the AWS CDK and jsii.</p>
</div>
<div class="sect3">
<h4 id="cdk-pgp-key">24.1.1. AWS CDK OpenPGP key</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x42B9CF2286CD987A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096/4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2022-07-05</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expires:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2026-07-04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Cloud Development Kit &lt;<a href="mailto:aws-cdk@amazon.com">aws-cdk@amazon.com</a>&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key fingerprint:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">69B5 2D5B A295 1D11 FA65 413B 42B9 CF22 86CD 987A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the "Copy" icon to copy the following OpenPGP key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGLEgOsBEADCoAMwvnszMLybJ+AD9cHhVyX6+rYIUEXYSgVnfkl6Z7qawIwv
wgd/a5fEs9Kiz2XJmfwS9Rxb4d+0+Y1ls1A+gnpw9FMLcZlqkC9KLnS2MqvuXWLB
t3z4kjZaL9fQ+58PoD4gy/M2hDg6gZrYqR3gtJuw8FcFpb/1KlkzRQUM8eAMFxf2
TyfjP0V0tSHwcB+84oushX7fUXVMyc3+OHsCPOe/WBFMIlWgKA+n33JKIQlUUC8f
kCWBAsAFupil0lCveT6mZu5slNRlc1I3iBLjUZ3/MtLygfqAMKwUVXeawtDvRIZe
PrAFc2NyODEhly2JG6K0FW7eIcvBqR3rg8U49t9Y74ELTM0kKnfd+flvq35xWqQC
0zghnk3kDppRTN4zWBgTKiCMxBcsHXGOoGn57t4B9VY9Zy3vkeySigeiwl/Tw9nJ
PE0SRnwEc/HnjTTfX+GTG1aQVE0xSVyZ4m5ymRNCu6+rNH8lKwo5FujlXJ+GXPkp
qT+Lx6Ix/Ny7PaoweWxwtZUkLRS4pWUsg0yotZrGyIbS+X3yMEG8WBTFI9hf6HTq
0ryfi5/TsBrdrGKqWB99EC9xYEGgtHp4fKO5X0ynOagVOhf0jSe8t1uyuJPGb2Gc
MQagSys5xMhdG/ZnEY4Cb+JDtH/4jc3tca0+4Z5RQ7kF9IhCncFtrbjJbwARAQAB
tC5BV1MgQ2xvdWQgRGV2ZWxvcG1lbnQgS2l0IDxhd3MtY2RrQGFtYXpvbi5jb20+
iQI/BBMBAgApBQJixIDrAhsvBQkHhM4ABwsJCAcDAgEGFQgCCQoLBBYCAwECHgEC
F4AACgkQQrnPIobNmHo2qg//Zt9p/kN1DevflzxWKouUX0AS7UmUtRYXu5k/EEbu
wkYNHpUr7+lZ+Me5YyjcIpt6UwuG9cW4SvwuxIfXucyKAWiwEbydCQauvnrYDxDa
J6Yr/ntk7Sii6An9re99qic3IsvX+xlUXh+qJ/34ooP/1PHziCMqykvW/DwAIyhx
2qvTXy+9+OlOWSUbhkCnNz5XKb4XQGq73DqalZX1nH4dG6fckZmYRX+dpw2njfTw
ZLdZ7bkrfiL84FI4A21RfSbEU4s4ngiV17lZ9ivilBKTbDv3da7+yc919M7C5N4J
yrlxvtyYNDoqKAD2WYZAnpEbG/shu3f56RyOJd56tXGwl9nKPh+F9y+379XthSwA
xZTURFtjWf7wWHaDZadU0DKi+Oeeszjg2f/VJaGmmS8PIg7q6GiSHHpqHqNvACHm
ZXMw12QFd3qt3xu0JMmE11ZC5VBgblwpkQTrO04Sq1rOpJwXI9ODMS/ZEhAIoYmT
OR7ouknlAx6mj9fwpavWDAAJHLdVUMYBZTXiQYFzDvx51ivvTRWkB1zTJcFdqShY
B37+Jz2jLDNdMrcHk2yfVp/VvfbxKcexg8wEwrrtQUslTUenl5jBZJouoz/wW81s
Y4U1nCPCdTK5/C7JCKzR2gVnCpe6uaxAWkkM2feQhjqJZkTC4cFVgBT+4M6WcT1r
yq4=
=ahbs
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jsii-pgp-key">24.1.2. jsii OpenPGP key</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x056C4E15DAE3D8D9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096/4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2022-07-05</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expires:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2026-07-04</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS JSII Team &lt;<a href="mailto:aws-jsii@amazon.com">aws-jsii@amazon.com</a>&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key fingerprint:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E07 31D4 57E5 FE87 87E5 530A 056C 4E15 DAE3 D8D9</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the "Copy" icon to copy the following OpenPGP key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGLEgOkBEAD27EPVG9g2mHQ3+M6tF6le+tfhARJ2EV7m7NKIrTdSlCZATLWn
AVLlxG1unW34NlkKZbcbR86gAxRnnAhuEhPuloU/S5wAqPGbRiFl58YjYZDNJw6U
1SSMpE4O1sfjxv9yAbiRihLYtvksyHHZmaDhYner2aK1PdeWu+BKq/tjfm3Yzsd2
uuVEduJ72YoQk/29dEiGOHfT+2kUKxUX+0tJSJ9MGlEf4NtQE4WLzrT6Xqb2SG4+
alIiIVxIEi0XKDn7n8ZLjFwfJwOYxVYLtEUkqFWM8e8vgoc9/nYc+vDXZVED2g3Z
FWrwSnDSXbQpnMa2cLhD4xLpDHUS3i2p7r3dkJQGLo/5JGOopLibrOAbYZ72izhu
H/TuPFogSz0mNFPglrWdnLF04UIjIq420+06V4WQZC9n55Zjcbki/OhnC3B9pAdU
tiy8zg070bWq45dPGf5STkPPn7G8A2zmKefyO51iLIi26ZzW78siB+FvcGRhdg25
39sHJ1cmrTeC+B+k4KeV5sQ/m3UucimrZnk1xdaiVp8mWzRqWb8bB6Rs8K9RMrMV
tFBOKOBAT2QxOQtRGAantVgm193E1T1cmNpD0FKAKkDdPs64rKBEwFiHxccXHbah
eMd1weVwn3AKFD6uAm8ZRMV+dyssfcQxqpo/kfT1XpA6cQeOmGDOcKBfdwARAQAB
tCNBV1MgSlNJSSBUZWFtIDxhd3MtanNpaUBhbWF6b24uY29tPokCPwQTAQIAKQUC
YsSA6QIbLwUJB4TOAAcLCQgHAwIBBhUIAgkKCwQWAgMBAh4BAheAAAoJEAVsThXa
49jZjU4QANoyqOJUT4gRrXshE3N0mW5Ad4i8Ke09GA62HyvTtfbsA+2nkNVGJpXm
sFMzdaFO95Q65RkLS9vW4nhhjXBEc2XYNCt2AnARudA/41ykjDPwU112z9ZTB9he
y4ItIeNGpHvMWr51fihl0y2nkpODOBeiv44jscLbHyOmZfki1f5fuIu2U2IbUGK3
5FtYyeHcgRHnpYkzLuzK4PfayOywqQPJ7M9DWrHf+v5Cu4ZCZDOIKfzF+ew7MWwc
6KaoWHCYbFpX8jxFppbGsSFOQ8Sl2quoP0TLz9Wsq70Khi6C2P8JI6lm0HRLO+1M
jFbQxNOwAcN3k4HSwunAjXBlmT/6oc1RsdBdpXBaZ2AWseIXwSYZqNXp+5L179uZ
vSiD3DSSUqLJbdQRVOsJi3/87V5QU59byq2dToHveRjtSbVnK0TkTx9ZlgkcpjvM
BwHNqWhratV6af2Upjq2YQ0fdSB42f3pgopInxNJPMvlAb+cCfr0Pfwu7ge7UooQ
WHTxbpCvwtn/HNctMGpWscO02WsWgoYVjnVFay/XphE77pQ9rRUkhMe6VKXfxj/n
OCZJKrydluIIwR8vvONNqO+QwZ1xDEhO7MaSZlOm1AuUZIXFPgaWQkPZHKiiwFA/
QWnL/+shuRtMH2geTjkev198Jgb5HyXFm4SyYtZferQROyliEhik
=BuGv
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pgp-keys-expired">24.2. Historical keys</h3>
<div class="paragraph">
<p>These keys may be used to validate releases of the AWS CDK and jsii before 2022-07-05.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New keys are created before the previous ones expire. As a result, at any given moment in time, more than one key may be valid. Keys are used to sign artifacts starting the day they are created, so use the more recently-issued key where keys' validity overlaps.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cdk-pgp-key-2022-04-07-">24.2.1. AWS CDK OpenPGP key (2022-04-07)</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This key was not used to sign AWS CDK artifacts after 2022-07-05.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x015584281F44A3C3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096/4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2022-04-07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expires:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2026-04-06</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Cloud Development Kit &lt;<a href="mailto:aws-cdk@amazon.com">aws-cdk@amazon.com</a>&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key fingerprint:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAE1 1A24 82B0 AA86 456E 6C67 0155 8428 1F44 A3C3</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the "Copy" icon to copy the following OpenPGP key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGJPLgUBEADtlR5jQtxtBmROQvmWlPOViqqnJNhk0dULc3tXnq8NS/l6X81r
wHk+/CHG5kBunwvM0qaqLFRC6z9NnnNDxEHcTi47n+OAjWyDM6unxxWOPz8Dfaps
Uq/ZWa4by292ZeqRC9Ir2wdrizb69JbRjeshBwlJDAS/qtqCAqBRH/f7Zw7QSD6/
XTxyIy+KOVjZwFPFNHMRQ/NmgUc/Rfxsa0pUjk1YAj/AkvQlwwD8DEnASoBhO0DP
QonZxouLqIpgp4LsGo8TZdQv30ocIj0C9DuYUiUXWlCPlYPgDj6IWf3rgpMQ6nB9
wC9lx4t/L3Zg1HUD52y8aymndmbdHVn90mzlNg4XWyc58rioYrEk57YwbDnea/Kk
Hv4kVHZRfJ4/OFPyqs5ex1X3X6rb07VvA1tfLgPywO9XF2Xws8YWOWcEobaWTcnb
AzyVC6wKya8rEQzxkYJ6UkJlhDB6g6bZwIpsI2zlimG+kSBsyFvE2oRYMS0cXPqU
o+tX0+4TvxEyW3RrUQzQHIpqXrb0X1Q8Z2idPn5dwsipDEa4gsFXtrSXmbB/0Cee
eJVvKWQAsxol3+NE9L/yozq3cz5PWh0SSbmCLRcs78lMJ23MmzbMWV7BWC9DXdY+
TywY5IkDUPjGCKlD8VlrI3TgC222bH6qaua6LYCiTtRtvpDYuJNAlUjhawARAQAB
tC5BV1MgQ2xvdWQgRGV2ZWxvcG1lbnQgS2l0IDxhd3MtY2RrQGFtYXpvbi5jb20+
iQI/BBMBAgApBQJiTy4FAhsvBQkHhM4ABwsJCAcDAgEGFQgCCQoLBBYCAwECHgEC
F4AACgkQAVWEKB9Eo8NpbxAAiBF0kR/lVw3vuam60mk4l0iGMVsP8Xq6g/buzbEO
2MEB4Ftk04qOnoa+93S0ZiLR9PqxrwsGSp4ADDX3Vtc4uxwzUlKUi1ywEhQ1cwyL
YHQI3Hd75K1J81ozMEu6qJH+yF0TtTDZMeZHtH/XvuIYJW3Lx4o5ZFlsEegFPAgX
YCCpUS+k9qC6M8g2VjcltQJpyjGswsKm6FWaKHW+B9dfjdOHlImB9E2jaknJ8eoY
zb9zHgFANluMzpZ6rYVSiCuXiEgYmazQWCvlPcMOP7nX+1hq1z11LMqeSnfE09gX
H+OYho9cMEJkb1dzx1H9MRpylFIn9tL+2iCp4UPJjnqi6uawWyLZ2tp4G11haqQq
1yAh69u233I8GZKFUySzjHwH5qWGRgBTjrZ6FdcjSS2w/wMkVKuCPkWtdvo/TJrm
msCd1Reye8SEKYqrs0ujTwmlvWmUZmO06AdUjo1kWiBKeslTJrWEuG7Yk4pFOoA4
dsaq83gxpOJNVCh6M3y4DLNrvl7dhF95NwTWMROPj2otw7NIjF4/cdzve2+P7YNN
pVAtyCtTJdD3eZbQPVaL3T8cf1VGqt6++pnLGnWJ0+X3TyvfmTohdJvN3TE+tq7A
7cprDX/q9c56HaXdJzVpxEzuf/YC+JuYKeHwsX3QouDhyRg3PsigdZES/02Wr8so
l6U=
=MQI4
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jsii-pgp-key-2022-04-07">24.2.2. jsii OpenPGP key (2022-04-07)</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This key was not used to sign jsii artifacts after 2022-07-05.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x985F5BC974B79356</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096/4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2022-04-07</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expires:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2026-04-06</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS JSII Team &lt;<a href="mailto:aws-jsii@amazon.com">aws-jsii@amazon.com</a>&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key fingerprint:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35A7 1785 8FA6 282D C5AC CD95 985F 5BC9 74B7 9356</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the "Copy" icon to copy the following OpenPGP key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGJPLewBEADHH4TXup/gOlHrKDZRbj8MvsMTdM6eDteA6/c32UYV/YsK9rDA
jN8Jv/xlfosOebcHrfnFpHF9VTkmjuOpN695XdwMrW/NvlEPISTGEJf21x6ZTQ2r
1xWFYzC3sl3FZmvj9XAXTmygdv+XM3TqsFgZeCaBkZVdiLbQf+FhYrovUlgotb5D
YiCQI3ofV5QTE+141jhO5Pkd3ZIoBG+P826LaT8NXhwS0o1XqVk39DCZNoFshNmR
WFZpkVCTHyv5ZhVey1NWXnD8opO375htGNV4AeSmSIH9YkURD1g5F+2t7RiosKFo
kJrfPmUjhHn8IFpReGc8qmMMZX0WaV3t+VAWfOHGGyrXDfQ4xz1VCot75C2+qypM
+qhwOAOOP0zA7CfI96ULZzSH/j8HuQk3O0DsUCybpMuKEazEMxP3tgGtRerwDaFG
jQvAlK8Rbq3v8buBI6YJuXTwSzJE8KLjleUiTFumE6WP4rsAvlP/5rBvubeMfa3n
NIMm5Rkl36Z+jt3e2Z2ZqWDPpBRta8m7QHccrZhkvqu3YC3Gl6kdnm4Vio3Xfpg2
qtWhIQutQ6DmItewV+weQHas3hl88RPJtSrfWWIIMkpbF7Y4vbX9xcnsYCLlp2Mz
tWbbnU+EWATNSsufml/Kdnu9iEEuLmeovE11I69nwjNOq9P+GJ3r/FUb2wARAQAB
tCNBV1MgSlNJSSBUZWFtIDxhd3MtanNpaUBhbWF6b24uY29tPokCPwQTAQIAKQUC
Yk8t7AIbLwUJB4TOAAcLCQgHAwIBBhUIAgkKCwQWAgMBAh4BAheAAAoJEJhfW8l0
t5NWo64P/2y7gcMRylLLW/wbrCjton2O4+YRocwQxKm1cBml9FVDUR5967YczNuu
EwEOfH/Pu3UAlrBfKAfxPNhKchLwYiOBNh2Wk5UUxRcldNHTLb5jn5gxCeWNAsl/
Tc46qY+ObdBMdOf2Vu33UCOg83WLbg1bfBoA8Bm1cd0XObtLGucu606EBt1dBrKq
9UTcbJfuGivY2Xjy5r4kEiMHBoLKcFrSo2Mm7VtYlE4Mabjyj9+orqUio7qxOl60
aa7Psa6rMvs1Ip9IOrAdG7o5Y29tQpeINH0R1/u47BrlTEAgG63Dfy49w2h/1g0G
c9KPXVuN55OWRIu0hsiySDMk/2ERsF348TU3NURZltnCOxp6pHlbPJIxRVTNa9Cn
f8tbLB3y3HfA80516g+qwNYIYiqksDdV2bz+VbvmCWcO+FellDZli831gyMGa5JJ
rq7d0lEr6nqjcnKiVwItTQXyFYmKTAXweQtVC72g1sd3oZIyqa7T8pvhWpKXxoJV
WP+OPBhGg/JEVC9sguhuv53tzVwayrNwb54JxJsD2nemfhQm1Wyvb2bPTEaJ3mrv
mhPUvXZj/I9rgsEq3L/sm2Xjy09nra4o3oe3bhEL8nOj11wkIodi17VaGP0y+H3s
I5zB5UztS6dy+cH+J7DoRaxzVzq7qtH/ZY2quClt30wwqDHUX1ef
=+iYX
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cdk-pgp-key-2018-06-19-">24.2.3. AWS CDK OpenPGP key (2018-06-19)</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x0566A784E17F3870</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096/4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-06-19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expires:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2022-06-18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS CDK Team &lt;<a href="mailto:aws-cdk@amazon.com">aws-cdk@amazon.com</a>&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key fingerprint:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E88B E3B6 F0B1 E350 9E36 4F96 0566 A784 E17F 3870</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the "Copy" icon to copy the following OpenPGP key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFsovE8BEADEFVCHeAVPvoQgsjVu9FPUczxy9P+2zGIT/MLI3/vPLiULQwRy
IN2oxyBNDtcDToNa/fTkW3Ev0NTP4V1h+uBoKDZD/p+dTmSDRfByECMI0sGZ3UsG
Ohhyl2Of44s0sL8gdLtDnqSRLf+ZrfT3gpgUnplW7VitkwLxr78jDpW4QD8p8dZ9
WNm3JgB55jyPgaJKqA1Ln4Vduni/1XkrG42nxrrU71uUdZPvPZ2ELLJa6n0/raG8
jq3le+xQh45gAIs6PGaAgy7jAsfbwkGTBHjjujITAY1DwvQH5iS31OaCM9n4JNpc
xGZeJAVYTLilznf2QtS/a50t+ZOmpq67Ssp2j6qYpiumm0Lo9q3K/R4/yF0FZ8SL
1TuNX0ecXEptiMVUfTiqrLsANg18EPtLZZOYW+ZkbcVytkDpiqj7bMwA7mI7zGCJ
1gjaTbcEmOmVdQYS1G6ZptwbTtvrgA6AfnZxX1HUxLRQ7tT/wvRtABfbQKAh85Ff
a3U9W4oC3c1MP5IyhNV1Wo8Zm0flZiZc0iZnojTtSG6UbcxNNL4Q8e08FWjhungj
yxSsIBnQO1Aeo1N4BbzlI+n9iaXVDUN7Kz1QEyS4PNpjvUyrUiQ+a9C5sRA7WP+x
IEOaBBGpoAXB3oLsdTNO6AcwcDd9+r2NlXlhWC4/uH2YHQUIegPqHmPWxwARAQAB
tCFBV1MgQ0RLIFRlYW0gPGF3cy1jZGtAYW1hem9uLmNvbT6JAj8EEwEIACkFAlso
vE8CGy8FCQeEzgAHCwkIBwMCAQYVCAIJCgsEFgIDAQIeAQIXgAAKCRAFZqeE4X84
cLGxD/0XHnhoR2xvz38GM8HQlwlZy9W1wVhQKmNDQUavw8Zx7+iRR3m7nq3xM7Qq
BDbcbKSg1lVLSBQ6H2V6vRpysOhkPSH1nN2dO8DtvSKIPcxK48+1x7lmO+ksSs/+
oo1UvOmTDaRzOitYh3kOGXHHXk/l11GtF2FGQzYssX5iM4PHcjBsK1unThs56IMh
OJeZezEYzBaskTu/ytRJ236bPP2kZIEXfzAvhmTytuXWUXEftxOxc6fIAcYiKTha
aofG7WyR+Fvb1j5gNLcbY552QMxa23NZd5cSZH7468WEW1SGJ3AdLA7k5xvsPPOC
2YvQFD+vUOZ1JJuu6B5rHkiEMhRTLklkvqXEShTxuXiCp7iTOo6TBCmrWAT4eQr7
htLmqlXrgKi8qPkWmRdXXG+MQBzI/UyZq2q8KC6cx2md1PhANmeefhiM7FZZfeNM
WLonWfh8gVCsNH5h8WJ9fxsQCADd3Xxx3NelS2zDYBPRoaqZEEBbgUP6LnWFprA2
EkSlc/RoDqZCpBGgcoy1FFWvV/ZLgNU6OTQlYH6oYOWiylSJnaTDyurrktsxJI6d
4gdsFb6tqwTGecuUPvvZaEuvhWExLxAebhu780FdAPXgVTX+YCLI2zf+dWQvkFQf
80RE7ayn7BsiaLzFBVux/zz/WgvudsZX18r8tDiVQBL51ORmqw==
=0wuQ
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jsii-pgp-key-2018-08-06">24.2.4. jsii OpenPGP key (2018-08-06)</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x1C7ACE4CB2A1B93A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096/4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-08-06</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expires:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2022-08-05</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User ID:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS JSII Team &lt;<a href="mailto:aws-jsii@amazon.com">aws-jsii@amazon.com</a>&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key fingerprint:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">85EF 6522 4CE2 1E8C 72DB 28EC 1C7A CE4C B2A1 B93A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Select the "Copy" icon to copy the following OpenPGP key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFtoSs0BEAD6WweLD0B26h0F7Jo9iR6tVQ4PgQBK1Va5H/eP+A2Iqw79UyxZ
WNzHYhzQ5MjYYI1SgcPavXy5/LV1N8HJ7QzyKszybnLYpNTLPYArWE8ZM9ZmjvIR
p1GzwnVBGQfoOlxyeutE9T5ZkAn45dTS5jlno4unji4gHjnwXKf2nP1APU2CZfdK
8vDpLOgj9LeeGlerYNbx+7xtY/I+csFIQvK09FPLSNMJQLlkBhY0r6Rt9ZQG+653
tJn+AUjyM237w0UIX1IqyYc5IONXu8HklPGu0NYuX9AY/63Ak2Cyfj0w/PZlvueQ
noQNM3j0nkOEsTOEXCyaLQw9iBKpxvLnm5RjMSODDCkj8c9uu0LHr7J4EOtgt2S1
pem7Y/c/N+/Z+Ksg9fP8fVTfYwRPvdI1x2sCiRDfLoQSG9tdrN5VwPFi4sGV04sI
x7Al8Vf/OBjAGZrDaJgM/gVvb9SKAQUA6t3ofeP14gDrS0eYodEXZ+lamnxFglxF
Sn8NRC4JFNmkXSUaTNGUdFf//F0D69PRNT8CnFfmniGj0CphN5037PCA2LC/Buq2
3+K6mTPkCcCHYPC/SwItp/xIDAQsGuDc1i1SfDYXrjsK7uOuwC5jLA9X6wZ/jgXQ
4umRRJBAV1aW8b1+yfaYYCO2AfXXO6caObv8IvH7Pc4leC2DoqylD3KklQARAQAB
tCNBV1MgSlNJSSBUZWFtIDxhd3MtanNpaUBhbWF6b24uY29tPokCPwQTAQgAKQUC
W2hKzQIbLwUJB4TOAAcLCQgHAwIBBhUIAgkKCwQWAgMBAh4BAheAAAoJEBx6zkyy
obk6B34P/iNb5QjKyhT0glZiq1wK7tuDDRpR6fC/sp6Jd/GhaNjO4BzlDbUPSjW5
950VT+qwaHXbIma/QVP7EIRztfwWy7m8eOodjpiu7JyJprhwG9nocXiNsLADcMoH
BvabkDRWXWIWSurq2wbcFMlTVwxjHPIQs6kt2oojpzP985CDS/KTzyjow6/gfMim
DLdhSSbDUM34STEgew79L2sQzL7cvM/N59k+AGyEMHZDXHkEw/Bge5Ovz50YOnsp
lisH4BzPRIw7uWqPlkVPzJKwMuo2WvMjDfgbYLbyjfvs5mqDxT2GTwAx/rd2taU6
iSqP0QmLM54BtTVVdoVXZSmJyTmXAAGlITq8ECZ/coUW9K2pUSgVuWyu63lktFP6
MyCQYRmXPh9aSd4+ielteXM9Y39snlyLgEJBhMxioZXVO2oszwluPuhPoAp4ekwj
/umVsBf6As6PoAchg7Qzr+lRZGmV9YTJOgDn2Z7jf/7tOes0g/mdiXTQMSGtp/Fp
ggnifTBx3iXkrQhqHlwtam8XTHGHy3MvX17ZslNuB8Pjh+07hhCxv0VUVZPUHJqJ
ZsLa398LMteQ8UMxwJ3t06jwDWAd7mbr2tatIilLHtWWBFoCwBh1XLe/03ENCpDp
njZ7OsBsBK2nVVcN0H2v5ey0T1yE93o6r7xOwCwBiVp5skTCRUob
=2Tag
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 topic">
<h2 id="doc-history">25. AWS CDK Developer Guide history</h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>AWS CDK Developer Guide history</p>
</div>
</blockquote>
</div>
<div class="sect2 updates">
<h3 id="unknown-title">25.1. Unknown Title!</h3>
<div class="sect3 update">
<h4 id="document-bootstrap-template-versions-v26-and-v27">25.1.1. Document bootstrap template versions v26 and v27</h4>
<div class="paragraph">
<p>For more information, see  <a href="https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping-env.html#bootstrap-template-history">Bootstrap template version history</a>.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="add-documentation-for-building-and-deploying-container-image-assets">25.1.2. Add documentation for building and deploying container image assets</h4>
<div class="paragraph">
<p>When you build container image assets with the AWS CDK,  <code class="noloc">Docker</code> is utilized by default to perform these actions. If you want to use a different container management tool, you can replace  <code class="noloc">Docker</code>. For more information, see  <a href="https://docs.aws.amazon.com/cdk/v2/guide/build-containers.html">Build and deploy container image assets in CDK apps</a>.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="add-documentation-for-cdk-migrate-feature">25.1.3. Add documentation for CDK Migrate feature</h4>
<div class="paragraph">
<p>Use the AWS CDK  <code class="noloc">CLI</code><code>cdk migrate</code> command to migrate deployed AWS resources, deployed AWS CloudFormation stacks, and local AWS CloudFormation templates to AWS CDK. For more information, see <a href="https://docs.aws.amazon.com/cdk/v2/guide/migrate.html">Migrate to AWS CDK</a>.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="iam-best-practices-updates">25.1.4. IAM best practices updates</h4>
<div class="paragraph">
<p>Updated guide to align with the IAM best practices. For more information, see  <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html">Security best practices in IAM</a>.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="document-cdk-json">25.1.5. Document  <code class="path">cdk.json</code></h4>
<div class="paragraph">
<p>Add documentation of  <code class="path">cdk.json</code> configuration values.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="dependency-management">25.1.6. Dependency management</h4>
<div class="paragraph">
<p>Add topic on managing dependencies with the AWS CDK.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="remove-double-braces-from-java-examples">25.1.7. Remove double-braces from Java examples</h4>
<div class="paragraph">
<p>Replace this anti-pattern with Java 9  <code>Map.of</code> throughout.</p>
</div>
</div>
<div class="sect3 update">
<h4 id="aws-cdk-v2-release">25.1.8. AWS CDK v2 release</h4>
<div class="paragraph">
<p>Version 2 of the AWS CDK Developer Guide is released.  <a href="../../v1/guide/doc-history.html">Document history</a> for CDK v1.</p>
</div>
<div class="paragraph">
<p>See  <a href="https://github.com/awslabs/aws-cdk/releases">Releases</a> for information about AWS CDK releases. The AWS CDK is updated approximately once a week. Maintenance versions may be released between weekly releases to address critical issues. Each release includes a matched AWS CDK Toolkit (CDK CLI), AWS Construct Library, and API Reference. Updates to this Guide generally do not synchronize with AWS CDK releases.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The table below represents significant documentation milestones. We fix errors and improve content on an ongoing basis.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-04-24 18:35:51 UTC
</div>
</div>
</body>
</html>